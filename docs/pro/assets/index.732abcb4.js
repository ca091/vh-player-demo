var Pf=Object.defineProperty,Ff=Object.defineProperties;var Df=Object.getOwnPropertyDescriptors;var Po=Object.getOwnPropertySymbols;var Cf=Object.prototype.hasOwnProperty,Of=Object.prototype.propertyIsEnumerable;var An=(le,J,Z)=>J in le?Pf(le,J,{enumerable:!0,configurable:!0,writable:!0,value:Z}):le[J]=Z,ve=(le,J)=>{for(var Z in J||(J={}))Cf.call(J,Z)&&An(le,Z,J[Z]);if(Po)for(var Z of Po(J))Of.call(J,Z)&&An(le,Z,J[Z]);return le},bt=(le,J)=>Ff(le,Df(J));var m=(le,J,Z)=>(An(le,typeof J!="symbol"?J+"":J,Z),Z);var __vite_style__=document.createElement("style");__vite_style__.innerHTML=`h1,h2,h3,h4,p{margin:0}section{padding-bottom:8px;border-bottom:1px solid #ccc}section+section{margin-top:8px}.player{position:relative;height:56.25vw;background-color:#0000001a}.mask{position:absolute;width:100%;top:0;left:0;bottom:0;z-index:2;color:#fff;background-color:#00000080;display:none}.mask-capture>img{height:80%}#url{width:90%}#log{height:300px;overflow:scroll;border:1px solid}#mask-all{position:fixed;left:0;right:0;top:0;bottom:0;z-index:999;background:rgba(0,0,0,.5)}:-webkit-full-screen video,:fullscreen video{position:absolute;width:100%;height:100%}.barrage-root{position:absolute;left:0;right:0;top:0;bottom:0;z-index:3;overflow:hidden}.barrage-root .barrage-item{padding:0 6px;position:absolute;left:100%;z-index:4;will-change:transform;cursor:pointer;font-size:14px;color:#fff;white-space:nowrap;border:none}.barrage-root .barrage-item img{max-height:120px}.marquee-root{position:absolute;left:0;right:0;top:0;bottom:0;z-index:2;overflow:hidden}.marquee-root .marquee{position:absolute;white-space:nowrap;user-select:none;font-size:18px;color:#ff8d41}@font-face{font-family:iconfont-player;src:url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.eot?t=1644487605199);src:url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.eot?t=1644487605199#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.woff2?t=1644487605199) format("woff2"),url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.woff?t=1644487605199) format("woff"),url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.ttf?t=1644487605199) format("truetype"),url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.svg?t=1644487605199#iconfont-player) format("svg")}.iconfont-player{font-family:iconfont-player!important;font-size:18px;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-player-Loading:before{content:"\\e65d"}.icon-player-danmukaiqi:before{content:"\\e613"}.icon-player-danmuguanbi:before{content:"\\e614"}.icon-player-reload:before{content:"\\e602"}.icon-player-diandiandian:before{content:"\\e8f5"}.icon-player-bofang:before{content:"\\e61c"}.icon-player-bofangzanting:before{content:"\\e61d"}.icon-player-jingyin:before{content:"\\e61e"}.icon-player-shengyin:before{content:"\\e62c"}.icon-player-quanping:before{content:"\\e646"}.icon-player-quanping1:before{content:"\\e672"}@supports ((--a: 0)){.player-loading-wrapper,.player-control-wrapper{--colorMain: #3967FF;--colorBg: rgba(0,0,0,.8);--colorBgBar: #eee;--colorFont: #fff;--colorPoint: #fff;--colorSuccess: #54b946;--margin: 12px;--padding: 8px;--paddingVol: 10px;--borderRadius: 4px}}.player-loading-wrapper,.player-control-wrapper{position:absolute;left:0;right:0;bottom:0;z-index:5}.player-loading-wrapper{top:0;display:flex;align-items:center;justify-content:center}.player-loading-wrapper.hide{display:none}.player-control-wrapper{font-size:14px;color:var(--colorFont);background:linear-gradient(0deg,black,transparent);display:none;user-select:none}.player-control-wrapper.active{display:block}.player-control-wrapper *{box-sizing:content-box!important}.player-control-wrapper .hide{display:none}.player-control-wrapper ul{margin:0;padding:4px var(--padding);position:absolute;z-index:9;list-style:none;border-radius:var(--borderRadius);background-color:var(--colorBg)}.player-control-wrapper ul.active{display:block}.player-control-wrapper li{line-height:1.6;cursor:pointer}.player-control-wrapper li.active{color:var(--colorMain)}.player-control-wrapper.is-live .tools-wrapper{padding:var(--padding)}.player-control-wrapper .tools-wrapper{padding:0 var(--padding) 2px;justify-content:space-between}.player-control-wrapper .bar-wrapper{flex:1;margin:0 8px;padding:8px 0;overflow:hidden}.player-control-wrapper .tools-wrapper,.player-control-wrapper .tools-wrapper-left,.player-control-wrapper .tools-wrapper-right{display:flex;align-items:center}.icon-player-bofang,.icon-player-bofangzanting,.icon-player-shengyin,.icon-player-jingyin{font-weight:700}.icon-player-Loading{font-size:28px;color:var(--colorMain);animation:loading-circle 1.3s linear infinite}.icon-player-danmukaiqi,.icon-player-danmuguanbi{font-size:24px}.icon-player-danmukaiqi{color:var(--colorSuccess)}.player-control-wrapper .ui-reload-root,.player-control-wrapper .ui-play-root,.player-control-wrapper .ui-barrage-root,.player-control-wrapper .ui-volume-root,.player-control-wrapper .ui-fullscreen-root{margin-right:var(--margin)}.player-control-wrapper .ui-duration-root{min-width:94px}.player-control-wrapper .bar-root{height:4px;position:relative;background-color:var(--colorBgBar);cursor:pointer}.player-control-wrapper .bar-root .bar{position:absolute;top:0;left:0;width:100%;height:100%;transform:translate(-100%)}.player-control-wrapper .bar-root .pos{position:absolute;top:50%;left:-8px;z-index:8;width:8px;height:8px;border-radius:50%;background-color:var(--colorPoint);border:4px solid var(--colorMain);transform:translateY(-50%)}.player-control-wrapper .bar-root .bar.bar-current{background-color:var(--colorMain);z-index:7}.player-control-wrapper .bar-root .bar.bar-buffered{background-color:#999;z-index:6}.player-control-wrapper .ui-volume-root{position:relative}.player-control-wrapper .volume-slider,.player-control-wrapper .slider-root{position:absolute;width:4px}.player-control-wrapper .volume-slider{padding:var(--paddingVol);left:0;bottom:26px;z-index:9;height:70px;display:none;border-radius:var(--borderRadius);background-color:var(--colorBg)}.player-control-wrapper .volume-slider.active{display:block}.player-control-wrapper .slider-root{left:var(--paddingVol);top:var(--paddingVol);bottom:var(--paddingVol);border-radius:var(--borderRadius);overflow:hidden;cursor:pointer;background-color:var(--colorBgBar)}.player-control-wrapper .slider-root .slider{position:absolute;left:0;top:0;width:100%;height:100%;transform:translateY(100%);background-color:var(--colorMain)}.player-control-wrapper .volume-slider .pos{position:absolute;left:calc(var(--paddingVol) - 2px);bottom:calc(var(--paddingVol) - 4px);width:8px;height:8px;border-radius:50%;transform:translateY(0);cursor:pointer;background-color:var(--colorPoint)}.player-control-wrapper .ui-setting-root{position:relative}.player-control-wrapper .setting-content2,.player-control-wrapper .setting-content{bottom:26px;text-align:center;display:none}.player-control-wrapper .setting-content{right:0;width:50px}.player-control-wrapper .setting-content2{right:68px;width:66px}video::cue{color:#fff;background:none;text-shadow:0 1px #000,1px 0 #000,-1px 0 #000,0 -1px #000}@keyframes loading-circle{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (any-hover: hover){.iconfont-player:hover{color:var(--colorMain);cursor:pointer}.player-control-wrapper li:hover{color:var(--colorMain)}}
`;document.head.appendChild(__vite_style__);(function(le,J,Z){"use strict";function Pn(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var ce=Pn(le),ue=Pn(J);const If=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}};var Rf="";const k=document.querySelector.bind(document);function j(n="div",e={},t={}){const i=document.createElement(n);return Object.getOwnPropertyNames(e).forEach(r=>{i[r]=e[r]}),Object.getOwnPropertyNames(t).forEach(r=>{i.setAttribute(r,t[r])}),i}function Fn(n){return typeof n=="string"?k(n):n}function Dn(n,e){return new Promise((t,i)=>{if(document.getElementById(n))t(!0);else{let r=document.createElement("script");r.setAttribute("id",n),r.setAttribute("src",e),document.head.appendChild(r),r.onload=()=>t(!0),r.onerror=()=>i(Error("network error")),setTimeout(()=>{i(Error("timeout"))},1e4)}})}function Cn(){const n={transition:"transitionend",WebkitTransition:"webkitTransitionEnd"};let e=document.createElement("div"),t=Object.keys(n);for(let i of t)if(e.style[i]!==void 0)return{css:i,event:n[i]};return!1}const On=window.WebKitCSSMatrix||window.DOMMatrix||window.MSCSSMatrix;function In(n){const e=window.getComputedStyle(n,null).getPropertyValue("transform");return Number(On?new On(e).m41:e.match(/[+-]?\d+/g)[4])}function Fo(){if(typeof document.hidden!="undefined")return["hidden","visibilitychange","visibilityState"];if("webkitHidden"in document)return["webkitHidden","webkitvisibilitychange","webkitVisibilityState"]}function Rn(n,e){let t=Fo();!t||document.addEventListener(t[1],function(){document[t[2]]==="visible"?n&&n():e&&e()},!1)}function Gi(n,e,t){const i="ontouchend"in document,r={down:{t:"touchstart",f:"mousedown"},move:{t:"touchmove",f:"mousemove"},up:{t:"touchend",f:"mouseup"}};let a=n.getBoundingClientRect(),s=i?r[e].t:r[e].f;n.addEventListener(s,o=>{i&&Do(s,o),t(o,a.x)})}function Do(n,e){n==="touchend"?e.clientX=e.changedTouches[0].clientX:e.clientX=e.touches[0].clientX}var qi=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Co(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var i=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:function(){return n[t]}})}),e}var Wi={},Xi={},zt={};Object.defineProperty(zt,"__esModule",{value:!0});var Oo=function(n){if("getBBox"in n){var e=n.getBBox();return Object.freeze({height:e.height,left:0,top:0,width:e.width})}else{var t=window.getComputedStyle(n);return Object.freeze({height:parseFloat(t.height||"0"),left:parseFloat(t.paddingLeft||"0"),top:parseFloat(t.paddingTop||"0"),width:parseFloat(t.width||"0")})}};zt.ContentRect=Oo,Object.defineProperty(Xi,"__esModule",{value:!0});var Io=zt,Ro=function(){function n(e){this.target=e,this.$$broadcastWidth=this.$$broadcastHeight=0}return Object.defineProperty(n.prototype,"broadcastWidth",{get:function(){return this.$$broadcastWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"broadcastHeight",{get:function(){return this.$$broadcastHeight},enumerable:!0,configurable:!0}),n.prototype.isActive=function(){var e=Io.ContentRect(this.target);return!!e&&(e.width!==this.broadcastWidth||e.height!==this.broadcastHeight)},n}();Xi.ResizeObservation=Ro;var Yi={};Object.defineProperty(Yi,"__esModule",{value:!0});var Lo=zt,Mo=function(){function n(e){this.target=e,this.contentRect=Lo.ContentRect(e)}return n}();Yi.ResizeObserverEntry=Mo,Object.defineProperty(Wi,"__esModule",{value:!0});var Uo=Xi,ko=Yi,Oe=[],Ln=function(){function n(e){this.$$observationTargets=[],this.$$activeTargets=[],this.$$skippedTargets=[];var t=Bo(e);if(t)throw TypeError(t);this.$$callback=e}return n.prototype.observe=function(e){var t=Un("observe",e);if(t)throw TypeError(t);var i=kn(this.$$observationTargets,e);i>=0||(this.$$observationTargets.push(new Uo.ResizeObservation(e)),No(this))},n.prototype.unobserve=function(e){var t=Un("unobserve",e);if(t)throw TypeError(t);var i=kn(this.$$observationTargets,e);i<0||(this.$$observationTargets.splice(i,1),this.$$observationTargets.length===0&&Mn(this))},n.prototype.disconnect=function(){this.$$observationTargets=[],this.$$activeTargets=[],Mn(this)},n}();Wi.ResizeObserver=Ln;function No(n){var e=Oe.indexOf(n);e<0&&(Oe.push(n),qo())}function Mn(n){var e=Oe.indexOf(n);e>=0&&(Oe.splice(e,1),Wo())}function Bo(n){if(typeof n=="undefined")return"Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.";if(typeof n!="function")return"Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function."}function Un(n,e){if(typeof e=="undefined")return"Failed to execute '"+n+"' on 'ResizeObserver': 1 argument required, but only 0 present.";if(!(e&&e.nodeType===window.Node.ELEMENT_NODE))return"Failed to execute '"+n+"' on 'ResizeObserver': parameter 1 is not of type 'Element'."}function kn(n,e){for(var t=0;t<n.length;t+=1)if(n[t].target===e)return t;return-1}var Nn=function(n){Oe.forEach(function(e){e.$$activeTargets=[],e.$$skippedTargets=[],e.$$observationTargets.forEach(function(t){if(t.isActive()){var i=Bn(t.target);i>n?e.$$activeTargets.push(t):e.$$skippedTargets.push(t)}})})},$o=function(){return Oe.some(function(n){return!!n.$$activeTargets.length})},Vo=function(){return Oe.some(function(n){return!!n.$$skippedTargets.length})},Ho=function(){var n=1/0;return Oe.forEach(function(e){if(!!e.$$activeTargets.length){var t=[];e.$$activeTargets.forEach(function(i){var r=new ko.ResizeObserverEntry(i.target);t.push(r),i.$$broadcastWidth=r.contentRect.width,i.$$broadcastHeight=r.contentRect.height;var a=Bn(i.target);a<n&&(n=a)}),e.$$callback(t,e),e.$$activeTargets=[]}}),n},zo=function(){var n=new window.ErrorEvent("ResizeLoopError",{message:"ResizeObserver loop completed with undelivered notifications."});window.dispatchEvent(n)},Bn=function(n){for(var e=0;n.parentNode;)n=n.parentNode,e+=1;return e},Go=function(){var n=0;for(Nn(n);$o();)n=Ho(),Nn(n);Vo()&&zo()},St,qo=function(){St||$n()},$n=function(){St=window.requestAnimationFrame(function(){Go(),$n()})},Wo=function(){St&&!Oe.some(function(n){return!!n.$$observationTargets.length})&&(window.cancelAnimationFrame(St),St=void 0)},Xo=function(){return window.ResizeObserver=Ln},Yo=Wi.install=Xo,ji={exports:{}};(function(n,e){(function(t,i){var r="0.7.31",a="",s="?",o="function",l="undefined",u="object",h="string",d="major",c="model",y="name",p="type",g="vendor",f="version",E="architecture",_="console",S="mobile",w="tablet",A="smarttv",N="wearable",z="embedded",b=255,I="Amazon",v="Apple",C="ASUS",P="BlackBerry",D="Browser",ae="Chrome",Bt="Edge",De="Firefox",Ye="Google",vo="Huawei",xn="LG",bn="Microsoft",xo="Motorola",$i="Opera",Sn="Samsung",Tn="Sony",bo="Xiaomi",wn="Zebra",So="Facebook",Ef=function(R,H){var L={};for(var Y in R)H[Y]&&H[Y].length%2===0?L[Y]=H[Y].concat(R[Y]):L[Y]=R[Y];return L},Vi=function(R){for(var H={},L=0;L<R.length;L++)H[R[L].toUpperCase()]=R[L];return H},To=function(R,H){return typeof R===h?$t(H).indexOf($t(R))!==-1:!1},$t=function(R){return R.toLowerCase()},_f=function(R){return typeof R===h?R.replace(/[^\d\.]/g,a).split(".")[0]:i},En=function(R,H){if(typeof R===h)return R=R.replace(/^\s\s*/,a).replace(/\s\s*$/,a),typeof H===l?R:R.substring(0,b)},Vt=function(R,H){for(var L=0,Y,U,zi,W,Ht,Ce;L<H.length&&!Ht;){var _o=H[L],Ao=H[L+1];for(Y=U=0;Y<_o.length&&!Ht;)if(Ht=_o[Y++].exec(R),Ht)for(zi=0;zi<Ao.length;zi++)Ce=Ht[++U],W=Ao[zi],typeof W===u&&W.length>0?W.length===2?typeof W[1]==o?this[W[0]]=W[1].call(this,Ce):this[W[0]]=W[1]:W.length===3?typeof W[1]===o&&!(W[1].exec&&W[1].test)?this[W[0]]=Ce?W[1].call(this,Ce,W[2]):i:this[W[0]]=Ce?Ce.replace(W[1],W[2]):i:W.length===4&&(this[W[0]]=Ce?W[3].call(this,Ce.replace(W[1],W[2])):i):this[W]=Ce||i;L+=2}},_n=function(R,H){for(var L in H)if(typeof H[L]===u&&H[L].length>0){for(var Y=0;Y<H[L].length;Y++)if(To(H[L][Y],R))return L===s?i:L}else if(To(H[L],R))return L===s?i:L;return R},Af={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},wo={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0","2000":"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0","7":"NT 6.1","8":"NT 6.2","8.1":"NT 6.3","10":["NT 6.4","NT 10.0"],RT:"ARM"},Eo={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[y,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,f],[/opios[\/ ]+([\w\.]+)/i],[f,[y,$i+" Mini"]],[/\bopr\/([\w\.]+)/i],[f,[y,$i]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[y,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[y,"UC"+D]],[/\bqbcore\/([\w\.]+)/i],[f,[y,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[y,"IE"]],[/yabrowser\/([\w\.]+)/i],[f,[y,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure "+D],f],[/\bfocus\/([\w\.]+)/i],[f,[y,De+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[y,$i+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[y,$i+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[y,"MIUI "+D]],[/fxios\/([-\w\.]+)/i],[f,[y,De]],[/\bqihu|(qi?ho?o?|360)browser/i],[[y,"360 "+D]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1 "+D],f],[/(comodo_dragon)\/([\w\.]+)/i],[[y,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[y,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,So],f],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[y,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[y,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[y,ae+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,ae+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[y,"Android "+D]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,f],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[f,[y,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[f,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[f,_n,Af]],[/(webkit|khtml)\/([\w\.]+)/i],[y,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[y,De+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[y,f]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[E,"amd64"]],[/(ia32(?=;))/i],[[E,$t]],[/((?:i[346]|x)86)[;\)]/i],[[E,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[E,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[E,"armhf"]],[/windows (ce|mobile); ppc;/i],[[E,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[E,/ower/,a,$t]],[/(sun4\w)[;\)]/i],[[E,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[E,$t]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[g,Sn],[p,w]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[c,[g,Sn],[p,S]],[/\((ip(?:hone|od)[\w ]*);/i],[c,[g,v],[p,S]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[g,v],[p,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[g,vo],[p,w]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[c,[g,vo],[p,S]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[c,/_/g," "],[g,bo],[p,S]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[g,bo],[p,w]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[g,"OPPO"],[p,S]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[g,"Vivo"],[p,S]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[c,[g,"Realme"],[p,S]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[g,xo],[p,S]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[g,xo],[p,w]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[g,xn],[p,w]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[g,xn],[p,S]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[g,"Lenovo"],[p,w]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[g,"Nokia"],[p,S]],[/(pixel c)\b/i],[c,[g,Ye],[p,w]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[g,Ye],[p,S]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[g,Tn],[p,S]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[g,Tn],[p,w]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[g,"OnePlus"],[p,S]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[g,I],[p,w]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[g,I],[p,S]],[/(playbook);[-\w\),; ]+(rim)/i],[c,g,[p,w]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[g,P],[p,S]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[g,C],[p,w]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[g,C],[p,S]],[/(nexus 9)/i],[c,[g,"HTC"],[p,w]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[g,[c,/_/g," "],[p,S]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[g,"Acer"],[p,w]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[g,"Meizu"],[p,S]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[g,"Sharp"],[p,S]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,c,[p,S]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,c,[p,w]],[/(surface duo)/i],[c,[g,bn],[p,w]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[g,"Fairphone"],[p,S]],[/(u304aa)/i],[c,[g,"AT&T"],[p,S]],[/\bsie-(\w*)/i],[c,[g,"Siemens"],[p,S]],[/\b(rct\w+) b/i],[c,[g,"RCA"],[p,w]],[/\b(venue[\d ]{2,7}) b/i],[c,[g,"Dell"],[p,w]],[/\b(q(?:mv|ta)\w+) b/i],[c,[g,"Verizon"],[p,w]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[g,"Barnes & Noble"],[p,w]],[/\b(tm\d{3}\w+) b/i],[c,[g,"NuVision"],[p,w]],[/\b(k88) b/i],[c,[g,"ZTE"],[p,w]],[/\b(nx\d{3}j) b/i],[c,[g,"ZTE"],[p,S]],[/\b(gen\d{3}) b.+49h/i],[c,[g,"Swiss"],[p,S]],[/\b(zur\d{3}) b/i],[c,[g,"Swiss"],[p,w]],[/\b((zeki)?tb.*\b) b/i],[c,[g,"Zeki"],[p,w]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],c,[p,w]],[/\b(ns-?\w{0,9}) b/i],[c,[g,"Insignia"],[p,w]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[g,"NextBook"],[p,w]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],c,[p,S]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],c,[p,S]],[/\b(ph-1) /i],[c,[g,"Essential"],[p,S]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[g,"Envizen"],[p,w]],[/\b(trio[-\w\. ]+) b/i],[c,[g,"MachSpeed"],[p,w]],[/\btu_(1491) b/i],[c,[g,"Rotor"],[p,w]],[/(shield[\w ]+) b/i],[c,[g,"Nvidia"],[p,w]],[/(sprint) (\w+)/i],[g,c,[p,S]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[g,bn],[p,S]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[g,wn],[p,w]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[g,wn],[p,S]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,c,[p,_]],[/droid.+; (shield) bui/i],[c,[g,"Nvidia"],[p,_]],[/(playstation [345portablevi]+)/i],[c,[g,Tn],[p,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[g,bn],[p,_]],[/smart-tv.+(samsung)/i],[g,[p,A]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[g,Sn],[p,A]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,xn],[p,A]],[/(apple) ?tv/i],[g,[c,v+" TV"],[p,A]],[/crkey/i],[[c,ae+"cast"],[g,Ye],[p,A]],[/droid.+aft(\w)( bui|\))/i],[c,[g,I],[p,A]],[/\(dtv[\);].+(aquos)/i],[c,[g,"Sharp"],[p,A]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[g,En],[c,En],[p,A]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,A]],[/((pebble))app/i],[g,c,[p,N]],[/droid.+; (glass) \d/i],[c,[g,Ye],[p,N]],[/droid.+; (wt63?0{2,3})\)/i],[c,[g,wn],[p,N]],[/(quest( 2)?)/i],[c,[g,So],[p,N]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[p,z]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[c,[p,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[p,w]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,w]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[p,S]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[y,Bt+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[y,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,y]],os:[[/microsoft (windows) (vista|xp)/i],[y,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[y,[f,_n,wo]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,"Windows"],[f,_n,wo]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[y,"Mac OS"],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[f,y],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[y,f],[/\(bb(10);/i],[f,[y,P]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[y,De+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[y,"webOS"]],[/crkey\/([\d\.]+)/i],[f,[y,ae+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[y,"Chromium OS"],f],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[y,f],[/(sunos) ?([\w\.\d]*)/i],[[y,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[y,f]]},Te=function(R,H){if(typeof R===u&&(H=R,R=i),!(this instanceof Te))return new Te(R,H).getResult();var L=R||(typeof t!==l&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:a),Y=H?Ef(Eo,H):Eo;return this.getBrowser=function(){var U={};return U[y]=i,U[f]=i,Vt.call(U,L,Y.browser),U.major=_f(U.version),U},this.getCPU=function(){var U={};return U[E]=i,Vt.call(U,L,Y.cpu),U},this.getDevice=function(){var U={};return U[g]=i,U[c]=i,U[p]=i,Vt.call(U,L,Y.device),U},this.getEngine=function(){var U={};return U[y]=i,U[f]=i,Vt.call(U,L,Y.engine),U},this.getOS=function(){var U={};return U[y]=i,U[f]=i,Vt.call(U,L,Y.os),U},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return L},this.setUA=function(U){return L=typeof U===h&&U.length>b?En(U,b):U,this},this.setUA(L),this};Te.VERSION=r,Te.BROWSER=Vi([y,f,d]),Te.CPU=Vi([E]),Te.DEVICE=Vi([c,g,p,_,S,A,w,N,z]),Te.ENGINE=Te.OS=Vi([y,f]),n.exports&&(e=n.exports=Te),e.UAParser=Te;var xt=typeof t!==l&&(t.jQuery||t.Zepto);if(xt&&!xt.ua){var Hi=new Te;xt.ua=Hi.getResult(),xt.ua.get=function(){return Hi.getUA()},xt.ua.set=function(R){Hi.setUA(R);var H=Hi.getResult();for(var L in H)xt.ua[L]=H[L]}}})(typeof window=="object"?window:qi)})(ji,ji.exports);function jo(n){return n==null}function Ko(n){return n.split(".").pop()}function Lf(n){const e={appId:["string"],accountId:["string","number"],token:["string"],videoNode:["string"],type:["string"]};for(let t of Object.getOwnPropertyNames(e))if(n.hasOwnProperty(t)){let i=e[t],r=typeof n[t];if(!i.includes(r))throw Error(`\u53C2\u6570\u7C7B\u578B\u9519\u8BEF\uFF0C${t} \u5FC5\u987B\u662F ${i.join()} \u7C7B\u578B`)}else throw Error(`\u53C2\u6570\u7F3A\u5931\uFF0C\u8BF7\u786E\u8BA4\u63D0\u4F9B ${t}`);if(n.type==="live")if(n.liveOption){if(!n.liveOption.roomId)throw Error("\u76F4\u64AD\u914D\u7F6E liveOption \u7F3A\u5C11\u53C2\u6570 roomId")}else throw Error("\u76F4\u64AD\u9700\u63D0\u4F9B\u53C2\u6570 liveOption");else if(n.vodOption){if(!n.vodOption.recordId)throw Error("\u70B9\u64AD\u914D\u7F6E vodOption \u7F3A\u5C11\u53C2\u6570 recordId")}else throw Error("\u70B9\u64AD\u9700\u63D0\u4F9B\u53C2\u6570 vodOption")}const we=function(){var i,r;let n=new ji.exports.UAParser().getResult(),e=/mqqbrowser|qzone|qqbrowser|qq|micromessenger/i.test(n.ua),t=/android|adr/i.test(n.ua.toLowerCase());return{isTencent:e,browser:(i=n.browser.name)==null?void 0:i.toLowerCase(),browserVersion:n.browser.version,os:(r=n.os.name)==null?void 0:r.toLowerCase(),osVersion:n.os.version,platform:/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i.test(n.ua)?"mobile":"pc",isIOS:/\(i[^;]+;( U;)? CPU.+Mac OS X/.test(n.ua),isAndroid:t,isX5:e&&t,isUC:/ucbrowser/.test(n.ua.toLowerCase()),supportMSE:!!(window.MediaSource||window.WebKitMediaSource)}}();function Ki(n,e){let t=Date.now(),i=null;return(...r)=>{i=Date.now(),i-t>e&&(n(...r),t=i)}}class Qo{constructor(){m(this,"videoNode");m(this,"type");m(this,"autoplay",!0);m(this,"controls","native");m(this,"poster","");m(this,"debug",!1)}merge(e){if(!e)return this;for(let t in e)typeof e[t]=="object"?this[t]=ve(ve({},this[t]),e[t]):this[t]=e[t];return this}}class Jo extends Qo{constructor(){super();m(this,"appId");m(this,"accountId");m(this,"token");m(this,"language","en");m(this,"liveOption");m(this,"vodOption");m(this,"scheduleOption",{enable:!0,playerData:{dispatch_server:"",log_info:{uid:""},default_server:{uri:""},app_type:0,live_type:0,live_subtitle:0,live_delay:0,live_duration:0}});m(this,"pursueOption");m(this,"switchOption",{enable:!0});m(this,"marqueeOption",{enable:!1});m(this,"watermarkOption",{enable:!1});m(this,"barrageOption",{enable:!0,positionRange:[0,.5],speed:100,style:{opacity:80,backgroundColor:"transparent"}});m(this,"reportOption");m(this,"peer5Option",{enable:!1,customerId:"",fallback:!0});m(this,"vttOptions",{enable:!1});m(this,"uiOptions");let e={bufferPursue:20,bufferSeek:30,bufferStop:10,pursueSpeed:1.2,mode:"pursue"},t={bufferPursue:30,bufferSeek:40,bufferStop:20,pursueSpeed:1.2,mode:"pursue"};this.pursueOption={enable:!0,flv:e,hls:t,dash:t,native:e}}}const Zo={API_SERVER:"//api.vhallyun.com/sdk",REPORT_SERVER:"//dc.e.vhall.com/login",BASE_MESSAGE_URL:`//static.vhallyun.com/jssdk/vhall-jssdk-base/vhall-msg-1.0.9.js?t=${Date.now()}`},ie={APP_ID:"app_id",THIRD_PARTY_USER_ID:"third_party_user_id",CLIENT:"client",ACCESS_TOKEN:"access_token",PACKAGE_CHECK:"package_check",LANGUAGE:"language"},Qi={INIT:"/v2/init/start",INIT_LIVE:"/v2/room/get-watch-info",INIT_VOD:"/v2/demand/get-record-watch-info"};var q=(n=>(n.Flv="flv",n.Hls="hls",n.HlsNative="hlsnative",n.Flash="flash",n.Native="native",n.Dash="dash",n))(q||{}),ke=(n=>(n.P360="360p",n.P480="480p",n.P720="720p",n.Pa="a",n.PSame="same",n))(ke||{}),Ne=(n=>(n.TX="tx",n.ALI="ali",n.HW="hw",n.CY="cy",n))(Ne||{}),T=(n=>(n.UISingleDisplay="UISingleDisplay",n.UIResize="UIResize",n))(T||{}),T=(n=>(n.Error="error",n.Waiting="waiting",n.Ended="ended",n.Loaded="loadeddata",n.Play="play",n.Canplay="canplay",n.Pause="pause",n.Ratechange="ratechange",n.Stalled="stalled",n.Volumechange="volumechange",n))(T||{}),T=(n=>(n.VTT_ADDED="vttAdded",n.VTT_SELECTED="vttSelected",n.VTT_CLOSED="vttClosed",n.DEFINITION_CHANGE="definitionChange",n.LIVESUBTITLE_OPENED="liveSubtitleOpened",n.LIVESUBTITLE_CLOSED="liveSubtitleClosed",n.AUTOPLAY_FAILED="autoplayFailed",n.FULLSCREEN_CHANGED="fullscreenChanged",n.LAG_REPORT="lagReport",n.LAG_RECOVER="lagRecover",n.OPEN_BARRAGE="openBarrage",n.CLOSE_BARRAGE="closeBarrage",n.CLEAR_BARRAGE="clearBarrage",n.SCHEDULER_COMPLETE="scheduleComplete",n.PULL_STREAM_FAILED="PULL_STREAM_FAILED",n.LINE_CHANGE="lineChange",n.LINE_CHANGED="lineChanged",n.LIVE_TIMESHIFT="liveTimeShift",n.TOUCH_PLAY="touchPlay",n.HLS_ERROR="hlsError",n.FLV_ERROR="flvError",n))(T||{}),Vn={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(l,u,h){this.fn=l,this.context=u,this.once=h||!1}function a(l,u,h,d,c){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new r(h,d||l,c),p=t?t+u:u;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],y]:l._events[p].push(y):(l._events[p]=y,l._eventsCount++),l}function s(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],h,d;if(this._eventsCount===0)return u;for(d in h=this._events)e.call(h,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(h)):u},o.prototype.listeners=function(u){var h=t?t+u:u,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var c=0,y=d.length,p=new Array(y);c<y;c++)p[c]=d[c].fn;return p},o.prototype.listenerCount=function(u){var h=t?t+u:u,d=this._events[h];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,h,d,c,y,p){var g=t?t+u:u;if(!this._events[g])return!1;var f=this._events[g],E=arguments.length,_,S;if(f.fn){switch(f.once&&this.removeListener(u,f.fn,void 0,!0),E){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,h),!0;case 3:return f.fn.call(f.context,h,d),!0;case 4:return f.fn.call(f.context,h,d,c),!0;case 5:return f.fn.call(f.context,h,d,c,y),!0;case 6:return f.fn.call(f.context,h,d,c,y,p),!0}for(S=1,_=new Array(E-1);S<E;S++)_[S-1]=arguments[S];f.fn.apply(f.context,_)}else{var w=f.length,A;for(S=0;S<w;S++)switch(f[S].once&&this.removeListener(u,f[S].fn,void 0,!0),E){case 1:f[S].fn.call(f[S].context);break;case 2:f[S].fn.call(f[S].context,h);break;case 3:f[S].fn.call(f[S].context,h,d);break;case 4:f[S].fn.call(f[S].context,h,d,c);break;default:if(!_)for(A=1,_=new Array(E-1);A<E;A++)_[A-1]=arguments[A];f[S].fn.apply(f[S].context,_)}}return!0},o.prototype.on=function(u,h,d){return a(this,u,h,d,!1)},o.prototype.once=function(u,h,d){return a(this,u,h,d,!0)},o.prototype.removeListener=function(u,h,d,c){var y=t?t+u:u;if(!this._events[y])return this;if(!h)return s(this,y),this;var p=this._events[y];if(p.fn)p.fn===h&&(!c||p.once)&&(!d||p.context===d)&&s(this,y);else{for(var g=0,f=[],E=p.length;g<E;g++)(p[g].fn!==h||c&&!p[g].once||d&&p[g].context!==d)&&f.push(p[g]);f.length?this._events[y]=f.length===1?f[0]:f:s(this,y)}return this},o.prototype.removeAllListeners=function(u){var h;return u?(h=t?t+u:u,this._events[h]&&s(this,h)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(Vn);class Hn{constructor(){m(this,"_emitter",new Vn.exports.EventEmitter)}emit(e,t){return this._emitter.emit(e,t)}listenerCount(e){return this._emitter.listenerCount(e)}listeners(e){return this._emitter.listeners(e)}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}}const je=function(){},Ji={trace:je,debug:je,log:je,warn:je,info:je,error:je};let Tt=Ji;function el(n){const e=self.console[n];return e?e.bind(self.console,`[vlog ${n}] >`):je}function tl(n,...e){n!==!1&&e.forEach(function(t){Tt[t]=typeof n=="object"&&n[t]?n[t].bind(n):el(t)})}function Zi(n){if(self.console&&n===!0||typeof n=="object"){tl(n,"debug","log","info","warn","error");try{Tt.log()}catch{Tt=Ji}}else Tt=Ji}const x=Tt;class Gt{constructor(e,t){m(this,"video");m(this,"options");m(this,"playedTime",0);m(this,"playBackRate",1);m(this,"isPaused",!0);m(this,"url","");m(this,"cacheUrl","");m(this,"autoPlayed",!1);m(this,"context");this.options=e,this.context=t,this.video=this.initVideo(e,Fn("#"+e.videoNode)),this.registerListeners()}initVideo(e,t=document.body){let i={};i.playsinline=!0,i["webkit-playsinline"]=!0,i["x5-playsinline"]=!0,i["mtt-playsinline"]=!0;let r=j("video",{autoplay:!!e.autoplay,controls:e.controls==="native",muted:!!e.muted},ve(ve({width:"100%",height:"100%",crossOrigin:"anonymous","z-index":0},i),e.poster?{poster:e.poster}:{}));return t.style.position="relative",t.appendChild(r),r}checkUrl(e,t=!1){return e?this.url===e&&!t?(x.warn("BasePlayer checkUrl - url \u672A\u6539\u53D8"),!1):(this.cacheUrl||(this.cacheUrl=e),!0):(x.warn("BasePlayer checkUrl - url \u672A\u63D0\u4F9B"),!1)}setUrl(e){var t;(t=this.context)==null||t.emit(T.LINE_CHANGED,{old:this.url,new:e}),this.url=e,this.cacheUrl=""}recordPlayStatus(e){x.info("BasePlayer change line old => ",this.url),x.info("BasePlayer change line new => ",e),this.playedTime=this.video.currentTime,this.playBackRate=this.video.playbackRate,this.isPaused=this.video.paused}recoverPlayStatus(){x.info("BasePlayer \u8FD8\u539F\u5207\u7EBF\u524D\u64AD\u653E\u72B6\u6001:"),this.options.type==="vod"&&(x.info("BasePlayer playedTime:",this.playedTime),this.video.currentTime=this.playedTime),x.info("BasePlayer playBackRate:",this.playBackRate),this.video.playbackRate=this.playBackRate,this.isPaused||this.video.play()}registerListeners(){this.video.addEventListener("play",e=>{var t;(t=this.context)==null||t.emit(T.Play,e)}),this.video.addEventListener("pause",e=>{var t;(t=this.context)==null||t.emit(T.Pause,e)}),this.video.addEventListener("canplay",e=>{var t;(t=this.context)==null||t.emit(T.Canplay,e)}),this.video.addEventListener("waiting",e=>{var t;(t=this.context)==null||t.emit(T.Waiting,e)}),this.video.addEventListener("ended",e=>{var t;(t=this.context)==null||t.emit(T.Ended,e)}),this.video.addEventListener("error",e=>{var i;(i=this.context)==null||i.emit(T.Error,e),x.error(`BasePlayer video error, type: ${e.type}; details: ${e.details}`);let t=e.target&&e.target.error;t&&x.error(`BasePlayer video error, code: ${t.code}; details: ${t.message}`)}),this.video.addEventListener("stalled",e=>{var t;(t=this.context)==null||t.emit(T.Stalled,e)}),this.video.addEventListener("loadeddata",e=>{var t;(t=this.context)==null||t.emit(T.Loaded,e)}),this.video.addEventListener("ratechange",e=>{var t;x.info("BasePlayer video ratechange",this.video.playbackRate),(t=this.context)==null||t.emit(T.Ratechange,e)}),this.video.addEventListener("volumechange",e=>{var t;(t=this.context)==null||t.emit(T.Volumechange,e)}),this.video.addEventListener("canplaythrough",e=>{this.options.autoplay&&!this.autoPlayed&&this.video.paused&&(this.autoPlayed=!0,this.video.play().catch(t=>{var i;x.warn("BasePlayer - not support autoplay"),(i=this.context)==null||i.emit(T.AUTOPLAY_FAILED,t)}))})}}class fe extends Gt{constructor(e,t="flv",i){super(e,i);m(this,"nPlayer");m(this,"type");m(this,"cacheInfo",{});x.info(`FlvPlayer - \u521B\u5EFA ${t} player`,e),this.type=t}load(e,t=!1){return this.checkUrl(e,t)?(this.nPlayer&&this.recordPlayStatus(e),new Promise(i=>{this.createInstance({type:this.type,isLive:this.options.type==="live",url:e},this.options.flvOptions||{}).then(r=>{r&&this.nPlayer.on(ce.default.Events.METADATA_ARRIVED,()=>{this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}}),this.registerFlvListeners(),this.nPlayer.on(ce.default.Events.METADATA_ARRIVED,()=>{this.setUrl(e)}),this.nPlayer.attachMediaElement(this.video),this.nPlayer.load(),i(!0)})})):Promise.reject(!1)}reload(){return this.load(this.cacheUrl||this.url,!0)}async createInstance(e,t){if(this.type==="flv"&&!ce.default.isSupported())throw x.error("FlvPlayer createInstance - flv not supported!"),Error("flv not supported!");const i=!!this.nPlayer;return await this.destroy(),this.nPlayer=ce.default.createPlayer(e,t),i}destroy(){var e;return(e=this.nPlayer)==null||e.destroy(),Promise.resolve(!0)}registerFlvListeners(){this.nPlayer.on(ce.default.Events.ERROR,(e,...t)=>{var i,r;x.error("FlvPlayer Events.ERROR",e,t),(i=this.context)==null||i.emit(T.FLV_ERROR,{errType:e,data:t}),e===ce.default.ErrorTypes.NETWORK_ERROR&&(t[0]===ce.default.ErrorDetails.NETWORK_STATUS_CODE_INVALID&&t[1].code===404||t[0]===ce.default.ErrorDetails.NETWORK_TIMEOUT||t[1].code===void 0)&&((r=this.context)==null||r.emit(T.PULL_STREAM_FAILED,this.url))}),this.nPlayer.on(ce.default.Events.LOADING_COMPLETE,e=>{var t;x.info("FlvPlayer Events.LOADING_COMPLETE",e),(t=this.context)==null||t.emit(T.PULL_STREAM_FAILED,this.url)}),this.nPlayer.on(ce.default.Events.STATISTICS_INFO,e=>{this.cacheInfo=e})}getBandwidthEstimate(){return this.cacheInfo.speed||0}}m(fe,"Events",ce.default.Events);class er extends Gt{constructor(e,t){super(e,t);m(this,"nPlayer");x.info("HlsPlayer - \u521B\u5EFA HlsPlayer",e)}load(e,t=!1){return this.checkUrl(e,t)?(this.nPlayer&&this.recordPlayStatus(e),new Promise(i=>{this.createHlsInstance().then(r=>{r&&(this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}),this.registerHlsListeners(),this.nPlayer.on(ue.default.Events.MANIFEST_LOADED,()=>{this.setUrl(e)}),this.nPlayer.loadSource(e),this.nPlayer.attachMedia(this.video),i(!0)})})):Promise.reject(!1)}reload(){return this.load(this.cacheUrl||this.url,!0)}async createHlsInstance(){if(!ue.default.isSupported())throw x.error("HlsPlayer - hls not supported"),Error("hls not supported");let e=await this.destroy();return this.nPlayer=new ue.default(bt(ve({},this.options.hlsOptions||{}),{fLoader:window.peer5&&window.peer5.HlsJsFragmentLoader,pLoader:window.peer5&&window.peer5.HlsJsPlaylistLoader})),e}destroy(){return new Promise(e=>{this.nPlayer?(this.nPlayer.once(ue.default.Events.MEDIA_DETACHED,()=>{e(!0)}),this.nPlayer.destroy()):e(!1)})}registerHlsListeners(){this.nPlayer.on(ue.default.Events.ERROR,(e,t)=>{var a,s;x.error("HlsPlayer Events.ERROR",e,t),(a=this.context)==null||a.emit(T.HLS_ERROR,t);let{details:i,type:r}=t;r===ue.default.ErrorTypes.NETWORK_ERROR&&(i===ue.default.ErrorDetails.MANIFEST_LOAD_ERROR||i===ue.default.ErrorDetails.MANIFEST_LOAD_TIMEOUT||i===ue.default.ErrorDetails.LEVEL_LOAD_ERROR||i===ue.default.ErrorDetails.LEVEL_LOAD_TIMEOUT)&&((s=this.context)==null||s.emit(T.PULL_STREAM_FAILED,this.url))})}getBandwidthEstimate(){return this.nPlayer.bandwidthEstimate/8192}}m(er,"Events",ue.default.Events);class zn extends Gt{constructor(e,t){super(e,t);m(this,"nPlayer");x.info("DashPlayer - \u521B\u5EFA DashPlayer")}load(e,t){return this.checkUrl(e,t)?(this.nPlayer&&this.recordPlayStatus(e),new Promise(i=>{this.createHlsInstance().then(r=>{r&&(this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}),this.registerHlsListeners(),this.nPlayer.on(Z.MediaPlayer.events.MANIFEST_LOADED,()=>{this.setUrl(e)}),this.nPlayer.initialize(this.video,e,!0),i(!0)})})):Promise.reject(!1)}async createHlsInstance(){if(!Z.supportsMediaSource())throw x.error("DashPlayer - dash not supported"),Error("dash not supported");let e=await this.destroy();return this.nPlayer=Z.MediaPlayer().create(),e}registerHlsListeners(){}reload(){return this.load(this.cacheUrl||this.url,!0)}destroy(){return new Promise(e=>{this.nPlayer?(this.nPlayer.destroy(),e(!0)):e(!1)})}getBandwidthEstimate(){return 0}}m(zn,"Events",Z.MediaPlayer.events);const Gn={timeWait:5e3,timeLazy:15e3,timesReached:-1,timesMax:-1,isInterval:!0};class il{constructor(e=Gn){m(this,"timeWait");m(this,"timeLazy");m(this,"timesReached");m(this,"timesMax");m(this,"isInterval");m(this,"times",0);m(this,"fn");m(this,"timer",0);m(this,"executing",!1);let t=Object.assign({},Gn,e);x.info("TaskLoop config",t),this.timeWait=t.timeWait,this.timeLazy=t.timeLazy,this.timesReached=t.timesReached,this.timesMax=t.timesMax,this.isInterval=t.isInterval}setCallback(e){return this.fn=e,this}setIsInterval(e){return this.isInterval=e,this}setTimeWait(e){this.isInterval?clearInterval(this.timer):clearTimeout(this.timer),this.timeWait=e}setInterval(){this.timer=window.setInterval(()=>{this.checkTimesReached()||(this.fn(),this.times+=1)},this.timeWait)}checkTimesReached(){return this.timesMax!==-1&&this.times>=this.timesMax?(this.destroy(),x.warn("TaskLoop checkTimesReached - Interval Reach the top, stopped"),!0):(this.timesReached!==-1&&this.timeWait!==this.timeLazy&&this.times>=this.timesReached&&(x.warn("TaskLoop checkTimesReached - Interval Reach the top, set lazy"),this.setTimeWait(this.timeLazy),this.isInterval&&this.setInterval()),!1)}execute(){if(!this.executing){if(this.isInterval)this.setInterval();else{if(this.checkTimesReached())return;this.timer=window.setTimeout(this.fn,this.timeWait),this.times+=1}this.executing=!0}}destroy(){this.isInterval?clearInterval(this.timer):clearTimeout(this.timer),this.times=0,this.executing=!1}}const rl={length:0,start:()=>0,end:()=>0};function qn(n){try{return n.buffered}catch(e){return x.warn("failed to get media.buffered",e),rl}}function qt(n){try{let e=qn(n);return e.length?e.end(e.length-1):0}catch(e){return x.warn("failed to get last media.buffered",e),0}}var pe=(n=>(n.ManifestLoading="ManifestLoading",n.ManifestLoaded="ManifestLoaded",n.ManifestParsed="ManifestParsed",n.TsLoading="TsLoading",n.TsLoaded="TsLoaded",n.Muxed="Muxed",n.Play="play",n.Pause="pause",n.Ratechange="ratechange",n.Stalled="stalled",n))(pe||{});class nl{constructor(e){m(this,"video");m(this,"ms");m(this,"objectUrl");m(this,"hls");m(this,"sourceBuffer");m(this,"taskLoop");m(this,"stats","Idle");m(this,"segmentTracker",{});m(this,"playManifest");m(this,"isSeeking",!1);m(this,"nextSegmentIndex",0);m(this,"onMediaSourceOpen",()=>{var a;const{ms:e,hls:t}=this;let i='video/mp4; codecs="avc1.42E01E, mp4a.40.2"',r=e.addSourceBuffer(i);r.addEventListener("updateend",this.updateEnd),this.sourceBuffer=r,(a=t.loader.m3u8Promise)==null||a.then(s=>{s.endList&&(e.duration=s.totalDuration),this.taskLoop=new il({timeWait:500}),this.taskLoop.setCallback(this.tick).execute()})});m(this,"onMediaSourceEnded",()=>{x.info("onMediaSourceEnded")});m(this,"onMediaSourceClose",()=>{x.info("onMediaSourceClose")});m(this,"onSeeking",()=>{this.isSeeking=!0;let{video:e}=this,t=qt(e);console.log("ana onSeeking",e.currentTime,t),this.nextSegmentIndex=this.findSegmentIndex(e.currentTime)});m(this,"onSeeked",()=>{this.isSeeking=!1;let{video:e}=this,t=qn(e);console.log("ana onSeeked",e.currentTime,t.end(0))});m(this,"tick",()=>{switch(this.stats){case"Idle":this.checkFetchNextSegment();break}});m(this,"updateEnd",()=>{const{ms:e,hls:t}=this;let{playManifest:i,segmentIndex:r}=t.loader;if(!this.sourceBuffer.updating&&e.readyState==="open"&&r===i.segments.length-1){this.stats="Ended",this.taskLoop.destroy(),e.endOfStream();return}this.stats="Idle"});this.hls=e,this.register()}register(){this.hls.on(pe.ManifestParsed,e=>{x.info("Events.ManifestParsed",e),this.playManifest=e}),this.hls.on(pe.TsLoading,e=>{this.stats="TsLoading"}),this.hls.on(pe.TsLoaded,e=>{this.stats="TsLoaded",this.segmentTracker[e.segment.index]=!0}),this.hls.on(pe.Muxed,e=>{x.info("getBufferedLast",qt(this.sourceBuffer)),this.sourceBuffer.appendBuffer(e)})}attachMedia(e){const t=this.video=e,i=this.ms=new MediaSource;i.addEventListener("sourceopen",this.onMediaSourceOpen),i.addEventListener("sourceended",this.onMediaSourceEnded),i.addEventListener("sourceclose",this.onMediaSourceClose),e.addEventListener("seeking",this.onSeeking),e.addEventListener("seeked",this.onSeeked),t.src=self.URL.createObjectURL(i),this.objectUrl=t.src}checkFetchNextSegment(){let{hls:i,video:r}=this,a=qt(r);x.info("buffered",r.currentTime,a),this.nextSegmentIndex?(this.checkBuffered(this.nextSegmentIndex)||i.loader.getTsData(this.nextSegmentIndex),this.nextSegmentIndex=0):r.currentTime>=a-(r.paused?60:10)&&i.loader.getTsData()}findSegmentIndex(e){let{playManifest:t}=this,i=0,r,a=Math.floor(e/t.avgDuration),s=a<10?0:a-10,o=t.segments.length;for(;s<o;s++)if(r=t.segments[s],i+=r.duration,i>=e)return r.index;return 0}checkBuffered(e){return this.segmentTracker[e]}}var Ke=function(){this.init=function(){var e={};this.on=function(t,i){e[t]||(e[t]=[]),e[t]=e[t].concat(i)},this.off=function(t,i){var r;return e[t]?(r=e[t].indexOf(i),e[t]=e[t].slice(),e[t].splice(r,1),r>-1):!1},this.trigger=function(t){var i,r,a,s;if(i=e[t],!!i)if(arguments.length===2)for(a=i.length,r=0;r<a;++r)i[r].call(this,arguments[1]);else{for(s=[],r=arguments.length,r=1;r<arguments.length;++r)s.push(arguments[r]);for(a=i.length,r=0;r<a;++r)i[r].apply(this,s)}},this.dispose=function(){e={}}}};Ke.prototype.pipe=function(n){return this.on("data",function(e){n.push(e)}),this.on("done",function(e){n.flush(e)}),this.on("partialdone",function(e){n.partialFlush(e)}),this.on("endedtimeline",function(e){n.endTimeline(e)}),this.on("reset",function(e){n.reset(e)}),n},Ke.prototype.push=function(n){this.trigger("data",n)},Ke.prototype.flush=function(n){this.trigger("done",n)},Ke.prototype.partialFlush=function(n){this.trigger("partialdone",n)},Ke.prototype.endTimeline=function(n){this.trigger("endedtimeline",n)},Ke.prototype.reset=function(n){this.trigger("reset",n)};var he=Ke,tr=9e4,ir,rr,Wt,nr,Wn,Xn,Yn;ir=function(e){return e*tr},rr=function(e,t){return e*t},Wt=function(e){return e/tr},nr=function(e,t){return e/t},Wn=function(e,t){return ir(nr(e,t))},Xn=function(e,t){return rr(Wt(e),t)},Yn=function(e,t,i){return Wt(i?e:e-t)};var Be={ONE_SECOND_IN_TS:tr,secondsToVideoTs:ir,secondsToAudioTs:rr,videoTsToSeconds:Wt,audioTsToSeconds:nr,audioTsToVideoTs:Wn,videoTsToAudioTs:Xn,metadataTsToSeconds:Yn},al=he,sl=Be.ONE_SECOND_IN_TS,Xt,jn=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Xt=function(e){var t,i=0;Xt.prototype.init.call(this),this.skipWarn_=function(r,a){this.trigger("log",{level:"warn",message:"adts skiping bytes "+r+" to "+a+" in frame "+i+" outside syncword"})},this.push=function(r){var a=0,s,o,l,u,h;if(e||(i=0),r.type==="audio"){t&&t.length?(l=t,t=new Uint8Array(l.byteLength+r.data.byteLength),t.set(l),t.set(r.data,l.byteLength)):t=r.data;for(var d;a+7<t.length;){if(t[a]!==255||(t[a+1]&246)!==240){typeof d!="number"&&(d=a),a++;continue}if(typeof d=="number"&&(this.skipWarn_(d,a),d=null),o=(~t[a+1]&1)*2,s=(t[a+3]&3)<<11|t[a+4]<<3|(t[a+5]&224)>>5,u=((t[a+6]&3)+1)*1024,h=u*sl/jn[(t[a+2]&60)>>>2],t.byteLength-a<s)break;this.trigger("data",{pts:r.pts+i*h,dts:r.dts+i*h,sampleCount:u,audioobjecttype:(t[a+2]>>>6&3)+1,channelcount:(t[a+2]&1)<<2|(t[a+3]&192)>>>6,samplerate:jn[(t[a+2]&60)>>>2],samplingfrequencyindex:(t[a+2]&60)>>>2,samplesize:16,data:t.subarray(a+7+o,a+s)}),i++,a+=s}typeof d=="number"&&(this.skipWarn_(d,a),d=null),t=t.subarray(a)}},this.flush=function(){i=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}},Xt.prototype=new al;var Yt=Xt,Kn;Kn=function(e){var t=e.byteLength,i=0,r=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+r},this.loadWord=function(){var a=e.byteLength-t,s=new Uint8Array(4),o=Math.min(4,t);if(o===0)throw new Error("no bytes available");s.set(e.subarray(a,a+o)),i=new DataView(s.buffer).getUint32(0),r=o*8,t-=o},this.skipBits=function(a){var s;r>a?(i<<=a,r-=a):(a-=r,s=Math.floor(a/8),a-=s*8,t-=s,this.loadWord(),i<<=a,r-=a)},this.readBits=function(a){var s=Math.min(r,a),o=i>>>32-s;return r-=s,r>0?i<<=s:t>0&&this.loadWord(),s=a-s,s>0?o<<s|this.readBits(s):o},this.skipLeadingZeros=function(){var a;for(a=0;a<r;++a)if((i&2147483648>>>a)!==0)return i<<=a,r-=a,a;return this.loadWord(),a+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var a=this.skipLeadingZeros();return this.readBits(a+1)-1},this.readExpGolomb=function(){var a=this.readUnsignedExpGolomb();return 1&a?1+a>>>1:-1*(a>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var ol=Kn,Qn=he,ll=ol,jt,wt,Jn;wt=function(){var e=0,t,i;wt.prototype.init.call(this),this.push=function(r){var a;i?(a=new Uint8Array(i.byteLength+r.data.byteLength),a.set(i),a.set(r.data,i.byteLength),i=a):i=r.data;for(var s=i.byteLength;e<s-3;e++)if(i[e+2]===1){t=e+5;break}for(;t<s;)switch(i[t]){case 0:if(i[t-1]!==0){t+=2;break}else if(i[t-2]!==0){t++;break}e+3!==t-2&&this.trigger("data",i.subarray(e+3,t-2));do t++;while(i[t]!==1&&t<s);e=t-2,t+=3;break;case 1:if(i[t-1]!==0||i[t-2]!==0){t+=3;break}this.trigger("data",i.subarray(e+3,t-2)),e=t-2,t+=3;break;default:t+=3;break}i=i.subarray(e),t-=e,e=0},this.reset=function(){i=null,e=0,this.trigger("reset")},this.flush=function(){i&&i.byteLength>3&&this.trigger("data",i.subarray(e+3)),i=null,e=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},wt.prototype=new Qn,Jn={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},jt=function(){var e=new wt,t,i,r,a,s,o,l;jt.prototype.init.call(this),t=this,this.push=function(u){u.type==="video"&&(i=u.trackId,r=u.pts,a=u.dts,e.push(u))},e.on("data",function(u){var h={trackId:i,pts:r,dts:a,data:u,nalUnitTypeCode:u[0]&31};switch(h.nalUnitTypeCode){case 5:h.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:h.nalUnitType="sei_rbsp",h.escapedRBSP=s(u.subarray(1));break;case 7:h.nalUnitType="seq_parameter_set_rbsp",h.escapedRBSP=s(u.subarray(1)),h.config=o(h.escapedRBSP);break;case 8:h.nalUnitType="pic_parameter_set_rbsp";break;case 9:h.nalUnitType="access_unit_delimiter_rbsp";break}t.trigger("data",h)}),e.on("done",function(){t.trigger("done")}),e.on("partialdone",function(){t.trigger("partialdone")}),e.on("reset",function(){t.trigger("reset")}),e.on("endedtimeline",function(){t.trigger("endedtimeline")}),this.flush=function(){e.flush()},this.partialFlush=function(){e.partialFlush()},this.reset=function(){e.reset()},this.endTimeline=function(){e.endTimeline()},l=function(h,d){var c=8,y=8,p,g;for(p=0;p<h;p++)y!==0&&(g=d.readExpGolomb(),y=(c+g+256)%256),c=y===0?c:y},s=function(h){for(var d=h.byteLength,c=[],y=1,p,g;y<d-2;)h[y]===0&&h[y+1]===0&&h[y+2]===3?(c.push(y+2),y+=2):y++;if(c.length===0)return h;p=d-c.length,g=new Uint8Array(p);var f=0;for(y=0;y<p;f++,y++)f===c[0]&&(f++,c.shift()),g[y]=h[f];return g},o=function(h){var d=0,c=0,y=0,p=0,g,f,E,_,S,w,A,N,z,b,I,v=[1,1],C,P;if(g=new ll(h),f=g.readUnsignedByte(),_=g.readUnsignedByte(),E=g.readUnsignedByte(),g.skipUnsignedExpGolomb(),Jn[f]&&(S=g.readUnsignedExpGolomb(),S===3&&g.skipBits(1),g.skipUnsignedExpGolomb(),g.skipUnsignedExpGolomb(),g.skipBits(1),g.readBoolean()))for(I=S!==3?8:12,P=0;P<I;P++)g.readBoolean()&&(P<6?l(16,g):l(64,g));if(g.skipUnsignedExpGolomb(),w=g.readUnsignedExpGolomb(),w===0)g.readUnsignedExpGolomb();else if(w===1)for(g.skipBits(1),g.skipExpGolomb(),g.skipExpGolomb(),A=g.readUnsignedExpGolomb(),P=0;P<A;P++)g.skipExpGolomb();if(g.skipUnsignedExpGolomb(),g.skipBits(1),N=g.readUnsignedExpGolomb(),z=g.readUnsignedExpGolomb(),b=g.readBits(1),b===0&&g.skipBits(1),g.skipBits(1),g.readBoolean()&&(d=g.readUnsignedExpGolomb(),c=g.readUnsignedExpGolomb(),y=g.readUnsignedExpGolomb(),p=g.readUnsignedExpGolomb()),g.readBoolean()&&g.readBoolean()){switch(C=g.readUnsignedByte(),C){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:{v=[g.readUnsignedByte()<<8|g.readUnsignedByte(),g.readUnsignedByte()<<8|g.readUnsignedByte()];break}}v&&v[0]/v[1]}return{profileIdc:f,levelIdc:E,profileCompatibility:_,width:(N+1)*16-d*2-c*2,height:(2-b)*(z+1)*16-y*2-p*2,sarRatio:v}}},jt.prototype=new Qn;var ar={H264Stream:jt,NalByteStream:wt},Zn={Adts:Yt,h264:ar},ea=Math.pow(2,32)-1,O,ta,ia,sr,ra,na,aa,sa,or,oa,la,ua,ha,da,ca,fa,pa,ma,ga,ya,va,lr,F,ur,xa,ba,Sa,Ta,wa,Ea,_a,Aa,Kt,Pa,Fa,Da;(function(){var n;if(F={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},typeof Uint8Array!="undefined"){for(n in F)F.hasOwnProperty(n)&&(F[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);ur=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),ba=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),xa=new Uint8Array([0,0,0,1]),Sa=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),Ta=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),wa={video:Sa,audio:Ta},Aa=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),_a=new Uint8Array([0,0,0,0,0,0,0,0]),Kt=new Uint8Array([0,0,0,0,0,0,0,0]),Pa=Kt,Fa=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Da=Kt,Ea=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),O=function(e){var t=[],i=0,r,a,s;for(r=1;r<arguments.length;r++)t.push(arguments[r]);for(r=t.length;r--;)i+=t[r].byteLength;for(a=new Uint8Array(i+8),s=new DataView(a.buffer,a.byteOffset,a.byteLength),s.setUint32(0,a.byteLength),a.set(e,4),r=0,i=8;r<t.length;r++)a.set(t[r],i),i+=t[r].byteLength;return a},ta=function(){return O(F.dinf,O(F.dref,Aa))},ia=function(e){return O(F.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},sr=function(){return O(F.ftyp,ur,xa,ur,ba)},fa=function(e){return O(F.hdlr,wa[e])},ra=function(e){return O(F.mdat,e)},ca=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,e.duration&255,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=e.samplerate&255),O(F.mdhd,t)},da=function(e){return O(F.mdia,ca(e),fa(e.type),aa(e))},na=function(e){return O(F.mfhd,new Uint8Array([0,0,0,0,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255]))},aa=function(e){return O(F.minf,e.type==="video"?O(F.vmhd,Ea):O(F.smhd,_a),ta(),ma(e))},sa=function(e,t){for(var i=[],r=t.length;r--;)i[r]=ya(t[r]);return O.apply(null,[F.moof,na(e)].concat(i))},or=function(e){for(var t=e.length,i=[];t--;)i[t]=ua(e[t]);return O.apply(null,[F.moov,la(4294967295)].concat(i).concat(oa(e)))},oa=function(e){for(var t=e.length,i=[];t--;)i[t]=va(e[t]);return O.apply(null,[F.mvex].concat(i))},la=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return O(F.mvhd,t)},pa=function(e){var t=e.samples||[],i=new Uint8Array(4+t.length),r,a;for(a=0;a<t.length;a++)r=t[a].flags,i[a+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return O(F.sdtp,i)},ma=function(e){return O(F.stbl,ga(e),O(F.stts,Da),O(F.stsc,Pa),O(F.stsz,Fa),O(F.stco,Kt))},function(){var n,e;ga=function(i){return O(F.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),i.type==="video"?n(i):e(i))},n=function(i){var r=i.sps||[],a=i.pps||[],s=[],o=[],l,u;for(l=0;l<r.length;l++)s.push((r[l].byteLength&65280)>>>8),s.push(r[l].byteLength&255),s=s.concat(Array.prototype.slice.call(r[l]));for(l=0;l<a.length;l++)o.push((a[l].byteLength&65280)>>>8),o.push(a[l].byteLength&255),o=o.concat(Array.prototype.slice.call(a[l]));if(u=[F.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(i.width&65280)>>8,i.width&255,(i.height&65280)>>8,i.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),O(F.avcC,new Uint8Array([1,i.profileIdc,i.profileCompatibility,i.levelIdc,255].concat([r.length],s,[a.length],o))),O(F.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],i.sarRatio){var h=i.sarRatio[0],d=i.sarRatio[1];u.push(O(F.pasp,new Uint8Array([(h&4278190080)>>24,(h&16711680)>>16,(h&65280)>>8,h&255,(d&4278190080)>>24,(d&16711680)>>16,(d&65280)>>8,d&255])))}return O.apply(null,u)},e=function(i){return O(F.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(i.channelcount&65280)>>8,i.channelcount&255,(i.samplesize&65280)>>8,i.samplesize&255,0,0,0,0,(i.samplerate&65280)>>8,i.samplerate&255,0,0]),ia(i))}}(),ha=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,0,(e.duration&4278190080)>>24,(e.duration&16711680)>>16,(e.duration&65280)>>8,e.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(e.width&65280)>>8,e.width&255,0,0,(e.height&65280)>>8,e.height&255,0,0]);return O(F.tkhd,t)},ya=function(e){var t,i,r,a,s,o,l;return t=O(F.tfhd,new Uint8Array([0,0,0,58,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),o=Math.floor(e.baseMediaDecodeTime/(ea+1)),l=Math.floor(e.baseMediaDecodeTime%(ea+1)),i=O(F.tfdt,new Uint8Array([1,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255])),s=32+20+8+16+8+8,e.type==="audio"?(r=lr(e,s),O(F.traf,t,i,r)):(a=pa(e),r=lr(e,a.length+s),O(F.traf,t,i,r,a))},ua=function(e){return e.duration=e.duration||4294967295,O(F.trak,ha(e),da(e))},va=function(e){var t=new Uint8Array([0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.type!=="video"&&(t[t.length-1]=0),O(F.trex,t)},function(){var n,e,t;t=function(r,a){var s=0,o=0,l=0,u=0;return r.length&&(r[0].duration!==void 0&&(s=1),r[0].size!==void 0&&(o=2),r[0].flags!==void 0&&(l=4),r[0].compositionTimeOffset!==void 0&&(u=8)),[0,0,s|o|l|u,1,(r.length&4278190080)>>>24,(r.length&16711680)>>>16,(r.length&65280)>>>8,r.length&255,(a&4278190080)>>>24,(a&16711680)>>>16,(a&65280)>>>8,a&255]},e=function(r,a){var s,o,l,u,h,d;for(u=r.samples||[],a+=8+12+16*u.length,l=t(u,a),o=new Uint8Array(l.length+u.length*16),o.set(l),s=l.length,d=0;d<u.length;d++)h=u[d],o[s++]=(h.duration&4278190080)>>>24,o[s++]=(h.duration&16711680)>>>16,o[s++]=(h.duration&65280)>>>8,o[s++]=h.duration&255,o[s++]=(h.size&4278190080)>>>24,o[s++]=(h.size&16711680)>>>16,o[s++]=(h.size&65280)>>>8,o[s++]=h.size&255,o[s++]=h.flags.isLeading<<2|h.flags.dependsOn,o[s++]=h.flags.isDependedOn<<6|h.flags.hasRedundancy<<4|h.flags.paddingValue<<1|h.flags.isNonSyncSample,o[s++]=h.flags.degradationPriority&240<<8,o[s++]=h.flags.degradationPriority&15,o[s++]=(h.compositionTimeOffset&4278190080)>>>24,o[s++]=(h.compositionTimeOffset&16711680)>>>16,o[s++]=(h.compositionTimeOffset&65280)>>>8,o[s++]=h.compositionTimeOffset&255;return O(F.trun,o)},n=function(r,a){var s,o,l,u,h,d;for(u=r.samples||[],a+=8+12+8*u.length,l=t(u,a),s=new Uint8Array(l.length+u.length*8),s.set(l),o=l.length,d=0;d<u.length;d++)h=u[d],s[o++]=(h.duration&4278190080)>>>24,s[o++]=(h.duration&16711680)>>>16,s[o++]=(h.duration&65280)>>>8,s[o++]=h.duration&255,s[o++]=(h.size&4278190080)>>>24,s[o++]=(h.size&16711680)>>>16,s[o++]=(h.size&65280)>>>8,s[o++]=h.size&255;return O(F.trun,s)},lr=function(r,a){return r.type==="audio"?n(r,a):e(r,a)}}();var Qt={ftyp:sr,mdat:ra,moof:sa,moov:or,initSegment:function(e){var t=sr(),i=or(e),r;return r=new Uint8Array(t.byteLength+i.byteLength),r.set(t),r.set(i,t.byteLength),r}},ul=function(e){return e>>>0},hl=function(e){return("00"+e.toString(16)).slice(-2)},Jt={toUnsigned:ul,toHexString:hl},dl=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3]),t},hr=dl,cl=Jt.toUnsigned,fl=hr,pl=function n(e,t){var i=[],r,a,s,o,l;if(!t.length)return null;for(r=0;r<e.byteLength;)a=cl(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]),s=fl(e.subarray(r+4,r+8)),o=a>1?r+a:e.byteLength,s===t[0]&&(t.length===1?i.push(e.subarray(r+8,o)):(l=n(e.subarray(r+8,o),t.slice(1)),l.length&&(i=i.concat(l)))),r=o;return i},dr=pl,ml=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4)},r=i.flags[2]&1,a=i.flags[2]&2,s=i.flags[2]&8,o=i.flags[2]&16,l=i.flags[2]&32,u=i.flags[0]&65536,h=i.flags[0]&131072,d;return d=8,r&&(d+=4,i.baseDataOffset=t.getUint32(12),d+=4),a&&(i.sampleDescriptionIndex=t.getUint32(d),d+=4),s&&(i.defaultSampleDuration=t.getUint32(d),d+=4),o&&(i.defaultSampleSize=t.getUint32(d),d+=4),l&&(i.defaultSampleFlags=t.getUint32(d)),u&&(i.durationIsEmpty=!0),!r&&h&&(i.baseDataOffsetIsMoof=!0),i},cr=ml,gl=function(e){return{isLeading:(e[0]&12)>>>2,dependsOn:e[0]&3,isDependedOn:(e[1]&192)>>>6,hasRedundancy:(e[1]&48)>>>4,paddingValue:(e[1]&14)>>>1,isNonSyncSample:e[1]&1,degradationPriority:e[2]<<8|e[3]}},yl=gl,Ca=yl,vl=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=t.flags[2]&1,a=t.flags[2]&4,s=t.flags[1]&1,o=t.flags[1]&2,l=t.flags[1]&4,u=t.flags[1]&8,h=i.getUint32(4),d=8,c;for(r&&(t.dataOffset=i.getInt32(d),d+=4),a&&h&&(c={flags:Ca(e.subarray(d,d+4))},d+=4,s&&(c.duration=i.getUint32(d),d+=4),o&&(c.size=i.getUint32(d),d+=4),u&&(t.version===1?c.compositionTimeOffset=i.getInt32(d):c.compositionTimeOffset=i.getUint32(d),d+=4),t.samples.push(c),h--);h--;)c={},s&&(c.duration=i.getUint32(d),d+=4),o&&(c.size=i.getUint32(d),d+=4),l&&(c.flags=Ca(e.subarray(d,d+4)),d+=4),u&&(t.version===1?c.compositionTimeOffset=i.getInt32(d):c.compositionTimeOffset=i.getUint32(d),d+=4),t.samples.push(c);return t},fr=vl,Oa=Jt.toUnsigned,xl=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),baseMediaDecodeTime:Oa(e[4]<<24|e[5]<<16|e[6]<<8|e[7])};return t.version===1&&(t.baseMediaDecodeTime*=Math.pow(2,32),t.baseMediaDecodeTime+=Oa(e[8]<<24|e[9]<<16|e[10]<<8|e[11])),t},pr=xl,nt=Jt.toUnsigned,Et=Jt.toHexString,K=dr,at=hr,bl=cr,Sl=fr,Tl=pr,Ia,Ra,La,Ma,Ua,mr;Ia=function(e){var t={},i=K(e,["moov","trak"]);return i.reduce(function(r,a){var s,o,l,u,h;return s=K(a,["tkhd"])[0],!s||(o=s[0],l=o===0?12:20,u=nt(s[l]<<24|s[l+1]<<16|s[l+2]<<8|s[l+3]),h=K(a,["mdia","mdhd"])[0],!h)?null:(o=h[0],l=o===0?12:20,r[u]=nt(h[l]<<24|h[l+1]<<16|h[l+2]<<8|h[l+3]),r)},t)},Ra=function(e,t){var i,r,a;return i=K(t,["moof","traf"]),r=[].concat.apply([],i.map(function(s){return K(s,["tfhd"]).map(function(o){var l,u,h;return l=nt(o[4]<<24|o[5]<<16|o[6]<<8|o[7]),u=e[l]||9e4,h=K(s,["tfdt"]).map(function(d){var c,y;return c=d[0],y=nt(d[4]<<24|d[5]<<16|d[6]<<8|d[7]),c===1&&(y*=Math.pow(2,32),y+=nt(d[8]<<24|d[9]<<16|d[10]<<8|d[11])),y})[0],h=typeof h=="number"&&!isNaN(h)?h:1/0,h/u})})),a=Math.min.apply(null,r),isFinite(a)?a:0},La=function(e,t){var i=K(t,["moof","traf"]),r=0,a=0,s;if(i&&i.length){var o=K(i[0],["tfhd"])[0],l=K(i[0],["trun"])[0],u=K(i[0],["tfdt"])[0];if(o){var h=bl(o);s=h.trackId}if(u){var d=Tl(u);r=d.baseMediaDecodeTime}if(l){var c=Sl(l);c.samples&&c.samples.length&&(a=c.samples[0].compositionTimeOffset||0)}}var y=e[s]||9e4;return(r+a)/y},Ma=function(e){var t=K(e,["moov","trak"]),i=[];return t.forEach(function(r){var a=K(r,["mdia","hdlr"]),s=K(r,["tkhd"]);a.forEach(function(o,l){var u=at(o.subarray(8,12)),h=s[l],d,c,y;u==="vide"&&(d=new DataView(h.buffer,h.byteOffset,h.byteLength),c=d.getUint8(0),y=c===0?d.getUint32(12):d.getUint32(20),i.push(y))})}),i},mr=function(e){var t=e[0],i=t===0?12:20;return nt(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3])},Ua=function(e){var t=K(e,["moov","trak"]),i=[];return t.forEach(function(r){var a={},s=K(r,["tkhd"])[0],o,l;s&&(o=new DataView(s.buffer,s.byteOffset,s.byteLength),l=o.getUint8(0),a.id=l===0?o.getUint32(12):o.getUint32(20));var u=K(r,["mdia","hdlr"])[0];if(u){var h=at(u.subarray(8,12));h==="vide"?a.type="video":h==="soun"?a.type="audio":a.type=h}var d=K(r,["mdia","minf","stbl","stsd"])[0];if(d){var c=d.subarray(8);a.codec=at(c.subarray(4,8));var y=K(c,[a.codec])[0],p,g;y&&(/^[asm]vc[1-9]$/i.test(a.codec)?(p=y.subarray(78),g=at(p.subarray(4,8)),g==="avcC"&&p.length>11?(a.codec+=".",a.codec+=Et(p[9]),a.codec+=Et(p[10]),a.codec+=Et(p[11])):a.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(a.codec)?(p=y.subarray(28),g=at(p.subarray(4,8)),g==="esds"&&p.length>20&&p[19]!==0?(a.codec+="."+Et(p[19]),a.codec+="."+Et(p[20]>>>2&63).replace(/^0/,"")):a.codec="mp4a.40.2"):a.codec=a.codec.toLowerCase())}var f=K(r,["mdia","mdhd"])[0];f&&(a.timescale=mr(f)),i.push(a)}),i};var wl={findBox:K,parseType:at,timescale:Ia,startTime:Ra,compositionStartTime:La,videoTrackIds:Ma,tracks:Ua,getTimescaleFromMediaHeader:mr},El=function(e){var t,i,r=[],a=[];for(a.byteLength=0,a.nalCount=0,a.duration=0,r.byteLength=0,t=0;t<e.length;t++)i=e[t],i.nalUnitType==="access_unit_delimiter_rbsp"?(r.length&&(r.duration=i.dts-r.dts,a.byteLength+=r.byteLength,a.nalCount+=r.length,a.duration+=r.duration,a.push(r)),r=[i],r.byteLength=i.data.byteLength,r.pts=i.pts,r.dts=i.dts):(i.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(r.keyFrame=!0),r.duration=i.dts-r.dts,r.byteLength+=i.data.byteLength,r.push(i));return a.length&&(!r.duration||r.duration<=0)&&(r.duration=a[a.length-1].duration),a.byteLength+=r.byteLength,a.nalCount+=r.length,a.duration+=r.duration,a.push(r),a},_l=function(e){var t,i,r=[],a=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,a.byteLength=0,a.nalCount=0,a.duration=0,a.pts=e[0].pts,a.dts=e[0].dts,t=0;t<e.length;t++)i=e[t],i.keyFrame?(r.length&&(a.push(r),a.byteLength+=r.byteLength,a.nalCount+=r.nalCount,a.duration+=r.duration),r=[i],r.nalCount=i.length,r.byteLength=i.byteLength,r.pts=i.pts,r.dts=i.dts,r.duration=i.duration):(r.duration+=i.duration,r.nalCount+=i.length,r.byteLength+=i.byteLength,r.push(i));return a.length&&r.duration<=0&&(r.duration=a[a.length-1].duration),a.byteLength+=r.byteLength,a.nalCount+=r.nalCount,a.duration+=r.duration,a.push(r),a},Al=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},Pl=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},ka=function(e,t){var i=Pl();return i.dataOffset=t,i.compositionTimeOffset=e.pts-e.dts,i.duration=e.duration,i.size=4*e.length,i.size+=e.byteLength,e.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},Fl=function(e,t){var i,r,a,s,o,l=t||0,u=[];for(i=0;i<e.length;i++)for(s=e[i],r=0;r<s.length;r++)o=s[r],a=ka(o,l),l+=a.size,u.push(a);return u},Dl=function(e){var t,i,r,a,s,o,l=0,u=e.byteLength,h=e.nalCount,d=u+4*h,c=new Uint8Array(d),y=new DataView(c.buffer);for(t=0;t<e.length;t++)for(a=e[t],i=0;i<a.length;i++)for(s=a[i],r=0;r<s.length;r++)o=s[r],y.setUint32(l,o.data.byteLength),l+=4,c.set(o.data,l),l+=o.data.byteLength;return c},Cl=function(e,t){var i,r=t||0,a=[];return i=ka(e,r),a.push(i),a},Ol=function(e){var t,i,r=0,a=e.byteLength,s=e.length,o=a+4*s,l=new Uint8Array(o),u=new DataView(l.buffer);for(t=0;t<e.length;t++)i=e[t],u.setUint32(r,i.data.byteLength),r+=4,l.set(i.data,r),r+=i.data.byteLength;return l},Na={groupNalsIntoFrames:El,groupFramesIntoGops:_l,extendFirstKeyFrame:Al,generateSampleTable:Fl,concatenateNalData:Dl,generateSampleTableForFrame:Cl,concatenateNalDataForFrame:Ol},$e=[33,16,5,32,164,27],gr=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],$=function(e){for(var t=[];e--;)t.push(0);return t},Il=function(e){return Object.keys(e).reduce(function(t,i){return t[i]=new Uint8Array(e[i].reduce(function(r,a){return r.concat(a)},[])),t},{})},yr,Rl=function(){if(!yr){var n={96e3:[$e,[227,64],$(154),[56]],88200:[$e,[231],$(170),[56]],64e3:[$e,[248,192],$(240),[56]],48e3:[$e,[255,192],$(268),[55,148,128],$(54),[112]],44100:[$e,[255,192],$(268),[55,163,128],$(84),[112]],32e3:[$e,[255,192],$(268),[55,234],$(226),[112]],24e3:[$e,[255,192],$(268),[55,255,128],$(268),[111,112],$(126),[224]],16e3:[$e,[255,192],$(268),[55,255,128],$(268),[111,255],$(269),[223,108],$(195),[1,192]],12e3:[gr,$(268),[3,127,248],$(268),[6,255,240],$(268),[13,255,224],$(268),[27,253,128],$(259),[56]],11025:[gr,$(268),[3,127,248],$(268),[6,255,240],$(268),[13,255,224],$(268),[27,255,192],$(268),[55,175,128],$(108),[112]],8e3:[gr,$(268),[3,121,16],$(47),[7]]};yr=Il(n)}return yr},Ll=Rl,Zt=Be,Ml=function(e){var t,i,r=0;for(t=0;t<e.length;t++)i=e[t],r+=i.data.byteLength;return r},Ul=function(e,t,i,r){var a,s=0,o=0,l=0,u=0,h,d,c;if(!!t.length&&(a=Zt.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),s=Math.ceil(Zt.ONE_SECOND_IN_TS/(e.samplerate/1024)),i&&r&&(o=a-Math.max(i,r),l=Math.floor(o/s),u=l*s),!(l<1||u>Zt.ONE_SECOND_IN_TS/2))){for(h=Ll()[e.samplerate],h||(h=t[0].data),d=0;d<l;d++)c=t[0],t.splice(0,0,{data:h,dts:c.dts-s,pts:c.pts-s});return e.baseMediaDecodeTime-=Math.floor(Zt.videoTsToAudioTs(u,e.samplerate)),u}},kl=function(e,t,i){return t.minSegmentDts>=i?e:(t.minSegmentDts=1/0,e.filter(function(r){return r.dts>=i?(t.minSegmentDts=Math.min(t.minSegmentDts,r.dts),t.minSegmentPts=t.minSegmentDts,!0):!1}))},Nl=function(e){var t,i,r=[];for(t=0;t<e.length;t++)i=e[t],r.push({size:i.data.byteLength,duration:1024});return r},Bl=function(e){var t,i,r=0,a=new Uint8Array(Ml(e));for(t=0;t<e.length;t++)i=e[t],a.set(i.data,r),r+=i.data.byteLength;return a},Ba={prefixWithSilence:Ul,trimAdtsFramesByEarliestDts:kl,generateSampleTable:Nl,concatenateFrameData:Bl},$l=Be.ONE_SECOND_IN_TS,Vl=function(e,t){typeof t.pts=="number"&&(e.timelineStartInfo.pts===void 0&&(e.timelineStartInfo.pts=t.pts),e.minSegmentPts===void 0?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),e.maxSegmentPts===void 0?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),typeof t.dts=="number"&&(e.timelineStartInfo.dts===void 0&&(e.timelineStartInfo.dts=t.dts),e.minSegmentDts===void 0?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.maxSegmentDts===void 0?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))},Hl=function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},zl=function(e,t){var i,r,a=e.minSegmentDts;return t||(a-=e.timelineStartInfo.dts),i=e.timelineStartInfo.baseMediaDecodeTime,i+=a,i=Math.max(0,i),e.type==="audio"&&(r=e.samplerate/$l,i*=r,i=Math.floor(i)),i},ei={clearDtsInfo:Hl,calculateTrackBaseMediaDecodeTime:zl,collectDtsInfo:Vl},$a=4,Gl=128,ql=function(e){for(var t=0,i={payloadType:-1,payloadSize:0},r=0,a=0;t<e.byteLength&&e[t]!==Gl;){for(;e[t]===255;)r+=255,t++;for(r+=e[t++];e[t]===255;)a+=255,t++;if(a+=e[t++],!i.payload&&r===$a){var s=String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6]);if(s==="GA94"){i.payloadType=r,i.payloadSize=a,i.payload=e.subarray(t,t+a);break}else i.payload=void 0}t+=a,r=0,a=0}return i},Wl=function(e){return e.payload[0]!==181||(e.payload[1]<<8|e.payload[2])!==49||String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])!=="GA94"||e.payload[7]!==3?null:e.payload.subarray(8,e.payload.length-1)},Xl=function(e,t){var i=[],r,a,s,o;if(!(t[0]&64))return i;for(a=t[0]&31,r=0;r<a;r++)s=r*3,o={type:t[s+2]&3,pts:e},t[s+2]&4&&(o.ccData=t[s+3]<<8|t[s+4],i.push(o));return i},Yl=function(e){for(var t=e.byteLength,i=[],r=1,a,s;r<t-2;)e[r]===0&&e[r+1]===0&&e[r+2]===3?(i.push(r+2),r+=2):r++;if(i.length===0)return e;a=t-i.length,s=new Uint8Array(a);var o=0;for(r=0;r<a;o++,r++)o===i[0]&&(o++,i.shift()),s[r]=e[o];return s},Va={parseSei:ql,parseUserData:Wl,parseCaptionPackets:Xl,discardEmulationPreventionBytes:Yl,USER_DATA_REGISTERED_ITU_T_T35:$a},vr=he,ti=Va,de=function n(e){e=e||{},n.prototype.init.call(this),this.parse708captions_=typeof e.parse708captions=="boolean"?e.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new X(0,0),new X(0,1),new X(1,0),new X(1,1)],this.parse708captions_&&(this.cc708Stream_=new G({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};de.prototype=new vr,de.prototype.push=function(n){var e,t,i;if(n.nalUnitType==="sei_rbsp"&&(e=ti.parseSei(n.escapedRBSP),!!e.payload&&e.payloadType===ti.USER_DATA_REGISTERED_ITU_T_T35&&(t=ti.parseUserData(e),!!t))){if(n.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(n.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}i=ti.parseCaptionPackets(n.pts,t),this.captionPackets_=this.captionPackets_.concat(i),this.latestDts_!==n.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=n.dts}},de.prototype.flushCCStreams=function(n){this.ccStreams_.forEach(function(e){return n==="flush"?e.flush():e.partialFlush()},this)},de.prototype.flushStream=function(n){if(!this.captionPackets_.length){this.flushCCStreams(n);return}this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(n)},de.prototype.flush=function(){return this.flushStream("flush")},de.prototype.partialFlush=function(){return this.flushStream("partialFlush")},de.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(n){n.reset()})},de.prototype.dispatchCea608Packet=function(n){this.setsTextOrXDSActive(n)?this.activeCea608Channel_[n.type]=null:this.setsChannel1Active(n)?this.activeCea608Channel_[n.type]=0:this.setsChannel2Active(n)&&(this.activeCea608Channel_[n.type]=1),this.activeCea608Channel_[n.type]!==null&&this.ccStreams_[(n.type<<1)+this.activeCea608Channel_[n.type]].push(n)},de.prototype.setsChannel1Active=function(n){return(n.ccData&30720)===4096},de.prototype.setsChannel2Active=function(n){return(n.ccData&30720)===6144},de.prototype.setsTextOrXDSActive=function(n){return(n.ccData&28928)===256||(n.ccData&30974)===4138||(n.ccData&30974)===6186},de.prototype.dispatchCea708Packet=function(n){this.parse708captions_&&this.cc708Stream_.push(n)};var jl={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},Kl=function(e){var t=jl[e]||e;return e&4096&&e===t?"":String.fromCharCode(t)},ii=function(e){return 32<=e&&e<=127||160<=e&&e<=255},Ie=function(e){this.windowNum=e,this.reset()};Ie.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Ie.prototype.getText=function(){return this.rows.join(`
`)},Ie.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Ie.prototype.newLine=function(n){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(n),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Ie.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},Ie.prototype.addText=function(n){this.rows[this.rowIdx]+=n},Ie.prototype.backspace=function(){if(!this.isEmpty()){var n=this.rows[this.rowIdx];this.rows[this.rowIdx]=n.substr(0,n.length-1)}};var ri=function(e,t,i){this.serviceNum=e,this.text="",this.currentWindow=new Ie(-1),this.windows=[],this.stream=i,typeof t=="string"&&this.createTextDecoder(t)};ri.prototype.init=function(n,e){this.startPts=n;for(var t=0;t<8;t++)this.windows[t]=new Ie(t),typeof e=="function"&&(this.windows[t].beforeRowOverflow=e)},ri.prototype.setCurrentWindow=function(n){this.currentWindow=this.windows[n]},ri.prototype.createTextDecoder=function(n){if(typeof TextDecoder=="undefined")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(n)}catch(e){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+n+" encoding. "+e})}};var G=function n(e){e=e||{},n.prototype.init.call(this);var t=this,i=e.captionServices||{},r={},a;Object.keys(i).forEach(function(s){a=i[s],/^SERVICE/.test(s)&&(r[s]=a.encoding)}),this.serviceEncodings=r,this.current708Packet=null,this.services={},this.push=function(s){s.type===3?(t.new708Packet(),t.add708Bytes(s)):(t.current708Packet===null&&t.new708Packet(),t.add708Bytes(s))}};G.prototype=new vr,G.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},G.prototype.add708Bytes=function(n){var e=n.ccData,t=e>>>8,i=e&255;this.current708Packet.ptsVals.push(n.pts),this.current708Packet.data.push(t),this.current708Packet.data.push(i)},G.prototype.push708Packet=function(){var n=this.current708Packet,e=n.data,t=null,i=null,r=0,a=e[r++];for(n.seq=a>>6,n.sizeCode=a&63;r<e.length;r++)a=e[r++],t=a>>5,i=a&31,t===7&&i>0&&(a=e[r++],t=a),this.pushServiceBlock(t,r,i),i>0&&(r+=i-1)},G.prototype.pushServiceBlock=function(n,e,t){var i,r=e,a=this.current708Packet.data,s=this.services[n];for(s||(s=this.initService(n,r));r<e+t&&r<a.length;r++)i=a[r],ii(i)?r=this.handleText(r,s):i===24?r=this.multiByteCharacter(r,s):i===16?r=this.extendedCommands(r,s):128<=i&&i<=135?r=this.setCurrentWindow(r,s):152<=i&&i<=159?r=this.defineWindow(r,s):i===136?r=this.clearWindows(r,s):i===140?r=this.deleteWindows(r,s):i===137?r=this.displayWindows(r,s):i===138?r=this.hideWindows(r,s):i===139?r=this.toggleWindows(r,s):i===151?r=this.setWindowAttributes(r,s):i===144?r=this.setPenAttributes(r,s):i===145?r=this.setPenColor(r,s):i===146?r=this.setPenLocation(r,s):i===143?s=this.reset(r,s):i===8?s.currentWindow.backspace():i===12?s.currentWindow.clearText():i===13?s.currentWindow.pendingNewLine=!0:i===14?s.currentWindow.clearText():i===141&&r++},G.prototype.extendedCommands=function(n,e){var t=this.current708Packet.data,i=t[++n];return ii(i)&&(n=this.handleText(n,e,{isExtended:!0})),n},G.prototype.getPts=function(n){return this.current708Packet.ptsVals[Math.floor(n/2)]},G.prototype.initService=function(n,e){var i="SERVICE"+n,t=this,i,r;return i in this.serviceEncodings&&(r=this.serviceEncodings[i]),this.services[n]=new ri(n,r,t),this.services[n].init(this.getPts(e),function(a){t.flushDisplayed(a,t.services[n])}),this.services[n]},G.prototype.handleText=function(n,e,t){var i=t&&t.isExtended,r=t&&t.isMultiByte,a=this.current708Packet.data,s=i?4096:0,o=a[n],l=a[n+1],u=e.currentWindow,h,d;return e.textDecoder_&&!i?(r?(d=[o,l],n++):d=[o],h=e.textDecoder_.decode(new Uint8Array(d))):h=Kl(s|o),u.pendingNewLine&&!u.isEmpty()&&u.newLine(this.getPts(n)),u.pendingNewLine=!1,u.addText(h),n},G.prototype.multiByteCharacter=function(n,e){var t=this.current708Packet.data,i=t[n+1],r=t[n+2];return ii(i)&&ii(r)&&(n=this.handleText(++n,e,{isMultiByte:!0})),n},G.prototype.setCurrentWindow=function(n,e){var t=this.current708Packet.data,i=t[n],r=i&7;return e.setCurrentWindow(r),n},G.prototype.defineWindow=function(n,e){var t=this.current708Packet.data,i=t[n],r=i&7;e.setCurrentWindow(r);var a=e.currentWindow;return i=t[++n],a.visible=(i&32)>>5,a.rowLock=(i&16)>>4,a.columnLock=(i&8)>>3,a.priority=i&7,i=t[++n],a.relativePositioning=(i&128)>>7,a.anchorVertical=i&127,i=t[++n],a.anchorHorizontal=i,i=t[++n],a.anchorPoint=(i&240)>>4,a.rowCount=i&15,i=t[++n],a.columnCount=i&63,i=t[++n],a.windowStyle=(i&56)>>3,a.penStyle=i&7,a.virtualRowCount=a.rowCount+1,n},G.prototype.setWindowAttributes=function(n,e){var t=this.current708Packet.data,i=t[n],r=e.currentWindow.winAttr;return i=t[++n],r.fillOpacity=(i&192)>>6,r.fillRed=(i&48)>>4,r.fillGreen=(i&12)>>2,r.fillBlue=i&3,i=t[++n],r.borderType=(i&192)>>6,r.borderRed=(i&48)>>4,r.borderGreen=(i&12)>>2,r.borderBlue=i&3,i=t[++n],r.borderType+=(i&128)>>5,r.wordWrap=(i&64)>>6,r.printDirection=(i&48)>>4,r.scrollDirection=(i&12)>>2,r.justify=i&3,i=t[++n],r.effectSpeed=(i&240)>>4,r.effectDirection=(i&12)>>2,r.displayEffect=i&3,n},G.prototype.flushDisplayed=function(n,e){for(var t=[],i=0;i<8;i++)e.windows[i].visible&&!e.windows[i].isEmpty()&&t.push(e.windows[i].getText());e.endPts=n,e.text=t.join(`

`),this.pushCaption(e),e.startPts=n},G.prototype.pushCaption=function(n){n.text!==""&&(this.trigger("data",{startPts:n.startPts,endPts:n.endPts,text:n.text,stream:"cc708_"+n.serviceNum}),n.text="",n.startPts=n.endPts)},G.prototype.displayWindows=function(n,e){var t=this.current708Packet.data,i=t[++n],r=this.getPts(n);this.flushDisplayed(r,e);for(var a=0;a<8;a++)i&1<<a&&(e.windows[a].visible=1);return n},G.prototype.hideWindows=function(n,e){var t=this.current708Packet.data,i=t[++n],r=this.getPts(n);this.flushDisplayed(r,e);for(var a=0;a<8;a++)i&1<<a&&(e.windows[a].visible=0);return n},G.prototype.toggleWindows=function(n,e){var t=this.current708Packet.data,i=t[++n],r=this.getPts(n);this.flushDisplayed(r,e);for(var a=0;a<8;a++)i&1<<a&&(e.windows[a].visible^=1);return n},G.prototype.clearWindows=function(n,e){var t=this.current708Packet.data,i=t[++n],r=this.getPts(n);this.flushDisplayed(r,e);for(var a=0;a<8;a++)i&1<<a&&e.windows[a].clearText();return n},G.prototype.deleteWindows=function(n,e){var t=this.current708Packet.data,i=t[++n],r=this.getPts(n);this.flushDisplayed(r,e);for(var a=0;a<8;a++)i&1<<a&&e.windows[a].reset();return n},G.prototype.setPenAttributes=function(n,e){var t=this.current708Packet.data,i=t[n],r=e.currentWindow.penAttr;return i=t[++n],r.textTag=(i&240)>>4,r.offset=(i&12)>>2,r.penSize=i&3,i=t[++n],r.italics=(i&128)>>7,r.underline=(i&64)>>6,r.edgeType=(i&56)>>3,r.fontStyle=i&7,n},G.prototype.setPenColor=function(n,e){var t=this.current708Packet.data,i=t[n],r=e.currentWindow.penColor;return i=t[++n],r.fgOpacity=(i&192)>>6,r.fgRed=(i&48)>>4,r.fgGreen=(i&12)>>2,r.fgBlue=i&3,i=t[++n],r.bgOpacity=(i&192)>>6,r.bgRed=(i&48)>>4,r.bgGreen=(i&12)>>2,r.bgBlue=i&3,i=t[++n],r.edgeRed=(i&48)>>4,r.edgeGreen=(i&12)>>2,r.edgeBlue=i&3,n},G.prototype.setPenLocation=function(n,e){var t=this.current708Packet.data,i=t[n],r=e.currentWindow.penLoc;return e.currentWindow.pendingNewLine=!0,i=t[++n],r.row=i&15,i=t[++n],r.column=i&63,n},G.prototype.reset=function(n,e){var t=this.getPts(n);return this.flushDisplayed(t,e),this.initService(e.serviceNum,n)};var Ql={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},ni=function(e){return e===null?"":(e=Ql[e]||e,String.fromCharCode(e))},ai=14,Jl=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Qe=function(){for(var e=[],t=ai+1;t--;)e.push("");return e},X=function n(e,t){n.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(i){var r,a,s,o,l;if(r=i.ccData&32639,r===this.lastControlCode_){this.lastControlCode_=null;return}if((r&61440)===4096?this.lastControlCode_=r:r!==this.PADDING_&&(this.lastControlCode_=null),s=r>>>8,o=r&255,r!==this.PADDING_)if(r===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(r===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(i.pts),this.flushDisplayed(i.pts),a=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=a,this.startPts_=i.pts;else if(r===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(i.pts);else if(r===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(i.pts);else if(r===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(i.pts);else if(r===this.CARRIAGE_RETURN_)this.clearFormatting(i.pts),this.flushDisplayed(i.pts),this.shiftRowsUp_(),this.startPts_=i.pts;else if(r===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(r===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(i.pts),this.displayed_=Qe();else if(r===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Qe();else if(r===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(i.pts),this.displayed_=Qe()),this.mode_="paintOn",this.startPts_=i.pts;else if(this.isSpecialCharacter(s,o))s=(s&3)<<8,l=ni(s|o),this[this.mode_](i.pts,l),this.column_++;else if(this.isExtCharacter(s,o))this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),s=(s&3)<<8,l=ni(s|o),this[this.mode_](i.pts,l),this.column_++;else if(this.isMidRowCode(s,o))this.clearFormatting(i.pts),this[this.mode_](i.pts," "),this.column_++,(o&14)===14&&this.addFormatting(i.pts,["i"]),(o&1)===1&&this.addFormatting(i.pts,["u"]);else if(this.isOffsetControlCode(s,o))this.column_+=o&3;else if(this.isPAC(s,o)){var u=Jl.indexOf(r&7968);this.mode_==="rollUp"&&(u-this.rollUpRows_+1<0&&(u=this.rollUpRows_-1),this.setRollUp(i.pts,u)),u!==this.row_&&(this.clearFormatting(i.pts),this.row_=u),o&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(i.pts,["u"]),(r&16)===16&&(this.column_=((r&14)>>1)*4),this.isColorPAC(o)&&(o&14)===14&&this.addFormatting(i.pts,["i"])}else this.isNormalChar(s)&&(o===0&&(o=null),l=ni(s),l+=ni(o),this[this.mode_](i.pts,l),this.column_+=l.length)}};X.prototype=new vr,X.prototype.flushDisplayed=function(n){var e=this.displayed_.map(function(t,i){try{return t.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+i+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:n,text:e,stream:this.name_})},X.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Qe(),this.nonDisplayed_=Qe(),this.lastControlCode_=null,this.column_=0,this.row_=ai,this.rollUpRows_=2,this.formatting_=[]},X.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},X.prototype.isSpecialCharacter=function(n,e){return n===this.EXT_&&e>=48&&e<=63},X.prototype.isExtCharacter=function(n,e){return(n===this.EXT_+1||n===this.EXT_+2)&&e>=32&&e<=63},X.prototype.isMidRowCode=function(n,e){return n===this.EXT_&&e>=32&&e<=47},X.prototype.isOffsetControlCode=function(n,e){return n===this.OFFSET_&&e>=33&&e<=35},X.prototype.isPAC=function(n,e){return n>=this.BASE_&&n<this.BASE_+8&&e>=64&&e<=127},X.prototype.isColorPAC=function(n){return n>=64&&n<=79||n>=96&&n<=127},X.prototype.isNormalChar=function(n){return n>=32&&n<=127},X.prototype.setRollUp=function(n,e){if(this.mode_!=="rollUp"&&(this.row_=ai,this.mode_="rollUp",this.flushDisplayed(n),this.nonDisplayed_=Qe(),this.displayed_=Qe()),e!==void 0&&e!==this.row_)for(var t=0;t<this.rollUpRows_;t++)this.displayed_[e-t]=this.displayed_[this.row_-t],this.displayed_[this.row_-t]="";e===void 0&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},X.prototype.addFormatting=function(n,e){this.formatting_=this.formatting_.concat(e);var t=e.reduce(function(i,r){return i+"<"+r+">"},"");this[this.mode_](n,t)},X.prototype.clearFormatting=function(n){if(!!this.formatting_.length){var e=this.formatting_.reverse().reduce(function(t,i){return t+"</"+i+">"},"");this.formatting_=[],this[this.mode_](n,e)}},X.prototype.popOn=function(n,e){var t=this.nonDisplayed_[this.row_];t+=e,this.nonDisplayed_[this.row_]=t},X.prototype.rollUp=function(n,e){var t=this.displayed_[this.row_];t+=e,this.displayed_[this.row_]=t},X.prototype.shiftRowsUp_=function(){var n;for(n=0;n<this.topRow_;n++)this.displayed_[n]="";for(n=this.row_+1;n<ai+1;n++)this.displayed_[n]="";for(n=this.topRow_;n<this.row_;n++)this.displayed_[n]=this.displayed_[n+1];this.displayed_[this.row_]=""},X.prototype.paintOn=function(n,e){var t=this.displayed_[this.row_];t+=e,this.displayed_[this.row_]=t};var Ha={CaptionStream:de,Cea608Stream:X,Cea708Stream:G},si={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Zl=he,eu=8589934592,tu=4294967296,za="shared",xr=function(e,t){var i=1;for(e>t&&(i=-1);Math.abs(t-e)>tu;)e+=i*eu;return e},Ga=function n(e){var t,i;n.prototype.init.call(this),this.type_=e||za,this.push=function(r){this.type_!==za&&r.type!==this.type_||(i===void 0&&(i=r.dts),r.dts=xr(r.dts,i),r.pts=xr(r.pts,i),t=r.dts,this.trigger("data",r))},this.flush=function(){i=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){i=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Ga.prototype=new Zl;var qa={TimestampRolloverStream:Ga,handleRollover:xr},iu=he,ru=si,Wa=function(e,t,i){var r,a="";for(r=t;r<i;r++)a+="%"+("00"+e[r].toString(16)).slice(-2);return a},oi=function(e,t,i){return decodeURIComponent(Wa(e,t,i))},nu=function(e,t,i){return unescape(Wa(e,t,i))},li=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Xa={TXXX:function(e){var t;if(e.data[0]===3){for(t=1;t<e.data.length;t++)if(e.data[t]===0){e.description=oi(e.data,1,t),e.value=oi(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(e.data[0]===3){for(t=1;t<e.data.length;t++)if(e.data[t]===0){e.description=oi(e.data,1,t),e.url=oi(e.data,t+1,e.data.length);break}}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(e.data[t]===0){e.owner=nu(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},ui;ui=function(e){var t={descriptor:e&&e.descriptor},i=0,r=[],a=0,s;if(ui.prototype.init.call(this),this.dispatchType=ru.METADATA_STREAM_TYPE.toString(16),t.descriptor)for(s=0;s<t.descriptor.length;s++)this.dispatchType+=("00"+t.descriptor[s].toString(16)).slice(-2);this.push=function(o){var l,u,h,d,c,y;if(o.type==="timed-metadata"){if(o.dataAlignmentIndicator&&(a=0,r.length=0),r.length===0&&(o.data.length<10||o.data[0]!=="I".charCodeAt(0)||o.data[1]!=="D".charCodeAt(0)||o.data[2]!=="3".charCodeAt(0))){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(r.push(o),a+=o.data.byteLength,r.length===1&&(i=li(o.data.subarray(6,10)),i+=10),!(a<i)){for(l={data:new Uint8Array(i),frames:[],pts:r[0].pts,dts:r[0].dts},c=0;c<i;)l.data.set(r[0].data.subarray(0,i-c),c),c+=r[0].data.byteLength,a-=r[0].data.byteLength,r.shift();u=10,l.data[5]&64&&(u+=4,u+=li(l.data.subarray(10,14)),i-=li(l.data.subarray(16,20)));do{if(h=li(l.data.subarray(u+4,u+8)),h<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping metadata parsing."});return}if(y=String.fromCharCode(l.data[u],l.data[u+1],l.data[u+2],l.data[u+3]),d={id:y,data:l.data.subarray(u+10,u+h+10)},d.key=d.id,Xa[d.id]&&(Xa[d.id](d),d.owner==="com.apple.streaming.transportStreamTimestamp")){var p=d.data,g=(p[3]&1)<<30|p[4]<<22|p[5]<<14|p[6]<<6|p[7]>>>2;g*=4,g+=p[7]&3,d.timeStamp=g,l.pts===void 0&&l.dts===void 0&&(l.pts=d.timeStamp,l.dts=d.timeStamp),this.trigger("timestamp",d)}l.frames.push(d),u+=10,u+=h}while(u<i);this.trigger("data",l)}}}},ui.prototype=new iu;var au=ui,br=he,Sr=Ha,xe=si,su=qa.TimestampRolloverStream,hi,_t,di,st=188,Tr=71;hi=function(){var e=new Uint8Array(st),t=0;hi.prototype.init.call(this),this.push=function(i){var r=0,a=st,s;for(t?(s=new Uint8Array(i.byteLength+t),s.set(e.subarray(0,t)),s.set(i,t),t=0):s=i;a<s.byteLength;){if(s[r]===Tr&&s[a]===Tr){this.trigger("data",s.subarray(r,a)),r+=st,a+=st;continue}r++,a++}r<s.byteLength&&(e.set(s.subarray(r),0),t=s.byteLength-r)},this.flush=function(){t===st&&e[0]===Tr&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}},hi.prototype=new br,_t=function(){var e,t,i,r;_t.prototype.init.call(this),r=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(s,o){var l=0;o.payloadUnitStartIndicator&&(l+=s[l]+1),o.type==="pat"?t(s.subarray(l),o):i(s.subarray(l),o)},t=function(s,o){o.section_number=s[7],o.last_section_number=s[8],r.pmtPid=(s[10]&31)<<8|s[11],o.pmtPid=r.pmtPid},i=function(s,o){var l,u,h,d;if(!!(s[5]&1)){for(r.programMapTable={video:null,audio:null,"timed-metadata":{}},l=(s[1]&15)<<8|s[2],u=3+l-4,h=(s[10]&15)<<8|s[11],d=12+h;d<u;){var c=s[d],y=(s[d+1]&31)<<8|s[d+2];c===xe.H264_STREAM_TYPE&&r.programMapTable.video===null?r.programMapTable.video=y:c===xe.ADTS_STREAM_TYPE&&r.programMapTable.audio===null?r.programMapTable.audio=y:c===xe.METADATA_STREAM_TYPE&&(r.programMapTable["timed-metadata"][y]=c),d+=((s[d+3]&15)<<8|s[d+4])+5}o.programMapTable=r.programMapTable}},this.push=function(a){var s={},o=4;if(s.payloadUnitStartIndicator=!!(a[1]&64),s.pid=a[1]&31,s.pid<<=8,s.pid|=a[2],(a[3]&48)>>>4>1&&(o+=a[o]+1),s.pid===0)s.type="pat",e(a.subarray(o),s),this.trigger("data",s);else if(s.pid===this.pmtPid)for(s.type="pmt",e(a.subarray(o),s),this.trigger("data",s);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([a,o,s]):this.processPes_(a,o,s)},this.processPes_=function(a,s,o){o.pid===this.programMapTable.video?o.streamType=xe.H264_STREAM_TYPE:o.pid===this.programMapTable.audio?o.streamType=xe.ADTS_STREAM_TYPE:o.streamType=this.programMapTable["timed-metadata"][o.pid],o.type="pes",o.data=a.subarray(s),this.trigger("data",o)}},_t.prototype=new br,_t.STREAM_TYPES={h264:27,adts:15},di=function(){var e=this,t=!1,i={data:[],size:0},r={data:[],size:0},a={data:[],size:0},s,o=function(h,d){var c,y=h[0]<<16|h[1]<<8|h[2];d.data=new Uint8Array,y===1&&(d.packetLength=6+(h[4]<<8|h[5]),d.dataAlignmentIndicator=(h[6]&4)!==0,c=h[7],c&192&&(d.pts=(h[9]&14)<<27|(h[10]&255)<<20|(h[11]&254)<<12|(h[12]&255)<<5|(h[13]&254)>>>3,d.pts*=4,d.pts+=(h[13]&6)>>>1,d.dts=d.pts,c&64&&(d.dts=(h[14]&14)<<27|(h[15]&255)<<20|(h[16]&254)<<12|(h[17]&255)<<5|(h[18]&254)>>>3,d.dts*=4,d.dts+=(h[18]&6)>>>1)),d.data=h.subarray(9+h[8]))},l=function(h,d,c){var y=new Uint8Array(h.size),p={type:d},g=0,f=0,E=!1,_;if(!(!h.data.length||h.size<9)){for(p.trackId=h.data[0].pid,g=0;g<h.data.length;g++)_=h.data[g],y.set(_.data,f),f+=_.data.byteLength;o(y,p),E=d==="video"||p.packetLength<=h.size,(c||E)&&(h.size=0,h.data.length=0),E&&e.trigger("data",p)}};di.prototype.init.call(this),this.push=function(u){({pat:function(){},pes:function(){var d,c;switch(u.streamType){case xe.H264_STREAM_TYPE:d=i,c="video";break;case xe.ADTS_STREAM_TYPE:d=r,c="audio";break;case xe.METADATA_STREAM_TYPE:d=a,c="timed-metadata";break;default:return}u.payloadUnitStartIndicator&&l(d,c,!0),d.data.push(u),d.size+=u.data.byteLength},pmt:function(){var d={type:"metadata",tracks:[]};s=u.programMapTable,s.video!==null&&d.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.video,codec:"avc",type:"video"}),s.audio!==null&&d.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.audio,codec:"adts",type:"audio"}),t=!0,e.trigger("data",d)}})[u.type]()},this.reset=function(){i.size=0,i.data.length=0,r.size=0,r.data.length=0,this.trigger("reset")},this.flushStreams_=function(){l(i,"video"),l(r,"audio"),l(a,"timed-metadata")},this.flush=function(){if(!t&&s){var u={type:"metadata",tracks:[]};s.video!==null&&u.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.video,codec:"avc",type:"video"}),s.audio!==null&&u.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.audio,codec:"adts",type:"audio"}),e.trigger("data",u)}t=!1,this.flushStreams_(),this.trigger("done")}},di.prototype=new br;var Ya={PAT_PID:0,MP2T_PACKET_LENGTH:st,TransportPacketStream:hi,TransportParseStream:_t,ElementaryStream:di,TimestampRolloverStream:su,CaptionStream:Sr.CaptionStream,Cea608Stream:Sr.Cea608Stream,Cea708Stream:Sr.Cea708Stream,MetadataStream:au};for(var wr in xe)xe.hasOwnProperty(wr)&&(Ya[wr]=xe[wr]);var ci=Ya,ou=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],ja=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],r=e[t+5],a=(r&16)>>4;return i=i>=0?i:0,a?i+20:i+10},lu=function n(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=ja(e,t),n(e,t))},uu=function(e){var t=lu(e,0);return e.length>=t+2&&(e[t]&255)===255&&(e[t+1]&240)===240&&(e[t+1]&22)===16},Ka=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},hu=function(e,t,i){var r,a="";for(r=t;r<i;r++)a+="%"+("00"+e[r].toString(16)).slice(-2);return a},du=function(e,t,i){return unescape(hu(e,t,i))},cu=function(e,t){var i=(e[t+5]&224)>>5,r=e[t+4]<<3,a=e[t+3]&3<<11;return a|r|i},fu=function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":e[t]&!0&&(e[t+1]&240)===240?"audio":null},pu=function(e){for(var t=0;t+5<e.length;){if(e[t]!==255||(e[t+1]&246)!==240){t++;continue}return ou[(e[t+2]&60)>>>2]}return null},mu=function(e){var t,i,r,a;t=10,e[5]&64&&(t+=4,t+=Ka(e.subarray(10,14)));do{if(i=Ka(e.subarray(t+4,t+8)),i<1)return null;if(a=String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]),a==="PRIV"){r=e.subarray(t+10,t+i+10);for(var s=0;s<r.byteLength;s++)if(r[s]===0){var o=du(r,0,s);if(o==="com.apple.streaming.transportStreamTimestamp"){var l=r.subarray(s+1),u=(l[3]&1)<<30|l[4]<<22|l[5]<<14|l[6]<<6|l[7]>>>2;return u*=4,u+=l[7]&3,u}break}}t+=10,t+=i}while(t<e.byteLength);return null},fi={isLikelyAacData:uu,parseId3TagSize:ja,parseAdtsSize:cu,parseType:fu,parseSampleRate:pu,parseAacTimestamp:mu},gu=he,Qa=fi,pi;pi=function(){var e=new Uint8Array,t=0;pi.prototype.init.call(this),this.setTimestamp=function(i){t=i},this.push=function(i){var r=0,a=0,s,o,l,u;for(e.length?(u=e.length,e=new Uint8Array(i.byteLength+u),e.set(e.subarray(0,u)),e.set(i,u)):e=i;e.length-a>=3;){if(e[a]==="I".charCodeAt(0)&&e[a+1]==="D".charCodeAt(0)&&e[a+2]==="3".charCodeAt(0)){if(e.length-a<10||(r=Qa.parseId3TagSize(e,a),a+r>e.length))break;o={type:"timed-metadata",data:e.subarray(a,a+r)},this.trigger("data",o),a+=r;continue}else if((e[a]&255)===255&&(e[a+1]&240)===240){if(e.length-a<7||(r=Qa.parseAdtsSize(e,a),a+r>e.length))break;l={type:"audio",data:e.subarray(a,a+r),pts:t,dts:t},this.trigger("data",l),a+=r;continue}a++}s=e.length-a,s>0?e=e.subarray(a):e=new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}},pi.prototype=new gu;var Ja=pi,yu=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Za=yu,vu=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],es=vu,mi=he,At=Qt,Pt=Na,gi=Ba,be=ei,Re=ci,yi=Be,ts=Yt,xu=ar.H264Stream,bu=Ja,Su=fi.isLikelyAacData,Tu=Be.ONE_SECOND_IN_TS,Er=Za,_r=es,Ft,ot,vi,Je,wu=function(e,t){t.stream=e,this.trigger("log",t)},is=function(e,t){for(var i=Object.keys(t),r=0;r<i.length;r++){var a=i[r];a==="headOfPipeline"||!t[a].on||t[a].on("log",wu.bind(e,a))}},rs=function(e,t){var i;if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},Ar=function(e,t,i,r,a,s){var o=i-t,l=r-t,u=a-i;return{start:{dts:e,pts:e+o},end:{dts:e+l,pts:e+u},prependedContentDuration:s,baseMediaDecodeTime:e}};ot=function(e,t){var i=[],r,a=0,s=0,o=1/0;t=t||{},r=t.firstSequenceNumber||0,ot.prototype.init.call(this),this.push=function(l){be.collectDtsInfo(e,l),e&&Er.forEach(function(u){e[u]=l[u]}),i.push(l)},this.setEarliestDts=function(l){a=l},this.setVideoBaseMediaDecodeTime=function(l){o=l},this.setAudioAppendStart=function(l){s=l},this.flush=function(){var l,u,h,d,c,y,p;if(i.length===0){this.trigger("done","AudioSegmentStream");return}l=gi.trimAdtsFramesByEarliestDts(i,e,a),e.baseMediaDecodeTime=be.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),p=gi.prefixWithSilence(e,l,s,o),e.samples=gi.generateSampleTable(l),h=At.mdat(gi.concatenateFrameData(l)),i=[],u=At.moof(r,[e]),d=new Uint8Array(u.byteLength+h.byteLength),r++,d.set(u),d.set(h,u.byteLength),be.clearDtsInfo(e),c=Math.ceil(Tu*1024/e.samplerate),l.length&&(y=l.length*c,this.trigger("segmentTimingInfo",Ar(yi.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),l[0].dts,l[0].pts,l[0].dts+y,l[0].pts+y,p||0)),this.trigger("timingInfo",{start:l[0].pts,end:l[0].pts+y})),this.trigger("data",{track:e,boxes:d}),this.trigger("done","AudioSegmentStream")},this.reset=function(){be.clearDtsInfo(e),i=[],this.trigger("reset")}},ot.prototype=new mi,Ft=function(e,t){var i,r=[],a=[],s,o;t=t||{},i=t.firstSequenceNumber||0,Ft.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(l){be.collectDtsInfo(e,l),l.nalUnitType==="seq_parameter_set_rbsp"&&!s&&(s=l.config,e.sps=[l.data],_r.forEach(function(u){e[u]=s[u]},this)),l.nalUnitType==="pic_parameter_set_rbsp"&&!o&&(o=l.data,e.pps=[l.data]),r.push(l)},this.flush=function(){for(var l,u,h,d,c,y,p=0,g,f;r.length&&r[0].nalUnitType!=="access_unit_delimiter_rbsp";)r.shift();if(r.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(l=Pt.groupNalsIntoFrames(r),h=Pt.groupFramesIntoGops(l),h[0][0].keyFrame||(u=this.getGopForFusion_(r[0],e),u?(p=u.duration,h.unshift(u),h.byteLength+=u.byteLength,h.nalCount+=u.nalCount,h.pts=u.pts,h.dts=u.dts,h.duration+=u.duration):h=Pt.extendFirstKeyFrame(h)),a.length){var E;if(t.alignGopsAtEnd?E=this.alignGopsAtEnd_(h):E=this.alignGopsAtStart_(h),!E){this.gopCache_.unshift({gop:h.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),r=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}be.clearDtsInfo(e),h=E}be.collectDtsInfo(e,h),e.samples=Pt.generateSampleTable(h),c=At.mdat(Pt.concatenateNalData(h)),e.baseMediaDecodeTime=be.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",h.map(function(_){return{pts:_.pts,dts:_.dts,byteLength:_.byteLength}})),g=h[0],f=h[h.length-1],this.trigger("segmentTimingInfo",Ar(e.baseMediaDecodeTime,g.dts,g.pts,f.dts+f.duration,f.pts+f.duration,p)),this.trigger("timingInfo",{start:h[0].pts,end:h[h.length-1].pts+h[h.length-1].duration}),this.gopCache_.unshift({gop:h.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),r=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),d=At.moof(i,[e]),y=new Uint8Array(d.byteLength+c.byteLength),i++,y.set(d),y.set(c,d.byteLength),this.trigger("data",{track:e,boxes:y}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),r=[],this.gopCache_.length=0,a.length=0,this.trigger("reset")},this.resetStream_=function(){be.clearDtsInfo(e),s=void 0,o=void 0},this.getGopForFusion_=function(l){var u=45e3,h=1e4,d=1/0,c,y,p,g,f;for(f=0;f<this.gopCache_.length;f++)g=this.gopCache_[f],p=g.gop,!(!(e.pps&&rs(e.pps[0],g.pps[0]))||!(e.sps&&rs(e.sps[0],g.sps[0])))&&(p.dts<e.timelineStartInfo.dts||(c=l.dts-p.dts-p.duration,c>=-h&&c<=u&&(!y||d>c)&&(y=g,d=c)));return y?y.gop:null},this.alignGopsAtStart_=function(l){var u,h,d,c,y,p,g,f;for(y=l.byteLength,p=l.nalCount,g=l.duration,u=h=0;u<a.length&&h<l.length&&(d=a[u],c=l[h],d.pts!==c.pts);){if(c.pts>d.pts){u++;continue}h++,y-=c.byteLength,p-=c.nalCount,g-=c.duration}return h===0?l:h===l.length?null:(f=l.slice(h),f.byteLength=y,f.duration=g,f.nalCount=p,f.pts=f[0].pts,f.dts=f[0].dts,f)},this.alignGopsAtEnd_=function(l){var u,h,d,c,y,p;for(u=a.length-1,h=l.length-1,y=null,p=!1;u>=0&&h>=0;){if(d=a[u],c=l[h],d.pts===c.pts){p=!0;break}if(d.pts>c.pts){u--;continue}u===a.length-1&&(y=h),h--}if(!p&&y===null)return null;var g;if(p?g=h:g=y,g===0)return l;var f=l.slice(g),E=f.reduce(function(_,S){return _.byteLength+=S.byteLength,_.duration+=S.duration,_.nalCount+=S.nalCount,_},{byteLength:0,duration:0,nalCount:0});return f.byteLength=E.byteLength,f.duration=E.duration,f.nalCount=E.nalCount,f.pts=f[0].pts,f.dts=f[0].dts,f},this.alignGopsWith=function(l){a=l}},Ft.prototype=new mi,Je=function(e,t){this.numberOfTracks=0,this.metadataStream=t,e=e||{},typeof e.remux!="undefined"?this.remuxTracks=!!e.remux:this.remuxTracks=!0,typeof e.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,Je.prototype.init.call(this),this.push=function(i){if(i.text)return this.pendingCaptions.push(i);if(i.frames)return this.pendingMetadata.push(i);this.pendingTracks.push(i.track),this.pendingBytes+=i.boxes.byteLength,i.track.type==="video"&&(this.videoTrack=i.track,this.pendingBoxes.push(i.boxes)),i.track.type==="audio"&&(this.audioTrack=i.track,this.pendingBoxes.unshift(i.boxes))}},Je.prototype=new mi,Je.prototype.flush=function(n){var e=0,t={captions:[],captionStreams:{},metadata:[],info:{}},i,r,a,s=0,o;if(this.pendingTracks.length<this.numberOfTracks){if(n!=="VideoSegmentStream"&&n!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(s=this.videoTrack.timelineStartInfo.pts,_r.forEach(function(l){t.info[l]=this.videoTrack[l]},this)):this.audioTrack&&(s=this.audioTrack.timelineStartInfo.pts,Er.forEach(function(l){t.info[l]=this.audioTrack[l]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?t.type=this.pendingTracks[0].type:t.type="combined",this.emittedTracks+=this.pendingTracks.length,a=At.initSegment(this.pendingTracks),t.initSegment=new Uint8Array(a.byteLength),t.initSegment.set(a),t.data=new Uint8Array(this.pendingBytes),o=0;o<this.pendingBoxes.length;o++)t.data.set(this.pendingBoxes[o],e),e+=this.pendingBoxes[o].byteLength;for(o=0;o<this.pendingCaptions.length;o++)i=this.pendingCaptions[o],i.startTime=yi.metadataTsToSeconds(i.startPts,s,this.keepOriginalTimestamps),i.endTime=yi.metadataTsToSeconds(i.endPts,s,this.keepOriginalTimestamps),t.captionStreams[i.stream]=!0,t.captions.push(i);for(o=0;o<this.pendingMetadata.length;o++)r=this.pendingMetadata[o],r.cueTime=yi.metadataTsToSeconds(r.pts,s,this.keepOriginalTimestamps),t.metadata.push(r);for(t.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",t),o=0;o<t.captions.length;o++)i=t.captions[o],this.trigger("caption",i);for(o=0;o<t.metadata.length;o++)r=t.metadata[o],this.trigger("id3Frame",r)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},Je.prototype.setRemux=function(n){this.remuxTracks=n},vi=function(e){var t=this,i=!0,r,a;vi.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var s={};this.transmuxPipeline_=s,s.type="aac",s.metadataStream=new Re.MetadataStream,s.aacStream=new bu,s.audioTimestampRolloverStream=new Re.TimestampRolloverStream("audio"),s.timedMetadataTimestampRolloverStream=new Re.TimestampRolloverStream("timed-metadata"),s.adtsStream=new ts,s.coalesceStream=new Je(e,s.metadataStream),s.headOfPipeline=s.aacStream,s.aacStream.pipe(s.audioTimestampRolloverStream).pipe(s.adtsStream),s.aacStream.pipe(s.timedMetadataTimestampRolloverStream).pipe(s.metadataStream).pipe(s.coalesceStream),s.metadataStream.on("timestamp",function(o){s.aacStream.setTimestamp(o.timeStamp)}),s.aacStream.on("data",function(o){o.type!=="timed-metadata"&&o.type!=="audio"||s.audioSegmentStream||(a=a||{timelineStartInfo:{baseMediaDecodeTime:t.baseMediaDecodeTime},codec:"adts",type:"audio"},s.coalesceStream.numberOfTracks++,s.audioSegmentStream=new ot(a,e),s.audioSegmentStream.on("log",t.getLogTrigger_("audioSegmentStream")),s.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),s.adtsStream.pipe(s.audioSegmentStream).pipe(s.coalesceStream),t.trigger("trackinfo",{hasAudio:!!a,hasVideo:!!r}))}),s.coalesceStream.on("data",this.trigger.bind(this,"data")),s.coalesceStream.on("done",this.trigger.bind(this,"done")),is(this,s)},this.setupTsPipeline=function(){var s={};this.transmuxPipeline_=s,s.type="ts",s.metadataStream=new Re.MetadataStream,s.packetStream=new Re.TransportPacketStream,s.parseStream=new Re.TransportParseStream,s.elementaryStream=new Re.ElementaryStream,s.timestampRolloverStream=new Re.TimestampRolloverStream,s.adtsStream=new ts,s.h264Stream=new xu,s.captionStream=new Re.CaptionStream(e),s.coalesceStream=new Je(e,s.metadataStream),s.headOfPipeline=s.packetStream,s.packetStream.pipe(s.parseStream).pipe(s.elementaryStream).pipe(s.timestampRolloverStream),s.timestampRolloverStream.pipe(s.h264Stream),s.timestampRolloverStream.pipe(s.adtsStream),s.timestampRolloverStream.pipe(s.metadataStream).pipe(s.coalesceStream),s.h264Stream.pipe(s.captionStream).pipe(s.coalesceStream),s.elementaryStream.on("data",function(o){var l;if(o.type==="metadata"){for(l=o.tracks.length;l--;)!r&&o.tracks[l].type==="video"?(r=o.tracks[l],r.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime):!a&&o.tracks[l].type==="audio"&&(a=o.tracks[l],a.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime);r&&!s.videoSegmentStream&&(s.coalesceStream.numberOfTracks++,s.videoSegmentStream=new Ft(r,e),s.videoSegmentStream.on("log",t.getLogTrigger_("videoSegmentStream")),s.videoSegmentStream.on("timelineStartInfo",function(u){a&&!e.keepOriginalTimestamps&&(a.timelineStartInfo=u,s.audioSegmentStream.setEarliestDts(u.dts-t.baseMediaDecodeTime))}),s.videoSegmentStream.on("processedGopsInfo",t.trigger.bind(t,"gopInfo")),s.videoSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"videoSegmentTimingInfo")),s.videoSegmentStream.on("baseMediaDecodeTime",function(u){a&&s.audioSegmentStream.setVideoBaseMediaDecodeTime(u)}),s.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),s.h264Stream.pipe(s.videoSegmentStream).pipe(s.coalesceStream)),a&&!s.audioSegmentStream&&(s.coalesceStream.numberOfTracks++,s.audioSegmentStream=new ot(a,e),s.audioSegmentStream.on("log",t.getLogTrigger_("audioSegmentStream")),s.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),s.audioSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"audioSegmentTimingInfo")),s.adtsStream.pipe(s.audioSegmentStream).pipe(s.coalesceStream)),t.trigger("trackinfo",{hasAudio:!!a,hasVideo:!!r})}}),s.coalesceStream.on("data",this.trigger.bind(this,"data")),s.coalesceStream.on("id3Frame",function(o){o.dispatchType=s.metadataStream.dispatchType,t.trigger("id3Frame",o)}),s.coalesceStream.on("caption",this.trigger.bind(this,"caption")),s.coalesceStream.on("done",this.trigger.bind(this,"done")),is(this,s)},this.setBaseMediaDecodeTime=function(s){var o=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=s),a&&(a.timelineStartInfo.dts=void 0,a.timelineStartInfo.pts=void 0,be.clearDtsInfo(a),o.audioTimestampRolloverStream&&o.audioTimestampRolloverStream.discontinuity()),r&&(o.videoSegmentStream&&(o.videoSegmentStream.gopCache_=[]),r.timelineStartInfo.dts=void 0,r.timelineStartInfo.pts=void 0,be.clearDtsInfo(r),o.captionStream.reset()),o.timestampRolloverStream&&o.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(s){a&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(s)},this.setRemux=function(s){var o=this.transmuxPipeline_;e.remux=s,o&&o.coalesceStream&&o.coalesceStream.setRemux(s)},this.alignGopsWith=function(s){r&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(s)},this.getLogTrigger_=function(s){var o=this;return function(l){l.stream=s,o.trigger("log",l)}},this.push=function(s){if(i){var o=Su(s);o&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!o&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),i=!1}this.transmuxPipeline_.headOfPipeline.push(s)},this.flush=function(){i=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},vi.prototype=new mi;var Pr={Transmuxer:vi,VideoSegmentStream:Ft,AudioSegmentStream:ot,AUDIO_PROPERTIES:Er,VIDEO_PROPERTIES:_r,generateSegmentTimingInfo:Ar},Eu=Va.discardEmulationPreventionBytes,_u=Ha.CaptionStream,Dt=dr,Au=pr,Pu=fr,Fu=cr,Du=function(e,t){for(var i=e,r=0;r<t.length;r++){var a=t[r];if(i<a.size)return a;i-=a.size}return null},Cu=function(e,t,i){var r=new DataView(e.buffer,e.byteOffset,e.byteLength),a={logs:[],seiNals:[]},s,o,l,u;for(o=0;o+4<e.length;o+=l)if(l=r.getUint32(o),o+=4,!(l<=0))switch(e[o]&31){case 6:var h=e.subarray(o+1,o+1+l),d=Du(o,t);if(s={nalUnitType:"sei_rbsp",size:l,data:h,escapedRBSP:Eu(h),trackId:i},d)s.pts=d.pts,s.dts=d.dts,u=d;else if(u)s.pts=u.pts,s.dts=u.dts;else{a.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+o+" for trackId "+i+". See mux.js#223."});break}a.seiNals.push(s);break}return a},Ou=function(e,t,i){var r=t,a=i.defaultSampleDuration||0,s=i.defaultSampleSize||0,o=i.trackId,l=[];return e.forEach(function(u){var h=Pu(u),d=h.samples;d.forEach(function(c){c.duration===void 0&&(c.duration=a),c.size===void 0&&(c.size=s),c.trackId=o,c.dts=r,c.compositionTimeOffset===void 0&&(c.compositionTimeOffset=0),c.pts=r+c.compositionTimeOffset,r+=c.duration}),l=l.concat(d)}),l},Iu=function(e,t){var i=Dt(e,["moof","traf"]),r=Dt(e,["mdat"]),a={},s=[];return r.forEach(function(o,l){var u=i[l];s.push({mdat:o,traf:u})}),s.forEach(function(o){var l=o.mdat,u=o.traf,h=Dt(u,["tfhd"]),d=Fu(h[0]),c=d.trackId,y=Dt(u,["tfdt"]),p=y.length>0?Au(y[0]).baseMediaDecodeTime:0,g=Dt(u,["trun"]),f,E;t===c&&g.length>0&&(f=Ou(g,p,d),E=Cu(l,f,c),a[c]||(a[c]={seiNals:[],logs:[]}),a[c].seiNals=a[c].seiNals.concat(E.seiNals),a[c].logs=a[c].logs.concat(E.logs))}),a},Ru=function(e,t,i){var r;if(t===null)return null;r=Iu(e,t);var a=r[t]||{};return{seiNals:a.seiNals,logs:a.logs,timescale:i}},Lu=function(){var e=!1,t,i,r,a,s,o;this.isInitialized=function(){return e},this.init=function(l){t=new _u,e=!0,o=l?l.isPartial:!1,t.on("data",function(u){u.startTime=u.startPts/a,u.endTime=u.endPts/a,s.captions.push(u),s.captionStreams[u.stream]=!0}),t.on("log",function(u){s.logs.push(u)})},this.isNewInit=function(l,u){return l&&l.length===0||u&&typeof u=="object"&&Object.keys(u).length===0?!1:r!==l[0]||a!==u[r]},this.parse=function(l,u,h){var d;if(this.isInitialized()){if(!u||!h)return null;if(this.isNewInit(u,h))r=u[0],a=h[r];else if(r===null||!a)return i.push(l),null}else return null;for(;i.length>0;){var c=i.shift();this.parse(c,u,h)}return d=Ru(l,r,a),d&&d.logs&&(s.logs=s.logs.concat(d.logs)),d===null||!d.seiNals?s.logs.length?{logs:s.logs,captions:[],captionStreams:[]}:null:(this.pushNals(d.seiNals),this.flushStream(),s)},this.pushNals=function(l){if(!this.isInitialized()||!l||l.length===0)return null;l.forEach(function(u){t.push(u)})},this.flushStream=function(){if(!this.isInitialized())return null;o?t.partialFlush():t.flush()},this.clearParsedCaptions=function(){s.captions=[],s.captionStreams={},s.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;t.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){i=[],r=null,a=null,s?this.clearParsedCaptions():s={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},Mu=Lu,Uu={generator:Qt,probe:wl,Transmuxer:Pr.Transmuxer,AudioSegmentStream:Pr.AudioSegmentStream,VideoSegmentStream:Pr.VideoSegmentStream,CaptionParser:Mu},B;B=function(e,t){var i=0,r=16384,a=function(d,c){var y,p=d.position+c;p<d.bytes.byteLength||(y=new Uint8Array(p*2),y.set(d.bytes.subarray(0,d.position),0),d.bytes=y,d.view=new DataView(d.bytes.buffer))},s=B.widthBytes||new Uint8Array(5),o=B.heightBytes||new Uint8Array(6),l=B.videocodecidBytes||new Uint8Array(12),u;if(!B.widthBytes){for(u=0;u<5;u++)s[u]="width".charCodeAt(u);for(u=0;u<6;u++)o[u]="height".charCodeAt(u);for(u=0;u<12;u++)l[u]="videocodecid".charCodeAt(u);B.widthBytes=s,B.heightBytes=o,B.videocodecidBytes=l}switch(this.keyFrame=!1,e){case B.VIDEO_TAG:this.length=16,r*=6;break;case B.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case B.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(r),this.view=new DataView(this.bytes.buffer),this.bytes[0]=e,this.position=this.length,this.keyFrame=t,this.pts=0,this.dts=0,this.writeBytes=function(h,d,c){var y=d||0,p;c=c||h.byteLength,p=y+c,a(this,c),this.bytes.set(h.subarray(y,p),this.position),this.position+=c,this.length=Math.max(this.length,this.position)},this.writeByte=function(h){a(this,1),this.bytes[this.position]=h,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(h){a(this,2),this.view.setUint16(this.position,h),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(h){return this.bytes[this.length-h]},this.nalUnitSize=function(){return i===0?0:this.length-(i+4)},this.startNalUnit=function(){if(i>0)throw new Error("Attempted to create new NAL wihout closing the old one");i=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(h){var d,c;this.length===i+4?this.length-=4:i>0&&(d=i+4,c=this.length-d,this.position=i,this.view.setUint32(this.position,c),this.position=this.length,h&&h.push(this.bytes.subarray(d,d+c))),i=0},this.writeMetaDataDouble=function(h,d){var c;if(a(this,2+h.length+9),this.view.setUint16(this.position,h.length),this.position+=2,h==="width")this.bytes.set(s,this.position),this.position+=5;else if(h==="height")this.bytes.set(o,this.position),this.position+=6;else if(h==="videocodecid")this.bytes.set(l,this.position),this.position+=12;else for(c=0;c<h.length;c++)this.bytes[this.position]=h.charCodeAt(c),this.position++;this.position++,this.view.setFloat64(this.position,d),this.position+=8,this.length=Math.max(this.length,this.position),++i},this.writeMetaDataBoolean=function(h,d){var c;for(a(this,2),this.view.setUint16(this.position,h.length),this.position+=2,c=0;c<h.length;c++)a(this,1),this.bytes[this.position]=h.charCodeAt(c),this.position++;a(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,d?1:0),this.position++,this.length=Math.max(this.length,this.position),++i},this.finalize=function(){var h,d;switch(this.bytes[0]){case B.VIDEO_TAG:this.bytes[11]=(this.keyFrame||t?16:32)|7,this.bytes[12]=t?0:1,h=this.pts-this.dts,this.bytes[13]=(h&16711680)>>>16,this.bytes[14]=(h&65280)>>>8,this.bytes[15]=(h&255)>>>0;break;case B.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=t?0:1;break;case B.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,i),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position;break}return d=this.length-11,this.bytes[1]=(d&16711680)>>>16,this.bytes[2]=(d&65280)>>>8,this.bytes[3]=(d&255)>>>0,this.bytes[4]=(this.dts&16711680)>>>16,this.bytes[5]=(this.dts&65280)>>>8,this.bytes[6]=(this.dts&255)>>>0,this.bytes[7]=(this.dts&4278190080)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,a(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=B.frameTime(this.bytes),this}},B.AUDIO_TAG=8,B.VIDEO_TAG=9,B.METADATA_TAG=18,B.isAudioFrame=function(n){return B.AUDIO_TAG===n[0]},B.isVideoFrame=function(n){return B.VIDEO_TAG===n[0]},B.isMetaData=function(n){return B.METADATA_TAG===n[0]},B.isKeyFrame=function(n){return B.isVideoFrame(n)?n[11]===23:!!(B.isAudioFrame(n)||B.isMetaData(n))},B.frameTime=function(n){var e=n[4]<<16;return e|=n[5]<<8,e|=n[6]<<0,e|=n[7]<<24,e};var Fr=B,ku=he,Dr=function n(e){this.numberOfTracks=0,this.metadataStream=e.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,n.prototype.init.call(this),this.push=function(t){if(t.text)return this.pendingCaptions.push(t);if(t.frames)return this.pendingMetadata.push(t);t.track.type==="video"&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),t.track.type==="audio"&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)}};Dr.prototype=new ku,Dr.prototype.flush=function(n){var e,t,i,r,a={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(n!=="VideoSegmentStream"&&n!=="AudioSegmentStream")return;if(this.pendingTracks===0&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?r=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(r=this.audioTrack.timelineStartInfo.pts),a.tags.videoTags=this.videoTags,a.tags.audioTags=this.audioTags,i=0;i<this.pendingCaptions.length;i++)t=this.pendingCaptions[i],t.startTime=t.startPts-r,t.startTime/=9e4,t.endTime=t.endPts-r,t.endTime/=9e4,a.captionStreams[t.stream]=!0,a.captions.push(t);for(i=0;i<this.pendingMetadata.length;i++)e=this.pendingMetadata[i],e.cueTime=e.pts-r,e.cueTime/=9e4,a.metadata.push(e);a.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",a),this.trigger("done")}};var Nu=Dr,Bu=function(){var e=this;this.list=[],this.push=function(t){this.list.push({bytes:t.bytes,dts:t.dts,pts:t.pts,keyFrame:t.keyFrame,metaDataTag:t.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return e.list.length}})},$u=Bu,Cr=he,me=Fr,Ve=ci,Vu=Yt,Hu=ar.H264Stream,zu=Nu,ns=$u,xi,bi,Si,Or,as,ss;Or=function(e,t){typeof t.pts=="number"&&(e.timelineStartInfo.pts===void 0?e.timelineStartInfo.pts=t.pts:e.timelineStartInfo.pts=Math.min(e.timelineStartInfo.pts,t.pts)),typeof t.dts=="number"&&(e.timelineStartInfo.dts===void 0?e.timelineStartInfo.dts=t.dts:e.timelineStartInfo.dts=Math.min(e.timelineStartInfo.dts,t.dts))},as=function(e,t){var i=new me(me.METADATA_TAG);return i.dts=t,i.pts=t,i.writeMetaDataDouble("videocodecid",7),i.writeMetaDataDouble("width",e.width),i.writeMetaDataDouble("height",e.height),i},ss=function(e,t){var i,r=new me(me.VIDEO_TAG,!0);for(r.dts=t,r.pts=t,r.writeByte(1),r.writeByte(e.profileIdc),r.writeByte(e.profileCompatibility),r.writeByte(e.levelIdc),r.writeByte(255),r.writeByte(225),r.writeShort(e.sps[0].length),r.writeBytes(e.sps[0]),r.writeByte(e.pps.length),i=0;i<e.pps.length;++i)r.writeShort(e.pps[i].length),r.writeBytes(e.pps[i]);return r},Si=function(e){var t=[],i=[],r;Si.prototype.init.call(this),this.push=function(a){Or(e,a),e&&(e.audioobjecttype=a.audioobjecttype,e.channelcount=a.channelcount,e.samplerate=a.samplerate,e.samplingfrequencyindex=a.samplingfrequencyindex,e.samplesize=a.samplesize,e.extraData=e.audioobjecttype<<11|e.samplingfrequencyindex<<7|e.channelcount<<3),a.pts=Math.round(a.pts/90),a.dts=Math.round(a.dts/90),t.push(a)},this.flush=function(){var a,s,o,l=new ns;if(t.length===0){this.trigger("done","AudioSegmentStream");return}for(o=-1/0;t.length;)a=t.shift(),i.length&&a.pts>=i[0]&&(o=i.shift(),this.writeMetaDataTags(l,o)),(e.extraData!==r||a.pts-o>=1e3)&&(this.writeMetaDataTags(l,a.pts),r=e.extraData,o=a.pts),s=new me(me.AUDIO_TAG),s.pts=a.pts,s.dts=a.dts,s.writeBytes(a.data),l.push(s.finalize());i.length=0,r=null,this.trigger("data",{track:e,tags:l.list}),this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(a,s){var o;o=new me(me.METADATA_TAG),o.pts=s,o.dts=s,o.writeMetaDataDouble("audiocodecid",10),o.writeMetaDataBoolean("stereo",e.channelcount===2),o.writeMetaDataDouble("audiosamplerate",e.samplerate),o.writeMetaDataDouble("audiosamplesize",16),a.push(o.finalize()),o=new me(me.AUDIO_TAG,!0),o.pts=s,o.dts=s,o.view.setUint16(o.position,e.extraData),o.position+=2,o.length=Math.max(o.length,o.position),a.push(o.finalize())},this.onVideoKeyFrame=function(a){i.push(a)}},Si.prototype=new Cr,bi=function(e){var t=[],i,r;bi.prototype.init.call(this),this.finishFrame=function(a,s){if(!!s){if(i&&e&&e.newMetadata&&(s.keyFrame||a.length===0)){var o=as(i,s.dts).finalize(),l=ss(e,s.dts).finalize();o.metaDataTag=l.metaDataTag=!0,a.push(o),a.push(l),e.newMetadata=!1,this.trigger("keyframe",s.dts)}s.endNalUnit(),a.push(s.finalize()),r=null}},this.push=function(a){Or(e,a),a.pts=Math.round(a.pts/90),a.dts=Math.round(a.dts/90),t.push(a)},this.flush=function(){for(var a,s=new ns;t.length&&t[0].nalUnitType!=="access_unit_delimiter_rbsp";)t.shift();if(t.length===0){this.trigger("done","VideoSegmentStream");return}for(;t.length;)a=t.shift(),a.nalUnitType==="seq_parameter_set_rbsp"?(e.newMetadata=!0,i=a.config,e.width=i.width,e.height=i.height,e.sps=[a.data],e.profileIdc=i.profileIdc,e.levelIdc=i.levelIdc,e.profileCompatibility=i.profileCompatibility,r.endNalUnit()):a.nalUnitType==="pic_parameter_set_rbsp"?(e.newMetadata=!0,e.pps=[a.data],r.endNalUnit()):a.nalUnitType==="access_unit_delimiter_rbsp"?(r&&this.finishFrame(s,r),r=new me(me.VIDEO_TAG),r.pts=a.pts,r.dts=a.dts):(a.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(r.keyFrame=!0),r.endNalUnit()),r.startNalUnit(),r.writeBytes(a.data);r&&this.finishFrame(s,r),this.trigger("data",{track:e,tags:s.list}),this.trigger("done","VideoSegmentStream")}},bi.prototype=new Cr,xi=function(e){var t=this,i,r,a,s,o,l,u,h,d,c,y,p;xi.prototype.init.call(this),e=e||{},this.metadataStream=new Ve.MetadataStream,e.metadataStream=this.metadataStream,i=new Ve.TransportPacketStream,r=new Ve.TransportParseStream,a=new Ve.ElementaryStream,s=new Ve.TimestampRolloverStream("video"),o=new Ve.TimestampRolloverStream("audio"),l=new Ve.TimestampRolloverStream("timed-metadata"),u=new Vu,h=new Hu,p=new zu(e),i.pipe(r).pipe(a),a.pipe(s).pipe(h),a.pipe(o).pipe(u),a.pipe(l).pipe(this.metadataStream).pipe(p),y=new Ve.CaptionStream(e),h.pipe(y).pipe(p),a.on("data",function(g){var f,E,_;if(g.type==="metadata"){for(f=g.tracks.length;f--;)g.tracks[f].type==="video"?E=g.tracks[f]:g.tracks[f].type==="audio"&&(_=g.tracks[f]);E&&!d&&(p.numberOfTracks++,d=new bi(E),h.pipe(d).pipe(p)),_&&!c&&(p.numberOfTracks++,c=new Si(_),u.pipe(c).pipe(p),d&&d.on("keyframe",c.onVideoKeyFrame))}}),this.push=function(g){i.push(g)},this.flush=function(){i.flush()},this.resetCaptions=function(){y.reset()},p.on("data",function(g){t.trigger("data",g)}),p.on("done",function(){t.trigger("done")})},xi.prototype=new Cr;var Gu=xi,os=Fr,qu=function(e,t,i){var r=new Uint8Array(9),a=new DataView(r.buffer),s,o,l;return e=e||0,t=t===void 0?!0:t,i=i===void 0?!0:i,a.setUint8(0,70),a.setUint8(1,76),a.setUint8(2,86),a.setUint8(3,1),a.setUint8(4,(t?4:0)|(i?1:0)),a.setUint32(5,r.byteLength),e<=0?(o=new Uint8Array(r.byteLength+4),o.set(r),o.set([0,0,0,0],r.byteLength),o):(s=new os(os.METADATA_TAG),s.pts=s.dts=0,s.writeMetaDataDouble("duration",e),l=s.finalize().length,o=new Uint8Array(r.byteLength+l),o.set(r),o.set(a.byteLength,l),o)},Wu=qu,Xu={tag:Fr,Transmuxer:Gu,getFlvHeader:Wu},Yu=ci,ju=he,Ir=Qt,Ti=Ba,wi=ei,Ku=Be.ONE_SECOND_IN_TS,Qu=Za,ls=function n(e,t){var i=[],r=0,a=0,s=0,o=1/0,l=null,u=null;t=t||{},n.prototype.init.call(this),this.push=function(h){wi.collectDtsInfo(e,h),e&&Qu.forEach(function(d){e[d]=h[d]}),i.push(h)},this.setEarliestDts=function(h){a=h},this.setVideoBaseMediaDecodeTime=function(h){o=h},this.setAudioAppendStart=function(h){s=h},this.processFrames_=function(){var h,d,c,y,p;i.length!==0&&(h=Ti.trimAdtsFramesByEarliestDts(i,e,a),h.length!==0&&(e.baseMediaDecodeTime=wi.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),Ti.prefixWithSilence(e,h,s,o),e.samples=Ti.generateSampleTable(h),c=Ir.mdat(Ti.concatenateFrameData(h)),i=[],d=Ir.moof(r,[e]),r++,e.initSegment=Ir.initSegment([e]),y=new Uint8Array(d.byteLength+c.byteLength),y.set(d),y.set(c,d.byteLength),wi.clearDtsInfo(e),l===null&&(u=l=h[0].pts),u+=h.length*(Ku*1024/e.samplerate),p={start:l},this.trigger("timingInfo",p),this.trigger("data",{track:e,boxes:y})))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:l,end:u}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){wi.clearDtsInfo(e),l=null,u=null},this.reset=function(){this.resetTiming_(),i=[],this.trigger("reset")}};ls.prototype=new ju;var Ju=ls,Zu=he,Rr=Qt,Ei=ei,Ct=Na,eh=es,us=function n(e,t){var i=0,r=[],a=[],s,o,l=null,u=null,h,d=!0;t=t||{},n.prototype.init.call(this),this.push=function(c){Ei.collectDtsInfo(e,c),typeof e.timelineStartInfo.dts=="undefined"&&(e.timelineStartInfo.dts=c.dts),c.nalUnitType==="seq_parameter_set_rbsp"&&!s&&(s=c.config,e.sps=[c.data],eh.forEach(function(y){e[y]=s[y]},this)),c.nalUnitType==="pic_parameter_set_rbsp"&&!o&&(o=c.data,e.pps=[c.data]),r.push(c)},this.processNals_=function(c){var y;for(r=a.concat(r);r.length&&r[0].nalUnitType!=="access_unit_delimiter_rbsp";)r.shift();if(r.length!==0){var p=Ct.groupNalsIntoFrames(r);if(!!p.length){if(a=p[p.length-1],c&&(p.pop(),p.duration-=a.duration,p.nalCount-=a.length,p.byteLength-=a.byteLength),!p.length){r=[];return}if(this.trigger("timelineStartInfo",e.timelineStartInfo),d){if(h=Ct.groupFramesIntoGops(p),!h[0][0].keyFrame){if(h=Ct.extendFirstKeyFrame(h),!h[0][0].keyFrame){r=[].concat.apply([],p).concat(a),a=[];return}p=[].concat.apply([],h),p.duration=h.duration}d=!1}for(l===null&&(l=p[0].pts,u=l),u+=p.duration,this.trigger("timingInfo",{start:l,end:u}),y=0;y<p.length;y++){var g=p[y];e.samples=Ct.generateSampleTableForFrame(g);var f=Rr.mdat(Ct.concatenateNalDataForFrame(g));Ei.clearDtsInfo(e),Ei.collectDtsInfo(e,g),e.baseMediaDecodeTime=Ei.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps);var E=Rr.moof(i,[e]);i++,e.initSegment=Rr.initSegment([e]);var _=new Uint8Array(E.byteLength+f.byteLength);_.set(E),_.set(f,E.byteLength),this.trigger("data",{track:e,boxes:_,sequence:i,videoFrameDts:g.dts,videoFramePts:g.pts})}r=[]}}},this.resetTimingAndConfig_=function(){s=void 0,o=void 0,l=null,u=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),a=[],r=[],d=!0,this.trigger("reset")}};us.prototype=new Zu;var th=us,hs=he,Le=ci,ds=Zn,cs=Ju,ih=th,fs=ei,rh=fi.isLikelyAacData,nh=Yt,ah=Ja,Lr=Be,ps=function(e){return e.prototype=new hs,e.prototype.init.call(e),e},sh=function(e){var t={type:"ts",tracks:{audio:null,video:null},packet:new Le.TransportPacketStream,parse:new Le.TransportParseStream,elementary:new Le.ElementaryStream,timestampRollover:new Le.TimestampRolloverStream,adts:new ds.Adts,h264:new ds.h264.H264Stream,captionStream:new Le.CaptionStream(e),metadataStream:new Le.MetadataStream};return t.headOfPipeline=t.packet,t.packet.pipe(t.parse).pipe(t.elementary).pipe(t.timestampRollover),t.timestampRollover.pipe(t.h264),t.h264.pipe(t.captionStream),t.timestampRollover.pipe(t.metadataStream),t.timestampRollover.pipe(t.adts),t.elementary.on("data",function(i){if(i.type==="metadata"){for(var r=0;r<i.tracks.length;r++)t.tracks[i.tracks[r].type]||(t.tracks[i.tracks[r].type]=i.tracks[r],t.tracks[i.tracks[r].type].timelineStartInfo.baseMediaDecodeTime=e.baseMediaDecodeTime);t.tracks.video&&!t.videoSegmentStream&&(t.videoSegmentStream=new ih(t.tracks.video,e),t.videoSegmentStream.on("timelineStartInfo",function(a){t.tracks.audio&&!e.keepOriginalTimestamps&&t.audioSegmentStream.setEarliestDts(a.dts-e.baseMediaDecodeTime)}),t.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),t.videoSegmentStream.on("data",function(a){t.trigger("data",{type:"video",data:a})}),t.videoSegmentStream.on("done",t.trigger.bind(t,"done")),t.videoSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.videoSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.h264.pipe(t.videoSegmentStream)),t.tracks.audio&&!t.audioSegmentStream&&(t.audioSegmentStream=new cs(t.tracks.audio,e),t.audioSegmentStream.on("data",function(a){t.trigger("data",{type:"audio",data:a})}),t.audioSegmentStream.on("done",t.trigger.bind(t,"done")),t.audioSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.audioSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),t.adts.pipe(t.audioSegmentStream)),t.trigger("trackinfo",{hasAudio:!!t.tracks.audio,hasVideo:!!t.tracks.video})}}),t.captionStream.on("data",function(i){var r;t.tracks.video?r=t.tracks.video.timelineStartInfo.pts||0:r=0,i.startTime=Lr.metadataTsToSeconds(i.startPts,r,e.keepOriginalTimestamps),i.endTime=Lr.metadataTsToSeconds(i.endPts,r,e.keepOriginalTimestamps),t.trigger("caption",i)}),t=ps(t),t.metadataStream.on("data",t.trigger.bind(t,"id3Frame")),t},oh=function(e){var t={type:"aac",tracks:{audio:null},metadataStream:new Le.MetadataStream,aacStream:new ah,audioRollover:new Le.TimestampRolloverStream("audio"),timedMetadataRollover:new Le.TimestampRolloverStream("timed-metadata"),adtsStream:new nh(!0)};return t.headOfPipeline=t.aacStream,t.aacStream.pipe(t.audioRollover).pipe(t.adtsStream),t.aacStream.pipe(t.timedMetadataRollover).pipe(t.metadataStream),t.metadataStream.on("timestamp",function(i){t.aacStream.setTimestamp(i.timeStamp)}),t.aacStream.on("data",function(i){i.type!=="timed-metadata"&&i.type!=="audio"||t.audioSegmentStream||(t.tracks.audio=t.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:e.baseMediaDecodeTime},codec:"adts",type:"audio"},t.audioSegmentStream=new cs(t.tracks.audio,e),t.audioSegmentStream.on("data",function(r){t.trigger("data",{type:"audio",data:r})}),t.audioSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.audioSegmentStream.on("done",t.trigger.bind(t,"done")),t.audioSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),t.adtsStream.pipe(t.audioSegmentStream),t.trigger("trackinfo",{hasAudio:!!t.tracks.audio,hasVideo:!!t.tracks.video}))}),t=ps(t),t.metadataStream.on("data",t.trigger.bind(t,"id3Frame")),t},ms=function(e,t){e.on("data",t.trigger.bind(t,"data")),e.on("done",t.trigger.bind(t,"done")),e.on("partialdone",t.trigger.bind(t,"partialdone")),e.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),e.on("audioTimingInfo",t.trigger.bind(t,"audioTimingInfo")),e.on("videoTimingInfo",t.trigger.bind(t,"videoTimingInfo")),e.on("trackinfo",t.trigger.bind(t,"trackinfo")),e.on("id3Frame",function(i){i.dispatchType=e.metadataStream.dispatchType,i.cueTime=Lr.videoTsToSeconds(i.pts),t.trigger("id3Frame",i)}),e.on("caption",function(i){t.trigger("caption",i)})},gs=function n(e){var t=null,i=!0;e=e||{},n.prototype.init.call(this),e.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.push=function(r){if(i){var a=rh(r);a&&(!t||t.type!=="aac")?(t=oh(e),ms(t,this)):!a&&(!t||t.type!=="ts")&&(t=sh(e),ms(t,this)),i=!1}t.headOfPipeline.push(r)},this.flush=function(){!t||(i=!0,t.headOfPipeline.flush())},this.partialFlush=function(){!t||t.headOfPipeline.partialFlush()},this.endTimeline=function(){!t||t.headOfPipeline.endTimeline()},this.reset=function(){!t||t.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(r){e.keepOriginalTimestamps||(e.baseMediaDecodeTime=r),t&&(t.tracks.audio&&(t.tracks.audio.timelineStartInfo.dts=void 0,t.tracks.audio.timelineStartInfo.pts=void 0,fs.clearDtsInfo(t.tracks.audio),t.audioRollover&&t.audioRollover.discontinuity()),t.tracks.video&&(t.videoSegmentStream&&(t.videoSegmentStream.gopCache_=[]),t.tracks.video.timelineStartInfo.dts=void 0,t.tracks.video.timelineStartInfo.pts=void 0,fs.clearDtsInfo(t.tracks.video)),t.timestampRollover&&t.timestampRollover.discontinuity())},this.setRemux=function(r){e.remux=r,t&&t.coalesceStream&&t.coalesceStream.setRemux(r)},this.setAudioAppendStart=function(r){!t||!t.tracks.audio||!t.audioSegmentStream||t.audioSegmentStream.setAudioAppendStart(r)},this.alignGopsWith=function(r){}};gs.prototype=new hs;var lh=gs,uh={Transmuxer:lh},ys=Math.pow(2,32),hh=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8)},r=12;i.version===0?(i.earliestPresentationTime=t.getUint32(r),i.firstOffset=t.getUint32(r+4),r+=8):(i.earliestPresentationTime=t.getUint32(r)*ys+t.getUint32(r+4),i.firstOffset=t.getUint32(r+8)*ys+t.getUint32(r+12),r+=16),r+=2;var a=t.getUint16(r);for(r+=2;a>0;r+=12,a--)i.references.push({referenceType:(e[r]&128)>>>7,referencedSize:t.getUint32(r)&2147483647,subsegmentDuration:t.getUint32(r+4),startsWithSap:!!(e[r+8]&128),sapType:(e[r+8]&112)>>>4,sapDeltaTime:t.getUint32(r+8)&268435455});return i},dh=hh,vs=Math.pow(2,32),re,Mr,ge=function(e){return new Date(e*1e3-20828448e5)},Ot=hr,ch=dr,fh=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=[],r,a;for(r=0;r+4<e.length;r+=a){if(a=t.getUint32(r),r+=4,a<=0){i.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(e[r]&31){case 1:i.push("slice_layer_without_partitioning_rbsp");break;case 5:i.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:i.push("sei_rbsp");break;case 7:i.push("seq_parameter_set_rbsp");break;case 8:i.push("pic_parameter_set_rbsp");break;case 9:i.push("access_unit_delimiter_rbsp");break;default:i.push("UNKNOWN NAL - "+e[r]&31);break}}return i},He={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:re(e.subarray(78,e.byteLength))}},avcC:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:e[4]&3,sps:[],pps:[]},r=e[5]&31,a,s,o,l;for(o=6,l=0;l<r;l++)s=t.getUint16(o),o+=2,i.sps.push(new Uint8Array(e.subarray(o,o+s))),o+=s;for(a=e[o],o++,l=0;l<a;l++)s=t.getUint16(o),o+=2,i.pps.push(new Uint8Array(e.subarray(o,o+s))),o+=s;return i},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},edts:function(e){return{boxes:re(e)}},elst:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),edits:[]},r=t.getUint32(4),a;for(a=8;r;r--)i.version===0?(i.edits.push({segmentDuration:t.getUint32(a),mediaTime:t.getInt32(a+4),mediaRate:t.getUint16(a+8)+t.getUint16(a+10)/(256*256)}),a+=12):(i.edits.push({segmentDuration:t.getUint32(a)*vs+t.getUint32(a+4),mediaTime:t.getUint32(a+8)*vs+t.getUint32(a+12),mediaRate:t.getUint16(a+16)+t.getUint16(a+18)/(256*256)}),a+=20);return i},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:e[8]&31,decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(e[26]&7)<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={majorBrand:Ot(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},r=8;r<e.byteLength;)i.compatibleBrands.push(Ot(e.subarray(r,r+4))),r+=4;return i},dinf:function(e){return{boxes:re(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:re(e.subarray(8))}},hdlr:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:Ot(e.subarray(8,12)),name:""},r=8;for(r=24;r<e.byteLength;r++){if(e[r]===0){r++;break}i.name+=String.fromCharCode(e[r])}return i.name=decodeURIComponent(escape(i.name)),i},mdat:function(e){return{byteLength:e.byteLength,nals:fh(e)}},mdhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r,a={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return a.version===1?(i+=4,a.creationTime=ge(t.getUint32(i)),i+=8,a.modificationTime=ge(t.getUint32(i)),i+=4,a.timescale=t.getUint32(i),i+=8,a.duration=t.getUint32(i)):(a.creationTime=ge(t.getUint32(i)),i+=4,a.modificationTime=ge(t.getUint32(i)),i+=4,a.timescale=t.getUint32(i),i+=4,a.duration=t.getUint32(i)),i+=4,r=t.getUint16(i),a.language+=String.fromCharCode((r>>10)+96),a.language+=String.fromCharCode(((r&992)>>5)+96),a.language+=String.fromCharCode((r&31)+96),a},mdia:function(e){return{boxes:re(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:re(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(i.streamDescriptor=re(e.subarray(28))[0]),i},moof:function(e){return{boxes:re(e)}},moov:function(e){return{boxes:re(e)}},mvex:function(e){return{boxes:re(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return r.version===1?(i+=4,r.creationTime=ge(t.getUint32(i)),i+=8,r.modificationTime=ge(t.getUint32(i)),i+=4,r.timescale=t.getUint32(i),i+=8,r.duration=t.getUint32(i)):(r.creationTime=ge(t.getUint32(i)),i+=4,r.modificationTime=ge(t.getUint32(i)),i+=4,r.timescale=t.getUint32(i),i+=4,r.duration=t.getUint32(i)),i+=4,r.rate=t.getUint16(i)+t.getUint16(i+2)/16,i+=4,r.volume=t.getUint8(i)+t.getUint8(i+1)/8,i+=2,i+=2,i+=2*4,r.matrix=new Uint32Array(e.subarray(i,i+9*4)),i+=9*4,i+=6*4,r.nextTrackId=t.getUint32(i),r},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},i;for(i=4;i<e.byteLength;i++)t.samples.push({dependsOn:(e[i]&48)>>4,isDependedOn:(e[i]&12)>>2,hasRedundancy:e[i]&3});return t},sidx:dh,smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:re(e)}},ctts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),compositionOffsets:[]},r=t.getUint32(4),a;for(a=8;r;a+=8,r--)i.compositionOffsets.push({sampleCount:t.getUint32(a),sampleOffset:t[i.version===0?"getUint32":"getInt32"](a+4)});return i},stss:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),syncSamples:[]},r=t.getUint32(4),a;for(a=8;r;a+=4,r--)i.syncSamples.push(t.getUint32(a));return i},stco:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},r=t.getUint32(4),a;for(a=8;r;a+=4,r--)i.chunkOffsets.push(t.getUint32(a));return i},stsc:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=t.getUint32(4),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]},a;for(a=8;i;a+=12,i--)r.sampleToChunks.push({firstChunk:t.getUint32(a),samplesPerChunk:t.getUint32(a+4),sampleDescriptionIndex:t.getUint32(a+8)});return r},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:re(e.subarray(8))}},stsz:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:t.getUint32(4),entries:[]},r;for(r=12;r<e.byteLength;r+=4)i.entries.push(t.getUint32(r));return i},stts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},r=t.getUint32(4),a;for(a=8;r;a+=8,r--)i.timeToSamples.push({sampleCount:t.getUint32(a),sampleDelta:t.getUint32(a+4)});return i},styp:function(e){return He.ftyp(e)},tfdt:pr,tfhd:cr,tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return r.version===1?(i+=4,r.creationTime=ge(t.getUint32(i)),i+=8,r.modificationTime=ge(t.getUint32(i)),i+=4,r.trackId=t.getUint32(i),i+=4,i+=8,r.duration=t.getUint32(i)):(r.creationTime=ge(t.getUint32(i)),i+=4,r.modificationTime=ge(t.getUint32(i)),i+=4,r.trackId=t.getUint32(i),i+=4,i+=4,r.duration=t.getUint32(i)),i+=4,i+=2*4,r.layer=t.getUint16(i),i+=2,r.alternateGroup=t.getUint16(i),i+=2,r.volume=t.getUint8(i)+t.getUint8(i+1)/8,i+=2,i+=2,r.matrix=new Uint32Array(e.subarray(i,i+9*4)),i+=9*4,r.width=t.getUint16(i)+t.getUint16(i+2)/65536,i+=4,r.height=t.getUint16(i)+t.getUint16(i+2)/65536,r},traf:function(e){return{boxes:re(e)}},trak:function(e){return{boxes:re(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:e[20]&3,sampleIsDependedOn:(e[21]&192)>>6,sampleHasRedundancy:(e[21]&48)>>4,samplePaddingValue:(e[21]&14)>>1,sampleIsDifferenceSample:!!(e[21]&1),sampleDegradationPriority:t.getUint16(22)}},trun:fr,"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}};re=function(e){for(var t=0,i=[],r,a,s,o,l,u=new ArrayBuffer(e.length),h=new Uint8Array(u),d=0;d<e.length;++d)h[d]=e[d];for(r=new DataView(u);t<e.byteLength;)a=r.getUint32(t),s=Ot(e.subarray(t+4,t+8)),o=a>1?t+a:e.byteLength,l=(He[s]||function(c){return{data:c}})(e.subarray(t+8,o)),l.size=a,l.type=s,i.push(l),t=o;return i},Mr=function(e,t){var i;return t=t||0,i=new Array(t*2+1).join(" "),e.map(function(r,a){return i+r.type+`
`+Object.keys(r).filter(function(s){return s!=="type"&&s!=="boxes"}).map(function(s){var o=i+"  "+s+": ",l=r[s];if(l instanceof Uint8Array||l instanceof Uint32Array){var u=Array.prototype.slice.call(new Uint8Array(l.buffer,l.byteOffset,l.byteLength)).map(function(h){return" "+("00"+h.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return u?u.length===1?o+"<"+u.join("").slice(1)+">":o+`<
`+u.map(function(h){return i+"  "+h}).join(`
`)+`
`+i+"  >":o+"<>"}return o+JSON.stringify(l,null,2).split(`
`).map(function(h,d){return d===0?h:i+"  "+h}).join(`
`)}).join(`
`)+(r.boxes?`
`+Mr(r.boxes,t+1):"")}).join(`
`)};var ph={inspect:re,textify:Mr,parseType:Ot,findBox:ch,parseTraf:He.traf,parseTfdt:He.tfdt,parseHdlr:He.hdlr,parseTfhd:He.tfhd,parseTrun:He.trun,parseSidx:He.sidx},mh={8:"audio",9:"video",18:"metadata"},gh=function(e){return"0x"+("00"+e.toString(16)).slice(-2).toUpperCase()},Ur=function(e){for(var t=[],i;e.byteLength>0;)i=0,t.push(gh(e[i++])),e=e.subarray(i);return t.join(" ")},yh=function(e,t){var i=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],r=e[1]&parseInt("01111111",2)<<16|e[2]<<8|e[3];return t=t||{},t.avcPacketType=i[e[0]],t.CompositionTime=e[1]&parseInt("10000000",2)?-r:r,e[0]===1?t.nalUnitTypeRaw=Ur(e.subarray(4,100)):t.data=Ur(e.subarray(4)),t},vh=function(e,t){var i=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"],r=e[0]&parseInt("00001111",2);return t=t||{},t.frameType=i[(e[0]&parseInt("11110000",2))>>>4],t.codecID=r,r===7?yh(e.subarray(1),t):t},xh=function(e,t){var i=["AAC Sequence Header","AAC Raw"];return t=t||{},t.aacPacketType=i[e[0]],t.data=Ur(e.subarray(1)),t},bh=function(e,t){var i=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"],r=["5.5-kHz","11-kHz","22-kHz","44-kHz"],a=(e[0]&parseInt("11110000",2))>>>4;return t=t||{},t.soundFormat=i[a],t.soundRate=r[(e[0]&parseInt("00001100",2))>>>2],t.soundSize=(e[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",t.soundType=e[0]&parseInt("00000001",2)?"Stereo":"Mono",a===10?xh(e.subarray(1),t):t},Sh=function(e){return{tagType:mh[e[0]],dataSize:e[1]<<16|e[2]<<8|e[3],timestamp:e[7]<<24|e[4]<<16|e[5]<<8|e[6],streamID:e[8]<<16|e[9]<<8|e[10]}},xs=function(e){var t=Sh(e);switch(e[0]){case 8:bh(e.subarray(11),t);break;case 9:vh(e.subarray(11),t);break}return t},Th=function(e){var t=9,i,r=[],a;for(t+=4;t<e.byteLength;)i=e[t+1]<<16,i|=e[t+2]<<8,i|=e[t+3],i+=11,a=e.subarray(t,t+i),r.push(xs(a)),t+=i+4;return r},wh=function(e){return JSON.stringify(e,null,2)},Eh={inspectTag:xs,inspect:Th,textify:wh},kr=si,bs=function(e){var t=e[1]&31;return t<<=8,t|=e[2],t},_i=function(e){return!!(e[1]&64)},Ai=function(e){var t=0;return(e[3]&48)>>>4>1&&(t+=e[4]+1),t},_h=function(e,t){var i=bs(e);return i===0?"pat":i===t?"pmt":t?"pes":null},Ah=function(e){var t=_i(e),i=4+Ai(e);return t&&(i+=e[i]+1),(e[i+10]&31)<<8|e[i+11]},Ph=function(e){var t={},i=_i(e),r=4+Ai(e);if(i&&(r+=e[r]+1),!!(e[r+5]&1)){var a,s,o;a=(e[r+1]&15)<<8|e[r+2],s=3+a-4,o=(e[r+10]&15)<<8|e[r+11];for(var l=12+o;l<s;){var u=r+l;t[(e[u+1]&31)<<8|e[u+2]]=e[u],l+=((e[u+3]&15)<<8|e[u+4])+5}return t}},Fh=function(e,t){var i=bs(e),r=t[i];switch(r){case kr.H264_STREAM_TYPE:return"video";case kr.ADTS_STREAM_TYPE:return"audio";case kr.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},Dh=function(e){var t=_i(e);if(!t)return null;var i=4+Ai(e);if(i>=e.byteLength)return null;var r=null,a;return a=e[i+7],a&192&&(r={},r.pts=(e[i+9]&14)<<27|(e[i+10]&255)<<20|(e[i+11]&254)<<12|(e[i+12]&255)<<5|(e[i+13]&254)>>>3,r.pts*=4,r.pts+=(e[i+13]&6)>>>1,r.dts=r.pts,a&64&&(r.dts=(e[i+14]&14)<<27|(e[i+15]&255)<<20|(e[i+16]&254)<<12|(e[i+17]&255)<<5|(e[i+18]&254)>>>3,r.dts*=4,r.dts+=(e[i+18]&6)>>>1)),r},Nr=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},Ch=function(e){for(var t=4+Ai(e),i=e.subarray(t),r=0,a=0,s=!1,o;a<i.byteLength-3;a++)if(i[a+2]===1){r=a+5;break}for(;r<i.byteLength;)switch(i[r]){case 0:if(i[r-1]!==0){r+=2;break}else if(i[r-2]!==0){r++;break}a+3!==r-2&&(o=Nr(i[a+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(s=!0));do r++;while(i[r]!==1&&r<i.length);a=r-2,r+=3;break;case 1:if(i[r-1]!==0||i[r-2]!==0){r+=3;break}o=Nr(i[a+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(s=!0),a=r-2,r+=3;break;default:r+=3;break}return i=i.subarray(a),r-=a,a=0,i&&i.byteLength>3&&(o=Nr(i[a+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(s=!0)),s},Oh={parseType:_h,parsePat:Ah,parsePmt:Ph,parsePayloadUnitStartIndicator:_i,parsePesType:Fh,parsePesTime:Dh,videoPacketContainsKeyFrame:Ch},Ss=si,lt=qa.handleRollover,V={};V.ts=Oh,V.aac=fi;var Ze=Be.ONE_SECOND_IN_TS,se=188,Ee=71,Ih=function(e,t){for(var i=0,r=se,a,s;r<e.byteLength;){if(e[i]===Ee&&e[r]===Ee){switch(a=e.subarray(i,r),s=V.ts.parseType(a,t.pid),s){case"pat":t.pid=V.ts.parsePat(a);break;case"pmt":var o=V.ts.parsePmt(a);t.table=t.table||{},Object.keys(o).forEach(function(l){t.table[l]=o[l]});break}i+=se,r+=se;continue}i++,r++}},Ts=function(e,t,i){for(var r=0,a=se,s,o,l,u,h,d=!1;a<=e.byteLength;){if(e[r]===Ee&&(e[a]===Ee||a===e.byteLength)){switch(s=e.subarray(r,a),o=V.ts.parseType(s,t.pid),o){case"pes":l=V.ts.parsePesType(s,t.table),u=V.ts.parsePayloadUnitStartIndicator(s),l==="audio"&&u&&(h=V.ts.parsePesTime(s),h&&(h.type="audio",i.audio.push(h),d=!0));break}if(d)break;r+=se,a+=se;continue}r++,a++}for(a=e.byteLength,r=a-se,d=!1;r>=0;){if(e[r]===Ee&&(e[a]===Ee||a===e.byteLength)){switch(s=e.subarray(r,a),o=V.ts.parseType(s,t.pid),o){case"pes":l=V.ts.parsePesType(s,t.table),u=V.ts.parsePayloadUnitStartIndicator(s),l==="audio"&&u&&(h=V.ts.parsePesTime(s),h&&(h.type="audio",i.audio.push(h),d=!0));break}if(d)break;r-=se,a-=se;continue}r--,a--}},Rh=function(e,t,i){for(var r=0,a=se,s,o,l,u,h,d,c,y,p=!1,g={data:[],size:0};a<e.byteLength;){if(e[r]===Ee&&e[a]===Ee){switch(s=e.subarray(r,a),o=V.ts.parseType(s,t.pid),o){case"pes":if(l=V.ts.parsePesType(s,t.table),u=V.ts.parsePayloadUnitStartIndicator(s),l==="video"&&(u&&!p&&(h=V.ts.parsePesTime(s),h&&(h.type="video",i.video.push(h),p=!0)),!i.firstKeyFrame)){if(u&&g.size!==0){for(d=new Uint8Array(g.size),c=0;g.data.length;)y=g.data.shift(),d.set(y,c),c+=y.byteLength;if(V.ts.videoPacketContainsKeyFrame(d)){var f=V.ts.parsePesTime(d);f?(i.firstKeyFrame=f,i.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}g.size=0}g.data.push(s),g.size+=s.byteLength}break}if(p&&i.firstKeyFrame)break;r+=se,a+=se;continue}r++,a++}for(a=e.byteLength,r=a-se,p=!1;r>=0;){if(e[r]===Ee&&e[a]===Ee){switch(s=e.subarray(r,a),o=V.ts.parseType(s,t.pid),o){case"pes":l=V.ts.parsePesType(s,t.table),u=V.ts.parsePayloadUnitStartIndicator(s),l==="video"&&u&&(h=V.ts.parsePesTime(s),h&&(h.type="video",i.video.push(h),p=!0));break}if(p)break;r-=se,a-=se;continue}r--,a--}},Lh=function(e,t){if(e.audio&&e.audio.length){var i=t;(typeof i=="undefined"||isNaN(i))&&(i=e.audio[0].dts),e.audio.forEach(function(s){s.dts=lt(s.dts,i),s.pts=lt(s.pts,i),s.dtsTime=s.dts/Ze,s.ptsTime=s.pts/Ze})}if(e.video&&e.video.length){var r=t;if((typeof r=="undefined"||isNaN(r))&&(r=e.video[0].dts),e.video.forEach(function(s){s.dts=lt(s.dts,r),s.pts=lt(s.pts,r),s.dtsTime=s.dts/Ze,s.ptsTime=s.pts/Ze}),e.firstKeyFrame){var a=e.firstKeyFrame;a.dts=lt(a.dts,r),a.pts=lt(a.pts,r),a.dtsTime=a.dts/Ze,a.ptsTime=a.pts/Ze}}},Mh=function(e){for(var t=!1,i=0,r=null,a=null,s=0,o=0,l;e.length-o>=3;){var u=V.aac.parseType(e,o);switch(u){case"timed-metadata":if(e.length-o<10){t=!0;break}if(s=V.aac.parseId3TagSize(e,o),s>e.length){t=!0;break}a===null&&(l=e.subarray(o,o+s),a=V.aac.parseAacTimestamp(l)),o+=s;break;case"audio":if(e.length-o<7){t=!0;break}if(s=V.aac.parseAdtsSize(e,o),s>e.length){t=!0;break}r===null&&(l=e.subarray(o,o+s),r=V.aac.parseSampleRate(l)),i++,o+=s;break;default:o++;break}if(t)return null}if(r===null||a===null)return null;var h=Ze/r,d={audio:[{type:"audio",dts:a,pts:a},{type:"audio",dts:a+i*1024*h,pts:a+i*1024*h}]};return d},Uh=function(e){var t={pid:null,table:null},i={};Ih(e,t);for(var r in t.table)if(t.table.hasOwnProperty(r)){var a=t.table[r];switch(a){case Ss.H264_STREAM_TYPE:i.video=[],Rh(e,t,i),i.video.length===0&&delete i.video;break;case Ss.ADTS_STREAM_TYPE:i.audio=[],Ts(e,t,i),i.audio.length===0&&delete i.audio;break}}return i},kh=function(e,t){var i=V.aac.isLikelyAacData(e),r;return i?r=Mh(e):r=Uh(e),!r||!r.audio&&!r.video?null:(Lh(r,t),r)},Nh={inspect:kh,parseAudioPes_:Ts},Pi={codecs:Zn,mp4:Uu,flv:Xu,mp2t:Yu,partial:uh};Pi.mp4.tools=ph,Pi.flv.tools=Eh,Pi.mp2t.tools=Nh;var Bh=Pi;class $h{constructor(e){m(this,"hls");m(this,"transmuxer");m(this,"remuxedSegments",[]);m(this,"remuxedInitSegment",null);m(this,"translate",e=>{this.transmuxer.push(new Uint8Array(e.arrayBuffer)),this.transmuxer.flush()});m(this,"onMuxedData",e=>{this.remuxedSegments.push(e);let t;this.remuxedInitSegment?t=new Uint8Array(e.data):(this.remuxedInitSegment=e.initSegment,t=new Uint8Array(e.initSegment.byteLength+e.data.byteLength),t.set(e.initSegment,0),t.set(e.data,e.initSegment.byteLength)),this.hls.emit(pe.Muxed,t)});this.hls=e,this.transmuxer=new Bh.mp4.Transmuxer,this.transmuxer.on("data",this.onMuxedData),this.register()}register(){this.hls.on(pe.TsLoaded,this.translate)}}function Br(n,e){return Br=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},Br(n,e)}function $r(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,Br(n,e)}var Vr=function(){function n(){this.listeners={}}var e=n.prototype;return e.on=function(i,r){this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push(r)},e.off=function(i,r){if(!this.listeners[i])return!1;var a=this.listeners[i].indexOf(r);return this.listeners[i]=this.listeners[i].slice(0),this.listeners[i].splice(a,1),a>-1},e.trigger=function(i){var r=this.listeners[i];if(!!r)if(arguments.length===2)for(var a=r.length,s=0;s<a;++s)r[s].call(this,arguments[1]);else for(var o=Array.prototype.slice.call(arguments,1),l=r.length,u=0;u<l;++u)r[u].apply(this,o)},e.dispose=function(){this.listeners={}},e.pipe=function(i){this.on("data",function(r){i.push(r)})},n}();function Fi(){return Fi=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Fi.apply(this,arguments)}function Vh(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}var It;typeof window!="undefined"?It=window:typeof qi!="undefined"?It=qi:typeof self!="undefined"?It=self:It={};var ws=It,Hh=function(e){return ws.atob?ws.atob(e):Buffer.from(e,"base64").toString("binary")};function zh(n){for(var e=Hh(n),t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}/*! @name m3u8-parser @version 4.7.0 @license Apache-2.0 */var Gh=function(n){$r(e,n);function e(){var i;return i=n.call(this)||this,i.buffer="",i}var t=e.prototype;return t.push=function(r){var a;for(this.buffer+=r,a=this.buffer.indexOf(`
`);a>-1;a=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,a)),this.buffer=this.buffer.substring(a+1)},e}(Vr),qh=String.fromCharCode(9),Hr=function(e){var t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),i={};return t[1]&&(i.length=parseInt(t[1],10)),t[2]&&(i.offset=parseInt(t[2],10)),i},Wh=function(){var e="[^=]*",t='"[^"]*"|[^,]*',i="(?:"+e+")=(?:"+t+")";return new RegExp("(?:^|,)("+i+")")},Se=function(e){for(var t=e.split(Wh()),i={},r=t.length,a;r--;)t[r]!==""&&(a=/([^=]*)=(.*)/.exec(t[r]).slice(1),a[0]=a[0].replace(/^\s+|\s+$/g,""),a[1]=a[1].replace(/^\s+|\s+$/g,""),a[1]=a[1].replace(/^['"](.*)['"]$/g,"$1"),i[a[0]]=a[1]);return i},Xh=function(n){$r(e,n);function e(){var i;return i=n.call(this)||this,i.customParsers=[],i.tagMappers=[],i}var t=e.prototype;return t.push=function(r){var a=this,s,o;if(r=r.trim(),r.length!==0){if(r[0]!=="#"){this.trigger("data",{type:"uri",uri:r});return}var l=this.tagMappers.reduce(function(u,h){var d=h(r);return d===r?u:u.concat([d])},[r]);l.forEach(function(u){for(var h=0;h<a.customParsers.length;h++)if(a.customParsers[h].call(a,u))return;if(u.indexOf("#EXT")!==0){a.trigger("data",{type:"comment",text:u.slice(1)});return}if(u=u.replace("\r",""),s=/^#EXTM3U/.exec(u),s){a.trigger("data",{type:"tag",tagType:"m3u"});return}if(s=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(u),s){o={type:"tag",tagType:"inf"},s[1]&&(o.duration=parseFloat(s[1])),s[2]&&(o.title=s[2]),a.trigger("data",o);return}if(s=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(u),s){o={type:"tag",tagType:"targetduration"},s[1]&&(o.duration=parseInt(s[1],10)),a.trigger("data",o);return}if(s=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(u),s){o={type:"tag",tagType:"version"},s[1]&&(o.version=parseInt(s[1],10)),a.trigger("data",o);return}if(s=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(u),s){o={type:"tag",tagType:"media-sequence"},s[1]&&(o.number=parseInt(s[1],10)),a.trigger("data",o);return}if(s=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(u),s){o={type:"tag",tagType:"discontinuity-sequence"},s[1]&&(o.number=parseInt(s[1],10)),a.trigger("data",o);return}if(s=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(u),s){o={type:"tag",tagType:"playlist-type"},s[1]&&(o.playlistType=s[1]),a.trigger("data",o);return}if(s=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(u),s){o=Fi(Hr(s[1]),{type:"tag",tagType:"byterange"}),a.trigger("data",o);return}if(s=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(u),s){o={type:"tag",tagType:"allow-cache"},s[1]&&(o.allowed=!/NO/.test(s[1])),a.trigger("data",o);return}if(s=/^#EXT-X-MAP:?(.*)$/.exec(u),s){if(o={type:"tag",tagType:"map"},s[1]){var d=Se(s[1]);d.URI&&(o.uri=d.URI),d.BYTERANGE&&(o.byterange=Hr(d.BYTERANGE))}a.trigger("data",o);return}if(s=/^#EXT-X-STREAM-INF:?(.*)$/.exec(u),s){if(o={type:"tag",tagType:"stream-inf"},s[1]){if(o.attributes=Se(s[1]),o.attributes.RESOLUTION){var c=o.attributes.RESOLUTION.split("x"),y={};c[0]&&(y.width=parseInt(c[0],10)),c[1]&&(y.height=parseInt(c[1],10)),o.attributes.RESOLUTION=y}o.attributes.BANDWIDTH&&(o.attributes.BANDWIDTH=parseInt(o.attributes.BANDWIDTH,10)),o.attributes["PROGRAM-ID"]&&(o.attributes["PROGRAM-ID"]=parseInt(o.attributes["PROGRAM-ID"],10))}a.trigger("data",o);return}if(s=/^#EXT-X-MEDIA:?(.*)$/.exec(u),s){o={type:"tag",tagType:"media"},s[1]&&(o.attributes=Se(s[1])),a.trigger("data",o);return}if(s=/^#EXT-X-ENDLIST/.exec(u),s){a.trigger("data",{type:"tag",tagType:"endlist"});return}if(s=/^#EXT-X-DISCONTINUITY/.exec(u),s){a.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(s=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(u),s){o={type:"tag",tagType:"program-date-time"},s[1]&&(o.dateTimeString=s[1],o.dateTimeObject=new Date(s[1])),a.trigger("data",o);return}if(s=/^#EXT-X-KEY:?(.*)$/.exec(u),s){o={type:"tag",tagType:"key"},s[1]&&(o.attributes=Se(s[1]),o.attributes.IV&&(o.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(o.attributes.IV=o.attributes.IV.substring(2)),o.attributes.IV=o.attributes.IV.match(/.{8}/g),o.attributes.IV[0]=parseInt(o.attributes.IV[0],16),o.attributes.IV[1]=parseInt(o.attributes.IV[1],16),o.attributes.IV[2]=parseInt(o.attributes.IV[2],16),o.attributes.IV[3]=parseInt(o.attributes.IV[3],16),o.attributes.IV=new Uint32Array(o.attributes.IV))),a.trigger("data",o);return}if(s=/^#EXT-X-START:?(.*)$/.exec(u),s){o={type:"tag",tagType:"start"},s[1]&&(o.attributes=Se(s[1]),o.attributes["TIME-OFFSET"]=parseFloat(o.attributes["TIME-OFFSET"]),o.attributes.PRECISE=/YES/.test(o.attributes.PRECISE)),a.trigger("data",o);return}if(s=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(u),s){o={type:"tag",tagType:"cue-out-cont"},s[1]?o.data=s[1]:o.data="",a.trigger("data",o);return}if(s=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(u),s){o={type:"tag",tagType:"cue-out"},s[1]?o.data=s[1]:o.data="",a.trigger("data",o);return}if(s=/^#EXT-X-CUE-IN:?(.*)?$/.exec(u),s){o={type:"tag",tagType:"cue-in"},s[1]?o.data=s[1]:o.data="",a.trigger("data",o);return}if(s=/^#EXT-X-SKIP:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"skip"},o.attributes=Se(s[1]),o.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(o.attributes["SKIPPED-SEGMENTS"]=parseInt(o.attributes["SKIPPED-SEGMENTS"],10)),o.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(o.attributes["RECENTLY-REMOVED-DATERANGES"]=o.attributes["RECENTLY-REMOVED-DATERANGES"].split(qh)),a.trigger("data",o);return}if(s=/^#EXT-X-PART:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"part"},o.attributes=Se(s[1]),["DURATION"].forEach(function(p){o.attributes.hasOwnProperty(p)&&(o.attributes[p]=parseFloat(o.attributes[p]))}),["INDEPENDENT","GAP"].forEach(function(p){o.attributes.hasOwnProperty(p)&&(o.attributes[p]=/YES/.test(o.attributes[p]))}),o.attributes.hasOwnProperty("BYTERANGE")&&(o.attributes.byterange=Hr(o.attributes.BYTERANGE)),a.trigger("data",o);return}if(s=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"server-control"},o.attributes=Se(s[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(p){o.attributes.hasOwnProperty(p)&&(o.attributes[p]=parseFloat(o.attributes[p]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(p){o.attributes.hasOwnProperty(p)&&(o.attributes[p]=/YES/.test(o.attributes[p]))}),a.trigger("data",o);return}if(s=/^#EXT-X-PART-INF:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"part-inf"},o.attributes=Se(s[1]),["PART-TARGET"].forEach(function(p){o.attributes.hasOwnProperty(p)&&(o.attributes[p]=parseFloat(o.attributes[p]))}),a.trigger("data",o);return}if(s=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"preload-hint"},o.attributes=Se(s[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(p){if(o.attributes.hasOwnProperty(p)){o.attributes[p]=parseInt(o.attributes[p],10);var g=p==="BYTERANGE-LENGTH"?"length":"offset";o.attributes.byterange=o.attributes.byterange||{},o.attributes.byterange[g]=o.attributes[p],delete o.attributes[p]}}),a.trigger("data",o);return}if(s=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"rendition-report"},o.attributes=Se(s[1]),["LAST-MSN","LAST-PART"].forEach(function(p){o.attributes.hasOwnProperty(p)&&(o.attributes[p]=parseInt(o.attributes[p],10))}),a.trigger("data",o);return}a.trigger("data",{type:"tag",data:u.slice(4)})})}},t.addParser=function(r){var a=this,s=r.expression,o=r.customType,l=r.dataParser,u=r.segment;typeof l!="function"&&(l=function(d){return d}),this.customParsers.push(function(h){var d=s.exec(h);if(d)return a.trigger("data",{type:"custom",data:l(h),customType:o,segment:u}),!0})},t.addTagMapper=function(r){var a=r.expression,s=r.map,o=function(u){return a.test(u)?s(u):u};this.tagMappers.push(o)},e}(Vr),Yh=function(e){return e.toLowerCase().replace(/-(\w)/g,function(t){return t[1].toUpperCase()})},ut=function(e){var t={};return Object.keys(e).forEach(function(i){t[Yh(i)]=e[i]}),t},zr=function(e){var t=e.serverControl,i=e.targetDuration,r=e.partTargetDuration;if(!!t){var a="#EXT-X-SERVER-CONTROL",s="holdBack",o="partHoldBack",l=i&&i*3,u=r&&r*2;i&&!t.hasOwnProperty(s)&&(t[s]=l,this.trigger("info",{message:a+" defaulting HOLD-BACK to targetDuration * 3 ("+l+")."})),l&&t[s]<l&&(this.trigger("warn",{message:a+" clamping HOLD-BACK ("+t[s]+") to targetDuration * 3 ("+l+")"}),t[s]=l),r&&!t.hasOwnProperty(o)&&(t[o]=r*3,this.trigger("info",{message:a+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+t[o]+")."})),r&&t[o]<u&&(this.trigger("warn",{message:a+" clamping PART-HOLD-BACK ("+t[o]+") to partTargetDuration * 2 ("+u+")."}),t[o]=u)}},jh=function(n){$r(e,n);function e(){var i;i=n.call(this)||this,i.lineStream=new Gh,i.parseStream=new Xh,i.lineStream.pipe(i.parseStream);var r=Vh(i),a=[],s={},o,l,u=!1,h=function(){},d={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},c="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",y=0;i.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var p=0,g=0;return i.on("end",function(){s.uri||!s.parts&&!s.preloadHints||(!s.map&&o&&(s.map=o),!s.key&&l&&(s.key=l),!s.timeline&&typeof y=="number"&&(s.timeline=y),i.manifest.preloadSegment=s)}),i.parseStream.on("data",function(f){var E,_;({tag:function(){({version:function(){f.version&&(this.manifest.version=f.version)},"allow-cache":function(){this.manifest.allowCache=f.allowed,"allowed"in f||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var A={};"length"in f&&(s.byterange=A,A.length=f.length,"offset"in f||(f.offset=p)),"offset"in f&&(s.byterange=A,A.offset=f.offset),p=A.offset+A.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),f.duration>0&&(s.duration=f.duration),f.duration===0&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=a},key:function(){if(!f.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(f.attributes.METHOD==="NONE"){l=null;return}if(!f.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(f.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:f.attributes};return}if(f.attributes.KEYFORMAT===c){var A=["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"];if(A.indexOf(f.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(f.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),f.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(f.attributes.KEYID&&f.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:f.attributes.KEYFORMAT,keyId:f.attributes.KEYID.substring(2)},pssh:zh(f.attributes.URI.split(",")[1])};return}f.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),l={method:f.attributes.METHOD||"AES-128",uri:f.attributes.URI},typeof f.attributes.IV!="undefined"&&(l.iv=f.attributes.IV)},"media-sequence":function(){if(!isFinite(f.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+f.number});return}this.manifest.mediaSequence=f.number},"discontinuity-sequence":function(){if(!isFinite(f.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+f.number});return}this.manifest.discontinuitySequence=f.number,y=f.number},"playlist-type":function(){if(!/VOD|EVENT/.test(f.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+f.playlist});return}this.manifest.playlistType=f.playlistType},map:function(){o={},f.uri&&(o.uri=f.uri),f.byterange&&(o.byterange=f.byterange),l&&(o.key=l)},"stream-inf":function(){if(this.manifest.playlists=a,this.manifest.mediaGroups=this.manifest.mediaGroups||d,!f.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}s.attributes||(s.attributes={}),Fi(s.attributes,f.attributes)},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||d,!(f.attributes&&f.attributes.TYPE&&f.attributes["GROUP-ID"]&&f.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}var A=this.manifest.mediaGroups[f.attributes.TYPE];A[f.attributes["GROUP-ID"]]=A[f.attributes["GROUP-ID"]]||{},E=A[f.attributes["GROUP-ID"]],_={default:/yes/i.test(f.attributes.DEFAULT)},_.default?_.autoselect=!0:_.autoselect=/yes/i.test(f.attributes.AUTOSELECT),f.attributes.LANGUAGE&&(_.language=f.attributes.LANGUAGE),f.attributes.URI&&(_.uri=f.attributes.URI),f.attributes["INSTREAM-ID"]&&(_.instreamId=f.attributes["INSTREAM-ID"]),f.attributes.CHARACTERISTICS&&(_.characteristics=f.attributes.CHARACTERISTICS),f.attributes.FORCED&&(_.forced=/yes/i.test(f.attributes.FORCED)),E[f.attributes.NAME]=_},discontinuity:function(){y+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(a.length)},"program-date-time":function(){typeof this.manifest.dateTimeString=="undefined"&&(this.manifest.dateTimeString=f.dateTimeString,this.manifest.dateTimeObject=f.dateTimeObject),s.dateTimeString=f.dateTimeString,s.dateTimeObject=f.dateTimeObject},targetduration:function(){if(!isFinite(f.duration)||f.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+f.duration});return}this.manifest.targetDuration=f.duration,zr.call(this,this.manifest)},start:function(){if(!f.attributes||isNaN(f.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:f.attributes["TIME-OFFSET"],precise:f.attributes.PRECISE}},"cue-out":function(){s.cueOut=f.data},"cue-out-cont":function(){s.cueOutCont=f.data},"cue-in":function(){s.cueIn=f.data},skip:function(){this.manifest.skip=ut(f.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",f.attributes,["SKIPPED-SEGMENTS"])},part:function(){var A=this;u=!0;var N=this.manifest.segments.length,z=ut(f.attributes);s.parts=s.parts||[],s.parts.push(z),z.byterange&&(z.byterange.hasOwnProperty("offset")||(z.byterange.offset=g),g=z.byterange.offset+z.byterange.length);var b=s.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+b+" for segment #"+N,f.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(function(I,v){I.hasOwnProperty("lastPart")||A.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+v+" lacks required attribute(s): LAST-PART"})})},"server-control":function(){var A=this.manifest.serverControl=ut(f.attributes);A.hasOwnProperty("canBlockReload")||(A.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),zr.call(this,this.manifest),A.canSkipDateranges&&!A.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var A=this.manifest.segments.length,N=ut(f.attributes),z=N.type&&N.type==="PART";s.preloadHints=s.preloadHints||[],s.preloadHints.push(N),N.byterange&&(N.byterange.hasOwnProperty("offset")||(N.byterange.offset=z?g:0,z&&(g=N.byterange.offset+N.byterange.length)));var b=s.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+b+" for segment #"+A,f.attributes,["TYPE","URI"]),!!N.type)for(var I=0;I<s.preloadHints.length-1;I++){var v=s.preloadHints[I];!v.type||v.type===N.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+b+" for segment #"+A+" has the same TYPE "+N.type+" as preload hint #"+I})}},"rendition-report":function(){var A=ut(f.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(A);var N=this.manifest.renditionReports.length-1,z=["LAST-MSN","URI"];u&&z.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+N,f.attributes,z)},"part-inf":function(){this.manifest.partInf=ut(f.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",f.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),zr.call(this,this.manifest)}}[f.tagType]||h).call(r)},uri:function(){s.uri=f.uri,a.push(s),this.manifest.targetDuration&&!("duration"in s)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),l&&(s.key=l),s.timeline=y,o&&(s.map=o),g=0,s={}},comment:function(){},custom:function(){f.segment?(s.custom=s.custom||{},s.custom[f.customType]=f.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[f.customType]=f.data)}})[f.type].call(r)}),i}var t=e.prototype;return t.warnOnMissingAttributes_=function(r,a,s){var o=[];s.forEach(function(l){a.hasOwnProperty(l)||o.push(l)}),o.length&&this.trigger("warn",{message:r+" lacks required attribute(s): "+o.join(", ")})},t.push=function(r){this.lineStream.push(r)},t.end=function(){this.lineStream.push(`
`),this.trigger("end")},t.addParser=function(r){this.parseStream.addParser(r)},t.addTagMapper=function(r){this.parseStream.addTagMapper(r)},e}(Vr);class Kh{constructor(e){m(this,"parser");m(this,"hls");m(this,"playManifest");m(this,"segmentIndex",-1);m(this,"m3u8Promise");m(this,"origin","");this.hls=e,this.parser=new jh}getM3u8Data(e){if(this.origin=new window.URL(e).origin,!this.origin){let i=`\u8D44\u6E90\u5730\u5740\u9519\u8BEF: ${e}`;return x.warn("Loader getM3u8Data error",i),Promise.reject(i)}let t=new Promise((i,r)=>{this.hls.emit(pe.ManifestLoading),fetch(e,{}).then(a=>{if(a.ok&&a.status===200)return a.text();r("response not 200")}).then(a=>{this.hls.emit(pe.ManifestLoaded,a),this.parser.push(a),this.parser.end(),this.playManifest=this.parser.manifest,this.setTotalDuration(),this.hls.emit(pe.ManifestParsed,this.parser.manifest),i(this.parser.manifest)})});return this.m3u8Promise=t,t}getTsData(e){this.segmentIndex=e===void 0?this.segmentIndex+1:e;let t=this.playManifest.segments[this.segmentIndex],i=this.origin+t.uri;if(!i){x.warn(`Loader getTsData - TS Url not found, index: ${this.segmentIndex}`);return}this.hls.emit(pe.TsLoading,t),fetch(i,{}).then(r=>{if(r.ok&&r.status===200)return r.arrayBuffer()}).then(r=>{this.hls.emit(pe.TsLoaded,{segment:t,arrayBuffer:r})})}setTotalDuration(){let e=0,t=0;for(let i of this.playManifest.segments)e+=i.duration,i.index=t++;this.playManifest.totalDuration=e,this.playManifest.avgDuration=Number((e/t).toFixed(2))}}class Qh extends Hn{constructor(){super();m(this,"video");m(this,"mseController");m(this,"loader");m(this,"muxer");this.mseController=new nl(this),this.loader=new Kh(this),this.muxer=new $h(this)}loadSource(e){this.loader.getM3u8Data(e)}attachMedia(e){this.mseController.attachMedia(e)}destroy(){}}const Jh=Qh;class Zh extends Gt{constructor(e,t){super(e,t);x.info("HlsLitePlayer - \u521B\u5EFA HlsLitePlayer")}load(e,t=!1){return this.checkUrl(e,t)?(this.nPlayer&&this.recordPlayStatus(e),new Promise(i=>{this.createHlsInstance().then(r=>{r&&(this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}),this.setUrl(e),this.nPlayer.loadSource(e),this.nPlayer.attachMedia(this.video),i(!0)})})):Promise.reject(!1)}reload(){return this.load(this.cacheUrl||this.url,!0)}async createHlsInstance(){let e=await this.destroy();return this.nPlayer=new Jh,e}destroy(){return new Promise(e=>{this.nPlayer?(this.nPlayer.destroy(),e(!0)):e(!1)})}getBandwidthEstimate(){return 0}}function ed(n){let{scheduleOption:e}=n;return!e.enable&&e.debugPlayer?e.debugPlayer:q.Hls}function Es(n){var a;let{scheduleOption:e,type:t,liveOption:i}=n,{playerData:r}=e;if(t==="live"){let s=i.type;return!s||s==="auto"?+r.live_type==1?q.Hls:ce.default.isSupported()?q.Flv:q.Hls:s}else return(a=r.default_server)!=null&&a.mp4_domainnames?q.Native:ed(n)}var td=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),i=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var r=42;e[t]=r;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(e,t);if(s.value!==r||s.enumerable!==!0)return!1}return!0},_s=typeof Symbol!="undefined"&&Symbol,id=td,rd=function(){return typeof _s!="function"||typeof Symbol!="function"||typeof _s("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:id()},nd="Function.prototype.bind called on incompatible ",Gr=Array.prototype.slice,ad=Object.prototype.toString,sd="[object Function]",od=function(e){var t=this;if(typeof t!="function"||ad.call(t)!==sd)throw new TypeError(nd+t);for(var i=Gr.call(arguments,1),r,a=function(){if(this instanceof r){var h=t.apply(this,i.concat(Gr.call(arguments)));return Object(h)===h?h:this}else return t.apply(e,i.concat(Gr.call(arguments)))},s=Math.max(0,t.length-i.length),o=[],l=0;l<s;l++)o.push("$"+l);if(r=Function("binder","return function ("+o.join(",")+"){ return binder.apply(this,arguments); }")(a),t.prototype){var u=function(){};u.prototype=t.prototype,r.prototype=new u,u.prototype=null}return r},ld=od,qr=Function.prototype.bind||ld,ud=qr,hd=ud.call(Function.call,Object.prototype.hasOwnProperty),M,Rt=SyntaxError,As=Function,ht=TypeError,Wr=function(n){try{return As('"use strict"; return ('+n+").constructor;")()}catch{}},et=Object.getOwnPropertyDescriptor;if(et)try{et({},"")}catch{et=null}var Xr=function(){throw new ht},dd=et?function(){try{return arguments.callee,Xr}catch{try{return et(arguments,"callee").get}catch{return Xr}}}():Xr,dt=rd(),ze=Object.getPrototypeOf||function(n){return n.__proto__},ct={},cd=typeof Uint8Array=="undefined"?M:ze(Uint8Array),ft={"%AggregateError%":typeof AggregateError=="undefined"?M:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer=="undefined"?M:ArrayBuffer,"%ArrayIteratorPrototype%":dt?ze([][Symbol.iterator]()):M,"%AsyncFromSyncIteratorPrototype%":M,"%AsyncFunction%":ct,"%AsyncGenerator%":ct,"%AsyncGeneratorFunction%":ct,"%AsyncIteratorPrototype%":ct,"%Atomics%":typeof Atomics=="undefined"?M:Atomics,"%BigInt%":typeof BigInt=="undefined"?M:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView=="undefined"?M:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array=="undefined"?M:Float32Array,"%Float64Array%":typeof Float64Array=="undefined"?M:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry=="undefined"?M:FinalizationRegistry,"%Function%":As,"%GeneratorFunction%":ct,"%Int8Array%":typeof Int8Array=="undefined"?M:Int8Array,"%Int16Array%":typeof Int16Array=="undefined"?M:Int16Array,"%Int32Array%":typeof Int32Array=="undefined"?M:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":dt?ze(ze([][Symbol.iterator]())):M,"%JSON%":typeof JSON=="object"?JSON:M,"%Map%":typeof Map=="undefined"?M:Map,"%MapIteratorPrototype%":typeof Map=="undefined"||!dt?M:ze(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise=="undefined"?M:Promise,"%Proxy%":typeof Proxy=="undefined"?M:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect=="undefined"?M:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set=="undefined"?M:Set,"%SetIteratorPrototype%":typeof Set=="undefined"||!dt?M:ze(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer=="undefined"?M:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":dt?ze(""[Symbol.iterator]()):M,"%Symbol%":dt?Symbol:M,"%SyntaxError%":Rt,"%ThrowTypeError%":dd,"%TypedArray%":cd,"%TypeError%":ht,"%Uint8Array%":typeof Uint8Array=="undefined"?M:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray=="undefined"?M:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array=="undefined"?M:Uint16Array,"%Uint32Array%":typeof Uint32Array=="undefined"?M:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap=="undefined"?M:WeakMap,"%WeakRef%":typeof WeakRef=="undefined"?M:WeakRef,"%WeakSet%":typeof WeakSet=="undefined"?M:WeakSet},fd=function n(e){var t;if(e==="%AsyncFunction%")t=Wr("async function () {}");else if(e==="%GeneratorFunction%")t=Wr("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Wr("async function* () {}");else if(e==="%AsyncGenerator%"){var i=n("%AsyncGeneratorFunction%");i&&(t=i.prototype)}else if(e==="%AsyncIteratorPrototype%"){var r=n("%AsyncGenerator%");r&&(t=ze(r.prototype))}return ft[e]=t,t},Ps={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Di=qr,Ci=hd,pd=Di.call(Function.call,Array.prototype.concat),md=Di.call(Function.apply,Array.prototype.splice),Fs=Di.call(Function.call,String.prototype.replace),Oi=Di.call(Function.call,String.prototype.slice),gd=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,yd=/\\(\\)?/g,vd=function(e){var t=Oi(e,0,1),i=Oi(e,-1);if(t==="%"&&i!=="%")throw new Rt("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&t!=="%")throw new Rt("invalid intrinsic syntax, expected opening `%`");var r=[];return Fs(e,gd,function(a,s,o,l){r[r.length]=o?Fs(l,yd,"$1"):s||a}),r},xd=function(e,t){var i=e,r;if(Ci(Ps,i)&&(r=Ps[i],i="%"+r[0]+"%"),Ci(ft,i)){var a=ft[i];if(a===ct&&(a=fd(i)),typeof a=="undefined"&&!t)throw new ht("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:i,value:a}}throw new Rt("intrinsic "+e+" does not exist!")},Yr=function(e,t){if(typeof e!="string"||e.length===0)throw new ht("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new ht('"allowMissing" argument must be a boolean');var i=vd(e),r=i.length>0?i[0]:"",a=xd("%"+r+"%",t),s=a.name,o=a.value,l=!1,u=a.alias;u&&(r=u[0],md(i,pd([0,1],u)));for(var h=1,d=!0;h<i.length;h+=1){var c=i[h],y=Oi(c,0,1),p=Oi(c,-1);if((y==='"'||y==="'"||y==="`"||p==='"'||p==="'"||p==="`")&&y!==p)throw new Rt("property names with quotes must have matching quotes");if((c==="constructor"||!d)&&(l=!0),r+="."+c,s="%"+r+"%",Ci(ft,s))o=ft[s];else if(o!=null){if(!(c in o)){if(!t)throw new ht("base intrinsic for "+e+" exists, but the property is not available.");return}if(et&&h+1>=i.length){var g=et(o,c);d=!!g,d&&"get"in g&&!("originalValue"in g.get)?o=g.get:o=o[c]}else d=Ci(o,c),o=o[c];d&&!l&&(ft[s]=o)}}return o},Ds={exports:{}};(function(n){var e=qr,t=Yr,i=t("%Function.prototype.apply%"),r=t("%Function.prototype.call%"),a=t("%Reflect.apply%",!0)||e.call(r,i),s=t("%Object.getOwnPropertyDescriptor%",!0),o=t("%Object.defineProperty%",!0),l=t("%Math.max%");if(o)try{o({},"a",{value:1})}catch{o=null}n.exports=function(d){var c=a(e,r,arguments);if(s&&o){var y=s(c,"length");y.configurable&&o(c,"length",{value:1+l(0,d.length-(arguments.length-1))})}return c};var u=function(){return a(e,i,arguments)};o?o(n.exports,"apply",{value:u}):n.exports.apply=u})(Ds);var Cs=Yr,Os=Ds.exports,bd=Os(Cs("String.prototype.indexOf")),Sd=function(e,t){var i=Cs(e,!!t);return typeof i=="function"&&bd(e,".prototype.")>-1?Os(i):i},Td={},wd=Object.freeze(Object.defineProperty({__proto__:null,default:Td},Symbol.toStringTag,{value:"Module"})),Ed=Co(wd),jr=typeof Map=="function"&&Map.prototype,Kr=Object.getOwnPropertyDescriptor&&jr?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ii=jr&&Kr&&typeof Kr.get=="function"?Kr.get:null,_d=jr&&Map.prototype.forEach,Qr=typeof Set=="function"&&Set.prototype,Jr=Object.getOwnPropertyDescriptor&&Qr?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Ri=Qr&&Jr&&typeof Jr.get=="function"?Jr.get:null,Ad=Qr&&Set.prototype.forEach,Pd=typeof WeakMap=="function"&&WeakMap.prototype,Lt=Pd?WeakMap.prototype.has:null,Fd=typeof WeakSet=="function"&&WeakSet.prototype,Mt=Fd?WeakSet.prototype.has:null,Dd=typeof WeakRef=="function"&&WeakRef.prototype,Is=Dd?WeakRef.prototype.deref:null,Cd=Boolean.prototype.valueOf,Od=Object.prototype.toString,Id=Function.prototype.toString,Rd=String.prototype.match,Zr=String.prototype.slice,Ge=String.prototype.replace,Ld=String.prototype.toUpperCase,Rs=String.prototype.toLowerCase,Ls=RegExp.prototype.test,Ms=Array.prototype.concat,_e=Array.prototype.join,Md=Array.prototype.slice,Us=Math.floor,en=typeof BigInt=="function"?BigInt.prototype.valueOf:null,tn=Object.getOwnPropertySymbols,rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,pt=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ne=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===pt?"object":"symbol")?Symbol.toStringTag:null,ks=Object.prototype.propertyIsEnumerable,Ns=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function Bs(n,e){if(n===1/0||n===-1/0||n!==n||n&&n>-1e3&&n<1e3||Ls.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof n=="number"){var i=n<0?-Us(-n):Us(n);if(i!==n){var r=String(i),a=Zr.call(e,r.length+1);return Ge.call(r,t,"$&_")+"."+Ge.call(Ge.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ge.call(e,t,"$&_")}var nn=Ed.custom,an=nn&&Vs(nn)?nn:null,Ud=function n(e,t,i,r){var a=t||{};if(qe(a,"quoteStyle")&&a.quoteStyle!=="single"&&a.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(qe(a,"maxStringLength")&&(typeof a.maxStringLength=="number"?a.maxStringLength<0&&a.maxStringLength!==1/0:a.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=qe(a,"customInspect")?a.customInspect:!0;if(typeof s!="boolean"&&s!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(qe(a,"indent")&&a.indent!==null&&a.indent!=="	"&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(qe(a,"numericSeparator")&&typeof a.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var o=a.numericSeparator;if(typeof e=="undefined")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return zs(e,a);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var l=String(e);return o?Bs(e,l):l}if(typeof e=="bigint"){var u=String(e)+"n";return o?Bs(e,u):u}var h=typeof a.depth=="undefined"?5:a.depth;if(typeof i=="undefined"&&(i=0),i>=h&&h>0&&typeof e=="object")return sn(e)?"[Array]":"[Object]";var d=tc(a,i);if(typeof r=="undefined")r=[];else if(Hs(r,e)>=0)return"[Circular]";function c(D,ae,Bt){if(ae&&(r=Md.call(r),r.push(ae)),Bt){var De={depth:a.depth};return qe(a,"quoteStyle")&&(De.quoteStyle=a.quoteStyle),n(D,De,i+1,r)}return n(D,a,i+1,r)}if(typeof e=="function"){var y=Wd(e),p=Li(e,c);return"[Function"+(y?": "+y:" (anonymous)")+"]"+(p.length>0?" { "+_e.call(p,", ")+" }":"")}if(Vs(e)){var g=pt?Ge.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):rn.call(e);return typeof e=="object"&&!pt?Ut(g):g}if(Jd(e)){for(var f="<"+Rs.call(String(e.nodeName)),E=e.attributes||[],_=0;_<E.length;_++)f+=" "+E[_].name+"="+$s(kd(E[_].value),"double",a);return f+=">",e.childNodes&&e.childNodes.length&&(f+="..."),f+="</"+Rs.call(String(e.nodeName))+">",f}if(sn(e)){if(e.length===0)return"[]";var S=Li(e,c);return d&&!ec(S)?"["+ln(S,d)+"]":"[ "+_e.call(S,", ")+" ]"}if($d(e)){var w=Li(e,c);return"cause"in e&&!ks.call(e,"cause")?"{ ["+String(e)+"] "+_e.call(Ms.call("[cause]: "+c(e.cause),w),", ")+" }":w.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+_e.call(w,", ")+" }"}if(typeof e=="object"&&s){if(an&&typeof e[an]=="function")return e[an]();if(s!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(Xd(e)){var A=[];return _d.call(e,function(D,ae){A.push(c(ae,e,!0)+" => "+c(D,e))}),Gs("Map",Ii.call(e),A,d)}if(Kd(e)){var N=[];return Ad.call(e,function(D){N.push(c(D,e))}),Gs("Set",Ri.call(e),N,d)}if(Yd(e))return on("WeakMap");if(Qd(e))return on("WeakSet");if(jd(e))return on("WeakRef");if(Hd(e))return Ut(c(Number(e)));if(Gd(e))return Ut(c(en.call(e)));if(zd(e))return Ut(Cd.call(e));if(Vd(e))return Ut(c(String(e)));if(!Nd(e)&&!Bd(e)){var z=Li(e,c),b=Ns?Ns(e)===Object.prototype:e instanceof Object||e.constructor===Object,I=e instanceof Object?"":"null prototype",v=!b&&ne&&Object(e)===e&&ne in e?Zr.call(We(e),8,-1):I?"Object":"",C=b||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",P=C+(v||I?"["+_e.call(Ms.call([],v||[],I||[]),": ")+"] ":"");return z.length===0?P+"{}":d?P+"{"+ln(z,d)+"}":P+"{ "+_e.call(z,", ")+" }"}return String(e)};function $s(n,e,t){var i=(t.quoteStyle||e)==="double"?'"':"'";return i+n+i}function kd(n){return Ge.call(String(n),/"/g,"&quot;")}function sn(n){return We(n)==="[object Array]"&&(!ne||!(typeof n=="object"&&ne in n))}function Nd(n){return We(n)==="[object Date]"&&(!ne||!(typeof n=="object"&&ne in n))}function Bd(n){return We(n)==="[object RegExp]"&&(!ne||!(typeof n=="object"&&ne in n))}function $d(n){return We(n)==="[object Error]"&&(!ne||!(typeof n=="object"&&ne in n))}function Vd(n){return We(n)==="[object String]"&&(!ne||!(typeof n=="object"&&ne in n))}function Hd(n){return We(n)==="[object Number]"&&(!ne||!(typeof n=="object"&&ne in n))}function zd(n){return We(n)==="[object Boolean]"&&(!ne||!(typeof n=="object"&&ne in n))}function Vs(n){if(pt)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!rn)return!1;try{return rn.call(n),!0}catch{}return!1}function Gd(n){if(!n||typeof n!="object"||!en)return!1;try{return en.call(n),!0}catch{}return!1}var qd=Object.prototype.hasOwnProperty||function(n){return n in this};function qe(n,e){return qd.call(n,e)}function We(n){return Od.call(n)}function Wd(n){if(n.name)return n.name;var e=Rd.call(Id.call(n),/^function\s*([\w$]+)/);return e?e[1]:null}function Hs(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,i=n.length;t<i;t++)if(n[t]===e)return t;return-1}function Xd(n){if(!Ii||!n||typeof n!="object")return!1;try{Ii.call(n);try{Ri.call(n)}catch{return!0}return n instanceof Map}catch{}return!1}function Yd(n){if(!Lt||!n||typeof n!="object")return!1;try{Lt.call(n,Lt);try{Mt.call(n,Mt)}catch{return!0}return n instanceof WeakMap}catch{}return!1}function jd(n){if(!Is||!n||typeof n!="object")return!1;try{return Is.call(n),!0}catch{}return!1}function Kd(n){if(!Ri||!n||typeof n!="object")return!1;try{Ri.call(n);try{Ii.call(n)}catch{return!0}return n instanceof Set}catch{}return!1}function Qd(n){if(!Mt||!n||typeof n!="object")return!1;try{Mt.call(n,Mt);try{Lt.call(n,Lt)}catch{return!0}return n instanceof WeakSet}catch{}return!1}function Jd(n){return!n||typeof n!="object"?!1:typeof HTMLElement!="undefined"&&n instanceof HTMLElement?!0:typeof n.nodeName=="string"&&typeof n.getAttribute=="function"}function zs(n,e){if(n.length>e.maxStringLength){var t=n.length-e.maxStringLength,i="... "+t+" more character"+(t>1?"s":"");return zs(Zr.call(n,0,e.maxStringLength),e)+i}var r=Ge.call(Ge.call(n,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Zd);return $s(r,"single",e)}function Zd(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+Ld.call(e.toString(16))}function Ut(n){return"Object("+n+")"}function on(n){return n+" { ? }"}function Gs(n,e,t,i){var r=i?ln(t,i):_e.call(t,", ");return n+" ("+e+") {"+r+"}"}function ec(n){for(var e=0;e<n.length;e++)if(Hs(n[e],`
`)>=0)return!1;return!0}function tc(n,e){var t;if(n.indent==="	")t="	";else if(typeof n.indent=="number"&&n.indent>0)t=_e.call(Array(n.indent+1)," ");else return null;return{base:t,prev:_e.call(Array(e+1),t)}}function ln(n,e){if(n.length===0)return"";var t=`
`+e.prev+e.base;return t+_e.call(n,","+t)+`
`+e.prev}function Li(n,e){var t=sn(n),i=[];if(t){i.length=n.length;for(var r=0;r<n.length;r++)i[r]=qe(n,r)?e(n[r],n):""}var a=typeof tn=="function"?tn(n):[],s;if(pt){s={};for(var o=0;o<a.length;o++)s["$"+a[o]]=a[o]}for(var l in n)!qe(n,l)||t&&String(Number(l))===l&&l<n.length||pt&&s["$"+l]instanceof Symbol||(Ls.call(/[^\w$]/,l)?i.push(e(l,n)+": "+e(n[l],n)):i.push(l+": "+e(n[l],n)));if(typeof tn=="function")for(var u=0;u<a.length;u++)ks.call(n,a[u])&&i.push("["+e(a[u])+"]: "+e(n[a[u]],n));return i}var un=Yr,mt=Sd,ic=Ud,rc=un("%TypeError%"),Mi=un("%WeakMap%",!0),Ui=un("%Map%",!0),nc=mt("WeakMap.prototype.get",!0),ac=mt("WeakMap.prototype.set",!0),sc=mt("WeakMap.prototype.has",!0),oc=mt("Map.prototype.get",!0),lc=mt("Map.prototype.set",!0),uc=mt("Map.prototype.has",!0),hn=function(n,e){for(var t=n,i;(i=t.next)!==null;t=i)if(i.key===e)return t.next=i.next,i.next=n.next,n.next=i,i},hc=function(n,e){var t=hn(n,e);return t&&t.value},dc=function(n,e,t){var i=hn(n,e);i?i.value=t:n.next={key:e,next:n.next,value:t}},cc=function(n,e){return!!hn(n,e)},fc=function(){var e,t,i,r={assert:function(a){if(!r.has(a))throw new rc("Side channel does not contain "+ic(a))},get:function(a){if(Mi&&a&&(typeof a=="object"||typeof a=="function")){if(e)return nc(e,a)}else if(Ui){if(t)return oc(t,a)}else if(i)return hc(i,a)},has:function(a){if(Mi&&a&&(typeof a=="object"||typeof a=="function")){if(e)return sc(e,a)}else if(Ui){if(t)return uc(t,a)}else if(i)return cc(i,a);return!1},set:function(a,s){Mi&&a&&(typeof a=="object"||typeof a=="function")?(e||(e=new Mi),ac(e,a,s)):Ui?(t||(t=new Ui),lc(t,a,s)):(i||(i={key:{},next:null}),dc(i,a,s))}};return r},pc=String.prototype.replace,mc=/%20/g,dn={RFC1738:"RFC1738",RFC3986:"RFC3986"},cn={default:dn.RFC3986,formatters:{RFC1738:function(n){return pc.call(n,mc,"+")},RFC3986:function(n){return String(n)}},RFC1738:dn.RFC1738,RFC3986:dn.RFC3986},gc=cn,fn=Object.prototype.hasOwnProperty,tt=Array.isArray,Ae=function(){for(var n=[],e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n}(),yc=function(e){for(;e.length>1;){var t=e.pop(),i=t.obj[t.prop];if(tt(i)){for(var r=[],a=0;a<i.length;++a)typeof i[a]!="undefined"&&r.push(i[a]);t.obj[t.prop]=r}}},qs=function(e,t){for(var i=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)typeof e[r]!="undefined"&&(i[r]=e[r]);return i},vc=function n(e,t,i){if(!t)return e;if(typeof t!="object"){if(tt(e))e.push(t);else if(e&&typeof e=="object")(i&&(i.plainObjects||i.allowPrototypes)||!fn.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var r=e;return tt(e)&&!tt(t)&&(r=qs(e,i)),tt(e)&&tt(t)?(t.forEach(function(a,s){if(fn.call(e,s)){var o=e[s];o&&typeof o=="object"&&a&&typeof a=="object"?e[s]=n(o,a,i):e.push(a)}else e[s]=a}),e):Object.keys(t).reduce(function(a,s){var o=t[s];return fn.call(a,s)?a[s]=n(a[s],o,i):a[s]=o,a},r)},xc=function(e,t){return Object.keys(t).reduce(function(i,r){return i[r]=t[r],i},e)},bc=function(n,e,t){var i=n.replace(/\+/g," ");if(t==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},Sc=function(e,t,i,r,a){if(e.length===0)return e;var s=e;if(typeof e=="symbol"?s=Symbol.prototype.toString.call(e):typeof e!="string"&&(s=String(e)),i==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(h){return"%26%23"+parseInt(h.slice(2),16)+"%3B"});for(var o="",l=0;l<s.length;++l){var u=s.charCodeAt(l);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||a===gc.RFC1738&&(u===40||u===41)){o+=s.charAt(l);continue}if(u<128){o=o+Ae[u];continue}if(u<2048){o=o+(Ae[192|u>>6]+Ae[128|u&63]);continue}if(u<55296||u>=57344){o=o+(Ae[224|u>>12]+Ae[128|u>>6&63]+Ae[128|u&63]);continue}l+=1,u=65536+((u&1023)<<10|s.charCodeAt(l)&1023),o+=Ae[240|u>>18]+Ae[128|u>>12&63]+Ae[128|u>>6&63]+Ae[128|u&63]}return o},Tc=function(e){for(var t=[{obj:{o:e},prop:"o"}],i=[],r=0;r<t.length;++r)for(var a=t[r],s=a.obj[a.prop],o=Object.keys(s),l=0;l<o.length;++l){var u=o[l],h=s[u];typeof h=="object"&&h!==null&&i.indexOf(h)===-1&&(t.push({obj:s,prop:u}),i.push(h))}return yc(t),e},wc=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},Ec=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},_c=function(e,t){return[].concat(e,t)},Ac=function(e,t){if(tt(e)){for(var i=[],r=0;r<e.length;r+=1)i.push(t(e[r]));return i}return t(e)},Ws={arrayToObject:qs,assign:xc,combine:_c,compact:Tc,decode:bc,encode:Sc,isBuffer:Ec,isRegExp:wc,maybeMap:Ac,merge:vc},Xs=fc,pn=Ws,kt=cn,Pc=Object.prototype.hasOwnProperty,Ys={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},it=Array.isArray,Fc=String.prototype.split,Dc=Array.prototype.push,js=function(n,e){Dc.apply(n,it(e)?e:[e])},Cc=Date.prototype.toISOString,Ks=kt.default,te={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:pn.encode,encodeValuesOnly:!1,format:Ks,formatter:kt.formatters[Ks],indices:!1,serializeDate:function(e){return Cc.call(e)},skipNulls:!1,strictNullHandling:!1},Oc=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},mn={},Ic=function n(e,t,i,r,a,s,o,l,u,h,d,c,y,p,g){for(var f=e,E=g,_=0,S=!1;(E=E.get(mn))!==void 0&&!S;){var w=E.get(e);if(_+=1,typeof w!="undefined"){if(w===_)throw new RangeError("Cyclic object value");S=!0}typeof E.get(mn)=="undefined"&&(_=0)}if(typeof o=="function"?f=o(t,f):f instanceof Date?f=h(f):i==="comma"&&it(f)&&(f=pn.maybeMap(f,function(Ye){return Ye instanceof Date?h(Ye):Ye})),f===null){if(r)return s&&!y?s(t,te.encoder,p,"key",d):t;f=""}if(Oc(f)||pn.isBuffer(f)){if(s){var A=y?t:s(t,te.encoder,p,"key",d);if(i==="comma"&&y){for(var N=Fc.call(String(f),","),z="",b=0;b<N.length;++b)z+=(b===0?"":",")+c(s(N[b],te.encoder,p,"value",d));return[c(A)+"="+z]}return[c(A)+"="+c(s(f,te.encoder,p,"value",d))]}return[c(t)+"="+c(String(f))]}var I=[];if(typeof f=="undefined")return I;var v;if(i==="comma"&&it(f))v=[{value:f.length>0?f.join(",")||null:void 0}];else if(it(o))v=o;else{var C=Object.keys(f);v=l?C.sort(l):C}for(var P=0;P<v.length;++P){var D=v[P],ae=typeof D=="object"&&typeof D.value!="undefined"?D.value:f[D];if(!(a&&ae===null)){var Bt=it(f)?typeof i=="function"?i(t,D):t:t+(u?"."+D:"["+D+"]");g.set(e,_);var De=Xs();De.set(mn,g),js(I,n(ae,Bt,i,r,a,s,o,l,u,h,d,c,y,p,De))}}return I},Rc=function(e){if(!e)return te;if(e.encoder!==null&&typeof e.encoder!="undefined"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||te.charset;if(typeof e.charset!="undefined"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=kt.default;if(typeof e.format!="undefined"){if(!Pc.call(kt.formatters,e.format))throw new TypeError("Unknown format option provided.");i=e.format}var r=kt.formatters[i],a=te.filter;return(typeof e.filter=="function"||it(e.filter))&&(a=e.filter),{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:te.addQueryPrefix,allowDots:typeof e.allowDots=="undefined"?te.allowDots:!!e.allowDots,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:te.charsetSentinel,delimiter:typeof e.delimiter=="undefined"?te.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:te.encode,encoder:typeof e.encoder=="function"?e.encoder:te.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:te.encodeValuesOnly,filter:a,format:i,formatter:r,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:te.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:te.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:te.strictNullHandling}},Lc=function(n,e){var t=n,i=Rc(e),r,a;typeof i.filter=="function"?(a=i.filter,t=a("",t)):it(i.filter)&&(a=i.filter,r=a);var s=[];if(typeof t!="object"||t===null)return"";var o;e&&e.arrayFormat in Ys?o=e.arrayFormat:e&&"indices"in e?o=e.indices?"indices":"repeat":o="indices";var l=Ys[o];r||(r=Object.keys(t)),i.sort&&r.sort(i.sort);for(var u=Xs(),h=0;h<r.length;++h){var d=r[h];i.skipNulls&&t[d]===null||js(s,Ic(t[d],d,l,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,u))}var c=s.join(i.delimiter),y=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),c.length>0?y+c:""},gt=Ws,gn=Object.prototype.hasOwnProperty,Mc=Array.isArray,ee={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:gt.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Uc=function(n){return n.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},Qs=function(n,e){return n&&typeof n=="string"&&e.comma&&n.indexOf(",")>-1?n.split(","):n},kc="utf8=%26%2310003%3B",Nc="utf8=%E2%9C%93",Bc=function(e,t){var i={},r=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,a=t.parameterLimit===1/0?void 0:t.parameterLimit,s=r.split(t.delimiter,a),o=-1,l,u=t.charset;if(t.charsetSentinel)for(l=0;l<s.length;++l)s[l].indexOf("utf8=")===0&&(s[l]===Nc?u="utf-8":s[l]===kc&&(u="iso-8859-1"),o=l,l=s.length);for(l=0;l<s.length;++l)if(l!==o){var h=s[l],d=h.indexOf("]="),c=d===-1?h.indexOf("="):d+1,y,p;c===-1?(y=t.decoder(h,ee.decoder,u,"key"),p=t.strictNullHandling?null:""):(y=t.decoder(h.slice(0,c),ee.decoder,u,"key"),p=gt.maybeMap(Qs(h.slice(c+1),t),function(g){return t.decoder(g,ee.decoder,u,"value")})),p&&t.interpretNumericEntities&&u==="iso-8859-1"&&(p=Uc(p)),h.indexOf("[]=")>-1&&(p=Mc(p)?[p]:p),gn.call(i,y)?i[y]=gt.combine(i[y],p):i[y]=p}return i},$c=function(n,e,t,i){for(var r=i?e:Qs(e,t),a=n.length-1;a>=0;--a){var s,o=n[a];if(o==="[]"&&t.parseArrays)s=[].concat(r);else{s=t.plainObjects?Object.create(null):{};var l=o.charAt(0)==="["&&o.charAt(o.length-1)==="]"?o.slice(1,-1):o,u=parseInt(l,10);!t.parseArrays&&l===""?s={0:r}:!isNaN(u)&&o!==l&&String(u)===l&&u>=0&&t.parseArrays&&u<=t.arrayLimit?(s=[],s[u]=r):l!=="__proto__"&&(s[l]=r)}r=s}return r},Vc=function(e,t,i,r){if(!!e){var a=i.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,s=/(\[[^[\]]*])/,o=/(\[[^[\]]*])/g,l=i.depth>0&&s.exec(a),u=l?a.slice(0,l.index):a,h=[];if(u){if(!i.plainObjects&&gn.call(Object.prototype,u)&&!i.allowPrototypes)return;h.push(u)}for(var d=0;i.depth>0&&(l=o.exec(a))!==null&&d<i.depth;){if(d+=1,!i.plainObjects&&gn.call(Object.prototype,l[1].slice(1,-1))&&!i.allowPrototypes)return;h.push(l[1])}return l&&h.push("["+a.slice(l.index)+"]"),$c(h,t,i,r)}},Hc=function(e){if(!e)return ee;if(e.decoder!==null&&e.decoder!==void 0&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset!="undefined"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=typeof e.charset=="undefined"?ee.charset:e.charset;return{allowDots:typeof e.allowDots=="undefined"?ee.allowDots:!!e.allowDots,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:ee.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:ee.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:ee.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:ee.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:ee.comma,decoder:typeof e.decoder=="function"?e.decoder:ee.decoder,delimiter:typeof e.delimiter=="string"||gt.isRegExp(e.delimiter)?e.delimiter:ee.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:ee.depth,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:ee.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:ee.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:ee.plainObjects,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:ee.strictNullHandling}},zc=function(n,e){var t=Hc(e);if(n===""||n===null||typeof n=="undefined")return t.plainObjects?Object.create(null):{};for(var i=typeof n=="string"?Bc(n,t):n,r=t.plainObjects?Object.create(null):{},a=Object.keys(i),s=0;s<a.length;++s){var o=a[s],l=Vc(o,i[o],t,typeof n=="string");r=gt.merge(r,l,t)}return t.allowSparse===!0?r:gt.compact(r)},Gc=Lc,qc=zc,Wc=cn,yn={formats:Wc,parse:qc,stringify:Gc};class ki{constructor(e){m(this,"store");m(this,"xhr");m(this,"e");m(this,"onError");m(this,"onTimeout");m(this,"onLoad");m(this,"onLoadend");this.store=e,this.e={error:this._onError.bind(this),timeout:this._onTimeout.bind(this),load:this._onLoad.bind(this),loadend:this._onLoadend.bind(this)};let t=new XMLHttpRequest;we.browser!=="ie"&&(t.responseType="json",t.timeout=5e3),t.onerror=this.e.error,t.ontimeout=this.e.timeout,t.onload=this.e.load,t.onloadend=this.e.loadend,this.xhr=t}_onError(e){this.onError&&this.onError(e.target),this.onError=null}_onTimeout(e){this.onTimeout&&this.onTimeout(e.target),this.onTimeout=null}_onLoad(e){if(!e.target){this._onError(e);return}let t=e.target.response;if(we.browser==="ie"&&t&&typeof t=="string")try{t=JSON.parse(t)}catch{}let{code:i,data:r}=t;if(+i!=200){this._onError(e);return}this.onLoad&&this.onLoad(r),this.onLoad=null}_onLoadend(e){this.onLoadend&&this.onLoadend(e.target),this.onLoadend=null}fire(e,t={},i="POST"){if(!this.xhr)return;we.isIOS&&we.isUC&&(i="GET");let r=new FormData;if(this.store&&(r.set(ie.CLIENT,this.store.getKV(ie.CLIENT)),r.set(ie.APP_ID,this.store.getKV(ie.APP_ID)),r.set(ie.THIRD_PARTY_USER_ID,this.store.getKV(ie.THIRD_PARTY_USER_ID)),r.set(ie.ACCESS_TOKEN,this.store.getKV(ie.ACCESS_TOKEN)),r.set(ie.PACKAGE_CHECK,this.store.getKV(ie.PACKAGE_CHECK))),Object.keys(t).forEach(a=>{r.set(a,t[a])}),i==="POST")this.xhr.open(i,e),this.xhr.send(r);else if(i==="GET"){let a={};r.forEach((o,l)=>{a[l]=o});let s=yn.stringify(a);s&&(e+=`?${s}`),this.xhr.open(i,e),this.xhr.send()}}destroy(){!this.xhr||(this.xhr.onerror=null,this.xhr.onload=null,this.xhr.onloadend=null,this.xhr.ontimeout=null,this.xhr=null,this.onLoad=null,this.onLoadend=null,this.onTimeout=null,this.onError=null)}}class Xc{constructor(){m(this,"info");this.info={}}setKV(e,t){this.info[e]=t}getKV(e){return this.info[e]}deleteK(e){this.info.hasOwnProperty(e)&&delete this.info[e]}reset(){this.info={}}}class Yc{constructor(e){m(this,"store");m(this,"server");this.store=e,this.server=Zo.API_SERVER}init(){return new Promise((e,t)=>{const i=new ki(this.store);i.fire(this.server+Qi.INIT),i.onError=r=>t(r),i.onLoad=r=>e(r)})}initLive(e){return new Promise((t,i)=>{const r=new ki(this.store);r.fire(this.server+Qi.INIT_LIVE,{room_id:e}),r.onError=a=>i(a),r.onLoad=a=>t(a)})}initVod(e){return new Promise((t,i)=>{const r=new ki(this.store);r.fire(this.server+Qi.INIT_VOD,{record_id:e}),r.onError=a=>i(a),r.onLoad=a=>t(a)})}}function jc(n){let{appId:e,accountId:t,token:i,language:r="zh"}=n,a=new Xc;return a.setKV(ie.APP_ID,e),a.setKV(ie.THIRD_PARTY_USER_ID,t),a.setKV(ie.ACCESS_TOKEN,i),a.setKV(ie.PACKAGE_CHECK,"peter"),a.setKV(ie.CLIENT,"pc_browser"),a.setKV(ie.LANGUAGE,r),a}async function Mf(n){let e=jc(n),t=new Yc(e),i=await t.init(),r;return n.type==="live"?r=await t.initLive(n.liveOption.roomId):r=await t.initVod(n.vodOption.recordId),{initData:i,playerData:r}}var Uf="";const Ue=class extends Hn{constructor(e){super();m(this,"plugins",{});m(this,"options");m(this,"root");m(this,"video");m(this,"vPlayer");m(this,"playerType");m(this,"def");m(this,"intervalLoader");m(this,"isFullscreen",!1);m(this,"enterFullscreen",()=>Promise.resolve(void 0));m(this,"exitFullscreen",()=>Promise.resolve(void 0));m(this,"toggleFullscreen",()=>Promise.resolve(void 0));m(this,"switch",()=>{});m(this,"setQuality",()=>{});m(this,"addBarrage",()=>{});m(this,"clearBarrage",()=>{});m(this,"openBarrage",()=>{});m(this,"closeBarrage",()=>{});m(this,"capture",()=>{});m(this,"selectVtt",()=>{});m(this,"closeVtt",()=>{});m(this,"handleTimeShift",()=>{});m(this,"openUI",()=>{});m(this,"hideUI",()=>{});this.options=new Jo().merge(e),this.root=Fn("#"+e.videoNode),this.registerListeners(),this.createPlayer(),this.applyPlugins()}static use(e){const t=e.pluginName;return Ue.plugins.some(i=>i.ctor===e)?Ue:jo(t)?(x.warn(`VhPlayer use plugin error\uFF0Cplugin: ${e.name} - ${t} can not be used`),Ue):(Ue.plugins.push({name:t,ctor:e}),Ue)}registerListeners(){this.on(T.SCHEDULER_COMPLETE,t=>{x.info("VhPlayer PlayerEvents.SCHEDULER_COMPLETE",t),t.timeShift||this.load(t.url)}),this.on(T.DEFINITION_CHANGE,t=>{x.info("VhPlayer PlayerEvents.DEFINITION_CHANGE",t),this.load(t.url)}),this.on(T.LINE_CHANGE,t=>{x.info("VhPlayer PlayerEvents.LINE_CHANGE",t),t.isReload?this.reload():this.load(t.url)}),this.on(T.LINE_CHANGED,()=>{x.info("VhPlayer PlayerEvents.LINE_CHANGED"),this.intervalLoader&&this.intervalLoader.destroy()}),this.on(T.PULL_STREAM_FAILED,t=>{x.info("VhPlayer PlayerEvents.PULL_STREAM_FAILED",t)}),window.ResizeObserver||Yo(),new ResizeObserver(()=>{this.emit(T.UIResize)}).observe(this.root)}createPlayer(){switch(this.playerType=Es(this.options),this.playerType){case q.Flv:this.vPlayer=new fe(this.options,"flv",this);break;case q.Hls:ue.default.isSupported()?this.vPlayer=new er(this.options,this):this.vPlayer=new fe(this.options,"native",this);break;case q.Native:case q.HlsNative:this.vPlayer=new fe(this.options,"native",this);break;case q.Dash:this.vPlayer=new zn(this.options,this);break;default:throw Error("\u672A\u63D0\u4F9B\u652F\u6301\u7684\u64AD\u653E\u5668\u7C7B\u578B")}this.video=this.vPlayer.video}applyPlugins(){Ue.plugins.forEach(e=>{const t=e.ctor;typeof t=="function"&&(this.plugins[e.name]=new t(this))})}load(e){this.vPlayer.load(e)}reload(){this.vPlayer.reload()}async destroy(){x.warn("VhPlayer destroy\uFF0Cplugins\uFF1A",Object.values(this.plugins));for(let e of Object.values(this.plugins))e.destroy&&e.destroy();await this.vPlayer.destroy(),this.video.remove()}play(){return this.video.play()}pause(){this.video.pause()}get isPaused(){return this.video.paused}get autoplay(){return this.video.autoplay}set autoplay(e){this.video.autoplay=e}get buffered(){return this.video.buffered}get bufferedMax(){let e=this.video.buffered;return e.length?e.end(e.length-1):0}get cdnName(){var e,t;return((e=this.def)==null?void 0:e.currentQualityCdnName)||((t=this.def)==null?void 0:t.currentQualityLineName)}get quality(){var e;return(e=this.def)==null?void 0:e.currentQuality}get qualities(){var e;return(e=this.def)==null?void 0:e.qualities}get controls(){return this.video.controls}set controls(e){this.video.controls=e}get crossOrigin(){return this.video.crossOrigin}set crossOrigin(e){this.video.crossOrigin=e}get currentTime(){return this.video.currentTime}set currentTime(e){this.video.currentTime=e}get defaultMuted(){return this.video.defaultMuted}set defaultMuted(e){this.video.defaultMuted=e}get duration(){return this.video.duration}get isEnded(){return this.video.ended}getEstimateNetSpeed(){return+this.vPlayer.getBandwidthEstimate().toFixed(3)}get loop(){return this.video.loop}set loop(e){this.video.loop=e}get muted(){return this.video.muted}set muted(e){this.video.muted=e}get networkState(){return this.video.networkState}get playbackRate(){return this.video.playbackRate}set playbackRate(e){this.video.playbackRate=e}get played(){return this.video.played}get preload(){return this.video.preload}set preload(e){this.video.preload=e}get readyState(){return this.video.readyState}get seekable(){return this.video.seekable}get isSeeking(){return this.video.seeking}get volume(){return this.video.volume}set volume(e){this.video.volume=e}static probe(){const e=document.createElement("video"),t=window.MediaSource||window.WebKitMediaSource;function i(r){return t&&t.isTypeSupported?t.isTypeSupported(r):e.canPlayType(r)}return bt(ve({},we),{H264:e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),H265:e.canPlayType('video/mp4; codecs="hevc"'),WebM_VP8:e.canPlayType('video/webm; codecs="vp8, vorbis"'),WebM_VP9:e.canPlayType('video/webm; codecs="vp9"'),MSE_H264:i('video/mp4; codecs="avc1.4D401E"'),MSE_H265:i('video/mp4; codecs="hevc"'),MSE_WebM_VP8:i('video/webm; codecs="vp8, vorbis"'),MSE_WebM_VP9:i('video/webm; codecs="vp9"'),MSE_AV1:i('video/mp4; codecs="av01.0.05M.08"'),WebSocket:!!window.WebSocket})}static async createInstance(e,t,i){try{Zi(e.debug===void 0?!1:e.debug);let{scheduleOption:r}=e;if(Es(e)===q.Hls&&ue.default.isSupported()){let{peer5Option:o}=e,l=o!=null&&o.enable?o.customerId:"";if(l)try{await Dn("script-peer5",`https://api.peer5.com/peer5.js?id=${l}`),await Dn("script-peer5-hls","https://api.peer5.com/peer5.hlsjs.loader.js")}catch(u){x.error("VhPlayer.createInstance - peer5 sdk load error: "+u.message)}}let s=new Ue(e);return window.vp=s,t&&t(s),s}catch(r){x.warn("VhPlayer.createInstance error",r),i&&i({code:500,message:r.message})}}};let Ni=Ue;m(Ni,"plugins",[]),m(Ni,"Events",T);const oe=Ni;var Js={};/*! crc32.js (C) 2014-present SheetJS -- http://sheetjs.com */(function(n){(function(e){e(typeof DO_NOT_EXPORT_CRC=="undefined"?n:{})})(function(e){e.version="1.2.1";function t(){for(var b=0,I=new Array(256),v=0;v!=256;++v)b=v,b=b&1?-306674912^b>>>1:b>>>1,b=b&1?-306674912^b>>>1:b>>>1,b=b&1?-306674912^b>>>1:b>>>1,b=b&1?-306674912^b>>>1:b>>>1,b=b&1?-306674912^b>>>1:b>>>1,b=b&1?-306674912^b>>>1:b>>>1,b=b&1?-306674912^b>>>1:b>>>1,b=b&1?-306674912^b>>>1:b>>>1,I[v]=b;return typeof Int32Array!="undefined"?new Int32Array(I):I}var i=t();function r(b){var I=0,v=0,C=0,P=typeof Int32Array!="undefined"?new Int32Array(4096):new Array(4096);for(C=0;C!=256;++C)P[C]=b[C];for(C=0;C!=256;++C)for(v=b[C],I=256+C;I<4096;I+=256)v=P[I]=v>>>8^b[v&255];var D=[];for(C=1;C!=16;++C)D[C-1]=typeof Int32Array!="undefined"?P.subarray(C*256,C*256+256):P.slice(C*256,C*256+256);return D}var a=r(i),s=a[0],o=a[1],l=a[2],u=a[3],h=a[4],d=a[5],c=a[6],y=a[7],p=a[8],g=a[9],f=a[10],E=a[11],_=a[12],S=a[13],w=a[14];function A(b,I){for(var v=I^-1,C=0,P=b.length;C<P;)v=v>>>8^i[(v^b.charCodeAt(C++))&255];return~v}function N(b,I){for(var v=I^-1,C=b.length-15,P=0;P<C;)v=w[b[P++]^v&255]^S[b[P++]^v>>8&255]^_[b[P++]^v>>16&255]^E[b[P++]^v>>>24]^f[b[P++]]^g[b[P++]]^p[b[P++]]^y[b[P++]]^c[b[P++]]^d[b[P++]]^h[b[P++]]^u[b[P++]]^l[b[P++]]^o[b[P++]]^s[b[P++]]^i[b[P++]];for(C+=15;P<C;)v=v>>>8^i[(v^b[P++])&255];return~v}function z(b,I){for(var v=I^-1,C=0,P=b.length,D=0,ae=0;C<P;)D=b.charCodeAt(C++),D<128?v=v>>>8^i[(v^D)&255]:D<2048?(v=v>>>8^i[(v^(192|D>>6&31))&255],v=v>>>8^i[(v^(128|D&63))&255]):D>=55296&&D<57344?(D=(D&1023)+64,ae=b.charCodeAt(C++)&1023,v=v>>>8^i[(v^(240|D>>8&7))&255],v=v>>>8^i[(v^(128|D>>2&63))&255],v=v>>>8^i[(v^(128|ae>>6&15|(D&3)<<4))&255],v=v>>>8^i[(v^(128|ae&63))&255]):(v=v>>>8^i[(v^(224|D>>12&15))&255],v=v>>>8^i[(v^(128|D>>6&63))&255],v=v>>>8^i[(v^(128|D&63))&255]);return~v}e.table=i,e.bstr=A,e.buf=N,e.str=z})})(Js);class yt{constructor(e=1e3*60*60){m(this,"oldToken");m(this,"newToken");m(this,"expireThreshold");m(this,"expireTime");this.oldToken="",this.newToken="",this.expireThreshold=e,this.expireTime=0}create(e){this.oldToken=e;let t=e.split("_")[0],i=e.split("_")[1],r=t.split("").reverse().join(""),s=`${(Js.str(r)>>>0).toString(16).toUpperCase()}_${i}`;return this.newToken=s,this.expireTime=Date.now()+this.expireThreshold,s}get isExpired(){return Date.now()>this.expireTime}static refreshToken(e){if(!e.token||e.token.isExpired){let t=new yt;e.token=t,e.tokenStr=t.create(e.tokenStr)}}}function Kc(n,e){return e===q.Hls||e===q.HlsNative?{key:"hls_domainname",allQuality:n.hls_domainnames,tokenStr:n.token}:{key:"mp4_domainname",allQuality:n.mp4_domainnames,tokenStr:n.token}}function Qc(n,e,t){var i,r;return e===q.Flv?{key:"httpflv_url",allQuality:n.httpflv_urls,allQualitySubtitles:n.httpflv_subtitle_urls,tokenStr:n.token}:e===q.Hls||e===q.HlsNative?t?{key:"hls_url",allQuality:(i=n.timeshift)==null?void 0:i.hls_urls,allQualitySubtitles:(r=n.timeshift_subtitle)==null?void 0:r.hls_urls,tokenStr:n.token}:{key:"hls_url",allQuality:n.hls_urls,allQualitySubtitles:n.hls_subtitle_urls,tokenStr:n.token}:{key:"rtmp_url",allQuality:n.rtmp_urls,allQualitySubtitles:n.rtmp_subtitle_urls,tokenStr:n.token}}function Jc(n,e){let{debugCDN:t}=e;return t&&n.find(i=>i.cdn_name===t)||n[0]}function Zc(n,e,t){var f,E;let{scheduleOption:i}=e,r=e.type==="live",{live_type:a,live_subtitle:s}=i.playerData,o=r?((f=e.liveOption)==null?void 0:f.defaultDefinition)||ke.PSame:((E=e.vodOption)==null?void 0:E.defaultDefinition)||ke.PSame,l=a===1,u=s===1,h=r?Qc(n,t,l):Kc(n,t),d=u?h.allQualitySubtitles:h.allQuality,c=Object.keys(d);if(!c.length)throw Error("\u65E0\u53EF\u7528\u6E05\u6670\u5EA6");c.includes(o)||(o=c[0]);let y=d[o],p=Jc(y,i),g=y.map(_=>_.cdn_name||_.line);return{allQuality:h.allQuality,allQualitySubtitles:h.allQualitySubtitles,qualities:c,lines:g,currentQuality:o,currentQualityUrl:p[h.key],currentQualityCdnName:p.cdn_name,currentQualityLineName:p.line,currentQualityLines:y,key:h.key,tokenStr:h.tokenStr}}class Zs{constructor(e){m(this,"player");m(this,"def");this.player=e}fetch(){let e=this.buildURL();const t=new ki;t.fire(e,{},"GET"),t.onError=i=>x.error("Schedule fetch error",i),t.onLoad=i=>this.resolveData(i)}buildURL(){return""}getRandom(){return(Math.random()*899999999>>0)+1e8}resolveData(e){let{options:t,playerType:i}=this.player;if(this.def=Zc(e,t,i),x.info("Schedule get def",this.def),t.type==="live"){let r=new yt;this.def.token=r,this.def.tokenStr=r.create(this.def.tokenStr)}this.player.def=this.def,this.player.emit(T.SCHEDULER_COMPLETE,{url:this.def.currentQualityUrl+"?token="+this.def.tokenStr,timeShift:t.type==="live"&&t.scheduleOption.playerData.live_type===1})}}class ef extends Zs{constructor(e){super(e);this.fetch()}buildURL(){let{scheduleOption:e,vodOption:t}=this.player.options,{dispatch_server:i,default_server:r,safe_server:a,log_info:s}=e.playerData;const o=Ko(r.uri)==="m3u8",l=we.browser==="ie",u=we.supportMSE&&!(we.os==="android"&&we.browser==="qqbrowser"),h=!!((a==null?void 0:a.uri)&&o&&!l&&u);let d={};d.webinar_id=t.recordId,d.rand=this.getRandom(),d.uid=s.uid,d.uri=this.getUri(h),d.bu=1;let c=this.getQuality(h);d.quality=c.length===0?'["same"]':`["${c.join('","')}"]`;let y=yn.stringify(d);return`${i}/api/dispatch_replay?${y}`}getUri(e){let{playerType:t}=this.player,{scheduleOption:i}=this.player.options,{dispatch_server:r,default_server:a,safe_server:s}=i.playerData,o=r+a.uri,l=e?r+s.uri:o,u=document.createElement("a");return u.href=t==="hls"?l:o,u.pathname}getQuality(e){let{scheduleOption:t}=this.player.options,{safe_definition:i,definition:r}=t.playerData;return(e?i:r)||["same"]}}class tf extends Zs{constructor(e){super(e);this.fetch()}buildURL(){let{scheduleOption:e,liveOption:t}=this.player.options,{dispatch_server:i,log_info:r,app_type:a,live_subtitle:s,live_delay:o}=e.playerData,l={};l.webinar_id=t.roomId,l.uid=r.uid,l.bu=1,l.rand=this.getRandom(),l.app_type=a,l.is_subtitle=s,l.is_delay_stream=o;let u=yn.stringify(l);return`${i}/api/dispatch_play?${u}`}}class eo{constructor(e){this.player=e;let{scheduleOption:t}=this.player.options;!t.enable||this.init()}init(){this.player.options.type==="live"?new tf(this.player):new ef(this.player),this.player.setQuality=this.setQuality.bind(this)}setQuality(e){let{def:t}=this.player;if(!t.qualities){x.warn("Scheduler setQuality - \u6CA1\u6709\u83B7\u53D6\u5230\u53EF\u7528\u6E05\u6670\u5EA6");return}if(!t.qualities.includes(e)){x.warn(`Scheduler setQuality - \u6E05\u6670\u5EA6\u53C2\u6570\u4E0D\u53EF\u7528-${e}\uFF1B\u53EF\u8BBE\u7F6E\u6E05\u6670\u5EA6\uFF1A${t.qualities.join()}`);return}t.currentQuality=e,t.currentQualityLines=t.allQuality[e];let i=t.currentQualityLines.find(r=>r.line===t.currentQualityLineName);t.currentQualityUrl=i[t.key],yt.refreshToken(t),this.player.emit(T.DEFINITION_CHANGE,{url:t.currentQualityUrl+"?token="+t.tokenStr,quality:e})}destroy(){}}m(eo,"pluginName","schedule");const to=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],rt=(()=>{let n={};for(let e of to)if(e[1]in document){let t=0,i=e.length;for(;t<i;t++)n[to[0][t]]=e[t];return n}return n})(),Pe={eventNameMap:{change:rt.fullscreenchange,error:rt.fullscreenerror},async request(n,e={navigationUI:"auto"}){if(n=n||document.documentElement,this.isEnabled)return await n[rt.requestFullscreen](e)},async exit(){return await document[rt.exitFullscreen]()},async toggle(n,e={navigationUI:"auto"}){return this.isFullscreen?await this.exit():await this.request(n,e)},onchange(n){this.on("change",n)},onerror(n){this.on("error",n)},on(n,e){this.eventNameMap[n]&&document.addEventListener(this.eventNameMap[n],e,!1)},off(n,e){this.eventNameMap[n]&&document.removeEventListener(this.eventNameMap[n],e,!1)},get isFullscreen(){return Boolean(document[rt.fullscreenElement])},get element(){return document[rt.fullscreenElement]},get isEnabled(){return Boolean(document[rt.fullscreenEnabled])}},Xe={async request(n){if(this.isEnabled(n))return await n.webkitEnterFullscreen()},async exit(n){return await n.webkitExitFullscreen()},async toggle(n){return this.isFullscreen?await this.exit(n):await this.request(n)},get isFullscreen(){return document.fullScreen||document.webkitIsFullScreen||!1},isEnabled(n){return!!n.webkitEnterFullscreen}};class io{constructor(e){m(this,"fsChangeHandler");this.player=e,this.fsChangeHandler=()=>{this.player.emit(T.FULLSCREEN_CHANGED,Pe.element!==null)},this.init()}init(){Pe.isEnabled?(this.player.enterFullscreen=Pe.request.bind(Pe,this.player.root),this.player.exitFullscreen=Pe.exit,this.defineProperty(Pe),this.player.toggleFullscreen=Pe.toggle.bind(Pe,this.player.root)):Xe.isEnabled(this.player.video)&&(this.player.enterFullscreen=Xe.request.bind(Xe,this.player.video),this.player.exitFullscreen=Xe.exit.bind(Xe,this.player.video),this.defineProperty(Xe),this.player.toggleFullscreen=Xe.toggle.bind(Xe,this.player.video)),Pe.on("change",this.fsChangeHandler)}defineProperty(e){Object.defineProperty(this.player,"isFullscreen",{get(){return e.isFullscreen}})}destroy(){Pe.off("change",this.fsChangeHandler)}}m(io,"pluginName","fullscreen");class ro{constructor(e){m(this,"lagTimes",0);this.player=e,this.init()}init(){let{switchOption:e,type:t}=this.player.options;if(!e.enable){x.warn("Switcher \u672A\u5F00\u542F\u5207\u7EBF\u529F\u80FD");return}if(this.player.switch=this.switch.bind(this),t==="vod"){x.warn("Switcher \u70B9\u64AD\u4E0D\u8FD0\u884C\u5361\u987F\u5207\u7EBF");return}this.registerListeners()}registerListeners(){this.player.on(T.LAG_REPORT,this.lag,this),this.player.on(T.LAG_RECOVER,this.lagRecover,this)}lag(e){x.warn("Switcher LAG_REPORT",e),this.lagTimes+=1,this.lagTimes>=3&&(x.info("Switcher \u5F00\u59CB\u5361\u987F\u5207\u7EBF"),this.lagTimes=0,this.switch())}lagRecover(e){x.info("Switcher LAG_RECOVER",e),this.lagTimes=0}switch(e){let{def:t}=this.player,i=t.currentQualityCdnName||t.currentQualityLineName;if(e&&e===i){x.warn("Switcher switch - \u5207\u7EBF\u88AB\u5FFD\u7565, \u5207\u6362\u5230\u4E86\u76F8\u540C\u7EBF\u8DEF");return}let r=e?this.findLine(t.currentQualityLines,e):this.getNextLine(t.currentQualityLines,i);if(!r){x.warn("Switcher switch - \u5207\u7EBF\u88AB\u5FFD\u7565, \u7EBF\u8DEF\u672A\u627E\u5230");return}t.currentQualityUrl=r[t.key],t.currentQualityCdnName=r.cdn_name,t.currentQualityLineName=r.line,yt.refreshToken(t),this.player.emit(T.LINE_CHANGE,{url:t.currentQualityUrl+"?token="+t.tokenStr,line:r.cdn_name||r.line,isReload:(r.cdn_name||r.line)===i})}openLiveSubtitle(){}closeLiveSubtitle(){}getNextLine(e,t){let r=e.findIndex(a=>a.line===t)+1;return r>=e.length&&(r=0),e[r]}findLine(e,t){return e.find(i=>(i.cdn_name||i.line)===t)}destroy(){this.player.off(T.LAG_REPORT),this.player.off(T.LAG_RECOVER)}}m(ro,"pluginName","switcher");class no{constructor(e){m(this,"pursueConfig");m(this,"isPursuing",!1);m(this,"_onTimeupdate");this.player=e,this.init()}init(){let{scheduleOption:e,pursueOption:t,type:i}=this.player.options;if(!t.enable){x.warn("Pursue - \u672A\u5F00\u542F\u8FFD\u64AD\u529F\u80FD");return}if(i==="vod"){x.warn("Pursue - \u70B9\u64AD\u4E0D\u8FD0\u884C\u8FFD\u64AD\u7B56\u7565");return}let{playerType:r}=this.player;if(+e.playerData.live_type==1&&r===q.Hls){x.warn("Pursue - \u65F6\u79FB\u76F4\u64AD\u4E0D\u8FD0\u884C\u8FFD\u64AD\u7B56\u7565");return}if(r===q.Flash){x.warn("Pursue - flash\u4E0D\u8FD0\u884C\u8FFD\u64AD\u7B56\u7565");return}if(r===q.HlsNative){x.warn("Pursue - \u64AD\u653E\u539F\u751Fm3u8\u65F6\uFF0C\u4E0D\u8FD0\u884C\u8FFD\u64AD\u7B56\u7565");return}this.pursueConfig=t[r],x.info("Pursue \u5F00\u542F\u8FFD\u64AD\u7B56\u7565",this.pursueConfig),this.registerListeners()}registerListeners(){this._onTimeupdate=Ki(this.onTimeupdate.bind(this),1e3),this.player.video.addEventListener("timeupdate",this._onTimeupdate)}unRegisterListeners(){this.player.video.removeEventListener("timeupdate",this._onTimeupdate)}onTimeupdate(){let e=this.player.bufferedMax,t=e-this.player.currentTime,{bufferPursue:i,bufferSeek:r,bufferStop:a,pursueSpeed:s,mode:o}=this.pursueConfig;if(t>i||this.isPursuing&&t>a)switch(o){case"pursue":t>r?this.jumpTo(e-a):this.run(s);break;case"seek":this.jumpTo(e-a);break;default:x.warn(`Pursue \u8FFD\u64AD\u7C7B\u578B\u914D\u7F6E\u9519\u8BEF\uFF0C\u53EA\u652F\u6301 pursue\u3001seek\uFF0C\u914D\u7F6E\u4E3A ${o}`);break}else this.walk()}jumpTo(e){e<=0||(x.info("Pursue jumpTo",e),this.player.currentTime=e,this.player.playbackRate=1,this.isPursuing=!1)}run(e){this.isPursuing||e<1||(x.info("Pursue run speed",e),this.player.playbackRate=e,this.isPursuing=!0)}walk(){this.player.playbackRate=1,this.isPursuing=!1}destroy(){this.unRegisterListeners()}}m(no,"pluginName","pursue");class ao{constructor(e){m(this,"pauseTime",0);m(this,"firstTime",0);this.player=e,this.init()}init(){let{type:e}=this.player.options;if(e==="vod"){x.warn("Replay - \u70B9\u64AD\u4E0D\u8FD0\u884C\u6682\u505C\u6062\u590D\u903B\u8F91");return}this.registerListeners()}registerListeners(){this.player.on(T.Play,this.onPlay,this),this.player.on(T.Pause,this.onPause,this),this.player.on(T.Loaded,this.onLoaded,this),this.player.on(T.LINE_CHANGE,this.onLineChange,this)}onLineChange(){this.pauseTime=0,this.firstTime=0}onPlay(){this.pauseTime?this.handleReplay((performance.now()-this.pauseTime)/1e3):this.onFirstPlay()}handleReplay(e){x.info("Replay \u6682\u505C\u65F6\u957F",e);let t=this.player.bufferedMax,{scheduleOption:i,liveOption:r}=this.player.options,a=+i.playerData.live_type==1;if(r.type===q.Hls&&a&&this.player.cdnName===Ne.TX)isFinite(t)&&t>=this.player.currentTime+e?x.info("Replay - \u65F6\u79FB\u76F4\u64AD\u6682\u505C\u6062\u590D(\u77ED\u6682\u505C)\uFF0C\u4ECE\u6682\u505C\u5904\u63A5\u7740\u64AD\u653E"):x.info("Replay - \u65F6\u79FB\u76F4\u64AD\u6682\u505C\u6062\u590D(\u957F\u6682\u505C)\uFF0C\u5B9A\u4F4D\u5230\u6700\u65B0\u8FDB\u5EA6");else{if(r.type===q.Flash){this.player.reload();return}x.info("Replay - \u76F4\u64AD\u6682\u505C\u6062\u590D\uFF0C\u8DF3\u5230\u6700\u65B0"),this.player.currentTime=this.player.currentTime+e}}onFirstPlay(){if(x.info("Replay - \u76F4\u64AD\u5F00\u59CB\u65F6\uFF0C\u5B9A\u4F4D\u5230\u6700\u65B0\u8FDB\u5EA6"),this.firstTime)this.handleReplay((performance.now()-this.firstTime)/1e3);else{let{pursueOption:e}=this.player.options,t=e[this.player.playerType],i=this.player.bufferedMax-t.bufferStop;i>0&&(this.player.currentTime=this.player.currentTime+i)}}onLoaded(){this.player.playerType===q.Hls&&(this.firstTime=performance.now())}onPause(){this.pauseTime=performance.now()}destroy(){}}m(ao,"pluginName","replay");class so{constructor(e){m(this,"lastCurrentTime",0);m(this,"lagTimes",0);m(this,"lagBeginTime",0);m(this,"detectInterval",0);m(this,"gapDetectTime",500);m(this,"gapEmitTime",3e3);m(this,"gapEmitLagTimes");this.player=e,this.init(),this.gapEmitLagTimes=this.gapEmitTime/this.gapDetectTime}init(){this.registerListeners()}registerListeners(){this.player.on(T.Play,this.startDetect,this),this.player.on(T.Pause,this.stopDetect,this),this.player.on(T.Ended,this.stopDetect,this),this.player.on(T.Error,this.onError,this),this.player.on(T.Stalled,this.onError,this),this.player.on(T.LINE_CHANGE,this.stopDetect,this),this.player.on(T.PULL_STREAM_FAILED,this.stopDetect,this)}onError(e){e&&e.target&&e.type==="stalled"||this.startDetect()}startDetect(){this.detectInterval||(x.info("Lag - \u5F00\u59CB\u5361\u987F\u68C0\u6D4B..."),this.detectInterval=window.setInterval(()=>{this.checkLag(this.player.currentTime),this.lagTimes&&this.lagTimes%this.gapEmitLagTimes===0?this.player.emit(T.LAG_REPORT,{times:this.lagTimes,beginTime:this.lagBeginTime}):!this.lagTimes&&this.lagBeginTime&&(this.player.emit(T.LAG_RECOVER,{lastTime:Date.now()-this.lagBeginTime}),this.lagBeginTime=0)},this.gapDetectTime))}stopDetect(){x.info("Lag - \u505C\u6B62\u5361\u987F\u68C0\u6D4B"),clearInterval(this.detectInterval),this.detectInterval=0,this.lagTimes=0,this.lagBeginTime=0,this.lastCurrentTime=0}checkLag(e){this.lastCurrentTime===e?(this.lagTimes+=1,this.lagBeginTime||(this.lagBeginTime=Date.now()-this.gapDetectTime)):(this.lastCurrentTime=e,this.lagTimes=0)}destroy(){clearInterval(this.detectInterval),this.detectInterval=0,this.lagTimes=0,this.lagBeginTime=0,this.lastCurrentTime=0}}m(so,"pluginName","lag");class Fe{static create(){return Fe.S4()+Fe.S4()+"-"+Fe.S4()+"-"+Fe.S4()+"-"+Fe.S4()+"-"+Fe.S4()+Fe.S4()+Fe.S4()}static S4(){return((1+Math.random())*65536|0).toString(16).substring(1)}}var kf="";class oo{constructor(e){m(this,"cssTransition");m(this,"elRoot");m(this,"elBarrageRoot");m(this,"rootWidth",0);m(this,"rootHeight",0);m(this,"tracksSize",30);m(this,"renderTopPosition",0);m(this,"renderBottomPosition",0);m(this,"tracker",[]);m(this,"renderQueue",[]);m(this,"renderTimer",0);m(this,"renderSuccessCount",0);m(this,"renderAborted",!1);m(this,"renderDelay",150);m(this,"opened",!0);this.player=e,this.init()}init(){var r;let{videoNode:e,barrageOption:t}=this.player.options;if(!t.enable){x.warn("Barrage - \u672A\u5F00\u542F\u5F39\u5E55\u529F\u80FD");return}this.opened=(r=t.defaultOpen)!=null?r:!0;let i=Cn();if(i===!1){x.warn("Barrage - not support css3 transition");return}this.cssTransition=i,this.elRoot=k("#"+e),this.elBarrageRoot=j("div",{},{class:"barrage-root"}),this.elRoot.appendChild(this.elBarrageRoot),this.registerListeners(),this.player.addBarrage=this.addBarrage.bind(this),this.player.clearBarrage=this.clearBarrage.bind(this),this.player.openBarrage=this.open.bind(this),this.player.closeBarrage=this.close.bind(this)}registerListeners(){this.player.on(T.Ended,this.clearBarrage,this),this.player.on(T.UIResize,this.resize,this),Rn(null,()=>{this.clearBarrage()})}open(){this.opened=!0,this.player.emit(T.OPEN_BARRAGE)}close(){this.opened=!1,this.player.emit(T.CLOSE_BARRAGE),this.clearBarrage()}addBarrage(e,t={}){if(!this.opened){x.warn("Barrage addBarrage - \u6DFB\u52A0\u5F39\u5E55\u5931\u8D25\uFF0C\u5F39\u5E55\u672A\u5F00\u542F");return}if(!this.tracker.length){x.warn("Barrage addBarrage - \u6DFB\u52A0\u5F39\u5E55\u5931\u8D25\uFF0C\u8F68\u9053\u6570\u91CF\u4E3A0");return}this.renderQueue.push({id:Fe.create(),msg:this.filterContent(e),style:ve(ve({},this.player.options.barrageOption.style),t),width:0,totalDistance:0,rollSpeed:this.player.options.barrageOption.speed,rollTime:0,useTracks:0,tracks:[]}),this.renderTimer||this.render()}render(){try{this.renderToDom()}finally{this.renderEnd()}}renderToDom(){if(this.renderQueue.length){const e=this.renderQueue[0];let t=e.node;if(!t){e.node=t=j("div",{},{class:"barrage-item"}),t.innerHTML=e.msg;for(let i of Object.keys(e.style))t.style[i]=e.style[i]}if(this.elBarrageRoot.appendChild(t),e.useTracks=Math.ceil(t.offsetHeight/this.tracksSize),e.useTracks>this.tracker.length){x.warn("Barrage renderToDom - \u5F39\u5E55\u5360\u7528\u9AD8\u5EA6\u8FC7\u9AD8\uFF0C\u4E22\u5F03"),this.renderQueue.shift(),this.elBarrageRoot.removeChild(t);return}e.width=t.offsetWidth,e.totalDistance=t.offsetWidth+this.rootWidth,e.rollTime=e.totalDistance/e.rollSpeed,this.addToTracks(e),e.tracks.length?(this.renderSuccessCount++,this.renderAborted=!1,this.renderQueue.shift(),t.setAttribute("data-y",e.tracks[0]+""),t.setAttribute("data-id",e.id),t.style.top=`${e.tracks[0]*this.tracksSize+this.renderTopPosition}px`,t.style[this.cssTransition.css]=`transform ${e.rollTime}s linear`,t.style.transform=`translate3d(-${e.totalDistance}px, 0, 0)`,t.addEventListener(this.cssTransition.event,()=>{this.removeFromTracker(e.tracks,e.id),this.elBarrageRoot.removeChild(t)},!1)):(this.renderAborted=!0,this.elBarrageRoot.removeChild(t))}}renderEnd(){this.renderQueue.length?(this.adaptRenderDelay(),this.renderTimer=window.setTimeout(()=>{this.render()},this.renderDelay)):this.renderTimer=0}adaptRenderDelay(){this.renderAborted?(this.renderDelay+=40,this.renderSuccessCount=0):this.renderSuccessCount>10&&(this.renderDelay-=50,this.renderSuccessCount=0)}addToTracks(e){let t,i,r=[];for(let a=0;a<this.tracker.length;a++)if(t=this.tracker[a],t.length?(i=t[t.length-1],-In(i.node)>i.width?r.push(a):r=[]):r.push(a),r.length>=e.useTracks){e.tracks=r,r.forEach(s=>{this.tracker[s].push(e)});break}}removeFromTracker(e,t){for(let i of e){const r=this.tracker[i];if(!r)continue;let a=0,s=r.length;for(;a<s;a++)if(r[a].id===t){r.splice(a,1);break}}}filterContent(e){return e&&e.replace(/<(?!img).*?>/gi,"")}clearBarrage(){this.eachNode(e=>{e.remove()}),this.tracker.forEach(e=>[]),this.renderQueue=[],this.player.emit(T.CLEAR_BARRAGE)}computedTracks(){let{positionRange:e}=this.player.options.barrageOption;this.player.isFullscreen?(this.renderTopPosition=window.innerHeight*e[0],this.renderBottomPosition=window.innerHeight*e[1]):(this.renderTopPosition=this.rootHeight*e[0],this.renderBottomPosition=this.rootHeight*e[1]);let t=this.renderBottomPosition-this.renderTopPosition;const i=Math.floor(t/this.tracksSize);this.tracker=new Array(i);for(let r=0;r<i;r++)this.tracker[r]=[];x.info("Barrage computedTracks",i)}resize(){x.info("Barrage resize"),this.rootWidth=this.elRoot.clientWidth,this.rootHeight=this.elRoot.clientHeight,this.clearBarrage(),this.computedTracks()}eachNode(e){let t=this.elBarrageRoot.firstChild,i,r;for(;t;)t.nodeType===1&&(r=t.getAttribute("data-y"),i=t.getAttribute("data-id"),r&&i&&e(t,+r,i)),t=t.nextSibling}destroy(){var e;this.clearBarrage(),(e=this.elBarrageRoot)==null||e.remove()}}m(oo,"pluginName","barrage");var Nf="";class lo{constructor(e){m(this,"cssTransition");m(this,"elRoot");m(this,"elMarqueeRoot");m(this,"timer",0);m(this,"createMarqueeItem",e=>{if(e===1){const g=this.elMarqueeRoot.querySelector(".marquee");g&&g.remove()}else if(!this.checkPosition())return!1;let{text:t,position:i=1,duration:r=6,alpha:a,fontSize:s,fontColor:o,height:l}=this.player.options.marqueeOption;if(!t){x.warn("Marquee - \u672A\u63D0\u4F9B\u914D\u7F6E\uFF1Atext");return}let u=j("div",{innerHTML:t},{class:"marquee",style:(a?`opacity: ${a/100};`:"")+(s?`font-size: ${s}px;`:"")+(o?`color: ${o};`:"")+(l?`line-height: ${l}px;`:"")});this.elMarqueeRoot.appendChild(u);const h=this.elMarqueeRoot.offsetWidth,d=this.elMarqueeRoot.offsetHeight,c=u.offsetWidth,y=u.offsetHeight,p={1:1,2:"20%",3:"50%",4:"80%"};switch(i){case 1:if(e===0){const g=d*.2,f=Math.floor(d*.6/y);let E=[g];for(let S=1;S<=f;S+=1)E.push(E[S-1]+y);let _=Math.floor(Math.random()*E.length);u.style.top=`${E[_]}px`}else d*.2>=y/2?(u.style.top=Math.random()*60+20+"%",u.style.transform="translateY(-50%)"):u.style.top=Math.random()*(d-y)+"px";break;case 2:d*.2>=y/2?(u.style.top=p[i],u.style.transform="translateY(-50%)"):u.style.top="0%";break;case 3:u.style.top=p[i],u.style.transform="translateY(-50%)";break;case 4:d*.2>=y/2?(u.style.top=p[i],u.style.transform="translateY(-50%)"):u.style.bottom="0%";break}if(e===0)u.style.left="100%",u.style[this.cssTransition.css]=`transform ${r}s linear`,this._stepMoveCss3({label:u,textWidth:c,rootWidth:h});else{const g=h&&c&&(h-c)/h*100,f=g&&Math.random()*g;u.style.left=`${f}%`}});this.player=e,this.init()}init(){let{videoNode:e,marqueeOption:t}=this.player.options;if(!t.enable){x.warn("Marquee - \u672A\u5F00\u542F\u8DD1\u9A6C\u706F\u529F\u80FD");return}let i=Cn();if(i===!1){x.warn("Marquee - not support css3 transition");return}this.cssTransition=i,this.elRoot=k("#"+e),this.elMarqueeRoot=j("div",{},{class:"marquee-root"}),this.elRoot.appendChild(this.elMarqueeRoot),this.registerListeners(),this.createMarquee()}registerListeners(){Rn(()=>{this.timer||this.createMarquee()},()=>{this.destroy()})}createMarquee(){let{type:e=0,interval:t=5}=this.player.options.marqueeOption;this.timer=window.setInterval(this.createMarqueeItem,t*1e3,e),this.createMarqueeItem(e)}_stepMoveCss3(e){e.label.addEventListener(this.cssTransition.event,()=>{e.label.remove()}),e.label.style.transform=`translate(-${e.textWidth+e.rootWidth}px, -50%)`}checkPosition(){const e=this.elMarqueeRoot.querySelectorAll(".marquee");for(let t=0;t<e.length;t+=1)if(In(e[t])===0)return!1;return!0}destroy(){var r;clearInterval(this.timer),this.timer=0;const e=this.elMarqueeRoot.querySelectorAll(".marquee");let t=0,i=e.length;for(;t<i;t++)e[t].remove();(r=this.elMarqueeRoot)==null||r.remove()}}m(lo,"pluginName","marquee");class uo{constructor(e){m(this,"elCanvas");this.player=e,this.init()}init(){this.player.capture=this.capture.bind(this)}capture(){this.elCanvas||(this.elCanvas=document.createElement("canvas"));let e=this.player.video;this.elCanvas.width=e.videoWidth,this.elCanvas.height=e.videoHeight;let t=this.elCanvas.getContext("2d");return t==null||t.drawImage(e,0,0),this.elCanvas.toDataURL("image/jpeg")}destroy(){}}m(uo,"pluginName","capture");class Me{constructor(e,t){m(this,"elRoot");m(this,"elMedia");m(this,"vhPlayer");this.elRoot=e,this.vhPlayer=t,this.elMedia=t.video}}class rf extends Me{constructor(e,t){super(e,t);m(this,"elBarRoot");m(this,"elBarCurrent");m(this,"elBarBuffered");m(this,"elPos");m(this,"_onTimeupdate");m(this,"_onProgress");m(this,"width",0);m(this,"cacheLayerX",0);m(this,"cacheX",-1);m(this,"cachePercent",-1);m(this,"isSeeking",!1);m(this,"onMouseDown",(e,t)=>{this.isSeeking=!0,this.cacheX=e.clientX;let i=e.clientX-t;e.target===this.elPos&&(i=e.clientX-t/2),this.cacheLayerX=e.target===this.elPos?i-8:i,this.percentMove(this.cacheLayerX/this.width*100)});m(this,"onMouseMove",e=>{this.cacheX!==-1&&this.percentMove((this.cacheLayerX+e.clientX-this.cacheX)/this.width*100)});m(this,"mouseUp",e=>{this.cacheX!==-1&&(this.isSeeking=!1,this.elMedia.currentTime=(this.cacheLayerX+e.clientX-this.cacheX)/this.width*this.elMedia.duration,this.cacheX=-1)});m(this,"onEnded",()=>{this.isSeeking||(this.elBarCurrent.style.transform="translateX(0%)",this.elBarBuffered.style.transform="translateX(0%)",this.elPos.style.transform=`translate(${this.width}px, -50%)`)});this.init(),this.registerListeners()}init(){this.elBarRoot=j("div",{},{class:"bar-root"}),this.elBarRoot.innerHTML=`
<div class="bar bar-current"></div>
<div class="bar bar-buffered"></div>
<div class="pos"></div>
`,this.elRoot.appendChild(this.elBarRoot),this.elBarCurrent=this.elBarRoot.querySelector(".bar-current"),this.elBarBuffered=this.elBarRoot.querySelector(".bar-buffered"),this.elPos=this.elBarRoot.querySelector(".pos"),setTimeout(()=>{this.width=this.elBarRoot.clientWidth},100)}registerListeners(){Gi(this.elBarRoot,"down",this.onMouseDown),Gi(this.elRoot,"move",this.onMouseMove),Gi(this.elBarRoot,"up",this.mouseUp),this.elRoot.addEventListener("mouseleave",this.mouseUp),this._onTimeupdate=Ki(this.onTimeupdate.bind(this),500),this._onProgress=Ki(this.onProgress.bind(this),500),this.elMedia.addEventListener("timeupdate",this._onTimeupdate),this.elMedia.addEventListener("progress",this._onProgress),this.elMedia.addEventListener("ended",this.onEnded),this.vhPlayer.on(T.UIResize,this.onResize,this)}onResize(){this.width=this.elBarRoot.clientWidth,this.cachePercent!==-1&&this.percentMove(this.cachePercent)}onTimeupdate(){this.isSeeking||this.percentMove(this.elMedia.currentTime/this.elMedia.duration*100)}onProgress(){let e=qt(this.elMedia)/this.elMedia.duration*100;this.elBarBuffered.style.transform=`translateX(${-100+e}%)`}percentMove(e){e>100||e<0||(this.cachePercent=e,this.elBarCurrent.style.transform=`translateX(${-100+e}%)`,this.elPos.style.transform=`translate(${e*this.width/100}px, -50%)`)}unRegisterListeners(){this.elMedia.removeEventListener("timeupdate",this._onTimeupdate),this.elMedia.removeEventListener("progress",this._onProgress),this.elMedia.removeEventListener("ended",this.onEnded)}destroy(){this.unRegisterListeners()}}class nf extends Me{constructor(e,t){super(e,t);m(this,"elTsBarRoot");m(this,"elBarCurrent");m(this,"elPos");m(this,"width",0);m(this,"cacheLayerX",0);m(this,"cacheX",-1);m(this,"cachePercent",-1);m(this,"timeShiftMax",7200);m(this,"timeShiftDuration",7200-90);m(this,"onMouseDown",e=>{this.cacheX=e.clientX,this.cacheLayerX=e.target===this.elPos?e.layerX-8:e.layerX,this.percentMove(this.cacheLayerX/this.width*100)});m(this,"onMouseMove",e=>{this.cacheX!==-1&&this.percentMove((this.cacheLayerX+e.clientX-this.cacheX)/this.width*100)});m(this,"mouseUp",e=>{if(this.cacheX===-1)return;let t=(this.cacheLayerX+e.clientX-this.cacheX)/this.width*this.timeShiftDuration;t=this.timeShiftDuration-t+90,t=t>this.timeShiftMax?this.timeShiftMax:t,this.vhPlayer.handleTimeShift(t),this.cacheX=-1});this.init(),this.registerListeners()}init(){this.elTsBarRoot=j("div",{},{class:"bar-root"}),this.elTsBarRoot.innerHTML=`
<div class="bar bar-current"></div>
<div class="pos hide"></div>
`,this.elRoot.appendChild(this.elTsBarRoot),this.elBarCurrent=this.elTsBarRoot.querySelector(".bar-current"),this.elPos=this.elTsBarRoot.querySelector(".pos"),setTimeout(()=>{this.width=this.elTsBarRoot.clientWidth,this.percentMove(100),this.elPos.classList.remove("hide")},100)}registerListeners(){this.elTsBarRoot.addEventListener("mousedown",this.onMouseDown),this.elRoot.addEventListener("mousemove",this.onMouseMove),this.elRoot.addEventListener("mouseleave",this.mouseUp),this.elTsBarRoot.addEventListener("mouseup",this.mouseUp),this.vhPlayer.on(T.UIResize,this.onResize,this)}onResize(){this.width=this.elTsBarRoot.clientWidth,this.cachePercent!==-1&&this.percentMove(this.cachePercent)}percentMove(e){e>100||e<0||(this.cachePercent=e,this.elBarCurrent.style.transform=`translateX(${-100+e}%)`,this.elPos.style.transform=`translate(${e*this.width/100}px, -50%)`)}destroy(){}}class af extends Me{constructor(e,t){super(e,t);m(this,"elPlayRoot");m(this,"elIcon");m(this,"onPlay",()=>{this.elIcon.classList.remove("icon-player-bofang"),this.elIcon.classList.add("icon-player-bofangzanting")});m(this,"onPause",()=>{this.elIcon.classList.remove("icon-player-bofangzanting"),this.elIcon.classList.add("icon-player-bofang")});m(this,"togglePlay",()=>{this.elMedia.paused?this.elMedia.play():this.elMedia.pause()});this.init(),this.registerListeners()}init(){this.elPlayRoot=j("div",{},{class:"ui-play-root"}),this.elPlayRoot.innerHTML=`
<i class="iconfont-player" title="\u64AD\u653E/\u6682\u505C"></i>
`,this.elRoot.appendChild(this.elPlayRoot),this.elIcon=this.elPlayRoot.querySelector(".iconfont-player"),this.elMedia.paused?this.onPause():this.onPlay()}registerListeners(){this.elIcon.addEventListener("click",this.togglePlay),this.elMedia.addEventListener("play",this.onPlay),this.elMedia.addEventListener("pause",this.onPause)}unRegisterListeners(){this.elMedia.removeEventListener("play",this.onPlay),this.elMedia.removeEventListener("pause",this.onPause)}destroy(){this.unRegisterListeners()}}class sf extends Me{constructor(e,t){super(e,t);m(this,"elReloadRoot");m(this,"elIcon");m(this,"reload",()=>{this.vhPlayer.emit(T.LINE_CHANGE,{isReload:!0})});this.init(),this.registerListeners()}init(){this.elReloadRoot=j("div",{},{class:"ui-reload-root"}),this.elReloadRoot.innerHTML=`
<i class="iconfont-player icon-player-reload" title="\u5237\u65B0"></i>
`,this.elRoot.appendChild(this.elReloadRoot),this.elIcon=this.elReloadRoot.querySelector(".iconfont-player")}registerListeners(){this.elIcon.addEventListener("click",this.reload)}destroy(){this.elIcon.removeEventListener("click",this.reload)}}class of extends Me{constructor(e,t){super(e,t);m(this,"elDurationRoot");m(this,"elDurationCurrent");m(this,"elDurationTotal");m(this,"onTimeupdate",()=>{this.elDurationCurrent.textContent=this.timeFormat(this.elMedia.currentTime)});m(this,"onDurationChange",()=>{this.elDurationTotal.textContent=this.timeFormat(this.elMedia.duration)});m(this,"onEnd",()=>{this.elDurationCurrent.textContent=this.timeFormat(this.elMedia.duration)});this.init(),this.registerListeners()}init(){this.elDurationRoot=j("div",{},{class:"ui-duration-root"}),this.elDurationRoot.innerHTML=`
<span class="duration duration-current">00</span> / <span class="duration duration-total"></span>
`,this.elRoot.appendChild(this.elDurationRoot),this.elDurationCurrent=this.elDurationRoot.querySelector(".duration-current"),this.elDurationTotal=this.elDurationRoot.querySelector(".duration-total"),this.elDurationCurrent.textContent=this.timeFormat(0)}registerListeners(){this.elMedia.addEventListener("timeupdate",this.onTimeupdate),this.elMedia.addEventListener("durationchange",this.onDurationChange),this.elMedia.addEventListener("ended",this.onEnd)}timeFormat(e){let t=Math.floor(e/3600),i=Math.floor(e/60%60),r=Math.floor(e%60);return`${t>0?this.fillZero(t,!1)+":":""}${this.fillZero(i,!0)}:${this.fillZero(r,!0)}`}fillZero(e,t){return e>0?e<10?"0"+e:e+"":t?"00":""}unRegisterListeners(){this.elMedia.removeEventListener("timeupdate",this.onTimeupdate),this.elMedia.removeEventListener("durationchange",this.onDurationChange),this.elMedia.removeEventListener("ended",this.onEnd)}destroy(){this.unRegisterListeners()}}class lf extends Me{constructor(e,t){super(e,t);m(this,"elBarrageRoot");m(this,"elIcon");m(this,"opened",!0);m(this,"onClick",()=>{this.opened?(this.elIcon.classList.replace("icon-player-danmukaiqi","icon-player-danmuguanbi"),this.vhPlayer.closeBarrage()):(this.elIcon.classList.replace("icon-player-danmuguanbi","icon-player-danmukaiqi"),this.vhPlayer.openBarrage()),this.opened=!this.opened});this.init(),this.registerListeners()}init(){let{barrageOption:e}=this.vhPlayer.options;!e.enable||(this.elBarrageRoot=j("div",{},{class:"ui-barrage-root"}),this.elBarrageRoot.innerHTML=`
      <i class="iconfont-player icon-player-danmukaiqi"></i>
    `,this.elRoot.appendChild(this.elBarrageRoot),this.elIcon=this.elBarrageRoot.querySelector(".iconfont-player"))}registerListeners(){this.elIcon.addEventListener("click",this.onClick)}destroy(){this.elIcon.removeEventListener("click",this.onClick)}}class uf extends Me{constructor(e,t){super(e,t);m(this,"elVolRoot");m(this,"elIcon");m(this,"elSlider");m(this,"elSliderRoot");m(this,"elSliderVol");m(this,"elSliderPos");m(this,"height");m(this,"timer",0);m(this,"onClick",e=>{this.changeVolume(e.layerY-this.height)});m(this,"onMouseOverIcon",()=>{this.mouseOverShowSlider(),this.height||(this.height=this.elSliderRoot.clientHeight)});m(this,"mouseOverShowSlider",()=>{this.vhPlayer.emit(T.UISingleDisplay,this.constructor.name),this.elSlider.classList.add("active"),this.timer&&clearTimeout(this.timer)});m(this,"mouseLeaveHideSlider",()=>{this.timer&&clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.elSlider.classList.remove("active")},1e3)});m(this,"toggleMuted",()=>{this.vhPlayer.video.muted=!this.vhPlayer.video.muted});m(this,"onDrag",e=>{e.preventDefault(),e.clientY!==0&&this.changeLayout(e.layerY-2)});m(this,"onDragEnd",e=>{e.preventDefault(),this.changeVolume(e.layerY-2)});this.init(),this.registerListeners()}init(){this.elVolRoot=j("div",{},{class:"ui-volume-root"}),this.elVolRoot.innerHTML=`
<i class="iconfont-player iconfont-player-vol"></i>
<div class="volume-slider">
  <div class="slider-root">
    <div class="slider"></div>
  </div>
  <div class="pos" draggable="true"></div>
</div>
`,this.elRoot.appendChild(this.elVolRoot),this.elIcon=this.elVolRoot.querySelector(".iconfont-player"),this.elSlider=this.elVolRoot.querySelector(".volume-slider"),this.elSliderRoot=this.elVolRoot.querySelector(".slider-root"),this.elSliderVol=this.elVolRoot.querySelector(".slider"),this.elSliderPos=this.elVolRoot.querySelector(".pos"),this.onVolumechange()}registerListeners(){this.elIcon.addEventListener("click",this.toggleMuted),this.elIcon.addEventListener("mouseenter",this.onMouseOverIcon),this.elIcon.addEventListener("mouseleave",this.mouseLeaveHideSlider),this.elSlider.addEventListener("mouseenter",this.mouseOverShowSlider),this.elSlider.addEventListener("mouseleave",this.mouseLeaveHideSlider),this.elSliderRoot.addEventListener("click",this.onClick),this.elSliderPos.addEventListener("drag",this.onDrag),this.elSliderPos.addEventListener("dragend",this.onDragEnd),this.vhPlayer.on(T.Volumechange,this.onVolumechange,this)}onVolumechange(){let e=this.vhPlayer.video.muted?0:this.vhPlayer.video.volume;this.elSliderVol.style.transform=`translateY(${(1-e)*100}%)`,this.elSliderPos.style.transform=`translateY(${-e*70}px)`,this.vhPlayer.video.muted?(this.elIcon.classList.add("icon-player-jingyin"),this.elIcon.classList.remove("icon-player-shengyin")):(this.elIcon.classList.remove("icon-player-jingyin"),this.elIcon.classList.add("icon-player-shengyin"))}changeVolume(e){let t=this.height;e>0?e=0:e<-t&&(e=-t);let i=(t+e)/t;this.vhPlayer.video.volume=1-i,this.vhPlayer.video.muted=i===1}changeLayout(e){let t=this.height;e>0?e=0:e<-t&&(e=-t),this.elSliderVol.style.transform=`translateY(${(t+e)/t*100}%)`,this.elSliderPos.style.transform=`translateY(${e}px)`}destroy(){}}class hf extends Me{constructor(e,t){super(e,t);m(this,"elFsRoot");m(this,"elIcon");m(this,"toggleFs",()=>{this.vhPlayer.toggleFullscreen()});this.init(),this.registerListeners()}init(){this.elFsRoot=j("div",{},{class:"ui-fullscreen-root"}),this.elFsRoot.innerHTML=`
<i class="iconfont-player icon-player-quanping1" title="\u5168\u5C4F"></i>
`,this.elRoot.appendChild(this.elFsRoot),this.elIcon=this.elFsRoot.querySelector(".iconfont-player")}registerListeners(){this.elIcon.addEventListener("click",this.toggleFs),this.vhPlayer.on(T.FULLSCREEN_CHANGED,this.onFsChange,this)}onFsChange(e){e?this.elIcon.classList.replace("icon-player-quanping1","icon-player-quanping"):this.elIcon.classList.replace("icon-player-quanping","icon-player-quanping1")}unRegisterListeners(){this.elIcon.removeEventListener("click",this.toggleFs),this.vhPlayer.off(T.FULLSCREEN_CHANGED)}destroy(){this.unRegisterListeners()}}class df extends Me{constructor(e,t){super(e,t);m(this,"elSettingRoot");m(this,"elIcon");m(this,"elSettingContent");m(this,"elSettingContent2");m(this,"elContentVtt");m(this,"elContentLine");m(this,"elContentQuality");m(this,"mapping",{vtt:this.elContentVtt,line:this.elContentLine,quality:this.elContentQuality});m(this,"timer1",-1);m(this,"onContentMouseLeave",()=>{this.timer1=window.setTimeout(()=>{this.hide()},1e3)});m(this,"onClick",()=>{this.elSettingContent.classList.contains("active")?this.hide():(this.vhPlayer.emit(T.UISingleDisplay,this.constructor.name),this.elSettingContent.classList.add("active"))});this.init(),this.registerListeners()}init(){this.elSettingRoot=j("div",{},{class:"ui-setting-root"}),this.elSettingRoot.innerHTML=`
<i class="iconfont-player icon-player-diandiandian" title="\u8BBE\u7F6E"></i>
<ul class="setting-content"></ul>
`,this.elRoot.appendChild(this.elSettingRoot),this.elIcon=this.elSettingRoot.querySelector(".iconfont-player"),this.elSettingContent=this.elSettingRoot.querySelector(".setting-content")}registerListeners(){this.vhPlayer.on(T.SCHEDULER_COMPLETE,this.onScheduleComplete,this),this.vhPlayer.on(T.VTT_ADDED,this.addVttUI,this),this.vhPlayer.on(T.UISingleDisplay,this.onSingleDisplay,this),this.vhPlayer.on(T.DEFINITION_CHANGE,this.onQualityChange,this),this.vhPlayer.on(T.LINE_CHANGE,this.onLineChange,this),this.vhPlayer.on(T.VTT_SELECTED,this.onVttSelected,this),this.vhPlayer.on(T.VTT_CLOSED,this.onVttClosed,this),this.elIcon.addEventListener("click",this.onClick),this.elSettingContent.addEventListener("mouseleave",this.onContentMouseLeave)}bindMouseEvent(e){this.mapping[e].addEventListener("mouseenter",()=>{this.timer1&&window.clearTimeout(this.timer1)}),this.mapping[e].addEventListener("mouseleave",t=>{t.currentTarget.classList.remove("active")})}showSelectedUI(e){for(let t of Object.keys(this.mapping))t===e?this.mapping[t].classList.add("active"):this.mapping[t]&&this.mapping[t].classList.remove("active")}showSelectedUI2(e,t){let i=this.mapping[e].querySelectorAll("li");for(let r of i)r.dataset.val===t?r.classList.add("active"):r.classList.remove("active")}onQualityChange(e){this.showSelectedUI2("quality",e.quality)}onLineChange(e){this.showSelectedUI2("line",e.line)}onVttSelected(e){this.showSelectedUI2("vtt",e.vtt)}onVttClosed(){this.showSelectedUI2("vtt","")}onScheduleComplete(){let{scheduleOption:e}=this.vhPlayer.options;if(e.enable){let t=document.createElement("li"),i=document.createElement("li");t.textContent="\u7EBF\u8DEF",i.textContent="\u6E05\u6670\u5EA6",t.addEventListener("click",()=>{this.showSelectedUI("line")}),i.addEventListener("click",()=>{this.showSelectedUI("quality")}),this.elSettingContent.appendChild(t),this.elSettingContent.appendChild(i),this.addLineUI(),this.addQualityUI()}}addLineUI(){this.elContentLine=j("ul",{},{class:"setting-content2 setting-content-line"}),this.elSettingRoot.appendChild(this.elContentLine),this.mapping.line=this.elContentLine,this.elSettingContent2=this.elSettingRoot.querySelectorAll(".setting-content2"),this.bindMouseEvent("line");let{lines:e,currentQualityCdnName:t,currentQualityLineName:i}=this.vhPlayer.def,{uiOptions:r}=this.vhPlayer.options;const a=r!=null&&r.line?r.line:!1;let s=document.createDocumentFragment();for(let o of e){let l=document.createElement("li");l.textContent=a&&a[o]?a[o]:o,l.dataset.val=o,o===(t||i)&&l.classList.add("active"),l.addEventListener("click",u=>{this.vhPlayer.switch(u.currentTarget.dataset.val),this.hide()}),s.appendChild(l)}this.elContentLine.appendChild(s)}addQualityUI(){this.elContentQuality=j("ul",{},{class:"setting-content2 setting-content-quality"}),this.elSettingRoot.appendChild(this.elContentQuality),this.mapping.quality=this.elContentQuality,this.elSettingContent2=this.elSettingRoot.querySelectorAll(".setting-content2"),this.bindMouseEvent("quality");let{qualities:e,currentQuality:t}=this.vhPlayer.def,{uiOptions:i}=this.vhPlayer.options;const r=i!=null&&i.quality?i.quality:!1;let a=document.createDocumentFragment();for(let s of e){let o=document.createElement("li");o.textContent=r&&r[s]?r[s]:s,o.dataset.val=s,s===t&&o.classList.add("active"),o.addEventListener("click",l=>{this.vhPlayer.setQuality(l.currentTarget.dataset.val),this.hide()}),a.appendChild(o)}this.elContentQuality.appendChild(a)}addVttUI(){let{vttOptions:e,type:t}=this.vhPlayer.options;if(e.enable&&t==="vod"){this.elContentVtt=j("ul",{},{class:"setting-content2 setting-content-vtt"}),this.elSettingRoot.appendChild(this.elContentVtt),this.mapping.vtt=this.elContentVtt,this.elSettingContent2=this.elSettingRoot.querySelectorAll(".setting-content2"),this.bindMouseEvent("vtt");let i=document.createElement("li");i.textContent="\u5B57\u5E55",i.addEventListener("click",()=>{this.showSelectedUI("vtt")}),this.elSettingContent.appendChild(i);let r=document.createElement("li");r.textContent="\u5173\u95ED",r.dataset.val="",r.addEventListener("click",()=>{this.vhPlayer.closeVtt(),this.hide()}),this.elContentVtt.appendChild(r);let a=document.createDocumentFragment();for(let s of e.tracks){let o=document.createElement("li");o.textContent=s.label||s.srclang,o.dataset.val=s.srclang,s.default&&o.classList.add("active"),o.addEventListener("click",()=>{this.vhPlayer.selectVtt(s.srclang),this.hide()}),a.appendChild(o)}this.elContentVtt.appendChild(a)}}onSingleDisplay(e){e!==this.constructor.name&&this.hide()}hide(){this.elSettingContent.classList.remove("active"),this.elSettingContent2.forEach(e=>e.classList.remove("active"))}destroy(){}}var Bf="",$f="";class ho{constructor(e){m(this,"elRoot");m(this,"elLoadingWrapper");m(this,"elControlWrapper");m(this,"toggleShow",e=>{if(this.elControlWrapper.classList.contains("active")){let t=0,i=e.target;for(;t<6&&i&&i!==this.elControlWrapper;)i=i.parentNode,t+=1;i!==this.elControlWrapper&&this.elControlWrapper.classList.remove("active")}else this.elControlWrapper.classList.add("active")});this.player=e,this.init()}init(){let{videoNode:e,scheduleOption:t,vttOptions:i,type:r,controls:a}=this.player.options;if(a!=="custom"){x.warn("UI - \u672A\u5F00\u542F\u81EA\u5B9A\u4E49\u63A7\u5236\u680F");return}this.elRoot=k("#"+e),this.elControlWrapper=j("div",{},{class:"player-control-wrapper active "+(r==="live"?"is-live":"")}),this.elLoadingWrapper=j("div",{},{class:"player-loading-wrapper hide"}),this.elLoadingWrapper.innerHTML=`
      <i class="iconfont-player icon-player-Loading"></i>
    `,this.elControlWrapper.innerHTML=`
      <div class="bar-wrapper"></div>
      <div class="tools-wrapper">
        <div class="tools-wrapper-left"></div>
        <div class="tools-wrapper-right"></div>
      </div>`,this.elRoot.appendChild(this.elLoadingWrapper),this.elRoot.appendChild(this.elControlWrapper);let s=this.elRoot.querySelector(".tools-wrapper-left"),o=this.elRoot.querySelector(".tools-wrapper-right"),l=this.elRoot.querySelector(".bar-wrapper");new af(s,this.player),r==="live"&&new sf(s,this.player),r==="vod"?(new rf(l,this.player),new of(s,this.player)):t.playerData.live_type===1?new nf(l,this.player):l.remove(),new lf(o,this.player),we.platform==="pc"&&new uf(o,this.player),new hf(o,this.player),(t.enable||i.enable&&r==="vod")&&new df(o,this.player),this.player.openUI=this.openUI.bind(this),this.player.hideUI=this.hideUI.bind(this),this.registerListeners()}registerListeners(){this.elRoot.addEventListener("click",this.toggleShow),this.player.on(T.Waiting,()=>{this.elLoadingWrapper.classList.remove("hide")}),this.player.on(T.Canplay,()=>{this.elLoadingWrapper.classList.add("hide")})}openUI(){this.elControlWrapper.classList.add("active")}hideUI(){this.elControlWrapper.classList.remove("active")}destroy(){var e;(e=this.elControlWrapper)==null||e.remove()}}m(ho,"pluginName","UI");class co{constructor(e){this.player=e,this.init()}init(){var i;let{vttOptions:e,type:t}=this.player.options;if(t==="live"){x.warn("Vtt - \u6682\u4E0D\u652F\u6301\u5BF9\u76F4\u64AD\u6DFB\u52A0\u5B57\u5E55");return}if(!e.enable){x.warn("Vtt - \u672A\u5F00\u542F\u5B57\u5E55");return}if(!((i=e.tracks)!=null&&i.length)){x.warn("Vtt - \u5B57\u5E55\u5217\u8868\u4E3A\u7A7A");return}this.loadTracks(),this.player.selectVtt=this.selectVtt.bind(this),this.player.closeVtt=this.closeVtt.bind(this)}loadTracks(){for(let e of this.player.options.vttOptions.tracks)this.addTracks(e);this.player.emit(T.VTT_ADDED)}selectVtt(e){for(let t of this.player.video.textTracks)t.language===e?(t.mode="showing",this.player.emit(T.VTT_SELECTED,{vtt:e})):t.mode="hidden"}closeVtt(){for(let e of this.player.video.textTracks)e.mode="hidden";this.player.emit(T.VTT_CLOSED)}addTracks(e){let t=j("track",{},{label:e.label||e.srclang,kind:e.kind,srclang:e.srclang,src:e.src});t.default=e.default===!0,this.player.video.appendChild(t)}destroy(){}}m(co,"pluginName","Vtt");const Nt=class{constructor(e){this.player=e,this.init()}init(){let{type:e}=this.player.options;if(e==="vod"){x.warn("TimeShift - \u70B9\u64AD\u6D3B\u52A8\u4E0D\u8FD0\u884C\u76F4\u64AD\u65F6\u79FB");return}if(this.player.playerType!==q.Hls){x.warn(`TimeShift - \u76F4\u64AD\u65F6\u79FB\u53EA\u652F\u6301hls\uFF0C\u5F53\u524D\u64AD\u653E\u5668\u7C7B\u578B\uFF1A${this.player.playerType}`);return}this.player.handleTimeShift=this.handleTimeShift.bind(this),this.registerListeners()}registerListeners(){this.player.on(T.SCHEDULER_COMPLETE,this.onScheduleComplete,this)}handleTimeShift(e=0){if(this.player.cdnName!==Ne.TX){x.warn(`TimeShift - \u76F4\u64AD\u65F6\u79FB\u53EA\u652F\u6301\u817E\u8BAF\u7EBF\u8DEF\uFF0C\u5F53\u524D\u7EBF\u8DEF\uFF1A${this.player.cdnName}`);return}e<Nt.TENCENT_DELAY?e=Nt.TENCENT_DELAY:e=Math.round(e);let i=(this.player.vPlayer.url||this.player.vPlayer.cacheUrl).split("?")[0]+this.creatTencentTimeShiftUrl(e);this.player.load(i),this.player.emit(T.LIVE_TIMESHIFT,{delay:e,url:i})}onScheduleComplete(e){e.timeShift&&this.player.load(`${e.url}&delay=${Nt.TENCENT_DELAY}`)}creatAliyunTimeShiftUrl(e){return`?aliyunols=on&lhs_start_human_s_8=${e}`}creatTencentTimeShiftUrl(e){let{def:t}=this.player;return yt.refreshToken(t),`?delay=${e}&token=${t.tokenStr}`}destroy(){}};let Bi=Nt;m(Bi,"pluginName","timeShift"),m(Bi,"TENCENT_DELAY",90),oe.use(eo),oe.use(io),oe.use(ro),oe.use(no),oe.use(ao),oe.use(so),oe.use(oo),oe.use(lo),oe.use(uo),oe.use(ho),oe.use(co),oe.use(Bi);const fo=document.querySelector.bind(document);function Q(n,e,t="click"){typeof n=="string"&&(n=fo(n)),n&&n.addEventListener(t,e)}function po(){let n={};return new window.URL(location.href).searchParams.forEach((e,t,i)=>{n[t]=e}),n}let vn;function cf(n){vn||(vn=fo("#log"));let e;typeof n=="object"?(e=document.createElement("pre"),e.textContent=JSON.stringify(n,null,2)):(e=document.createElement("p"),e.textContent=n),vn.appendChild(e)}const mo={dispatch_server:"https://gslb.e.vhall.com",log_info:{uid:"10000127"}},go=bt(ve({},mo),{safe_definition:["same","a","360p"],definition:["same","a","360p"],default_server:{uri:"/vhallyun/vhallcoop/02290ce8c85e49463092cb860d455983/58faa1f6/02290ce8c85e49463092cb860d455983.m3u8",mp4_domainnames:""},subtitle_info:{}}),yo=bt(ve({},mo),{app_type:0,live_type:0,live_subtitle:0,live_delay:0,live_duration:0});let ff=[location.pathname+"out.flv",location.pathname+"qhh.flv"],pf=[location.pathname+"hls1/out.m3u8",location.pathname+"hls2/qhh.m3u8"];function vt(n="flv",e=0){let t=n==="flv"?ff:pf;if(t.length===2){let i=po();console.log("ana querystring",i),i.url&&t.unshift(i.url)}return e=e>=t.length?0:e,{index:e,url:t[e]+"?token=alibaba"}}const ye={videoNode:"vh-player",type:"vod",autoplay:!0,controls:"custom",muted:!1,debug:!0,flvOptions:{enableWorker:!1,statisticsInfoReportInterval:3e3},hlsOptions:{debug:!1,levelLoadingMaxRetry:-1}};function mf(){let n=po();console.log("ana querystring",n);const e=n.type;return e==="vod"&&n.schedule==="true"&&n.scheduleUri&&(go.default_server.uri=n.scheduleUri),e==="live"&&n.timeshift==="true"&&(yo.live_type=1),bt(ve({},ye),{type:e||"vod",appId:n.appId,accountId:405,token:"vhall",liveOption:{roomId:n.roomId,type:n.playerType||q.Flv},vodOption:{recordId:n.recordId},scheduleOption:{enable:n.schedule==="true",playerData:e==="live"?yo:go,debugUrl:n.url?n.url+(n.url.indexOf("?token")!==-1?"":"?token=alibaba"):"",debugCDN:n.cdn||Ne.TX,debugPlayer:n.playerType},peer5Option:{enable:n.peer5==="true",customerId:n.peer5CustomerId,fallback:!0},switchOption:{enable:!0},pursueOption:{enable:!0},marqueeOption:{enable:!0,type:1,text:"test marquee"},vttOptions:{enable:!0,tracks:[{label:"\u82F1\u6587",kind:"subtitles",srclang:"en",src:location.pathname+"vtt/subtitles_en.vtt"},{label:"\u4E2D\u6587",kind:"subtitles",srclang:"zh",src:location.pathname+"vtt/subtitles_zh.vtt",default:!0}]},uiOptions:{line:{[Ne.TX]:"\u817E\u8BAF\u7EBF\u8DEF",[Ne.ALI]:"\u5907\u7528\u7EBF\u8DEF1",[Ne.HW]:"\u5907\u7528\u7EBF\u8DEF2",[Ne.CY]:"\u5907\u7528\u7EBF\u8DEF3"},quality:{[ke.PSame]:"\u539F\u753B",[ke.P720]:"\u9AD8\u6E05",[ke.P480]:"\u6807\u6E05",[ke.P360]:"\u6D41\u7545",[ke.Pa]:"\u97F3\u9891"}}})}function gf(){cf(oe.probe());let n;function e(){const p=mf();oe.createInstance(p,g=>{if(n=g,yf(g),vf(g),!p.scheduleOption.enable)if(p.scheduleOption.debugUrl)n.load(p.scheduleOption.debugUrl);else{const f={flv:"out.flv",hls:"hls1/out.m3u8",native:"hls1/out.m3u8",flash:"",dash:"dash/qhh.mpd"};n.load(location.pathname+f[n.playerType])}},g=>{console.error(g)})}const t=k(".mask-info"),i=k("#bandwidth"),r=k("#cdn"),a=k("#quality"),s=k("#bufferedTime"),o=k("#playedTime"),l=k("#canSeekTime"),u=k(".mask-capture"),h=k(".mask-capture > img");let d=0,c=0;Q(k("#btn-init-player"),()=>{e()}),Q(k("#btn-toggle-play"),()=>{n.video.paused?n.play():n.pause()}),Q(k("#btn-seek"),()=>{n.currentTime=70}),Q(k("#btn-destroy"),()=>{n.destroy()}),Q(k("#btn-capture"),()=>{u.style.display="block",h.src=n.capture(),window.clearTimeout(c),c=window.setTimeout(()=>{u.style.display="none"},3e3)}),Q(k("#btn-add-barrage"),()=>{let p=new Array(100);for(let g of p)n.addBarrage("test barrage \u6D4B\u8BD5\u5F39\u5E55",{color:"red"})}),Q(k("#btn-clear-barrage"),()=>{n.clearBarrage()}),Q(k("#btn-browser-hank"),()=>{k("#mask-all").style.display="block"});const y=()=>{r.textContent=n==null?void 0:n.cdnName,a.textContent=n==null?void 0:n.quality,i.textContent=(n==null?void 0:n.getEstimateNetSpeed())+"",s.textContent=(n==null?void 0:n.bufferedMax)+"",o.textContent=(n==null?void 0:n.currentTime)+"",l.textContent=(n==null?void 0:n.bufferedMax)-(n==null?void 0:n.currentTime)+""};Q(k("#btn-mask-info"),()=>{t.style.display==="block"?(t.style.display="none",clearInterval(d)):(t.style.display="block",y(),d=window.setInterval(y,5e3))})}function yf(n){n.on(oe.Events.FULLSCREEN_CHANGED,e=>{console.log("Events.FULLSCREEN_CHANGED",e)})}function vf(n){const e=["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","ratechange","seeked","seeking","stalled","suspend","waiting"];for(let t of e)n.video.addEventListener(t,()=>{console.log(`[vlog - origin event: ${t}]`)})}function xf(){let n,e;Q(k("#btn-flv-init"),()=>{ye.videoNode="flv-player",console.log("Flv Player Params:",ye),window.vp=n=new fe(ye),e=vt("flv"),n.load(e.url).then(()=>{bf(n)})}),Q(k("#btn-flv-toggle-play"),()=>{n.video.paused?n.video.play():n.video.pause()}),Q(k("#btn-flv-switch"),()=>{e=vt("flv",e.index+1),n.load(e.url)})}function bf(n){n.nPlayer.on(fe.Events.ERROR,(e,t,i)=>{console.log("FlvPlayer.Events.ERROR"),console.log("errorType: ",e),console.log("errorDetail: ",t),console.log("errorInfo: ",i)}),n.nPlayer.on(fe.Events.LOADING_COMPLETE,e=>{console.log("FlvPlayer.Events.LOADING_COMPLETE",e)}),n.nPlayer.on(fe.Events.MEDIA_INFO,e=>{console.log("FlvPlayer.Events.MEDIA_INFO",e)}),n.nPlayer.on(fe.Events.METADATA_ARRIVED,e=>{console.log("FlvPlayer.Events.METADATA_ARRIVED",e)}),n.nPlayer.on(fe.Events.RECOVERED_EARLY_EOF,e=>{console.log("FlvPlayer.Events.RECOVERED_EARLY_EOF",e)}),n.nPlayer.on(fe.Events.SCRIPTDATA_ARRIVED,e=>{console.log("FlvPlayer.Events.SCRIPTDATA_ARRIVED",e)}),n.nPlayer.on(fe.Events.STATISTICS_INFO,e=>{})}function Sf(){let n,e;Q(k("#btn-hls-init"),()=>{ye.videoNode="hls-player",console.log("Hls Player Params:",ye),Zi(ye.debug),window.vp=n=new er(ye),e=vt("hls"),n.load(e.url)}),Q(k("#btn-hls-toggle-play"),()=>{n.video.paused?n.video.play():n.video.pause()}),Q(k("#btn-hls-switch"),()=>{e=vt("hls",e.index+1),n.load(e.url)}),Q(k("#btn-hls-seek"),()=>{n.video.currentTime=24*60})}function Tf(){let n,e;Q(k("#btn-hlslite-init"),()=>{ye.videoNode="hls-lite-player",console.log("HlsLite Player Params:",ye),Zi(ye.debug),window.vp=n=new Zh(ye),e=vt("hls"),n.load(e.url)}),Q(k("#btn-hlslite-toggle-play"),()=>{n.video.paused?n.video.play():n.video.pause()}),Q(k("#btn-hlslite-switch"),()=>{e=vt("hls",e.index+1),n.load(e.url)})}function wf(){gf(),xf(),Sf(),Tf()}window.onload=wf})(flvjs,Hls,dashjs);
