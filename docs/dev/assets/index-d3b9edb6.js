var Ff=Object.defineProperty;var Mf=(Z,Q,be)=>Q in Z?Ff(Z,Q,{enumerable:!0,configurable:!0,writable:!0,value:be}):Z[Q]=be;var m=(Z,Q,be)=>(Mf(Z,typeof Q!="symbol"?Q+"":Q,be),be);(function(Z,Q,be){var yn;"use strict";var Pn=document.createElement("style");Pn.textContent=`h1,h2,h3,h4,p{margin:0}section{padding-bottom:8px;border-bottom:1px solid #ccc}section+section{margin-top:8px}.player{position:relative;height:56.25vw;background-color:#0000001a}.mask{position:absolute;width:100%;top:0;left:0;bottom:0;z-index:2;color:#fff;background-color:#00000080;display:none}.mask-capture>img{height:80%}#url{width:90%}#log{height:300px;overflow:scroll;border:1px solid}#mask-all{position:fixed;left:0;right:0;top:0;bottom:0;z-index:999;background:rgba(0,0,0,.5)}.horizontal-fullscrren{position:fixed!important;top:0;bottom:0;left:calc((100vw - 100vh)/2);z-index:999;margin:auto;width:100vh;height:100vw;transform:rotate(90deg);background-color:#000}:-webkit-full-screen video,:fullscreen video{position:absolute;width:100%;height:100%}.barrage-root{position:absolute;left:0;right:0;top:0;bottom:0;z-index:3;overflow:hidden}.barrage-root .barrage-item{padding:0 6px;position:absolute;left:100%;z-index:4;will-change:transform;cursor:pointer;font-size:14px;color:#fff;white-space:nowrap;border:none}.barrage-root .barrage-item img{max-height:120px}.marquee-root{position:absolute;left:0;right:0;top:0;bottom:0;z-index:2;overflow:hidden}.marquee-root .marquee{position:absolute;white-space:nowrap;user-select:none;font-size:18px;color:#ff8d41}@font-face{font-family:iconfont-player;src:url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.eot?t=1644487605199);src:url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.eot?t=1644487605199#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.woff2?t=1644487605199) format("woff2"),url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.woff?t=1644487605199) format("woff"),url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.ttf?t=1644487605199) format("truetype"),url(//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.svg?t=1644487605199#iconfont-player) format("svg")}.iconfont-player{font-family:iconfont-player!important;font-size:18px;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-player-Loading:before{content:""}.icon-player-danmukaiqi:before{content:""}.icon-player-danmuguanbi:before{content:""}.icon-player-reload:before{content:""}.icon-player-diandiandian:before{content:""}.icon-player-bofang:before{content:""}.icon-player-bofangzanting:before{content:""}.icon-player-jingyin:before{content:""}.icon-player-shengyin:before{content:""}.icon-player-quanping:before{content:""}.icon-player-quanping1:before{content:""}@supports ((--a: 0)){.player-loading-wrapper,.player-control-wrapper{--colorMain: #3967FF;--colorBg: rgba(0,0,0,.8);--colorBgBar: #eee;--colorFont: #fff;--colorPoint: #fff;--colorSuccess: #54b946;--margin: 12px;--padding: 8px;--paddingVol: 10px;--borderRadius: 4px}}.player-loading-wrapper,.player-control-wrapper{position:absolute;left:0;right:0;bottom:0;z-index:5}.player-loading-wrapper{top:0;display:flex;align-items:center;justify-content:center}.player-loading-wrapper.hide{display:none}.player-control-wrapper{font-size:14px;color:var(--colorFont);background:linear-gradient(0deg,black,transparent);display:none;user-select:none}.player-control-wrapper.active{display:block}.player-control-wrapper *{box-sizing:content-box!important}.player-control-wrapper .hide{display:none}.player-control-wrapper ul{margin:0;padding:4px var(--padding);position:absolute;z-index:9;list-style:none;border-radius:var(--borderRadius);background-color:var(--colorBg)}.player-control-wrapper ul.active{display:block}.player-control-wrapper li{line-height:1.6;cursor:pointer}.player-control-wrapper li.active{color:var(--colorMain)}.player-control-wrapper.is-live .tools-wrapper{padding:var(--padding)}.player-control-wrapper .tools-wrapper{padding:0 var(--padding) 2px;justify-content:space-between}.player-control-wrapper .bar-wrapper{flex:1;margin:0 8px;padding:8px 0;overflow:hidden}.player-control-wrapper .tools-wrapper,.player-control-wrapper .tools-wrapper-left,.player-control-wrapper .tools-wrapper-right{display:flex;align-items:center}.icon-player-bofang,.icon-player-bofangzanting,.icon-player-shengyin,.icon-player-jingyin{font-weight:700}.icon-player-Loading{font-size:28px;color:var(--colorMain);animation:loading-circle 1.3s linear infinite}.icon-player-danmukaiqi,.icon-player-danmuguanbi{font-size:24px}.icon-player-danmukaiqi{color:var(--colorSuccess)}.player-control-wrapper .ui-reload-root,.player-control-wrapper .ui-play-root,.player-control-wrapper .ui-barrage-root,.player-control-wrapper .ui-volume-root,.player-control-wrapper .ui-fullscreen-root{margin-right:var(--margin)}.player-control-wrapper .ui-duration-root{min-width:94px}.player-control-wrapper .bar-root{height:4px;position:relative;background-color:var(--colorBgBar);cursor:pointer}.player-control-wrapper .bar-root .bar{position:absolute;top:0;left:0;width:100%;height:100%;transform:translate(-100%)}.player-control-wrapper .bar-root .pos{position:absolute;top:50%;left:-8px;z-index:8;width:8px;height:8px;border-radius:50%;background-color:var(--colorPoint);border:4px solid var(--colorMain);transform:translateY(-50%)}.player-control-wrapper .bar-root .bar.bar-current{background-color:var(--colorMain);z-index:7}.player-control-wrapper .bar-root .bar.bar-buffered{background-color:#999;z-index:6}.player-control-wrapper .ui-volume-root{position:relative}.player-control-wrapper .volume-slider,.player-control-wrapper .slider-root{position:absolute;width:4px}.player-control-wrapper .volume-slider{padding:var(--paddingVol);left:0;bottom:26px;z-index:9;height:70px;display:none;border-radius:var(--borderRadius);background-color:var(--colorBg)}.player-control-wrapper .volume-slider.active{display:block}.player-control-wrapper .slider-root{left:var(--paddingVol);top:var(--paddingVol);bottom:var(--paddingVol);border-radius:var(--borderRadius);overflow:hidden;cursor:pointer;background-color:var(--colorBgBar)}.player-control-wrapper .slider-root .slider{position:absolute;left:0;top:0;width:100%;height:100%;transform:translateY(100%);background-color:var(--colorMain)}.player-control-wrapper .volume-slider .pos{position:absolute;left:calc(var(--paddingVol) - 2px);bottom:calc(var(--paddingVol) - 4px);width:8px;height:8px;border-radius:50%;transform:translateY(0);cursor:pointer;background-color:var(--colorPoint)}.player-control-wrapper .ui-setting-root{position:relative}.player-control-wrapper .setting-content2,.player-control-wrapper .setting-content{bottom:26px;text-align:center;display:none}.player-control-wrapper .setting-content{right:0;width:50px}.player-control-wrapper .setting-content2{right:68px;width:66px}video::cue{color:#fff;background:none;text-shadow:0 1px #000,1px 0 #000,-1px 0 #000,0 -1px #000}@keyframes loading-circle{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (any-hover: hover){.iconfont-player:hover{color:var(--colorMain);cursor:pointer}.player-control-wrapper li:hover{color:var(--colorMain)}}
`,document.head.appendChild(Pn);const kf="",k=document.querySelector.bind(document);function K(n="div",e={},t={}){const i=document.createElement(n);return Object.getOwnPropertyNames(e).forEach(r=>{i[r]=e[r]}),Object.getOwnPropertyNames(t).forEach(r=>{i.setAttribute(r,t[r])}),i}function An(n){return typeof n=="string"?k(n):n}function On(n,e){return new Promise((t,i)=>{if(document.getElementById(n))t(!0);else{let r=document.createElement("script");r.setAttribute("id",n),r.setAttribute("src",e),document.head.appendChild(r),r.onload=()=>t(!0),r.onerror=()=>i(Error("network error")),setTimeout(()=>{i(Error("timeout"))},1e4)}})}function Rn(){const n={transition:"transitionend",WebkitTransition:"webkitTransitionEnd"};let e=document.createElement("div"),t=Object.keys(n);for(let i of t)if(e.style[i]!==void 0)return{css:i,event:n[i]};return!1}const In=window.WebKitCSSMatrix||window.DOMMatrix||window.MSCSSMatrix;function Ln(n){const e=window.getComputedStyle(n,null).getPropertyValue("transform");return Number(In?new In(e).m41:e.match(/[+-]?\d+/g)[4])}function Co(){if(typeof document.hidden<"u")return["hidden","visibilitychange","visibilityState"];if("webkitHidden"in document)return["webkitHidden","webkitvisibilitychange","webkitVisibilityState"]}function Cn(n,e){let t=Co();t&&document.addEventListener(t[1],function(){document[t[2]]==="visible"?n&&n():e&&e()},!1)}const Do=function(){let n=!1;try{const e={get passive(){return n=!0,!0}},t=()=>{};window.addEventListener("test",t,e),window.removeEventListener("test",t)}catch{n=!1}return n}();function zi(n,e,t){const i="ontouchend"in document,r={down:{t:"touchstart",f:"mousedown"},move:{t:"touchmove",f:"mousemove"},up:{t:"touchend",f:"mouseup"}};let a=n.getBoundingClientRect(),s=i?r[e].t:r[e].f;n.addEventListener(s,o=>{i&&Fo(s,o),t(o,a.x)},Do?{passive:!0}:!1)}function Fo(n,e){n==="touchend"?e.clientX=e.changedTouches[0].clientX:e.clientX=e.touches[0].clientX}var Hi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gi(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Mo(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){if(this instanceof i){var r=[null];r.push.apply(r,arguments);var a=Function.bind.apply(e,r);return new a}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}var qi={},Wi={},zt={};Object.defineProperty(zt,"__esModule",{value:!0});var ko=function(n){if("getBBox"in n){var e=n.getBBox();return Object.freeze({height:e.height,left:0,top:0,width:e.width})}else{var t=window.getComputedStyle(n);return Object.freeze({height:parseFloat(t.height||"0"),left:parseFloat(t.paddingLeft||"0"),top:parseFloat(t.paddingTop||"0"),width:parseFloat(t.width||"0")})}};zt.ContentRect=ko,Object.defineProperty(Wi,"__esModule",{value:!0});var Uo=zt,No=function(){function n(e){this.target=e,this.$$broadcastWidth=this.$$broadcastHeight=0}return Object.defineProperty(n.prototype,"broadcastWidth",{get:function(){return this.$$broadcastWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"broadcastHeight",{get:function(){return this.$$broadcastHeight},enumerable:!0,configurable:!0}),n.prototype.isActive=function(){var e=Uo.ContentRect(this.target);return!!e&&(e.width!==this.broadcastWidth||e.height!==this.broadcastHeight)},n}();Wi.ResizeObservation=No;var Xi={};Object.defineProperty(Xi,"__esModule",{value:!0});var Bo=zt,$o=function(){function n(e){this.target=e,this.contentRect=Bo.ContentRect(e)}return n}();Xi.ResizeObserverEntry=$o,Object.defineProperty(qi,"__esModule",{value:!0});var Vo=Wi,zo=Xi,Ie=[],Dn=function(){function n(e){this.$$observationTargets=[],this.$$activeTargets=[],this.$$skippedTargets=[];var t=Go(e);if(t)throw TypeError(t);this.$$callback=e}return n.prototype.observe=function(e){var t=Mn("observe",e);if(t)throw TypeError(t);var i=kn(this.$$observationTargets,e);i>=0||(this.$$observationTargets.push(new Vo.ResizeObservation(e)),Ho(this))},n.prototype.unobserve=function(e){var t=Mn("unobserve",e);if(t)throw TypeError(t);var i=kn(this.$$observationTargets,e);i<0||(this.$$observationTargets.splice(i,1),this.$$observationTargets.length===0&&Fn(this))},n.prototype.disconnect=function(){this.$$observationTargets=[],this.$$activeTargets=[],Fn(this)},n}();qi.ResizeObserver=Dn;function Ho(n){var e=Ie.indexOf(n);e<0&&(Ie.push(n),Qo())}function Fn(n){var e=Ie.indexOf(n);e>=0&&(Ie.splice(e,1),jo())}function Go(n){if(typeof n>"u")return"Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.";if(typeof n!="function")return"Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function."}function Mn(n,e){if(typeof e>"u")return"Failed to execute '"+n+"' on 'ResizeObserver': 1 argument required, but only 0 present.";if(!(e&&e.nodeType===window.Node.ELEMENT_NODE))return"Failed to execute '"+n+"' on 'ResizeObserver': parameter 1 is not of type 'Element'."}function kn(n,e){for(var t=0;t<n.length;t+=1)if(n[t].target===e)return t;return-1}var Un=function(n){Ie.forEach(function(e){e.$$activeTargets=[],e.$$skippedTargets=[],e.$$observationTargets.forEach(function(t){if(t.isActive()){var i=Nn(t.target);i>n?e.$$activeTargets.push(t):e.$$skippedTargets.push(t)}})})},qo=function(){return Ie.some(function(n){return!!n.$$activeTargets.length})},Wo=function(){return Ie.some(function(n){return!!n.$$skippedTargets.length})},Xo=function(){var n=1/0;return Ie.forEach(function(e){if(e.$$activeTargets.length){var t=[];e.$$activeTargets.forEach(function(i){var r=new zo.ResizeObserverEntry(i.target);t.push(r),i.$$broadcastWidth=r.contentRect.width,i.$$broadcastHeight=r.contentRect.height;var a=Nn(i.target);a<n&&(n=a)}),e.$$callback(t,e),e.$$activeTargets=[]}}),n},Yo=function(){var n=new window.ErrorEvent("ResizeLoopError",{message:"ResizeObserver loop completed with undelivered notifications."});window.dispatchEvent(n)},Nn=function(n){for(var e=0;n.parentNode;)n=n.parentNode,e+=1;return e},Ko=function(){var n=0;for(Un(n);qo();)n=Xo(),Un(n);Wo()&&Yo()},bt,Qo=function(){bt||Bn()},Bn=function(){bt=window.requestAnimationFrame(function(){Ko(),Bn()})},jo=function(){bt&&!Ie.some(function(n){return!!n.$$observationTargets.length})&&(window.cancelAnimationFrame(bt),bt=void 0)},Jo=function(){return window.ResizeObserver=Dn},Zo=qi.install=Jo,Yi={exports:{}};(function(n,e){(function(t,i){var r="0.7.35",a="",s="?",o="function",l="undefined",u="object",h="string",d="major",c="model",y="name",f="type",g="vendor",p="version",x="architecture",_="console",T="mobile",E="tablet",P="smarttv",N="wearable",H="embedded",S=350,F="Amazon",v="Apple",L="ASUS",A="BlackBerry",M="Browser",oe="Chrome",vt="Edge",ve="Firefox",Ui="Google",To="Huawei",vn="LG",xn="Microsoft",wo="Motorola",Ni="Opera",bn="Samsung",Eo="Sharp",Bi="Sony",Sn="Xiaomi",Tn="Zebra",_o="Facebook",Po="Chromium OS",Ao="Mac OS",Lf=function(U,G){var R={};for(var W in U)G[W]&&G[W].length%2===0?R[W]=G[W].concat(U[W]):R[W]=U[W];return R},$i=function(U){for(var G={},R=0;R<U.length;R++)G[U[R].toUpperCase()]=U[R];return G},Oo=function(U,G){return typeof U===h?$t(G).indexOf($t(U))!==-1:!1},$t=function(U){return U.toLowerCase()},Cf=function(U){return typeof U===h?U.replace(/[^\d\.]/g,a).split(".")[0]:i},wn=function(U,G){if(typeof U===h)return U=U.replace(/^\s\s*/,a),typeof G===l?U:U.substring(0,S)},Vt=function(U,G){for(var R=0,W,Xe,Oe,$,O,Re;R<G.length&&!O;){var _n=G[R],Lo=G[R+1];for(W=Xe=0;W<_n.length&&!O&&_n[W];)if(O=_n[W++].exec(U),O)for(Oe=0;Oe<Lo.length;Oe++)Re=O[++Xe],$=Lo[Oe],typeof $===u&&$.length>0?$.length===2?typeof $[1]==o?this[$[0]]=$[1].call(this,Re):this[$[0]]=$[1]:$.length===3?typeof $[1]===o&&!($[1].exec&&$[1].test)?this[$[0]]=Re?$[1].call(this,Re,$[2]):i:this[$[0]]=Re?Re.replace($[1],$[2]):i:$.length===4&&(this[$[0]]=Re?$[3].call(this,Re.replace($[1],$[2])):i):this[$]=Re||i;R+=2}},En=function(U,G){for(var R in G)if(typeof G[R]===u&&G[R].length>0){for(var W=0;W<G[R].length;W++)if(Oo(G[R][W],U))return R===s?i:R}else if(Oo(G[R],U))return R===s?i:R;return U},Df={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Ro={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Io={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[y,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,p],[/opios[\/ ]+([\w\.]+)/i],[p,[y,Ni+" Mini"]],[/\bopr\/([\w\.]+)/i],[p,[y,Ni]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[y,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[y,"UC"+M]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[y,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[y,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[y,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure "+M],p],[/\bfocus\/([\w\.]+)/i],[p,[y,ve+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[y,Ni+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[y,Ni+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[y,"MIUI "+M]],[/fxios\/([-\w\.]+)/i],[p,[y,ve]],[/\bqihu|(qi?ho?o?|360)browser/i],[[y,"360 "+M]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1 "+M],p],[/(comodo_dragon)\/([\w\.]+)/i],[[y,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[y,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,_o],p],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[y,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[y,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[y,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[y,oe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,oe+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[y,"Android "+M]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[y,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[p,En,Df]],[/(webkit|khtml)\/([\w\.]+)/i],[y,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[y,ve+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[y,p],[/(cobalt)\/([\w\.]+)/i],[y,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[x,"amd64"]],[/(ia32(?=;))/i],[[x,$t]],[/((?:i[346]|x)86)[;\)]/i],[[x,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[x,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[x,"armhf"]],[/windows (ce|mobile); ppc;/i],[[x,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[x,/ower/,a,$t]],[/(sun4\w)[;\)]/i],[[x,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[x,$t]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[g,bn],[f,E]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[c,[g,bn],[f,T]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[c,[g,v],[f,T]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[g,v],[f,E]],[/(macintosh);/i],[c,[g,v]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[g,Eo],[f,T]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[g,To],[f,E]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[c,[g,To],[f,T]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[c,/_/g," "],[g,Sn],[f,T]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[g,Sn],[f,E]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[g,"OPPO"],[f,T]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[g,"Vivo"],[f,T]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[c,[g,"Realme"],[f,T]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[g,wo],[f,T]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[g,wo],[f,E]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[g,vn],[f,E]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[g,vn],[f,T]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[g,"Lenovo"],[f,E]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[g,"Nokia"],[f,T]],[/(pixel c)\b/i],[c,[g,Ui],[f,E]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[g,Ui],[f,T]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[g,Bi],[f,T]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[g,Bi],[f,E]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[g,"OnePlus"],[f,T]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[g,F],[f,E]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[g,F],[f,T]],[/(playbook);[-\w\),; ]+(rim)/i],[c,g,[f,E]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[g,A],[f,T]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[g,L],[f,E]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[g,L],[f,T]],[/(nexus 9)/i],[c,[g,"HTC"],[f,E]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[c,/_/g," "],[f,T]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[g,"Acer"],[f,E]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[g,"Meizu"],[f,T]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,c,[f,T]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,c,[f,E]],[/(surface duo)/i],[c,[g,xn],[f,E]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[g,"Fairphone"],[f,T]],[/(u304aa)/i],[c,[g,"AT&T"],[f,T]],[/\bsie-(\w*)/i],[c,[g,"Siemens"],[f,T]],[/\b(rct\w+) b/i],[c,[g,"RCA"],[f,E]],[/\b(venue[\d ]{2,7}) b/i],[c,[g,"Dell"],[f,E]],[/\b(q(?:mv|ta)\w+) b/i],[c,[g,"Verizon"],[f,E]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[g,"Barnes & Noble"],[f,E]],[/\b(tm\d{3}\w+) b/i],[c,[g,"NuVision"],[f,E]],[/\b(k88) b/i],[c,[g,"ZTE"],[f,E]],[/\b(nx\d{3}j) b/i],[c,[g,"ZTE"],[f,T]],[/\b(gen\d{3}) b.+49h/i],[c,[g,"Swiss"],[f,T]],[/\b(zur\d{3}) b/i],[c,[g,"Swiss"],[f,E]],[/\b((zeki)?tb.*\b) b/i],[c,[g,"Zeki"],[f,E]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],c,[f,E]],[/\b(ns-?\w{0,9}) b/i],[c,[g,"Insignia"],[f,E]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[g,"NextBook"],[f,E]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],c,[f,T]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],c,[f,T]],[/\b(ph-1) /i],[c,[g,"Essential"],[f,T]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[g,"Envizen"],[f,E]],[/\b(trio[-\w\. ]+) b/i],[c,[g,"MachSpeed"],[f,E]],[/\btu_(1491) b/i],[c,[g,"Rotor"],[f,E]],[/(shield[\w ]+) b/i],[c,[g,"Nvidia"],[f,E]],[/(sprint) (\w+)/i],[g,c,[f,T]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[g,xn],[f,T]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[g,Tn],[f,E]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[g,Tn],[f,T]],[/smart-tv.+(samsung)/i],[g,[f,P]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[g,bn],[f,P]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,vn],[f,P]],[/(apple) ?tv/i],[g,[c,v+" TV"],[f,P]],[/crkey/i],[[c,oe+"cast"],[g,Ui],[f,P]],[/droid.+aft(\w)( bui|\))/i],[c,[g,F],[f,P]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[c,[g,Eo],[f,P]],[/(bravia[\w ]+)( bui|\))/i],[c,[g,Bi],[f,P]],[/(mitv-\w{5}) bui/i],[c,[g,Sn],[f,P]],[/Hbbtv.*(technisat) (.*);/i],[g,c,[f,P]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,wn],[c,wn],[f,P]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,P]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,c,[f,_]],[/droid.+; (shield) bui/i],[c,[g,"Nvidia"],[f,_]],[/(playstation [345portablevi]+)/i],[c,[g,Bi],[f,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[g,xn],[f,_]],[/((pebble))app/i],[g,c,[f,N]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[c,[g,v],[f,N]],[/droid.+; (glass) \d/i],[c,[g,Ui],[f,N]],[/droid.+; (wt63?0{2,3})\)/i],[c,[g,Tn],[f,N]],[/(quest( 2| pro)?)/i],[c,[g,_o],[f,N]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[f,H]],[/(aeobc)\b/i],[c,[g,F],[f,H]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[c,[f,T]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[f,E]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,E]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,T]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[y,vt+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[y,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,y]],os:[[/microsoft (windows) (vista|xp)/i],[y,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[y,[p,En,Ro]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,"Windows"],[p,En,Ro]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[y,Ao],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,y],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[y,p],[/\(bb(10);/i],[p,[y,A]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[y,ve+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[y,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[y,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[y,oe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[y,Po],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[y,p],[/(sunos) ?([\w\.\d]*)/i],[[y,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[y,p]]},xe=function(U,G){if(typeof U===u&&(G=U,U=i),!(this instanceof xe))return new xe(U,G).getResult();var R=typeof t!==l&&t.navigator?t.navigator:i,W=U||(R&&R.userAgent?R.userAgent:a),Xe=R&&R.userAgentData?R.userAgentData:i,Oe=G?Lf(Io,G):Io,$=R&&R.userAgent==W;return this.getBrowser=function(){var O={};return O[y]=i,O[p]=i,Vt.call(O,W,Oe.browser),O[d]=Cf(O[p]),$&&R&&R.brave&&typeof R.brave.isBrave==o&&(O[y]="Brave"),O},this.getCPU=function(){var O={};return O[x]=i,Vt.call(O,W,Oe.cpu),O},this.getDevice=function(){var O={};return O[g]=i,O[c]=i,O[f]=i,Vt.call(O,W,Oe.device),$&&!O[f]&&Xe&&Xe.mobile&&(O[f]=T),$&&O[c]=="Macintosh"&&R&&typeof R.standalone!==l&&R.maxTouchPoints&&R.maxTouchPoints>2&&(O[c]="iPad",O[f]=E),O},this.getEngine=function(){var O={};return O[y]=i,O[p]=i,Vt.call(O,W,Oe.engine),O},this.getOS=function(){var O={};return O[y]=i,O[p]=i,Vt.call(O,W,Oe.os),$&&!O[y]&&Xe&&Xe.platform!="Unknown"&&(O[y]=Xe.platform.replace(/chrome os/i,Po).replace(/macos/i,Ao)),O},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return W},this.setUA=function(O){return W=typeof O===h&&O.length>S?wn(O,S):O,this},this.setUA(W),this};xe.VERSION=r,xe.BROWSER=$i([y,p,d]),xe.CPU=$i([x]),xe.DEVICE=$i([c,g,f,_,T,P,E,N,H]),xe.ENGINE=xe.OS=$i([y,p]),n.exports&&(e=n.exports=xe),e.UAParser=xe;var xt=typeof t!==l&&(t.jQuery||t.Zepto);if(xt&&!xt.ua){var Vi=new xe;xt.ua=Vi.getResult(),xt.ua.get=function(){return Vi.getUA()},xt.ua.set=function(U){Vi.setUA(U);var G=Vi.getResult();for(var R in G)xt.ua[R]=G[R]}}})(typeof window=="object"?window:Hi)})(Yi,Yi.exports);var el=Yi.exports;function tl(n){return n==null}function il(n){return n.split(".").pop()}function Uf(n){const e={appId:["string"],accountId:["string","number"],token:["string"],videoNode:["string"],type:["string"]};for(let t of Object.getOwnPropertyNames(e))if(n.hasOwnProperty(t)){let i=e[t],r=typeof n[t];if(!i.includes(r))throw Error(`参数类型错误，${t} 必须是 ${i.join()} 类型`)}else throw Error(`参数缺失，请确认提供 ${t}`);if(n.type==="live")if(n.liveOption){if(!n.liveOption.roomId)throw Error("直播配置 liveOption 缺少参数 roomId")}else throw Error("直播需提供参数 liveOption");else if(n.vodOption){if(!n.vodOption.recordId)throw Error("点播配置 vodOption 缺少参数 recordId")}else throw Error("点播需提供参数 vodOption")}const Se=function(){var i,r;let n=new el.UAParser().getResult(),e=/mqqbrowser|qzone|qqbrowser|qq|micromessenger/i.test(n.ua),t=/android|adr/i.test(n.ua.toLowerCase());return{isTencent:e,browser:(i=n.browser.name)==null?void 0:i.toLowerCase(),browserVersion:n.browser.version,os:(r=n.os.name)==null?void 0:r.toLowerCase(),osVersion:n.os.version,platform:/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i.test(n.ua)?"mobile":"pc",isIOS:/\(i[^;]+;( U;)? CPU.+Mac OS X/.test(n.ua),isAndroid:t,isX5:e&&t,isUC:/ucbrowser/.test(n.ua.toLowerCase()),supportMSE:!!(window.MediaSource||window.WebKitMediaSource)}}();function Ki(n,e){let t=Date.now(),i=null;return(...r)=>{i=Date.now(),i-t>e&&(n(...r),t=i)}}class rl{constructor(){m(this,"videoNode");m(this,"type");m(this,"autoplay",!0);m(this,"controls","native");m(this,"poster","");m(this,"debug",!1)}merge(e){if(!e)return this;for(let t in e)typeof e[t]=="object"?this[t]={...this[t],...e[t]}:this[t]=e[t];return this}}class nl extends rl{constructor(){super();m(this,"appId");m(this,"accountId");m(this,"token");m(this,"language","en");m(this,"liveOption");m(this,"vodOption");m(this,"scheduleOption",{enable:!0,playerData:{dispatch_server:"",log_info:{uid:""},default_server:{uri:""},app_type:0,live_type:0,live_subtitle:0,live_delay:0,live_duration:0}});m(this,"pursueOption");m(this,"switchOption",{enable:!0});m(this,"marqueeOption",{enable:!1});m(this,"watermarkOption",{enable:!1});m(this,"barrageOption",{enable:!0,positionRange:[0,.5],speed:100,style:{opacity:80,backgroundColor:"transparent"}});m(this,"reportOption");m(this,"peer5Option",{enable:!1,customerId:"",fallback:!0});m(this,"vttOptions",{enable:!1});m(this,"uiOptions");let t={bufferPursue:20,bufferSeek:30,bufferStop:10,pursueSpeed:1.2,mode:"pursue"},i={bufferPursue:30,bufferSeek:40,bufferStop:20,pursueSpeed:1.2,mode:"pursue"};this.pursueOption={enable:!0,flv:t,hls:i,dash:i,native:t}}}const al={API_SERVER:"//api.vhallyun.com/sdk",REPORT_SERVER:"//dc.e.vhall.com/login",BASE_MESSAGE_URL:`//static.vhallyun.com/jssdk/vhall-jssdk-base/vhall-msg-1.0.9.js?t=${Date.now()}`},te={APP_ID:"app_id",THIRD_PARTY_USER_ID:"third_party_user_id",CLIENT:"client",ACCESS_TOKEN:"access_token",PACKAGE_CHECK:"package_check",LANGUAGE:"language"},Qi={INIT:"/v2/init/start",INIT_LIVE:"/v2/room/get-watch-info",INIT_VOD:"/v2/demand/get-record-watch-info"};var X=(n=>(n.Flv="flv",n.Hls="hls",n.HlsNative="hlsnative",n.Flash="flash",n.Native="native",n.Dash="dash",n))(X||{}),Ue=(n=>(n.P360="360p",n.P480="480p",n.P720="720p",n.Pa="a",n.PSame="same",n))(Ue||{}),Ne=(n=>(n.TX="tx",n.ALI="ali",n.HW="hw",n.CY="cy",n))(Ne||{}),w=(n=>(n.UISingleDisplay="UISingleDisplay",n.UIResize="UIResize",n))(w||{}),w=(n=>(n.Error="error",n.Waiting="waiting",n.Ended="ended",n.Loaded="loadeddata",n.Play="play",n.Canplay="canplay",n.Pause="pause",n.Ratechange="ratechange",n.Stalled="stalled",n.Volumechange="volumechange",n))(w||{}),w=(n=>(n.VTT_ADDED="vttAdded",n.VTT_SELECTED="vttSelected",n.VTT_CLOSED="vttClosed",n.DEFINITION_CHANGE="definitionChange",n.LIVESUBTITLE_OPENED="liveSubtitleOpened",n.LIVESUBTITLE_CLOSED="liveSubtitleClosed",n.AUTOPLAY_FAILED="autoplayFailed",n.FULLSCREEN_CHANGED="fullscreenChanged",n.LAG_REPORT="lagReport",n.LAG_RECOVER="lagRecover",n.OPEN_BARRAGE="openBarrage",n.CLOSE_BARRAGE="closeBarrage",n.CLEAR_BARRAGE="clearBarrage",n.SCHEDULER_COMPLETE="scheduleComplete",n.PULL_STREAM_FAILED="PULL_STREAM_FAILED",n.LINE_CHANGE="lineChange",n.LINE_CHANGED="lineChanged",n.LIVE_TIMESHIFT="liveTimeShift",n.TOUCH_PLAY="touchPlay",n.HLS_ERROR="hlsError",n.FLV_ERROR="flvError",n))(w||{}),$n={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(l,u,h){this.fn=l,this.context=u,this.once=h||!1}function a(l,u,h,d,c){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new r(h,d||l,c),f=t?t+u:u;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],y]:l._events[f].push(y):(l._events[f]=y,l._eventsCount++),l}function s(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],h,d;if(this._eventsCount===0)return u;for(d in h=this._events)e.call(h,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(h)):u},o.prototype.listeners=function(u){var h=t?t+u:u,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var c=0,y=d.length,f=new Array(y);c<y;c++)f[c]=d[c].fn;return f},o.prototype.listenerCount=function(u){var h=t?t+u:u,d=this._events[h];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,h,d,c,y,f){var g=t?t+u:u;if(!this._events[g])return!1;var p=this._events[g],x=arguments.length,_,T;if(p.fn){switch(p.once&&this.removeListener(u,p.fn,void 0,!0),x){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,h),!0;case 3:return p.fn.call(p.context,h,d),!0;case 4:return p.fn.call(p.context,h,d,c),!0;case 5:return p.fn.call(p.context,h,d,c,y),!0;case 6:return p.fn.call(p.context,h,d,c,y,f),!0}for(T=1,_=new Array(x-1);T<x;T++)_[T-1]=arguments[T];p.fn.apply(p.context,_)}else{var E=p.length,P;for(T=0;T<E;T++)switch(p[T].once&&this.removeListener(u,p[T].fn,void 0,!0),x){case 1:p[T].fn.call(p[T].context);break;case 2:p[T].fn.call(p[T].context,h);break;case 3:p[T].fn.call(p[T].context,h,d);break;case 4:p[T].fn.call(p[T].context,h,d,c);break;default:if(!_)for(P=1,_=new Array(x-1);P<x;P++)_[P-1]=arguments[P];p[T].fn.apply(p[T].context,_)}}return!0},o.prototype.on=function(u,h,d){return a(this,u,h,d,!1)},o.prototype.once=function(u,h,d){return a(this,u,h,d,!0)},o.prototype.removeListener=function(u,h,d,c){var y=t?t+u:u;if(!this._events[y])return this;if(!h)return s(this,y),this;var f=this._events[y];if(f.fn)f.fn===h&&(!c||f.once)&&(!d||f.context===d)&&s(this,y);else{for(var g=0,p=[],x=f.length;g<x;g++)(f[g].fn!==h||c&&!f[g].once||d&&f[g].context!==d)&&p.push(f[g]);p.length?this._events[y]=p.length===1?p[0]:p:s(this,y)}return this},o.prototype.removeAllListeners=function(u){var h;return u?(h=t?t+u:u,this._events[h]&&s(this,h)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})($n);var sl=$n.exports;class Vn{constructor(){m(this,"_emitter",new sl.EventEmitter)}emit(e,t){return this._emitter.emit(e,t)}listenerCount(e){return this._emitter.listenerCount(e)}listeners(e){return this._emitter.listeners(e)}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,r){this._emitter.off(e,t,i,r)}}const Ye=function(){},ji={trace:Ye,debug:Ye,log:Ye,warn:Ye,info:Ye,error:Ye};let St=ji;function ol(n){const e=self.console[n];if(e){const t={trace:"green",debug:"purple",log:"indigo",warn:"coral",info:"blue",error:"red"};return e.bind(self.console,`%c[vlog ${n}]`,`color:${t[n]};font-size:14px;`)}return Ye}function ll(n,...e){n!==!1&&e.forEach(function(t){St[t]=typeof n=="object"&&n[t]?n[t].bind(n):ol(t)})}function Ji(n){if(self.console&&n===!0||typeof n=="object"){ll(n,"debug","log","info","warn","error");try{St.log()}catch{St=ji}}else St=ji}const b=St;class Ht{constructor(e,t){m(this,"video");m(this,"options");m(this,"playedTime",0);m(this,"playBackRate",1);m(this,"isPaused",!0);m(this,"url","");m(this,"cacheUrl","");m(this,"autoPlayed",!1);m(this,"context");this.options=e,this.context=t,this.video=this.initVideo(e,An("#"+e.videoNode)),this.registerListeners()}initVideo(e,t=document.body){let i={};i.playsinline=!0,i["webkit-playsinline"]=!0,i["x5-playsinline"]=!0,i["mtt-playsinline"]=!0;let r=K("video",{autoplay:!!e.autoplay,controls:e.controls==="native",muted:!!e.muted},{width:"100%",height:"100%",crossOrigin:"anonymous","z-index":0,...i,...e.poster?{poster:e.poster}:{}});return t.style.position="relative",t.appendChild(r),r}checkUrl(e,t=!1){return e?this.url===e&&!t?(b.warn("BasePlayer checkUrl - url 未改变"),!1):(this.cacheUrl||(this.cacheUrl=e),!0):(b.warn("BasePlayer checkUrl - url 未提供"),!1)}setUrl(e){var t;(t=this.context)==null||t.emit(w.LINE_CHANGED,{old:this.url,new:e}),this.url=e,this.cacheUrl=""}recordPlayStatus(e){b.info("BasePlayer change line old => ",this.url),b.info("BasePlayer change line new => ",e),this.playedTime=this.video.currentTime,this.playBackRate=this.video.playbackRate,this.isPaused=this.video.paused}recoverPlayStatus(){b.info("BasePlayer 还原切线前播放状态:"),this.options.type==="vod"&&(b.info("BasePlayer playedTime:",this.playedTime),this.video.currentTime=this.playedTime),b.info("BasePlayer playBackRate:",this.playBackRate),this.video.playbackRate=this.playBackRate,this.isPaused||this.video.play()}registerListeners(){this.video.addEventListener("play",e=>{var t;(t=this.context)==null||t.emit(w.Play,e)}),this.video.addEventListener("pause",e=>{var t;(t=this.context)==null||t.emit(w.Pause,e)}),this.video.addEventListener("canplay",e=>{var t;(t=this.context)==null||t.emit(w.Canplay,e)}),this.video.addEventListener("waiting",e=>{var t;(t=this.context)==null||t.emit(w.Waiting,e)}),this.video.addEventListener("ended",e=>{var t;(t=this.context)==null||t.emit(w.Ended,e)}),this.video.addEventListener("error",e=>{var i;(i=this.context)==null||i.emit(w.Error,e),b.error(`BasePlayer video error, type: ${e.type}; details: ${e.details}`);let t=e.target&&e.target.error;t&&b.error(`BasePlayer video error, code: ${t.code}; details: ${t.message}`)}),this.video.addEventListener("stalled",e=>{var t;(t=this.context)==null||t.emit(w.Stalled,e)}),this.video.addEventListener("loadeddata",e=>{var t;(t=this.context)==null||t.emit(w.Loaded,e)}),this.video.addEventListener("ratechange",e=>{var t;b.info("BasePlayer video ratechange",this.video.playbackRate),(t=this.context)==null||t.emit(w.Ratechange,e)}),this.video.addEventListener("volumechange",e=>{var t;(t=this.context)==null||t.emit(w.Volumechange,e)}),this.video.addEventListener("canplaythrough",e=>{this.options.autoplay&&!this.autoPlayed&&this.video.paused&&(this.autoPlayed=!0,this.video.play().catch(t=>{var i;b.warn("BasePlayer - not support autoplay"),(i=this.context)==null||i.emit(w.AUTOPLAY_FAILED,t)}))})}}class he extends Ht{constructor(t,i="flv",r){super(t,r);m(this,"nPlayer");m(this,"type");m(this,"cacheInfo",{});b.info(`FlvPlayer - 创建 ${i} player`,t),this.type=i}load(t,i=!1){return this.checkUrl(t,i)?(this.nPlayer&&this.recordPlayStatus(t),new Promise(r=>{this.createInstance({type:this.type,isLive:this.options.type==="live",url:t},this.options.flvOptions||{}).then(a=>{a&&this.nPlayer.on(Z.Events.METADATA_ARRIVED,()=>{this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}}),this.registerFlvListeners(),this.nPlayer.on(Z.Events.METADATA_ARRIVED,()=>{this.setUrl(t)}),this.nPlayer.attachMediaElement(this.video),this.nPlayer.load(),r(!0)})})):Promise.reject(!1)}reload(){return this.load(this.cacheUrl||this.url,!0)}async createInstance(t,i){if(this.type==="flv"&&!Z.isSupported())throw b.error("FlvPlayer createInstance - flv not supported!"),Error("flv not supported!");const r=!!this.nPlayer;return await this.destroy(),this.nPlayer=Z.createPlayer(t,i),r}destroy(){var t;return(t=this.nPlayer)==null||t.destroy(),Promise.resolve(!0)}registerFlvListeners(){this.nPlayer.on(Z.Events.ERROR,(t,...i)=>{var r,a;b.error("FlvPlayer Events.ERROR",t,i),(r=this.context)==null||r.emit(w.FLV_ERROR,{errType:t,data:i}),t===Z.ErrorTypes.NETWORK_ERROR&&(i[0]===Z.ErrorDetails.NETWORK_STATUS_CODE_INVALID&&i[1].code===404||i[0]===Z.ErrorDetails.NETWORK_TIMEOUT||i[1].code===void 0)&&((a=this.context)==null||a.emit(w.PULL_STREAM_FAILED,this.url))}),this.nPlayer.on(Z.Events.LOADING_COMPLETE,t=>{var i;b.info("FlvPlayer Events.LOADING_COMPLETE",t),(i=this.context)==null||i.emit(w.PULL_STREAM_FAILED,this.url)}),this.nPlayer.on(Z.Events.STATISTICS_INFO,t=>{this.cacheInfo=t})}getBandwidthEstimate(){return this.cacheInfo.speed||0}}m(he,"Events",Z.Events);class Zi extends Ht{constructor(t,i){super(t,i);m(this,"nPlayer");b.info("HlsPlayer - 创建 HlsPlayer",t)}load(t,i=!1){return this.checkUrl(t,i)?(this.nPlayer&&this.recordPlayStatus(t),new Promise(r=>{this.createHlsInstance().then(a=>{a&&(this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}),this.registerHlsListeners(),this.nPlayer.on(Q.Events.MANIFEST_LOADED,()=>{this.setUrl(t)}),this.nPlayer.loadSource(t),this.nPlayer.attachMedia(this.video),r(!0)})})):Promise.reject(!1)}reload(){return this.load(this.cacheUrl||this.url,!0)}async createHlsInstance(){if(!Q.isSupported())throw b.error("HlsPlayer - hls not supported"),Error("hls not supported");let t=await this.destroy();return this.nPlayer=new Q({...this.options.hlsOptions||{},fLoader:window.peer5&&window.peer5.HlsJsFragmentLoader,pLoader:window.peer5&&window.peer5.HlsJsPlaylistLoader}),t}destroy(){return new Promise(t=>{this.nPlayer?(this.nPlayer.once(Q.Events.MEDIA_DETACHED,()=>{t(!0)}),this.nPlayer.destroy()):t(!1)})}registerHlsListeners(){this.nPlayer.on(Q.Events.ERROR,(t,i)=>{var s,o;b.error("HlsPlayer Events.ERROR",t,i),(s=this.context)==null||s.emit(w.HLS_ERROR,i);let{details:r,type:a}=i;a===Q.ErrorTypes.NETWORK_ERROR&&(r===Q.ErrorDetails.MANIFEST_LOAD_ERROR||r===Q.ErrorDetails.MANIFEST_LOAD_TIMEOUT||r===Q.ErrorDetails.LEVEL_LOAD_ERROR||r===Q.ErrorDetails.LEVEL_LOAD_TIMEOUT)&&((o=this.context)==null||o.emit(w.PULL_STREAM_FAILED,this.url))})}getBandwidthEstimate(){return this.nPlayer.bandwidthEstimate/8192}}m(Zi,"Events",Q.Events);class zn extends Ht{constructor(t,i){super(t,i);m(this,"nPlayer");b.info("DashPlayer - 创建 DashPlayer")}load(t,i){return this.checkUrl(t,i)?(this.nPlayer&&this.recordPlayStatus(t),new Promise(r=>{this.createHlsInstance().then(a=>{a&&(this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}),this.registerHlsListeners(),this.nPlayer.on(be.MediaPlayer.events.MANIFEST_LOADED,()=>{this.setUrl(t)}),this.nPlayer.initialize(this.video,t,!0),r(!0)})})):Promise.reject(!1)}async createHlsInstance(){if(!be.supportsMediaSource())throw b.error("DashPlayer - dash not supported"),Error("dash not supported");let t=await this.destroy();return this.nPlayer=be.MediaPlayer().create(),t}registerHlsListeners(){}reload(){return this.load(this.cacheUrl||this.url,!0)}destroy(){return new Promise(t=>{this.nPlayer?(this.nPlayer.destroy(),t(!0)):t(!1)})}getBandwidthEstimate(){return 0}}m(zn,"Events",be.MediaPlayer.events);const Hn={timeWait:5e3,timeLazy:15e3,timesReached:-1,timesMax:-1,isInterval:!0};class ul{constructor(e=Hn){m(this,"timeWait");m(this,"timeLazy");m(this,"timesReached");m(this,"timesMax");m(this,"isInterval");m(this,"times",0);m(this,"fn");m(this,"timer",0);m(this,"executing",!1);let t=Object.assign({},Hn,e);b.info("TaskLoop config",t),this.timeWait=t.timeWait,this.timeLazy=t.timeLazy,this.timesReached=t.timesReached,this.timesMax=t.timesMax,this.isInterval=t.isInterval}setCallback(e){return this.fn=e,this}setIsInterval(e){return this.isInterval=e,this}setTimeWait(e){this.isInterval?clearInterval(this.timer):clearTimeout(this.timer),this.timeWait=e}setInterval(){this.timer=window.setInterval(()=>{this.checkTimesReached()||(this.fn(),this.times+=1)},this.timeWait)}checkTimesReached(){return this.timesMax!==-1&&this.times>=this.timesMax?(this.destroy(),b.warn("TaskLoop checkTimesReached - Interval Reach the top, stopped"),!0):(this.timesReached!==-1&&this.timeWait!==this.timeLazy&&this.times>=this.timesReached&&(b.warn("TaskLoop checkTimesReached - Interval Reach the top, set lazy"),this.setTimeWait(this.timeLazy),this.isInterval&&this.setInterval()),!1)}execute(){if(!this.executing){if(this.isInterval)this.setInterval();else{if(this.checkTimesReached())return;this.timer=window.setTimeout(this.fn,this.timeWait),this.times+=1}this.executing=!0}}destroy(){this.isInterval?clearInterval(this.timer):clearTimeout(this.timer),this.times=0,this.executing=!1}}const hl={length:0,start:()=>0,end:()=>0};function Gn(n){try{return n.buffered}catch(e){return b.warn("failed to get media.buffered",e),hl}}function Gt(n){try{let e=Gn(n);return e.length?e.end(e.length-1):0}catch(e){return b.warn("failed to get last media.buffered",e),0}}var de=(n=>(n.ManifestLoading="ManifestLoading",n.ManifestLoaded="ManifestLoaded",n.ManifestParsed="ManifestParsed",n.TsLoading="TsLoading",n.TsLoaded="TsLoaded",n.Muxed="Muxed",n.Play="play",n.Pause="pause",n.Ratechange="ratechange",n.Stalled="stalled",n))(de||{});class dl{constructor(e){m(this,"video");m(this,"ms");m(this,"objectUrl");m(this,"hls");m(this,"sourceBuffer");m(this,"taskLoop");m(this,"stats","Idle");m(this,"segmentTracker",{});m(this,"playManifest");m(this,"isSeeking",!1);m(this,"nextSegmentIndex",0);m(this,"onMediaSourceOpen",()=>{var a;const{ms:e,hls:t}=this;let i='video/mp4; codecs="avc1.42E01E, mp4a.40.2"',r=e.addSourceBuffer(i);r.addEventListener("updateend",this.updateEnd),this.sourceBuffer=r,(a=t.loader.m3u8Promise)==null||a.then(s=>{s.endList&&(e.duration=s.totalDuration),this.taskLoop=new ul({timeWait:500}),this.taskLoop.setCallback(this.tick).execute()})});m(this,"onMediaSourceEnded",()=>{b.info("onMediaSourceEnded")});m(this,"onMediaSourceClose",()=>{b.info("onMediaSourceClose")});m(this,"onSeeking",()=>{this.isSeeking=!0;let{video:e}=this,t=Gt(e);console.log("ana onSeeking",e.currentTime,t),this.nextSegmentIndex=this.findSegmentIndex(e.currentTime)});m(this,"onSeeked",()=>{this.isSeeking=!1;let{video:e}=this,t=Gn(e);console.log("ana onSeeked",e.currentTime,t.end(0))});m(this,"tick",()=>{switch(this.stats){case"Idle":this.checkFetchNextSegment();break}});m(this,"updateEnd",()=>{const{ms:e,hls:t}=this;let{playManifest:i,segmentIndex:r}=t.loader;if(!this.sourceBuffer.updating&&e.readyState==="open"&&r===i.segments.length-1){this.stats="Ended",this.taskLoop.destroy(),e.endOfStream();return}this.stats="Idle"});this.hls=e,this.register()}register(){this.hls.on(de.ManifestParsed,e=>{b.info("Events.ManifestParsed",e),this.playManifest=e}),this.hls.on(de.TsLoading,e=>{this.stats="TsLoading"}),this.hls.on(de.TsLoaded,e=>{this.stats="TsLoaded",this.segmentTracker[e.segment.index]=!0}),this.hls.on(de.Muxed,e=>{b.info("getBufferedLast",Gt(this.sourceBuffer)),this.sourceBuffer.appendBuffer(e)})}attachMedia(e){const t=this.video=e,i=this.ms=new MediaSource;i.addEventListener("sourceopen",this.onMediaSourceOpen),i.addEventListener("sourceended",this.onMediaSourceEnded),i.addEventListener("sourceclose",this.onMediaSourceClose),e.addEventListener("seeking",this.onSeeking),e.addEventListener("seeked",this.onSeeked),t.src=self.URL.createObjectURL(i),this.objectUrl=t.src}checkFetchNextSegment(){let{hls:i,video:r}=this,a=Gt(r);b.info("buffered",r.currentTime,a),this.nextSegmentIndex?(this.checkBuffered(this.nextSegmentIndex)||i.loader.getTsData(this.nextSegmentIndex),this.nextSegmentIndex=0):r.currentTime>=a-(r.paused?60:10)&&i.loader.getTsData()}findSegmentIndex(e){let{playManifest:t}=this,i=0,r,a=Math.floor(e/t.avgDuration),s=a<10?0:a-10,o=t.segments.length;for(;s<o;s++)if(r=t.segments[s],i+=r.duration,i>=e)return r.index;return 0}checkBuffered(e){return this.segmentTracker[e]}}var Ke=function(){this.init=function(){var e={};this.on=function(t,i){e[t]||(e[t]=[]),e[t]=e[t].concat(i)},this.off=function(t,i){var r;return e[t]?(r=e[t].indexOf(i),e[t]=e[t].slice(),e[t].splice(r,1),r>-1):!1},this.trigger=function(t){var i,r,a,s;if(i=e[t],!!i)if(arguments.length===2)for(a=i.length,r=0;r<a;++r)i[r].call(this,arguments[1]);else{for(s=[],r=arguments.length,r=1;r<arguments.length;++r)s.push(arguments[r]);for(a=i.length,r=0;r<a;++r)i[r].apply(this,s)}},this.dispose=function(){e={}}}};Ke.prototype.pipe=function(n){return this.on("data",function(e){n.push(e)}),this.on("done",function(e){n.flush(e)}),this.on("partialdone",function(e){n.partialFlush(e)}),this.on("endedtimeline",function(e){n.endTimeline(e)}),this.on("reset",function(e){n.reset(e)}),n},Ke.prototype.push=function(n){this.trigger("data",n)},Ke.prototype.flush=function(n){this.trigger("done",n)},Ke.prototype.partialFlush=function(n){this.trigger("partialdone",n)},Ke.prototype.endTimeline=function(n){this.trigger("endedtimeline",n)},Ke.prototype.reset=function(n){this.trigger("reset",n)};var le=Ke,er=9e4,tr,ir,qt,rr,qn,Wn,Xn;tr=function(e){return e*er},ir=function(e,t){return e*t},qt=function(e){return e/er},rr=function(e,t){return e/t},qn=function(e,t){return tr(rr(e,t))},Wn=function(e,t){return ir(qt(e),t)},Xn=function(e,t,i){return qt(i?e:e-t)};var Be={ONE_SECOND_IN_TS:er,secondsToVideoTs:tr,secondsToAudioTs:ir,videoTsToSeconds:qt,audioTsToSeconds:rr,audioTsToVideoTs:qn,videoTsToAudioTs:Wn,metadataTsToSeconds:Xn},cl=le,fl=Be.ONE_SECOND_IN_TS,Wt,Yn=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];Wt=function(e){var t,i=0;Wt.prototype.init.call(this),this.skipWarn_=function(r,a){this.trigger("log",{level:"warn",message:"adts skiping bytes "+r+" to "+a+" in frame "+i+" outside syncword"})},this.push=function(r){var a=0,s,o,l,u,h;if(e||(i=0),r.type==="audio"){t&&t.length?(l=t,t=new Uint8Array(l.byteLength+r.data.byteLength),t.set(l),t.set(r.data,l.byteLength)):t=r.data;for(var d;a+7<t.length;){if(t[a]!==255||(t[a+1]&246)!==240){typeof d!="number"&&(d=a),a++;continue}if(typeof d=="number"&&(this.skipWarn_(d,a),d=null),o=(~t[a+1]&1)*2,s=(t[a+3]&3)<<11|t[a+4]<<3|(t[a+5]&224)>>5,u=((t[a+6]&3)+1)*1024,h=u*fl/Yn[(t[a+2]&60)>>>2],t.byteLength-a<s)break;this.trigger("data",{pts:r.pts+i*h,dts:r.dts+i*h,sampleCount:u,audioobjecttype:(t[a+2]>>>6&3)+1,channelcount:(t[a+2]&1)<<2|(t[a+3]&192)>>>6,samplerate:Yn[(t[a+2]&60)>>>2],samplingfrequencyindex:(t[a+2]&60)>>>2,samplesize:16,data:t.subarray(a+7+o,a+s)}),i++,a+=s}typeof d=="number"&&(this.skipWarn_(d,a),d=null),t=t.subarray(a)}},this.flush=function(){i=0,this.trigger("done")},this.reset=function(){t=void 0,this.trigger("reset")},this.endTimeline=function(){t=void 0,this.trigger("endedtimeline")}},Wt.prototype=new cl;var Xt=Wt,Kn;Kn=function(e){var t=e.byteLength,i=0,r=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+r},this.loadWord=function(){var a=e.byteLength-t,s=new Uint8Array(4),o=Math.min(4,t);if(o===0)throw new Error("no bytes available");s.set(e.subarray(a,a+o)),i=new DataView(s.buffer).getUint32(0),r=o*8,t-=o},this.skipBits=function(a){var s;r>a?(i<<=a,r-=a):(a-=r,s=Math.floor(a/8),a-=s*8,t-=s,this.loadWord(),i<<=a,r-=a)},this.readBits=function(a){var s=Math.min(r,a),o=i>>>32-s;return r-=s,r>0?i<<=s:t>0&&this.loadWord(),s=a-s,s>0?o<<s|this.readBits(s):o},this.skipLeadingZeros=function(){var a;for(a=0;a<r;++a)if(i&2147483648>>>a)return i<<=a,r-=a,a;return this.loadWord(),a+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var a=this.skipLeadingZeros();return this.readBits(a+1)-1},this.readExpGolomb=function(){var a=this.readUnsignedExpGolomb();return 1&a?1+a>>>1:-1*(a>>>1)},this.readBoolean=function(){return this.readBits(1)===1},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var pl=Kn,Qn=le,ml=pl,Yt,Tt,jn;Tt=function(){var e=0,t,i;Tt.prototype.init.call(this),this.push=function(r){var a;i?(a=new Uint8Array(i.byteLength+r.data.byteLength),a.set(i),a.set(r.data,i.byteLength),i=a):i=r.data;for(var s=i.byteLength;e<s-3;e++)if(i[e+2]===1){t=e+5;break}for(;t<s;)switch(i[t]){case 0:if(i[t-1]!==0){t+=2;break}else if(i[t-2]!==0){t++;break}e+3!==t-2&&this.trigger("data",i.subarray(e+3,t-2));do t++;while(i[t]!==1&&t<s);e=t-2,t+=3;break;case 1:if(i[t-1]!==0||i[t-2]!==0){t+=3;break}this.trigger("data",i.subarray(e+3,t-2)),e=t-2,t+=3;break;default:t+=3;break}i=i.subarray(e),t-=e,e=0},this.reset=function(){i=null,e=0,this.trigger("reset")},this.flush=function(){i&&i.byteLength>3&&this.trigger("data",i.subarray(e+3)),i=null,e=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},Tt.prototype=new Qn,jn={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},Yt=function(){var e=new Tt,t,i,r,a,s,o,l;Yt.prototype.init.call(this),t=this,this.push=function(u){u.type==="video"&&(i=u.trackId,r=u.pts,a=u.dts,e.push(u))},e.on("data",function(u){var h={trackId:i,pts:r,dts:a,data:u,nalUnitTypeCode:u[0]&31};switch(h.nalUnitTypeCode){case 5:h.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:h.nalUnitType="sei_rbsp",h.escapedRBSP=s(u.subarray(1));break;case 7:h.nalUnitType="seq_parameter_set_rbsp",h.escapedRBSP=s(u.subarray(1)),h.config=o(h.escapedRBSP);break;case 8:h.nalUnitType="pic_parameter_set_rbsp";break;case 9:h.nalUnitType="access_unit_delimiter_rbsp";break}t.trigger("data",h)}),e.on("done",function(){t.trigger("done")}),e.on("partialdone",function(){t.trigger("partialdone")}),e.on("reset",function(){t.trigger("reset")}),e.on("endedtimeline",function(){t.trigger("endedtimeline")}),this.flush=function(){e.flush()},this.partialFlush=function(){e.partialFlush()},this.reset=function(){e.reset()},this.endTimeline=function(){e.endTimeline()},l=function(h,d){var c=8,y=8,f,g;for(f=0;f<h;f++)y!==0&&(g=d.readExpGolomb(),y=(c+g+256)%256),c=y===0?c:y},s=function(h){for(var d=h.byteLength,c=[],y=1,f,g;y<d-2;)h[y]===0&&h[y+1]===0&&h[y+2]===3?(c.push(y+2),y+=2):y++;if(c.length===0)return h;f=d-c.length,g=new Uint8Array(f);var p=0;for(y=0;y<f;p++,y++)p===c[0]&&(p++,c.shift()),g[y]=h[p];return g},o=function(h){var d=0,c=0,y=0,f=0,g,p,x,_,T,E,P,N,H,S,F,v=[1,1],L,A;if(g=new ml(h),p=g.readUnsignedByte(),_=g.readUnsignedByte(),x=g.readUnsignedByte(),g.skipUnsignedExpGolomb(),jn[p]&&(T=g.readUnsignedExpGolomb(),T===3&&g.skipBits(1),g.skipUnsignedExpGolomb(),g.skipUnsignedExpGolomb(),g.skipBits(1),g.readBoolean()))for(F=T!==3?8:12,A=0;A<F;A++)g.readBoolean()&&(A<6?l(16,g):l(64,g));if(g.skipUnsignedExpGolomb(),E=g.readUnsignedExpGolomb(),E===0)g.readUnsignedExpGolomb();else if(E===1)for(g.skipBits(1),g.skipExpGolomb(),g.skipExpGolomb(),P=g.readUnsignedExpGolomb(),A=0;A<P;A++)g.skipExpGolomb();if(g.skipUnsignedExpGolomb(),g.skipBits(1),N=g.readUnsignedExpGolomb(),H=g.readUnsignedExpGolomb(),S=g.readBits(1),S===0&&g.skipBits(1),g.skipBits(1),g.readBoolean()&&(d=g.readUnsignedExpGolomb(),c=g.readUnsignedExpGolomb(),y=g.readUnsignedExpGolomb(),f=g.readUnsignedExpGolomb()),g.readBoolean()&&g.readBoolean()){switch(L=g.readUnsignedByte(),L){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:{v=[g.readUnsignedByte()<<8|g.readUnsignedByte(),g.readUnsignedByte()<<8|g.readUnsignedByte()];break}}v&&v[0]/v[1]}return{profileIdc:p,levelIdc:x,profileCompatibility:_,width:(N+1)*16-d*2-c*2,height:(2-S)*(H+1)*16-y*2-f*2,sarRatio:v}}},Yt.prototype=new Qn;var nr={H264Stream:Yt,NalByteStream:Tt},Jn={Adts:Xt,h264:nr},Zn=Math.pow(2,32)-1,C,ea,ta,ar,ia,ra,na,aa,sr,sa,oa,la,ua,ha,da,ca,fa,pa,ma,ga,ya,or,I,lr,va,xa,ba,Sa,Ta,wa,Ea,_a,Kt,Pa,Aa,Oa;(function(){var n;if(I={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},!(typeof Uint8Array>"u")){for(n in I)I.hasOwnProperty(n)&&(I[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);lr=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),xa=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),va=new Uint8Array([0,0,0,1]),ba=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),Sa=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),Ta={video:ba,audio:Sa},_a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),Ea=new Uint8Array([0,0,0,0,0,0,0,0]),Kt=new Uint8Array([0,0,0,0,0,0,0,0]),Pa=Kt,Aa=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Oa=Kt,wa=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),C=function(e){var t=[],i=0,r,a,s;for(r=1;r<arguments.length;r++)t.push(arguments[r]);for(r=t.length;r--;)i+=t[r].byteLength;for(a=new Uint8Array(i+8),s=new DataView(a.buffer,a.byteOffset,a.byteLength),s.setUint32(0,a.byteLength),a.set(e,4),r=0,i=8;r<t.length;r++)a.set(t[r],i),i+=t[r].byteLength;return a},ea=function(){return C(I.dinf,C(I.dref,_a))},ta=function(e){return C(I.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},ar=function(){return C(I.ftyp,lr,va,lr,xa)},ca=function(e){return C(I.hdlr,Ta[e])},ia=function(e){return C(I.mdat,e)},da=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,e.duration&255,85,196,0,0]);return e.samplerate&&(t[12]=e.samplerate>>>24&255,t[13]=e.samplerate>>>16&255,t[14]=e.samplerate>>>8&255,t[15]=e.samplerate&255),C(I.mdhd,t)},ha=function(e){return C(I.mdia,da(e),ca(e.type),na(e))},ra=function(e){return C(I.mfhd,new Uint8Array([0,0,0,0,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255]))},na=function(e){return C(I.minf,e.type==="video"?C(I.vmhd,wa):C(I.smhd,Ea),ea(),pa(e))},aa=function(e,t){for(var i=[],r=t.length;r--;)i[r]=ga(t[r]);return C.apply(null,[I.moof,ra(e)].concat(i))},sr=function(e){for(var t=e.length,i=[];t--;)i[t]=la(e[t]);return C.apply(null,[I.moov,oa(4294967295)].concat(i).concat(sa(e)))},sa=function(e){for(var t=e.length,i=[];t--;)i[t]=ya(e[t]);return C.apply(null,[I.mvex].concat(i))},oa=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return C(I.mvhd,t)},fa=function(e){var t=e.samples||[],i=new Uint8Array(4+t.length),r,a;for(a=0;a<t.length;a++)r=t[a].flags,i[a+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return C(I.sdtp,i)},pa=function(e){return C(I.stbl,ma(e),C(I.stts,Oa),C(I.stsc,Pa),C(I.stsz,Aa),C(I.stco,Kt))},function(){var n,e;ma=function(i){return C(I.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),i.type==="video"?n(i):e(i))},n=function(i){var r=i.sps||[],a=i.pps||[],s=[],o=[],l,u;for(l=0;l<r.length;l++)s.push((r[l].byteLength&65280)>>>8),s.push(r[l].byteLength&255),s=s.concat(Array.prototype.slice.call(r[l]));for(l=0;l<a.length;l++)o.push((a[l].byteLength&65280)>>>8),o.push(a[l].byteLength&255),o=o.concat(Array.prototype.slice.call(a[l]));if(u=[I.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(i.width&65280)>>8,i.width&255,(i.height&65280)>>8,i.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),C(I.avcC,new Uint8Array([1,i.profileIdc,i.profileCompatibility,i.levelIdc,255].concat([r.length],s,[a.length],o))),C(I.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],i.sarRatio){var h=i.sarRatio[0],d=i.sarRatio[1];u.push(C(I.pasp,new Uint8Array([(h&4278190080)>>24,(h&16711680)>>16,(h&65280)>>8,h&255,(d&4278190080)>>24,(d&16711680)>>16,(d&65280)>>8,d&255])))}return C.apply(null,u)},e=function(i){return C(I.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(i.channelcount&65280)>>8,i.channelcount&255,(i.samplesize&65280)>>8,i.samplesize&255,0,0,0,0,(i.samplerate&65280)>>8,i.samplerate&255,0,0]),ta(i))}}(),ua=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,0,(e.duration&4278190080)>>24,(e.duration&16711680)>>16,(e.duration&65280)>>8,e.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(e.width&65280)>>8,e.width&255,0,0,(e.height&65280)>>8,e.height&255,0,0]);return C(I.tkhd,t)},ga=function(e){var t,i,r,a,s,o,l;return t=C(I.tfhd,new Uint8Array([0,0,0,58,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),o=Math.floor(e.baseMediaDecodeTime/(Zn+1)),l=Math.floor(e.baseMediaDecodeTime%(Zn+1)),i=C(I.tfdt,new Uint8Array([1,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,o&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255])),s=32+20+8+16+8+8,e.type==="audio"?(r=or(e,s),C(I.traf,t,i,r)):(a=fa(e),r=or(e,a.length+s),C(I.traf,t,i,r,a))},la=function(e){return e.duration=e.duration||4294967295,C(I.trak,ua(e),ha(e))},ya=function(e){var t=new Uint8Array([0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.type!=="video"&&(t[t.length-1]=0),C(I.trex,t)},function(){var n,e,t;t=function(r,a){var s=0,o=0,l=0,u=0;return r.length&&(r[0].duration!==void 0&&(s=1),r[0].size!==void 0&&(o=2),r[0].flags!==void 0&&(l=4),r[0].compositionTimeOffset!==void 0&&(u=8)),[0,0,s|o|l|u,1,(r.length&4278190080)>>>24,(r.length&16711680)>>>16,(r.length&65280)>>>8,r.length&255,(a&4278190080)>>>24,(a&16711680)>>>16,(a&65280)>>>8,a&255]},e=function(r,a){var s,o,l,u,h,d;for(u=r.samples||[],a+=8+12+16*u.length,l=t(u,a),o=new Uint8Array(l.length+u.length*16),o.set(l),s=l.length,d=0;d<u.length;d++)h=u[d],o[s++]=(h.duration&4278190080)>>>24,o[s++]=(h.duration&16711680)>>>16,o[s++]=(h.duration&65280)>>>8,o[s++]=h.duration&255,o[s++]=(h.size&4278190080)>>>24,o[s++]=(h.size&16711680)>>>16,o[s++]=(h.size&65280)>>>8,o[s++]=h.size&255,o[s++]=h.flags.isLeading<<2|h.flags.dependsOn,o[s++]=h.flags.isDependedOn<<6|h.flags.hasRedundancy<<4|h.flags.paddingValue<<1|h.flags.isNonSyncSample,o[s++]=h.flags.degradationPriority&240<<8,o[s++]=h.flags.degradationPriority&15,o[s++]=(h.compositionTimeOffset&4278190080)>>>24,o[s++]=(h.compositionTimeOffset&16711680)>>>16,o[s++]=(h.compositionTimeOffset&65280)>>>8,o[s++]=h.compositionTimeOffset&255;return C(I.trun,o)},n=function(r,a){var s,o,l,u,h,d;for(u=r.samples||[],a+=8+12+8*u.length,l=t(u,a),s=new Uint8Array(l.length+u.length*8),s.set(l),o=l.length,d=0;d<u.length;d++)h=u[d],s[o++]=(h.duration&4278190080)>>>24,s[o++]=(h.duration&16711680)>>>16,s[o++]=(h.duration&65280)>>>8,s[o++]=h.duration&255,s[o++]=(h.size&4278190080)>>>24,s[o++]=(h.size&16711680)>>>16,s[o++]=(h.size&65280)>>>8,s[o++]=h.size&255;return C(I.trun,s)},or=function(r,a){return r.type==="audio"?n(r,a):e(r,a)}}();var Qt={ftyp:ar,mdat:ia,moof:aa,moov:sr,initSegment:function(e){var t=ar(),i=sr(e),r;return r=new Uint8Array(t.byteLength+i.byteLength),r.set(t),r.set(i,t.byteLength),r}},gl=function(e){return e>>>0},yl=function(e){return("00"+e.toString(16)).slice(-2)},jt={toUnsigned:gl,toHexString:yl},vl=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3]),t},ur=vl,xl=jt.toUnsigned,bl=ur,Sl=function n(e,t){var i=[],r,a,s,o,l;if(!t.length)return null;for(r=0;r<e.byteLength;)a=xl(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]),s=bl(e.subarray(r+4,r+8)),o=a>1?r+a:e.byteLength,s===t[0]&&(t.length===1?i.push(e.subarray(r+8,o)):(l=n(e.subarray(r+8,o),t.slice(1)),l.length&&(i=i.concat(l)))),r=o;return i},hr=Sl,Tl=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4)},r=i.flags[2]&1,a=i.flags[2]&2,s=i.flags[2]&8,o=i.flags[2]&16,l=i.flags[2]&32,u=i.flags[0]&65536,h=i.flags[0]&131072,d;return d=8,r&&(d+=4,i.baseDataOffset=t.getUint32(12),d+=4),a&&(i.sampleDescriptionIndex=t.getUint32(d),d+=4),s&&(i.defaultSampleDuration=t.getUint32(d),d+=4),o&&(i.defaultSampleSize=t.getUint32(d),d+=4),l&&(i.defaultSampleFlags=t.getUint32(d)),u&&(i.durationIsEmpty=!0),!r&&h&&(i.baseDataOffsetIsMoof=!0),i},dr=Tl,wl=function(e){return{isLeading:(e[0]&12)>>>2,dependsOn:e[0]&3,isDependedOn:(e[1]&192)>>>6,hasRedundancy:(e[1]&48)>>>4,paddingValue:(e[1]&14)>>>1,isNonSyncSample:e[1]&1,degradationPriority:e[2]<<8|e[3]}},El=wl,Ra=El,_l=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},i=new DataView(e.buffer,e.byteOffset,e.byteLength),r=t.flags[2]&1,a=t.flags[2]&4,s=t.flags[1]&1,o=t.flags[1]&2,l=t.flags[1]&4,u=t.flags[1]&8,h=i.getUint32(4),d=8,c;for(r&&(t.dataOffset=i.getInt32(d),d+=4),a&&h&&(c={flags:Ra(e.subarray(d,d+4))},d+=4,s&&(c.duration=i.getUint32(d),d+=4),o&&(c.size=i.getUint32(d),d+=4),u&&(t.version===1?c.compositionTimeOffset=i.getInt32(d):c.compositionTimeOffset=i.getUint32(d),d+=4),t.samples.push(c),h--);h--;)c={},s&&(c.duration=i.getUint32(d),d+=4),o&&(c.size=i.getUint32(d),d+=4),l&&(c.flags=Ra(e.subarray(d,d+4)),d+=4),u&&(t.version===1?c.compositionTimeOffset=i.getInt32(d):c.compositionTimeOffset=i.getUint32(d),d+=4),t.samples.push(c);return t},cr=_l,Ia=jt.toUnsigned,Pl=function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),baseMediaDecodeTime:Ia(e[4]<<24|e[5]<<16|e[6]<<8|e[7])};return t.version===1&&(t.baseMediaDecodeTime*=Math.pow(2,32),t.baseMediaDecodeTime+=Ia(e[8]<<24|e[9]<<16|e[10]<<8|e[11])),t},fr=Pl,rt=jt.toUnsigned,wt=jt.toHexString,j=hr,nt=ur,Al=dr,Ol=cr,Rl=fr,La,Ca,Da,Fa,Ma,pr;La=function(e){var t={},i=j(e,["moov","trak"]);return i.reduce(function(r,a){var s,o,l,u,h;return s=j(a,["tkhd"])[0],!s||(o=s[0],l=o===0?12:20,u=rt(s[l]<<24|s[l+1]<<16|s[l+2]<<8|s[l+3]),h=j(a,["mdia","mdhd"])[0],!h)?null:(o=h[0],l=o===0?12:20,r[u]=rt(h[l]<<24|h[l+1]<<16|h[l+2]<<8|h[l+3]),r)},t)},Ca=function(e,t){var i,r,a;return i=j(t,["moof","traf"]),r=[].concat.apply([],i.map(function(s){return j(s,["tfhd"]).map(function(o){var l,u,h;return l=rt(o[4]<<24|o[5]<<16|o[6]<<8|o[7]),u=e[l]||9e4,h=j(s,["tfdt"]).map(function(d){var c,y;return c=d[0],y=rt(d[4]<<24|d[5]<<16|d[6]<<8|d[7]),c===1&&(y*=Math.pow(2,32),y+=rt(d[8]<<24|d[9]<<16|d[10]<<8|d[11])),y})[0],h=typeof h=="number"&&!isNaN(h)?h:1/0,h/u})})),a=Math.min.apply(null,r),isFinite(a)?a:0},Da=function(e,t){var i=j(t,["moof","traf"]),r=0,a=0,s;if(i&&i.length){var o=j(i[0],["tfhd"])[0],l=j(i[0],["trun"])[0],u=j(i[0],["tfdt"])[0];if(o){var h=Al(o);s=h.trackId}if(u){var d=Rl(u);r=d.baseMediaDecodeTime}if(l){var c=Ol(l);c.samples&&c.samples.length&&(a=c.samples[0].compositionTimeOffset||0)}}var y=e[s]||9e4;return(r+a)/y},Fa=function(e){var t=j(e,["moov","trak"]),i=[];return t.forEach(function(r){var a=j(r,["mdia","hdlr"]),s=j(r,["tkhd"]);a.forEach(function(o,l){var u=nt(o.subarray(8,12)),h=s[l],d,c,y;u==="vide"&&(d=new DataView(h.buffer,h.byteOffset,h.byteLength),c=d.getUint8(0),y=c===0?d.getUint32(12):d.getUint32(20),i.push(y))})}),i},pr=function(e){var t=e[0],i=t===0?12:20;return rt(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3])},Ma=function(e){var t=j(e,["moov","trak"]),i=[];return t.forEach(function(r){var a={},s=j(r,["tkhd"])[0],o,l;s&&(o=new DataView(s.buffer,s.byteOffset,s.byteLength),l=o.getUint8(0),a.id=l===0?o.getUint32(12):o.getUint32(20));var u=j(r,["mdia","hdlr"])[0];if(u){var h=nt(u.subarray(8,12));h==="vide"?a.type="video":h==="soun"?a.type="audio":a.type=h}var d=j(r,["mdia","minf","stbl","stsd"])[0];if(d){var c=d.subarray(8);a.codec=nt(c.subarray(4,8));var y=j(c,[a.codec])[0],f,g;y&&(/^[asm]vc[1-9]$/i.test(a.codec)?(f=y.subarray(78),g=nt(f.subarray(4,8)),g==="avcC"&&f.length>11?(a.codec+=".",a.codec+=wt(f[9]),a.codec+=wt(f[10]),a.codec+=wt(f[11])):a.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(a.codec)?(f=y.subarray(28),g=nt(f.subarray(4,8)),g==="esds"&&f.length>20&&f[19]!==0?(a.codec+="."+wt(f[19]),a.codec+="."+wt(f[20]>>>2&63).replace(/^0/,"")):a.codec="mp4a.40.2"):a.codec=a.codec.toLowerCase())}var p=j(r,["mdia","mdhd"])[0];p&&(a.timescale=pr(p)),i.push(a)}),i};var Il={findBox:j,parseType:nt,timescale:La,startTime:Ca,compositionStartTime:Da,videoTrackIds:Fa,tracks:Ma,getTimescaleFromMediaHeader:pr},Ll=function(e){var t,i,r=[],a=[];for(a.byteLength=0,a.nalCount=0,a.duration=0,r.byteLength=0,t=0;t<e.length;t++)i=e[t],i.nalUnitType==="access_unit_delimiter_rbsp"?(r.length&&(r.duration=i.dts-r.dts,a.byteLength+=r.byteLength,a.nalCount+=r.length,a.duration+=r.duration,a.push(r)),r=[i],r.byteLength=i.data.byteLength,r.pts=i.pts,r.dts=i.dts):(i.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(r.keyFrame=!0),r.duration=i.dts-r.dts,r.byteLength+=i.data.byteLength,r.push(i));return a.length&&(!r.duration||r.duration<=0)&&(r.duration=a[a.length-1].duration),a.byteLength+=r.byteLength,a.nalCount+=r.length,a.duration+=r.duration,a.push(r),a},Cl=function(e){var t,i,r=[],a=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=e[0].pts,r.dts=e[0].dts,a.byteLength=0,a.nalCount=0,a.duration=0,a.pts=e[0].pts,a.dts=e[0].dts,t=0;t<e.length;t++)i=e[t],i.keyFrame?(r.length&&(a.push(r),a.byteLength+=r.byteLength,a.nalCount+=r.nalCount,a.duration+=r.duration),r=[i],r.nalCount=i.length,r.byteLength=i.byteLength,r.pts=i.pts,r.dts=i.dts,r.duration=i.duration):(r.duration+=i.duration,r.nalCount+=i.length,r.byteLength+=i.byteLength,r.push(i));return a.length&&r.duration<=0&&(r.duration=a[a.length-1].duration),a.byteLength+=r.byteLength,a.nalCount+=r.nalCount,a.duration+=r.duration,a.push(r),a},Dl=function(e){var t;return!e[0][0].keyFrame&&e.length>1&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},Fl=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},ka=function(e,t){var i=Fl();return i.dataOffset=t,i.compositionTimeOffset=e.pts-e.dts,i.duration=e.duration,i.size=4*e.length,i.size+=e.byteLength,e.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},Ml=function(e,t){var i,r,a,s,o,l=t||0,u=[];for(i=0;i<e.length;i++)for(s=e[i],r=0;r<s.length;r++)o=s[r],a=ka(o,l),l+=a.size,u.push(a);return u},kl=function(e){var t,i,r,a,s,o,l=0,u=e.byteLength,h=e.nalCount,d=u+4*h,c=new Uint8Array(d),y=new DataView(c.buffer);for(t=0;t<e.length;t++)for(a=e[t],i=0;i<a.length;i++)for(s=a[i],r=0;r<s.length;r++)o=s[r],y.setUint32(l,o.data.byteLength),l+=4,c.set(o.data,l),l+=o.data.byteLength;return c},Ul=function(e,t){var i,r=t||0,a=[];return i=ka(e,r),a.push(i),a},Nl=function(e){var t,i,r=0,a=e.byteLength,s=e.length,o=a+4*s,l=new Uint8Array(o),u=new DataView(l.buffer);for(t=0;t<e.length;t++)i=e[t],u.setUint32(r,i.data.byteLength),r+=4,l.set(i.data,r),r+=i.data.byteLength;return l},Ua={groupNalsIntoFrames:Ll,groupFramesIntoGops:Cl,extendFirstKeyFrame:Dl,generateSampleTable:Ml,concatenateNalData:kl,generateSampleTableForFrame:Ul,concatenateNalDataForFrame:Nl},$e=[33,16,5,32,164,27],mr=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],V=function(e){for(var t=[];e--;)t.push(0);return t},Bl=function(e){return Object.keys(e).reduce(function(t,i){return t[i]=new Uint8Array(e[i].reduce(function(r,a){return r.concat(a)},[])),t},{})},gr,$l=function(){if(!gr){var n={96e3:[$e,[227,64],V(154),[56]],88200:[$e,[231],V(170),[56]],64e3:[$e,[248,192],V(240),[56]],48e3:[$e,[255,192],V(268),[55,148,128],V(54),[112]],44100:[$e,[255,192],V(268),[55,163,128],V(84),[112]],32e3:[$e,[255,192],V(268),[55,234],V(226),[112]],24e3:[$e,[255,192],V(268),[55,255,128],V(268),[111,112],V(126),[224]],16e3:[$e,[255,192],V(268),[55,255,128],V(268),[111,255],V(269),[223,108],V(195),[1,192]],12e3:[mr,V(268),[3,127,248],V(268),[6,255,240],V(268),[13,255,224],V(268),[27,253,128],V(259),[56]],11025:[mr,V(268),[3,127,248],V(268),[6,255,240],V(268),[13,255,224],V(268),[27,255,192],V(268),[55,175,128],V(108),[112]],8e3:[mr,V(268),[3,121,16],V(47),[7]]};gr=Bl(n)}return gr},Vl=$l,Jt=Be,zl=function(e){var t,i,r=0;for(t=0;t<e.length;t++)i=e[t],r+=i.data.byteLength;return r},Hl=function(e,t,i,r){var a,s=0,o=0,l=0,u=0,h,d,c;if(t.length&&(a=Jt.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),s=Math.ceil(Jt.ONE_SECOND_IN_TS/(e.samplerate/1024)),i&&r&&(o=a-Math.max(i,r),l=Math.floor(o/s),u=l*s),!(l<1||u>Jt.ONE_SECOND_IN_TS/2))){for(h=Vl()[e.samplerate],h||(h=t[0].data),d=0;d<l;d++)c=t[0],t.splice(0,0,{data:h,dts:c.dts-s,pts:c.pts-s});return e.baseMediaDecodeTime-=Math.floor(Jt.videoTsToAudioTs(u,e.samplerate)),u}},Gl=function(e,t,i){return t.minSegmentDts>=i?e:(t.minSegmentDts=1/0,e.filter(function(r){return r.dts>=i?(t.minSegmentDts=Math.min(t.minSegmentDts,r.dts),t.minSegmentPts=t.minSegmentDts,!0):!1}))},ql=function(e){var t,i,r=[];for(t=0;t<e.length;t++)i=e[t],r.push({size:i.data.byteLength,duration:1024});return r},Wl=function(e){var t,i,r=0,a=new Uint8Array(zl(e));for(t=0;t<e.length;t++)i=e[t],a.set(i.data,r),r+=i.data.byteLength;return a},Na={prefixWithSilence:Hl,trimAdtsFramesByEarliestDts:Gl,generateSampleTable:ql,concatenateFrameData:Wl},Xl=Be.ONE_SECOND_IN_TS,Yl=function(e,t){typeof t.pts=="number"&&(e.timelineStartInfo.pts===void 0&&(e.timelineStartInfo.pts=t.pts),e.minSegmentPts===void 0?e.minSegmentPts=t.pts:e.minSegmentPts=Math.min(e.minSegmentPts,t.pts),e.maxSegmentPts===void 0?e.maxSegmentPts=t.pts:e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)),typeof t.dts=="number"&&(e.timelineStartInfo.dts===void 0&&(e.timelineStartInfo.dts=t.dts),e.minSegmentDts===void 0?e.minSegmentDts=t.dts:e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.maxSegmentDts===void 0?e.maxSegmentDts=t.dts:e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts))},Kl=function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},Ql=function(e,t){var i,r,a=e.minSegmentDts;return t||(a-=e.timelineStartInfo.dts),i=e.timelineStartInfo.baseMediaDecodeTime,i+=a,i=Math.max(0,i),e.type==="audio"&&(r=e.samplerate/Xl,i*=r,i=Math.floor(i)),i},Zt={clearDtsInfo:Kl,calculateTrackBaseMediaDecodeTime:Ql,collectDtsInfo:Yl},Ba=4,jl=128,Jl=function(e){for(var t=0,i={payloadType:-1,payloadSize:0},r=0,a=0;t<e.byteLength&&e[t]!==jl;){for(;e[t]===255;)r+=255,t++;for(r+=e[t++];e[t]===255;)a+=255,t++;if(a+=e[t++],!i.payload&&r===Ba){var s=String.fromCharCode(e[t+3],e[t+4],e[t+5],e[t+6]);if(s==="GA94"){i.payloadType=r,i.payloadSize=a,i.payload=e.subarray(t,t+a);break}else i.payload=void 0}t+=a,r=0,a=0}return i},Zl=function(e){return e.payload[0]!==181||(e.payload[1]<<8|e.payload[2])!==49||String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])!=="GA94"||e.payload[7]!==3?null:e.payload.subarray(8,e.payload.length-1)},eu=function(e,t){var i=[],r,a,s,o;if(!(t[0]&64))return i;for(a=t[0]&31,r=0;r<a;r++)s=r*3,o={type:t[s+2]&3,pts:e},t[s+2]&4&&(o.ccData=t[s+3]<<8|t[s+4],i.push(o));return i},tu=function(e){for(var t=e.byteLength,i=[],r=1,a,s;r<t-2;)e[r]===0&&e[r+1]===0&&e[r+2]===3?(i.push(r+2),r+=2):r++;if(i.length===0)return e;a=t-i.length,s=new Uint8Array(a);var o=0;for(r=0;r<a;o++,r++)o===i[0]&&(o++,i.shift()),s[r]=e[o];return s},$a={parseSei:Jl,parseUserData:Zl,parseCaptionPackets:eu,discardEmulationPreventionBytes:tu,USER_DATA_REGISTERED_ITU_T_T35:Ba},yr=le,ei=$a,ue=function n(e){e=e||{},n.prototype.init.call(this),this.parse708captions_=typeof e.parse708captions=="boolean"?e.parse708captions:!0,this.captionPackets_=[],this.ccStreams_=[new Y(0,0),new Y(0,1),new Y(1,0),new Y(1,1)],this.parse708captions_&&(this.cc708Stream_=new q({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};ue.prototype=new yr,ue.prototype.push=function(n){var e,t,i;if(n.nalUnitType==="sei_rbsp"&&(e=ei.parseSei(n.escapedRBSP),!!e.payload&&e.payloadType===ei.USER_DATA_REGISTERED_ITU_T_T35&&(t=ei.parseUserData(e),!!t))){if(n.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}else if(n.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.numSameDts_--,this.numSameDts_||(this.ignoreNextEqualDts_=!1);return}i=ei.parseCaptionPackets(n.pts,t),this.captionPackets_=this.captionPackets_.concat(i),this.latestDts_!==n.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=n.dts}},ue.prototype.flushCCStreams=function(n){this.ccStreams_.forEach(function(e){return n==="flush"?e.flush():e.partialFlush()},this)},ue.prototype.flushStream=function(n){if(!this.captionPackets_.length){this.flushCCStreams(n);return}this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){e.type<2?this.dispatchCea608Packet(e):this.dispatchCea708Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(n)},ue.prototype.flush=function(){return this.flushStream("flush")},ue.prototype.partialFlush=function(){return this.flushStream("partialFlush")},ue.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(n){n.reset()})},ue.prototype.dispatchCea608Packet=function(n){this.setsTextOrXDSActive(n)?this.activeCea608Channel_[n.type]=null:this.setsChannel1Active(n)?this.activeCea608Channel_[n.type]=0:this.setsChannel2Active(n)&&(this.activeCea608Channel_[n.type]=1),this.activeCea608Channel_[n.type]!==null&&this.ccStreams_[(n.type<<1)+this.activeCea608Channel_[n.type]].push(n)},ue.prototype.setsChannel1Active=function(n){return(n.ccData&30720)===4096},ue.prototype.setsChannel2Active=function(n){return(n.ccData&30720)===6144},ue.prototype.setsTextOrXDSActive=function(n){return(n.ccData&28928)===256||(n.ccData&30974)===4138||(n.ccData&30974)===6186},ue.prototype.dispatchCea708Packet=function(n){this.parse708captions_&&this.cc708Stream_.push(n)};var iu={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},ru=function(e){var t=iu[e]||e;return e&4096&&e===t?"":String.fromCharCode(t)},ti=function(e){return 32<=e&&e<=127||160<=e&&e<=255},Le=function(e){this.windowNum=e,this.reset()};Le.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},Le.prototype.getText=function(){return this.rows.join(`
`)},Le.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},Le.prototype.newLine=function(n){for(this.rows.length>=this.virtualRowCount&&typeof this.beforeRowOverflow=="function"&&this.beforeRowOverflow(n),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},Le.prototype.isEmpty=function(){return this.rows.length===0?!0:this.rows.length===1?this.rows[0]==="":!1},Le.prototype.addText=function(n){this.rows[this.rowIdx]+=n},Le.prototype.backspace=function(){if(!this.isEmpty()){var n=this.rows[this.rowIdx];this.rows[this.rowIdx]=n.substr(0,n.length-1)}};var ii=function(e,t,i){this.serviceNum=e,this.text="",this.currentWindow=new Le(-1),this.windows=[],this.stream=i,typeof t=="string"&&this.createTextDecoder(t)};ii.prototype.init=function(n,e){this.startPts=n;for(var t=0;t<8;t++)this.windows[t]=new Le(t),typeof e=="function"&&(this.windows[t].beforeRowOverflow=e)},ii.prototype.setCurrentWindow=function(n){this.currentWindow=this.windows[n]},ii.prototype.createTextDecoder=function(n){if(typeof TextDecoder>"u")this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(n)}catch(e){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+n+" encoding. "+e})}};var q=function n(e){e=e||{},n.prototype.init.call(this);var t=this,i=e.captionServices||{},r={},a;Object.keys(i).forEach(function(s){a=i[s],/^SERVICE/.test(s)&&(r[s]=a.encoding)}),this.serviceEncodings=r,this.current708Packet=null,this.services={},this.push=function(s){s.type===3?(t.new708Packet(),t.add708Bytes(s)):(t.current708Packet===null&&t.new708Packet(),t.add708Bytes(s))}};q.prototype=new yr,q.prototype.new708Packet=function(){this.current708Packet!==null&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},q.prototype.add708Bytes=function(n){var e=n.ccData,t=e>>>8,i=e&255;this.current708Packet.ptsVals.push(n.pts),this.current708Packet.data.push(t),this.current708Packet.data.push(i)},q.prototype.push708Packet=function(){var n=this.current708Packet,e=n.data,t=null,i=null,r=0,a=e[r++];for(n.seq=a>>6,n.sizeCode=a&63;r<e.length;r++)a=e[r++],t=a>>5,i=a&31,t===7&&i>0&&(a=e[r++],t=a),this.pushServiceBlock(t,r,i),i>0&&(r+=i-1)},q.prototype.pushServiceBlock=function(n,e,t){var i,r=e,a=this.current708Packet.data,s=this.services[n];for(s||(s=this.initService(n,r));r<e+t&&r<a.length;r++)i=a[r],ti(i)?r=this.handleText(r,s):i===24?r=this.multiByteCharacter(r,s):i===16?r=this.extendedCommands(r,s):128<=i&&i<=135?r=this.setCurrentWindow(r,s):152<=i&&i<=159?r=this.defineWindow(r,s):i===136?r=this.clearWindows(r,s):i===140?r=this.deleteWindows(r,s):i===137?r=this.displayWindows(r,s):i===138?r=this.hideWindows(r,s):i===139?r=this.toggleWindows(r,s):i===151?r=this.setWindowAttributes(r,s):i===144?r=this.setPenAttributes(r,s):i===145?r=this.setPenColor(r,s):i===146?r=this.setPenLocation(r,s):i===143?s=this.reset(r,s):i===8?s.currentWindow.backspace():i===12?s.currentWindow.clearText():i===13?s.currentWindow.pendingNewLine=!0:i===14?s.currentWindow.clearText():i===141&&r++},q.prototype.extendedCommands=function(n,e){var t=this.current708Packet.data,i=t[++n];return ti(i)&&(n=this.handleText(n,e,{isExtended:!0})),n},q.prototype.getPts=function(n){return this.current708Packet.ptsVals[Math.floor(n/2)]},q.prototype.initService=function(n,e){var i="SERVICE"+n,t=this,i,r;return i in this.serviceEncodings&&(r=this.serviceEncodings[i]),this.services[n]=new ii(n,r,t),this.services[n].init(this.getPts(e),function(a){t.flushDisplayed(a,t.services[n])}),this.services[n]},q.prototype.handleText=function(n,e,t){var i=t&&t.isExtended,r=t&&t.isMultiByte,a=this.current708Packet.data,s=i?4096:0,o=a[n],l=a[n+1],u=e.currentWindow,h,d;return e.textDecoder_&&!i?(r?(d=[o,l],n++):d=[o],h=e.textDecoder_.decode(new Uint8Array(d))):h=ru(s|o),u.pendingNewLine&&!u.isEmpty()&&u.newLine(this.getPts(n)),u.pendingNewLine=!1,u.addText(h),n},q.prototype.multiByteCharacter=function(n,e){var t=this.current708Packet.data,i=t[n+1],r=t[n+2];return ti(i)&&ti(r)&&(n=this.handleText(++n,e,{isMultiByte:!0})),n},q.prototype.setCurrentWindow=function(n,e){var t=this.current708Packet.data,i=t[n],r=i&7;return e.setCurrentWindow(r),n},q.prototype.defineWindow=function(n,e){var t=this.current708Packet.data,i=t[n],r=i&7;e.setCurrentWindow(r);var a=e.currentWindow;return i=t[++n],a.visible=(i&32)>>5,a.rowLock=(i&16)>>4,a.columnLock=(i&8)>>3,a.priority=i&7,i=t[++n],a.relativePositioning=(i&128)>>7,a.anchorVertical=i&127,i=t[++n],a.anchorHorizontal=i,i=t[++n],a.anchorPoint=(i&240)>>4,a.rowCount=i&15,i=t[++n],a.columnCount=i&63,i=t[++n],a.windowStyle=(i&56)>>3,a.penStyle=i&7,a.virtualRowCount=a.rowCount+1,n},q.prototype.setWindowAttributes=function(n,e){var t=this.current708Packet.data,i=t[n],r=e.currentWindow.winAttr;return i=t[++n],r.fillOpacity=(i&192)>>6,r.fillRed=(i&48)>>4,r.fillGreen=(i&12)>>2,r.fillBlue=i&3,i=t[++n],r.borderType=(i&192)>>6,r.borderRed=(i&48)>>4,r.borderGreen=(i&12)>>2,r.borderBlue=i&3,i=t[++n],r.borderType+=(i&128)>>5,r.wordWrap=(i&64)>>6,r.printDirection=(i&48)>>4,r.scrollDirection=(i&12)>>2,r.justify=i&3,i=t[++n],r.effectSpeed=(i&240)>>4,r.effectDirection=(i&12)>>2,r.displayEffect=i&3,n},q.prototype.flushDisplayed=function(n,e){for(var t=[],i=0;i<8;i++)e.windows[i].visible&&!e.windows[i].isEmpty()&&t.push(e.windows[i].getText());e.endPts=n,e.text=t.join(`

`),this.pushCaption(e),e.startPts=n},q.prototype.pushCaption=function(n){n.text!==""&&(this.trigger("data",{startPts:n.startPts,endPts:n.endPts,text:n.text,stream:"cc708_"+n.serviceNum}),n.text="",n.startPts=n.endPts)},q.prototype.displayWindows=function(n,e){var t=this.current708Packet.data,i=t[++n],r=this.getPts(n);this.flushDisplayed(r,e);for(var a=0;a<8;a++)i&1<<a&&(e.windows[a].visible=1);return n},q.prototype.hideWindows=function(n,e){var t=this.current708Packet.data,i=t[++n],r=this.getPts(n);this.flushDisplayed(r,e);for(var a=0;a<8;a++)i&1<<a&&(e.windows[a].visible=0);return n},q.prototype.toggleWindows=function(n,e){var t=this.current708Packet.data,i=t[++n],r=this.getPts(n);this.flushDisplayed(r,e);for(var a=0;a<8;a++)i&1<<a&&(e.windows[a].visible^=1);return n},q.prototype.clearWindows=function(n,e){var t=this.current708Packet.data,i=t[++n],r=this.getPts(n);this.flushDisplayed(r,e);for(var a=0;a<8;a++)i&1<<a&&e.windows[a].clearText();return n},q.prototype.deleteWindows=function(n,e){var t=this.current708Packet.data,i=t[++n],r=this.getPts(n);this.flushDisplayed(r,e);for(var a=0;a<8;a++)i&1<<a&&e.windows[a].reset();return n},q.prototype.setPenAttributes=function(n,e){var t=this.current708Packet.data,i=t[n],r=e.currentWindow.penAttr;return i=t[++n],r.textTag=(i&240)>>4,r.offset=(i&12)>>2,r.penSize=i&3,i=t[++n],r.italics=(i&128)>>7,r.underline=(i&64)>>6,r.edgeType=(i&56)>>3,r.fontStyle=i&7,n},q.prototype.setPenColor=function(n,e){var t=this.current708Packet.data,i=t[n],r=e.currentWindow.penColor;return i=t[++n],r.fgOpacity=(i&192)>>6,r.fgRed=(i&48)>>4,r.fgGreen=(i&12)>>2,r.fgBlue=i&3,i=t[++n],r.bgOpacity=(i&192)>>6,r.bgRed=(i&48)>>4,r.bgGreen=(i&12)>>2,r.bgBlue=i&3,i=t[++n],r.edgeRed=(i&48)>>4,r.edgeGreen=(i&12)>>2,r.edgeBlue=i&3,n},q.prototype.setPenLocation=function(n,e){var t=this.current708Packet.data,i=t[n],r=e.currentWindow.penLoc;return e.currentWindow.pendingNewLine=!0,i=t[++n],r.row=i&15,i=t[++n],r.column=i&63,n},q.prototype.reset=function(n,e){var t=this.getPts(n);return this.flushDisplayed(t,e),this.initService(e.serviceNum,n)};var nu={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},ri=function(e){return e===null?"":(e=nu[e]||e,String.fromCharCode(e))},ni=14,au=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Qe=function(){for(var e=[],t=ni+1;t--;)e.push("");return e},Y=function n(e,t){n.prototype.init.call(this),this.field_=e||0,this.dataChannel_=t||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(i){var r,a,s,o,l;if(r=i.ccData&32639,r===this.lastControlCode_){this.lastControlCode_=null;return}if((r&61440)===4096?this.lastControlCode_=r:r!==this.PADDING_&&(this.lastControlCode_=null),s=r>>>8,o=r&255,r!==this.PADDING_)if(r===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(r===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(i.pts),this.flushDisplayed(i.pts),a=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=a,this.startPts_=i.pts;else if(r===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(i.pts);else if(r===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(i.pts);else if(r===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(i.pts);else if(r===this.CARRIAGE_RETURN_)this.clearFormatting(i.pts),this.flushDisplayed(i.pts),this.shiftRowsUp_(),this.startPts_=i.pts;else if(r===this.BACKSPACE_)this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(r===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(i.pts),this.displayed_=Qe();else if(r===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Qe();else if(r===this.RESUME_DIRECT_CAPTIONING_)this.mode_!=="paintOn"&&(this.flushDisplayed(i.pts),this.displayed_=Qe()),this.mode_="paintOn",this.startPts_=i.pts;else if(this.isSpecialCharacter(s,o))s=(s&3)<<8,l=ri(s|o),this[this.mode_](i.pts,l),this.column_++;else if(this.isExtCharacter(s,o))this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),s=(s&3)<<8,l=ri(s|o),this[this.mode_](i.pts,l),this.column_++;else if(this.isMidRowCode(s,o))this.clearFormatting(i.pts),this[this.mode_](i.pts," "),this.column_++,(o&14)===14&&this.addFormatting(i.pts,["i"]),(o&1)===1&&this.addFormatting(i.pts,["u"]);else if(this.isOffsetControlCode(s,o))this.column_+=o&3;else if(this.isPAC(s,o)){var u=au.indexOf(r&7968);this.mode_==="rollUp"&&(u-this.rollUpRows_+1<0&&(u=this.rollUpRows_-1),this.setRollUp(i.pts,u)),u!==this.row_&&(this.clearFormatting(i.pts),this.row_=u),o&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(i.pts,["u"]),(r&16)===16&&(this.column_=((r&14)>>1)*4),this.isColorPAC(o)&&(o&14)===14&&this.addFormatting(i.pts,["i"])}else this.isNormalChar(s)&&(o===0&&(o=null),l=ri(s),l+=ri(o),this[this.mode_](i.pts,l),this.column_+=l.length)}};Y.prototype=new yr,Y.prototype.flushDisplayed=function(n){var e=this.displayed_.map(function(t,i){try{return t.trim()}catch{return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+i+"."}),""}},this).join(`
`).replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:n,text:e,stream:this.name_})},Y.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Qe(),this.nonDisplayed_=Qe(),this.lastControlCode_=null,this.column_=0,this.row_=ni,this.rollUpRows_=2,this.formatting_=[]},Y.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=this.CONTROL_|32,this.END_OF_CAPTION_=this.CONTROL_|47,this.ROLL_UP_2_ROWS_=this.CONTROL_|37,this.ROLL_UP_3_ROWS_=this.CONTROL_|38,this.ROLL_UP_4_ROWS_=this.CONTROL_|39,this.CARRIAGE_RETURN_=this.CONTROL_|45,this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41,this.BACKSPACE_=this.CONTROL_|33,this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44,this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46},Y.prototype.isSpecialCharacter=function(n,e){return n===this.EXT_&&e>=48&&e<=63},Y.prototype.isExtCharacter=function(n,e){return(n===this.EXT_+1||n===this.EXT_+2)&&e>=32&&e<=63},Y.prototype.isMidRowCode=function(n,e){return n===this.EXT_&&e>=32&&e<=47},Y.prototype.isOffsetControlCode=function(n,e){return n===this.OFFSET_&&e>=33&&e<=35},Y.prototype.isPAC=function(n,e){return n>=this.BASE_&&n<this.BASE_+8&&e>=64&&e<=127},Y.prototype.isColorPAC=function(n){return n>=64&&n<=79||n>=96&&n<=127},Y.prototype.isNormalChar=function(n){return n>=32&&n<=127},Y.prototype.setRollUp=function(n,e){if(this.mode_!=="rollUp"&&(this.row_=ni,this.mode_="rollUp",this.flushDisplayed(n),this.nonDisplayed_=Qe(),this.displayed_=Qe()),e!==void 0&&e!==this.row_)for(var t=0;t<this.rollUpRows_;t++)this.displayed_[e-t]=this.displayed_[this.row_-t],this.displayed_[this.row_-t]="";e===void 0&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},Y.prototype.addFormatting=function(n,e){this.formatting_=this.formatting_.concat(e);var t=e.reduce(function(i,r){return i+"<"+r+">"},"");this[this.mode_](n,t)},Y.prototype.clearFormatting=function(n){if(this.formatting_.length){var e=this.formatting_.reverse().reduce(function(t,i){return t+"</"+i+">"},"");this.formatting_=[],this[this.mode_](n,e)}},Y.prototype.popOn=function(n,e){var t=this.nonDisplayed_[this.row_];t+=e,this.nonDisplayed_[this.row_]=t},Y.prototype.rollUp=function(n,e){var t=this.displayed_[this.row_];t+=e,this.displayed_[this.row_]=t},Y.prototype.shiftRowsUp_=function(){var n;for(n=0;n<this.topRow_;n++)this.displayed_[n]="";for(n=this.row_+1;n<ni+1;n++)this.displayed_[n]="";for(n=this.topRow_;n<this.row_;n++)this.displayed_[n]=this.displayed_[n+1];this.displayed_[this.row_]=""},Y.prototype.paintOn=function(n,e){var t=this.displayed_[this.row_];t+=e,this.displayed_[this.row_]=t};var Va={CaptionStream:ue,Cea608Stream:Y,Cea708Stream:q},ai={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},su=le,ou=8589934592,lu=4294967296,za="shared",vr=function(e,t){var i=1;for(e>t&&(i=-1);Math.abs(t-e)>lu;)e+=i*ou;return e},Ha=function n(e){var t,i;n.prototype.init.call(this),this.type_=e||za,this.push=function(r){this.type_!==za&&r.type!==this.type_||(i===void 0&&(i=r.dts),r.dts=vr(r.dts,i),r.pts=vr(r.pts,i),t=r.dts,this.trigger("data",r))},this.flush=function(){i=t,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){i=void 0,t=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Ha.prototype=new su;var Ga={TimestampRolloverStream:Ha,handleRollover:vr},uu=le,hu=ai,qa=function(e,t,i){var r,a="";for(r=t;r<i;r++)a+="%"+("00"+e[r].toString(16)).slice(-2);return a},si=function(e,t,i){return decodeURIComponent(qa(e,t,i))},du=function(e,t,i){return unescape(qa(e,t,i))},oi=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Wa={TXXX:function(e){var t;if(e.data[0]===3){for(t=1;t<e.data.length;t++)if(e.data[t]===0){e.description=si(e.data,1,t),e.value=si(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(e.data[0]===3){for(t=1;t<e.data.length;t++)if(e.data[t]===0){e.description=si(e.data,1,t),e.url=si(e.data,t+1,e.data.length);break}}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(e.data[t]===0){e.owner=du(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},li;li=function(e){var t={descriptor:e&&e.descriptor},i=0,r=[],a=0,s;if(li.prototype.init.call(this),this.dispatchType=hu.METADATA_STREAM_TYPE.toString(16),t.descriptor)for(s=0;s<t.descriptor.length;s++)this.dispatchType+=("00"+t.descriptor[s].toString(16)).slice(-2);this.push=function(o){var l,u,h,d,c,y;if(o.type==="timed-metadata"){if(o.dataAlignmentIndicator&&(a=0,r.length=0),r.length===0&&(o.data.length<10||o.data[0]!=="I".charCodeAt(0)||o.data[1]!=="D".charCodeAt(0)||o.data[2]!=="3".charCodeAt(0))){this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});return}if(r.push(o),a+=o.data.byteLength,r.length===1&&(i=oi(o.data.subarray(6,10)),i+=10),!(a<i)){for(l={data:new Uint8Array(i),frames:[],pts:r[0].pts,dts:r[0].dts},c=0;c<i;)l.data.set(r[0].data.subarray(0,i-c),c),c+=r[0].data.byteLength,a-=r[0].data.byteLength,r.shift();u=10,l.data[5]&64&&(u+=4,u+=oi(l.data.subarray(10,14)),i-=oi(l.data.subarray(16,20)));do{if(h=oi(l.data.subarray(u+4,u+8)),h<1){this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping metadata parsing."});return}if(y=String.fromCharCode(l.data[u],l.data[u+1],l.data[u+2],l.data[u+3]),d={id:y,data:l.data.subarray(u+10,u+h+10)},d.key=d.id,Wa[d.id]&&(Wa[d.id](d),d.owner==="com.apple.streaming.transportStreamTimestamp")){var f=d.data,g=(f[3]&1)<<30|f[4]<<22|f[5]<<14|f[6]<<6|f[7]>>>2;g*=4,g+=f[7]&3,d.timeStamp=g,l.pts===void 0&&l.dts===void 0&&(l.pts=d.timeStamp,l.dts=d.timeStamp),this.trigger("timestamp",d)}l.frames.push(d),u+=10,u+=h}while(u<i);this.trigger("data",l)}}}},li.prototype=new uu;var cu=li,xr=le,br=Va,me=ai,fu=Ga.TimestampRolloverStream,ui,Et,hi,at=188,Sr=71;ui=function(){var e=new Uint8Array(at),t=0;ui.prototype.init.call(this),this.push=function(i){var r=0,a=at,s;for(t?(s=new Uint8Array(i.byteLength+t),s.set(e.subarray(0,t)),s.set(i,t),t=0):s=i;a<s.byteLength;){if(s[r]===Sr&&s[a]===Sr){this.trigger("data",s.subarray(r,a)),r+=at,a+=at;continue}r++,a++}r<s.byteLength&&(e.set(s.subarray(r),0),t=s.byteLength-r)},this.flush=function(){t===at&&e[0]===Sr&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}},ui.prototype=new xr,Et=function(){var e,t,i,r;Et.prototype.init.call(this),r=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(s,o){var l=0;o.payloadUnitStartIndicator&&(l+=s[l]+1),o.type==="pat"?t(s.subarray(l),o):i(s.subarray(l),o)},t=function(s,o){o.section_number=s[7],o.last_section_number=s[8],r.pmtPid=(s[10]&31)<<8|s[11],o.pmtPid=r.pmtPid},i=function(s,o){var l,u,h,d;if(s[5]&1){for(r.programMapTable={video:null,audio:null,"timed-metadata":{}},l=(s[1]&15)<<8|s[2],u=3+l-4,h=(s[10]&15)<<8|s[11],d=12+h;d<u;){var c=s[d],y=(s[d+1]&31)<<8|s[d+2];c===me.H264_STREAM_TYPE&&r.programMapTable.video===null?r.programMapTable.video=y:c===me.ADTS_STREAM_TYPE&&r.programMapTable.audio===null?r.programMapTable.audio=y:c===me.METADATA_STREAM_TYPE&&(r.programMapTable["timed-metadata"][y]=c),d+=((s[d+3]&15)<<8|s[d+4])+5}o.programMapTable=r.programMapTable}},this.push=function(a){var s={},o=4;if(s.payloadUnitStartIndicator=!!(a[1]&64),s.pid=a[1]&31,s.pid<<=8,s.pid|=a[2],(a[3]&48)>>>4>1&&(o+=a[o]+1),s.pid===0)s.type="pat",e(a.subarray(o),s),this.trigger("data",s);else if(s.pid===this.pmtPid)for(s.type="pmt",e(a.subarray(o),s),this.trigger("data",s);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===void 0?this.packetsWaitingForPmt.push([a,o,s]):this.processPes_(a,o,s)},this.processPes_=function(a,s,o){o.pid===this.programMapTable.video?o.streamType=me.H264_STREAM_TYPE:o.pid===this.programMapTable.audio?o.streamType=me.ADTS_STREAM_TYPE:o.streamType=this.programMapTable["timed-metadata"][o.pid],o.type="pes",o.data=a.subarray(s),this.trigger("data",o)}},Et.prototype=new xr,Et.STREAM_TYPES={h264:27,adts:15},hi=function(){var e=this,t=!1,i={data:[],size:0},r={data:[],size:0},a={data:[],size:0},s,o=function(h,d){var c,y=h[0]<<16|h[1]<<8|h[2];d.data=new Uint8Array,y===1&&(d.packetLength=6+(h[4]<<8|h[5]),d.dataAlignmentIndicator=(h[6]&4)!==0,c=h[7],c&192&&(d.pts=(h[9]&14)<<27|(h[10]&255)<<20|(h[11]&254)<<12|(h[12]&255)<<5|(h[13]&254)>>>3,d.pts*=4,d.pts+=(h[13]&6)>>>1,d.dts=d.pts,c&64&&(d.dts=(h[14]&14)<<27|(h[15]&255)<<20|(h[16]&254)<<12|(h[17]&255)<<5|(h[18]&254)>>>3,d.dts*=4,d.dts+=(h[18]&6)>>>1)),d.data=h.subarray(9+h[8]))},l=function(h,d,c){var y=new Uint8Array(h.size),f={type:d},g=0,p=0,x=!1,_;if(!(!h.data.length||h.size<9)){for(f.trackId=h.data[0].pid,g=0;g<h.data.length;g++)_=h.data[g],y.set(_.data,p),p+=_.data.byteLength;o(y,f),x=d==="video"||f.packetLength<=h.size,(c||x)&&(h.size=0,h.data.length=0),x&&e.trigger("data",f)}};hi.prototype.init.call(this),this.push=function(u){({pat:function(){},pes:function(){var d,c;switch(u.streamType){case me.H264_STREAM_TYPE:d=i,c="video";break;case me.ADTS_STREAM_TYPE:d=r,c="audio";break;case me.METADATA_STREAM_TYPE:d=a,c="timed-metadata";break;default:return}u.payloadUnitStartIndicator&&l(d,c,!0),d.data.push(u),d.size+=u.data.byteLength},pmt:function(){var d={type:"metadata",tracks:[]};s=u.programMapTable,s.video!==null&&d.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.video,codec:"avc",type:"video"}),s.audio!==null&&d.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.audio,codec:"adts",type:"audio"}),t=!0,e.trigger("data",d)}})[u.type]()},this.reset=function(){i.size=0,i.data.length=0,r.size=0,r.data.length=0,this.trigger("reset")},this.flushStreams_=function(){l(i,"video"),l(r,"audio"),l(a,"timed-metadata")},this.flush=function(){if(!t&&s){var u={type:"metadata",tracks:[]};s.video!==null&&u.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.video,codec:"avc",type:"video"}),s.audio!==null&&u.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.audio,codec:"adts",type:"audio"}),e.trigger("data",u)}t=!1,this.flushStreams_(),this.trigger("done")}},hi.prototype=new xr;var Xa={PAT_PID:0,MP2T_PACKET_LENGTH:at,TransportPacketStream:ui,TransportParseStream:Et,ElementaryStream:hi,TimestampRolloverStream:fu,CaptionStream:br.CaptionStream,Cea608Stream:br.Cea608Stream,Cea708Stream:br.Cea708Stream,MetadataStream:cu};for(var Tr in me)me.hasOwnProperty(Tr)&&(Xa[Tr]=me[Tr]);var di=Xa,pu=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Ya=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],r=e[t+5],a=(r&16)>>4;return i=i>=0?i:0,a?i+20:i+10},mu=function n(e,t){return e.length-t<10||e[t]!=="I".charCodeAt(0)||e[t+1]!=="D".charCodeAt(0)||e[t+2]!=="3".charCodeAt(0)?t:(t+=Ya(e,t),n(e,t))},gu=function(e){var t=mu(e,0);return e.length>=t+2&&(e[t]&255)===255&&(e[t+1]&240)===240&&(e[t+1]&22)===16},Ka=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},yu=function(e,t,i){var r,a="";for(r=t;r<i;r++)a+="%"+("00"+e[r].toString(16)).slice(-2);return a},vu=function(e,t,i){return unescape(yu(e,t,i))},xu=function(e,t){var i=(e[t+5]&224)>>5,r=e[t+4]<<3,a=e[t+3]&3<<11;return a|r|i},bu=function(e,t){return e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)?"timed-metadata":e[t]&!0&&(e[t+1]&240)===240?"audio":null},Su=function(e){for(var t=0;t+5<e.length;){if(e[t]!==255||(e[t+1]&246)!==240){t++;continue}return pu[(e[t+2]&60)>>>2]}return null},Tu=function(e){var t,i,r,a;t=10,e[5]&64&&(t+=4,t+=Ka(e.subarray(10,14)));do{if(i=Ka(e.subarray(t+4,t+8)),i<1)return null;if(a=String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]),a==="PRIV"){r=e.subarray(t+10,t+i+10);for(var s=0;s<r.byteLength;s++)if(r[s]===0){var o=vu(r,0,s);if(o==="com.apple.streaming.transportStreamTimestamp"){var l=r.subarray(s+1),u=(l[3]&1)<<30|l[4]<<22|l[5]<<14|l[6]<<6|l[7]>>>2;return u*=4,u+=l[7]&3,u}break}}t+=10,t+=i}while(t<e.byteLength);return null},ci={isLikelyAacData:gu,parseId3TagSize:Ya,parseAdtsSize:xu,parseType:bu,parseSampleRate:Su,parseAacTimestamp:Tu},wu=le,Qa=ci,fi;fi=function(){var e=new Uint8Array,t=0;fi.prototype.init.call(this),this.setTimestamp=function(i){t=i},this.push=function(i){var r=0,a=0,s,o,l,u;for(e.length?(u=e.length,e=new Uint8Array(i.byteLength+u),e.set(e.subarray(0,u)),e.set(i,u)):e=i;e.length-a>=3;){if(e[a]==="I".charCodeAt(0)&&e[a+1]==="D".charCodeAt(0)&&e[a+2]==="3".charCodeAt(0)){if(e.length-a<10||(r=Qa.parseId3TagSize(e,a),a+r>e.length))break;o={type:"timed-metadata",data:e.subarray(a,a+r)},this.trigger("data",o),a+=r;continue}else if((e[a]&255)===255&&(e[a+1]&240)===240){if(e.length-a<7||(r=Qa.parseAdtsSize(e,a),a+r>e.length))break;l={type:"audio",data:e.subarray(a,a+r),pts:t,dts:t},this.trigger("data",l),a+=r;continue}a++}s=e.length-a,s>0?e=e.subarray(a):e=new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}},fi.prototype=new wu;var ja=fi,Eu=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],Ja=Eu,_u=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],Za=_u,pi=le,_t=Qt,Pt=Ua,mi=Na,ge=Zt,Ce=di,gi=Be,es=Xt,Pu=nr.H264Stream,Au=ja,Ou=ci.isLikelyAacData,Ru=Be.ONE_SECOND_IN_TS,wr=Ja,Er=Za,At,st,yi,je,Iu=function(e,t){t.stream=e,this.trigger("log",t)},ts=function(e,t){for(var i=Object.keys(t),r=0;r<i.length;r++){var a=i[r];a==="headOfPipeline"||!t[a].on||t[a].on("log",Iu.bind(e,a))}},is=function(e,t){var i;if(e.length!==t.length)return!1;for(i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0},_r=function(e,t,i,r,a,s){var o=i-t,l=r-t,u=a-i;return{start:{dts:e,pts:e+o},end:{dts:e+l,pts:e+u},prependedContentDuration:s,baseMediaDecodeTime:e}};st=function(e,t){var i=[],r,a=0,s=0,o=1/0;t=t||{},r=t.firstSequenceNumber||0,st.prototype.init.call(this),this.push=function(l){ge.collectDtsInfo(e,l),e&&wr.forEach(function(u){e[u]=l[u]}),i.push(l)},this.setEarliestDts=function(l){a=l},this.setVideoBaseMediaDecodeTime=function(l){o=l},this.setAudioAppendStart=function(l){s=l},this.flush=function(){var l,u,h,d,c,y,f;if(i.length===0){this.trigger("done","AudioSegmentStream");return}l=mi.trimAdtsFramesByEarliestDts(i,e,a),e.baseMediaDecodeTime=ge.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),f=mi.prefixWithSilence(e,l,s,o),e.samples=mi.generateSampleTable(l),h=_t.mdat(mi.concatenateFrameData(l)),i=[],u=_t.moof(r,[e]),d=new Uint8Array(u.byteLength+h.byteLength),r++,d.set(u),d.set(h,u.byteLength),ge.clearDtsInfo(e),c=Math.ceil(Ru*1024/e.samplerate),l.length&&(y=l.length*c,this.trigger("segmentTimingInfo",_r(gi.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),l[0].dts,l[0].pts,l[0].dts+y,l[0].pts+y,f||0)),this.trigger("timingInfo",{start:l[0].pts,end:l[0].pts+y})),this.trigger("data",{track:e,boxes:d}),this.trigger("done","AudioSegmentStream")},this.reset=function(){ge.clearDtsInfo(e),i=[],this.trigger("reset")}},st.prototype=new pi,At=function(e,t){var i,r=[],a=[],s,o;t=t||{},i=t.firstSequenceNumber||0,At.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(l){ge.collectDtsInfo(e,l),l.nalUnitType==="seq_parameter_set_rbsp"&&!s&&(s=l.config,e.sps=[l.data],Er.forEach(function(u){e[u]=s[u]},this)),l.nalUnitType==="pic_parameter_set_rbsp"&&!o&&(o=l.data,e.pps=[l.data]),r.push(l)},this.flush=function(){for(var l,u,h,d,c,y,f=0,g,p;r.length&&r[0].nalUnitType!=="access_unit_delimiter_rbsp";)r.shift();if(r.length===0){this.resetStream_(),this.trigger("done","VideoSegmentStream");return}if(l=Pt.groupNalsIntoFrames(r),h=Pt.groupFramesIntoGops(l),h[0][0].keyFrame||(u=this.getGopForFusion_(r[0],e),u?(f=u.duration,h.unshift(u),h.byteLength+=u.byteLength,h.nalCount+=u.nalCount,h.pts=u.pts,h.dts=u.dts,h.duration+=u.duration):h=Pt.extendFirstKeyFrame(h)),a.length){var x;if(t.alignGopsAtEnd?x=this.alignGopsAtEnd_(h):x=this.alignGopsAtStart_(h),!x){this.gopCache_.unshift({gop:h.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),r=[],this.resetStream_(),this.trigger("done","VideoSegmentStream");return}ge.clearDtsInfo(e),h=x}ge.collectDtsInfo(e,h),e.samples=Pt.generateSampleTable(h),c=_t.mdat(Pt.concatenateNalData(h)),e.baseMediaDecodeTime=ge.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",h.map(function(_){return{pts:_.pts,dts:_.dts,byteLength:_.byteLength}})),g=h[0],p=h[h.length-1],this.trigger("segmentTimingInfo",_r(e.baseMediaDecodeTime,g.dts,g.pts,p.dts+p.duration,p.pts+p.duration,f)),this.trigger("timingInfo",{start:h[0].pts,end:h[h.length-1].pts+h[h.length-1].duration}),this.gopCache_.unshift({gop:h.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),r=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),d=_t.moof(i,[e]),y=new Uint8Array(d.byteLength+c.byteLength),i++,y.set(d),y.set(c,d.byteLength),this.trigger("data",{track:e,boxes:y}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),r=[],this.gopCache_.length=0,a.length=0,this.trigger("reset")},this.resetStream_=function(){ge.clearDtsInfo(e),s=void 0,o=void 0},this.getGopForFusion_=function(l){var u=45e3,h=1e4,d=1/0,c,y,f,g,p;for(p=0;p<this.gopCache_.length;p++)g=this.gopCache_[p],f=g.gop,!(!(e.pps&&is(e.pps[0],g.pps[0]))||!(e.sps&&is(e.sps[0],g.sps[0])))&&(f.dts<e.timelineStartInfo.dts||(c=l.dts-f.dts-f.duration,c>=-h&&c<=u&&(!y||d>c)&&(y=g,d=c)));return y?y.gop:null},this.alignGopsAtStart_=function(l){var u,h,d,c,y,f,g,p;for(y=l.byteLength,f=l.nalCount,g=l.duration,u=h=0;u<a.length&&h<l.length&&(d=a[u],c=l[h],d.pts!==c.pts);){if(c.pts>d.pts){u++;continue}h++,y-=c.byteLength,f-=c.nalCount,g-=c.duration}return h===0?l:h===l.length?null:(p=l.slice(h),p.byteLength=y,p.duration=g,p.nalCount=f,p.pts=p[0].pts,p.dts=p[0].dts,p)},this.alignGopsAtEnd_=function(l){var u,h,d,c,y,f;for(u=a.length-1,h=l.length-1,y=null,f=!1;u>=0&&h>=0;){if(d=a[u],c=l[h],d.pts===c.pts){f=!0;break}if(d.pts>c.pts){u--;continue}u===a.length-1&&(y=h),h--}if(!f&&y===null)return null;var g;if(f?g=h:g=y,g===0)return l;var p=l.slice(g),x=p.reduce(function(_,T){return _.byteLength+=T.byteLength,_.duration+=T.duration,_.nalCount+=T.nalCount,_},{byteLength:0,duration:0,nalCount:0});return p.byteLength=x.byteLength,p.duration=x.duration,p.nalCount=x.nalCount,p.pts=p[0].pts,p.dts=p[0].dts,p},this.alignGopsWith=function(l){a=l}},At.prototype=new pi,je=function(e,t){this.numberOfTracks=0,this.metadataStream=t,e=e||{},typeof e.remux<"u"?this.remuxTracks=!!e.remux:this.remuxTracks=!0,typeof e.keepOriginalTimestamps=="boolean"?this.keepOriginalTimestamps=e.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,je.prototype.init.call(this),this.push=function(i){if(i.text)return this.pendingCaptions.push(i);if(i.frames)return this.pendingMetadata.push(i);this.pendingTracks.push(i.track),this.pendingBytes+=i.boxes.byteLength,i.track.type==="video"&&(this.videoTrack=i.track,this.pendingBoxes.push(i.boxes)),i.track.type==="audio"&&(this.audioTrack=i.track,this.pendingBoxes.unshift(i.boxes))}},je.prototype=new pi,je.prototype.flush=function(n){var e=0,t={captions:[],captionStreams:{},metadata:[],info:{}},i,r,a,s=0,o;if(this.pendingTracks.length<this.numberOfTracks){if(n!=="VideoSegmentStream"&&n!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++,this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}if(this.videoTrack?(s=this.videoTrack.timelineStartInfo.pts,Er.forEach(function(l){t.info[l]=this.videoTrack[l]},this)):this.audioTrack&&(s=this.audioTrack.timelineStartInfo.pts,wr.forEach(function(l){t.info[l]=this.audioTrack[l]},this)),this.videoTrack||this.audioTrack){for(this.pendingTracks.length===1?t.type=this.pendingTracks[0].type:t.type="combined",this.emittedTracks+=this.pendingTracks.length,a=_t.initSegment(this.pendingTracks),t.initSegment=new Uint8Array(a.byteLength),t.initSegment.set(a),t.data=new Uint8Array(this.pendingBytes),o=0;o<this.pendingBoxes.length;o++)t.data.set(this.pendingBoxes[o],e),e+=this.pendingBoxes[o].byteLength;for(o=0;o<this.pendingCaptions.length;o++)i=this.pendingCaptions[o],i.startTime=gi.metadataTsToSeconds(i.startPts,s,this.keepOriginalTimestamps),i.endTime=gi.metadataTsToSeconds(i.endPts,s,this.keepOriginalTimestamps),t.captionStreams[i.stream]=!0,t.captions.push(i);for(o=0;o<this.pendingMetadata.length;o++)r=this.pendingMetadata[o],r.cueTime=gi.metadataTsToSeconds(r.pts,s,this.keepOriginalTimestamps),t.metadata.push(r);for(t.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",t),o=0;o<t.captions.length;o++)i=t.captions[o],this.trigger("caption",i);for(o=0;o<t.metadata.length;o++)r=t.metadata[o],this.trigger("id3Frame",r)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},je.prototype.setRemux=function(n){this.remuxTracks=n},yi=function(e){var t=this,i=!0,r,a;yi.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var s={};this.transmuxPipeline_=s,s.type="aac",s.metadataStream=new Ce.MetadataStream,s.aacStream=new Au,s.audioTimestampRolloverStream=new Ce.TimestampRolloverStream("audio"),s.timedMetadataTimestampRolloverStream=new Ce.TimestampRolloverStream("timed-metadata"),s.adtsStream=new es,s.coalesceStream=new je(e,s.metadataStream),s.headOfPipeline=s.aacStream,s.aacStream.pipe(s.audioTimestampRolloverStream).pipe(s.adtsStream),s.aacStream.pipe(s.timedMetadataTimestampRolloverStream).pipe(s.metadataStream).pipe(s.coalesceStream),s.metadataStream.on("timestamp",function(o){s.aacStream.setTimestamp(o.timeStamp)}),s.aacStream.on("data",function(o){o.type!=="timed-metadata"&&o.type!=="audio"||s.audioSegmentStream||(a=a||{timelineStartInfo:{baseMediaDecodeTime:t.baseMediaDecodeTime},codec:"adts",type:"audio"},s.coalesceStream.numberOfTracks++,s.audioSegmentStream=new st(a,e),s.audioSegmentStream.on("log",t.getLogTrigger_("audioSegmentStream")),s.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),s.adtsStream.pipe(s.audioSegmentStream).pipe(s.coalesceStream),t.trigger("trackinfo",{hasAudio:!!a,hasVideo:!!r}))}),s.coalesceStream.on("data",this.trigger.bind(this,"data")),s.coalesceStream.on("done",this.trigger.bind(this,"done")),ts(this,s)},this.setupTsPipeline=function(){var s={};this.transmuxPipeline_=s,s.type="ts",s.metadataStream=new Ce.MetadataStream,s.packetStream=new Ce.TransportPacketStream,s.parseStream=new Ce.TransportParseStream,s.elementaryStream=new Ce.ElementaryStream,s.timestampRolloverStream=new Ce.TimestampRolloverStream,s.adtsStream=new es,s.h264Stream=new Pu,s.captionStream=new Ce.CaptionStream(e),s.coalesceStream=new je(e,s.metadataStream),s.headOfPipeline=s.packetStream,s.packetStream.pipe(s.parseStream).pipe(s.elementaryStream).pipe(s.timestampRolloverStream),s.timestampRolloverStream.pipe(s.h264Stream),s.timestampRolloverStream.pipe(s.adtsStream),s.timestampRolloverStream.pipe(s.metadataStream).pipe(s.coalesceStream),s.h264Stream.pipe(s.captionStream).pipe(s.coalesceStream),s.elementaryStream.on("data",function(o){var l;if(o.type==="metadata"){for(l=o.tracks.length;l--;)!r&&o.tracks[l].type==="video"?(r=o.tracks[l],r.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime):!a&&o.tracks[l].type==="audio"&&(a=o.tracks[l],a.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime);r&&!s.videoSegmentStream&&(s.coalesceStream.numberOfTracks++,s.videoSegmentStream=new At(r,e),s.videoSegmentStream.on("log",t.getLogTrigger_("videoSegmentStream")),s.videoSegmentStream.on("timelineStartInfo",function(u){a&&!e.keepOriginalTimestamps&&(a.timelineStartInfo=u,s.audioSegmentStream.setEarliestDts(u.dts-t.baseMediaDecodeTime))}),s.videoSegmentStream.on("processedGopsInfo",t.trigger.bind(t,"gopInfo")),s.videoSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"videoSegmentTimingInfo")),s.videoSegmentStream.on("baseMediaDecodeTime",function(u){a&&s.audioSegmentStream.setVideoBaseMediaDecodeTime(u)}),s.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),s.h264Stream.pipe(s.videoSegmentStream).pipe(s.coalesceStream)),a&&!s.audioSegmentStream&&(s.coalesceStream.numberOfTracks++,s.audioSegmentStream=new st(a,e),s.audioSegmentStream.on("log",t.getLogTrigger_("audioSegmentStream")),s.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),s.audioSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"audioSegmentTimingInfo")),s.adtsStream.pipe(s.audioSegmentStream).pipe(s.coalesceStream)),t.trigger("trackinfo",{hasAudio:!!a,hasVideo:!!r})}}),s.coalesceStream.on("data",this.trigger.bind(this,"data")),s.coalesceStream.on("id3Frame",function(o){o.dispatchType=s.metadataStream.dispatchType,t.trigger("id3Frame",o)}),s.coalesceStream.on("caption",this.trigger.bind(this,"caption")),s.coalesceStream.on("done",this.trigger.bind(this,"done")),ts(this,s)},this.setBaseMediaDecodeTime=function(s){var o=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=s),a&&(a.timelineStartInfo.dts=void 0,a.timelineStartInfo.pts=void 0,ge.clearDtsInfo(a),o.audioTimestampRolloverStream&&o.audioTimestampRolloverStream.discontinuity()),r&&(o.videoSegmentStream&&(o.videoSegmentStream.gopCache_=[]),r.timelineStartInfo.dts=void 0,r.timelineStartInfo.pts=void 0,ge.clearDtsInfo(r),o.captionStream.reset()),o.timestampRolloverStream&&o.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(s){a&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(s)},this.setRemux=function(s){var o=this.transmuxPipeline_;e.remux=s,o&&o.coalesceStream&&o.coalesceStream.setRemux(s)},this.alignGopsWith=function(s){r&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(s)},this.getLogTrigger_=function(s){var o=this;return function(l){l.stream=s,o.trigger("log",l)}},this.push=function(s){if(i){var o=Ou(s);o&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():!o&&this.transmuxPipeline_.type!=="ts"&&this.setupTsPipeline(),i=!1}this.transmuxPipeline_.headOfPipeline.push(s)},this.flush=function(){i=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},yi.prototype=new pi;var Pr={Transmuxer:yi,VideoSegmentStream:At,AudioSegmentStream:st,AUDIO_PROPERTIES:wr,VIDEO_PROPERTIES:Er,generateSegmentTimingInfo:_r},Lu=$a.discardEmulationPreventionBytes,Cu=Va.CaptionStream,Ot=hr,Du=fr,Fu=cr,Mu=dr,ku=function(e,t){for(var i=e,r=0;r<t.length;r++){var a=t[r];if(i<a.size)return a;i-=a.size}return null},Uu=function(e,t,i){var r=new DataView(e.buffer,e.byteOffset,e.byteLength),a={logs:[],seiNals:[]},s,o,l,u;for(o=0;o+4<e.length;o+=l)if(l=r.getUint32(o),o+=4,!(l<=0))switch(e[o]&31){case 6:var h=e.subarray(o+1,o+1+l),d=ku(o,t);if(s={nalUnitType:"sei_rbsp",size:l,data:h,escapedRBSP:Lu(h),trackId:i},d)s.pts=d.pts,s.dts=d.dts,u=d;else if(u)s.pts=u.pts,s.dts=u.dts;else{a.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+o+" for trackId "+i+". See mux.js#223."});break}a.seiNals.push(s);break}return a},Nu=function(e,t,i){var r=t,a=i.defaultSampleDuration||0,s=i.defaultSampleSize||0,o=i.trackId,l=[];return e.forEach(function(u){var h=Fu(u),d=h.samples;d.forEach(function(c){c.duration===void 0&&(c.duration=a),c.size===void 0&&(c.size=s),c.trackId=o,c.dts=r,c.compositionTimeOffset===void 0&&(c.compositionTimeOffset=0),c.pts=r+c.compositionTimeOffset,r+=c.duration}),l=l.concat(d)}),l},Bu=function(e,t){var i=Ot(e,["moof","traf"]),r=Ot(e,["mdat"]),a={},s=[];return r.forEach(function(o,l){var u=i[l];s.push({mdat:o,traf:u})}),s.forEach(function(o){var l=o.mdat,u=o.traf,h=Ot(u,["tfhd"]),d=Mu(h[0]),c=d.trackId,y=Ot(u,["tfdt"]),f=y.length>0?Du(y[0]).baseMediaDecodeTime:0,g=Ot(u,["trun"]),p,x;t===c&&g.length>0&&(p=Nu(g,f,d),x=Uu(l,p,c),a[c]||(a[c]={seiNals:[],logs:[]}),a[c].seiNals=a[c].seiNals.concat(x.seiNals),a[c].logs=a[c].logs.concat(x.logs))}),a},$u=function(e,t,i){var r;if(t===null)return null;r=Bu(e,t);var a=r[t]||{};return{seiNals:a.seiNals,logs:a.logs,timescale:i}},Vu=function(){var e=!1,t,i,r,a,s,o;this.isInitialized=function(){return e},this.init=function(l){t=new Cu,e=!0,o=l?l.isPartial:!1,t.on("data",function(u){u.startTime=u.startPts/a,u.endTime=u.endPts/a,s.captions.push(u),s.captionStreams[u.stream]=!0}),t.on("log",function(u){s.logs.push(u)})},this.isNewInit=function(l,u){return l&&l.length===0||u&&typeof u=="object"&&Object.keys(u).length===0?!1:r!==l[0]||a!==u[r]},this.parse=function(l,u,h){var d;if(this.isInitialized()){if(!u||!h)return null;if(this.isNewInit(u,h))r=u[0],a=h[r];else if(r===null||!a)return i.push(l),null}else return null;for(;i.length>0;){var c=i.shift();this.parse(c,u,h)}return d=$u(l,r,a),d&&d.logs&&(s.logs=s.logs.concat(d.logs)),d===null||!d.seiNals?s.logs.length?{logs:s.logs,captions:[],captionStreams:[]}:null:(this.pushNals(d.seiNals),this.flushStream(),s)},this.pushNals=function(l){if(!this.isInitialized()||!l||l.length===0)return null;l.forEach(function(u){t.push(u)})},this.flushStream=function(){if(!this.isInitialized())return null;o?t.partialFlush():t.flush()},this.clearParsedCaptions=function(){s.captions=[],s.captionStreams={},s.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;t.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){i=[],r=null,a=null,s?this.clearParsedCaptions():s={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},zu=Vu,Hu={generator:Qt,probe:Il,Transmuxer:Pr.Transmuxer,AudioSegmentStream:Pr.AudioSegmentStream,VideoSegmentStream:Pr.VideoSegmentStream,CaptionParser:zu},B;B=function(e,t){var i=0,r=16384,a=function(d,c){var y,f=d.position+c;f<d.bytes.byteLength||(y=new Uint8Array(f*2),y.set(d.bytes.subarray(0,d.position),0),d.bytes=y,d.view=new DataView(d.bytes.buffer))},s=B.widthBytes||new Uint8Array(5),o=B.heightBytes||new Uint8Array(6),l=B.videocodecidBytes||new Uint8Array(12),u;if(!B.widthBytes){for(u=0;u<5;u++)s[u]="width".charCodeAt(u);for(u=0;u<6;u++)o[u]="height".charCodeAt(u);for(u=0;u<12;u++)l[u]="videocodecid".charCodeAt(u);B.widthBytes=s,B.heightBytes=o,B.videocodecidBytes=l}switch(this.keyFrame=!1,e){case B.VIDEO_TAG:this.length=16,r*=6;break;case B.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case B.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(r),this.view=new DataView(this.bytes.buffer),this.bytes[0]=e,this.position=this.length,this.keyFrame=t,this.pts=0,this.dts=0,this.writeBytes=function(h,d,c){var y=d||0,f;c=c||h.byteLength,f=y+c,a(this,c),this.bytes.set(h.subarray(y,f),this.position),this.position+=c,this.length=Math.max(this.length,this.position)},this.writeByte=function(h){a(this,1),this.bytes[this.position]=h,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(h){a(this,2),this.view.setUint16(this.position,h),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(h){return this.bytes[this.length-h]},this.nalUnitSize=function(){return i===0?0:this.length-(i+4)},this.startNalUnit=function(){if(i>0)throw new Error("Attempted to create new NAL wihout closing the old one");i=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(h){var d,c;this.length===i+4?this.length-=4:i>0&&(d=i+4,c=this.length-d,this.position=i,this.view.setUint32(this.position,c),this.position=this.length,h&&h.push(this.bytes.subarray(d,d+c))),i=0},this.writeMetaDataDouble=function(h,d){var c;if(a(this,2+h.length+9),this.view.setUint16(this.position,h.length),this.position+=2,h==="width")this.bytes.set(s,this.position),this.position+=5;else if(h==="height")this.bytes.set(o,this.position),this.position+=6;else if(h==="videocodecid")this.bytes.set(l,this.position),this.position+=12;else for(c=0;c<h.length;c++)this.bytes[this.position]=h.charCodeAt(c),this.position++;this.position++,this.view.setFloat64(this.position,d),this.position+=8,this.length=Math.max(this.length,this.position),++i},this.writeMetaDataBoolean=function(h,d){var c;for(a(this,2),this.view.setUint16(this.position,h.length),this.position+=2,c=0;c<h.length;c++)a(this,1),this.bytes[this.position]=h.charCodeAt(c),this.position++;a(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,d?1:0),this.position++,this.length=Math.max(this.length,this.position),++i},this.finalize=function(){var h,d;switch(this.bytes[0]){case B.VIDEO_TAG:this.bytes[11]=(this.keyFrame||t?16:32)|7,this.bytes[12]=t?0:1,h=this.pts-this.dts,this.bytes[13]=(h&16711680)>>>16,this.bytes[14]=(h&65280)>>>8,this.bytes[15]=(h&255)>>>0;break;case B.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=t?0:1;break;case B.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,i),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position;break}return d=this.length-11,this.bytes[1]=(d&16711680)>>>16,this.bytes[2]=(d&65280)>>>8,this.bytes[3]=(d&255)>>>0,this.bytes[4]=(this.dts&16711680)>>>16,this.bytes[5]=(this.dts&65280)>>>8,this.bytes[6]=(this.dts&255)>>>0,this.bytes[7]=(this.dts&4278190080)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,a(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=B.frameTime(this.bytes),this}},B.AUDIO_TAG=8,B.VIDEO_TAG=9,B.METADATA_TAG=18,B.isAudioFrame=function(n){return B.AUDIO_TAG===n[0]},B.isVideoFrame=function(n){return B.VIDEO_TAG===n[0]},B.isMetaData=function(n){return B.METADATA_TAG===n[0]},B.isKeyFrame=function(n){return B.isVideoFrame(n)?n[11]===23:!!(B.isAudioFrame(n)||B.isMetaData(n))},B.frameTime=function(n){var e=n[4]<<16;return e|=n[5]<<8,e|=n[6]<<0,e|=n[7]<<24,e};var Ar=B,Gu=le,Or=function n(e){this.numberOfTracks=0,this.metadataStream=e.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,n.prototype.init.call(this),this.push=function(t){if(t.text)return this.pendingCaptions.push(t);if(t.frames)return this.pendingMetadata.push(t);t.track.type==="video"&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),t.track.type==="audio"&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)}};Or.prototype=new Gu,Or.prototype.flush=function(n){var e,t,i,r,a={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(n!=="VideoSegmentStream"&&n!=="AudioSegmentStream")return;if(this.pendingTracks===0&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?r=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(r=this.audioTrack.timelineStartInfo.pts),a.tags.videoTags=this.videoTags,a.tags.audioTags=this.audioTags,i=0;i<this.pendingCaptions.length;i++)t=this.pendingCaptions[i],t.startTime=t.startPts-r,t.startTime/=9e4,t.endTime=t.endPts-r,t.endTime/=9e4,a.captionStreams[t.stream]=!0,a.captions.push(t);for(i=0;i<this.pendingMetadata.length;i++)e=this.pendingMetadata[i],e.cueTime=e.pts-r,e.cueTime/=9e4,a.metadata.push(e);a.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",a),this.trigger("done")}};var qu=Or,Wu=function(){var e=this;this.list=[],this.push=function(t){this.list.push({bytes:t.bytes,dts:t.dts,pts:t.pts,keyFrame:t.keyFrame,metaDataTag:t.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return e.list.length}})},Xu=Wu,Rr=le,ce=Ar,Ve=di,Yu=Xt,Ku=nr.H264Stream,Qu=qu,rs=Xu,vi,xi,bi,Ir,ns,as;Ir=function(e,t){typeof t.pts=="number"&&(e.timelineStartInfo.pts===void 0?e.timelineStartInfo.pts=t.pts:e.timelineStartInfo.pts=Math.min(e.timelineStartInfo.pts,t.pts)),typeof t.dts=="number"&&(e.timelineStartInfo.dts===void 0?e.timelineStartInfo.dts=t.dts:e.timelineStartInfo.dts=Math.min(e.timelineStartInfo.dts,t.dts))},ns=function(e,t){var i=new ce(ce.METADATA_TAG);return i.dts=t,i.pts=t,i.writeMetaDataDouble("videocodecid",7),i.writeMetaDataDouble("width",e.width),i.writeMetaDataDouble("height",e.height),i},as=function(e,t){var i,r=new ce(ce.VIDEO_TAG,!0);for(r.dts=t,r.pts=t,r.writeByte(1),r.writeByte(e.profileIdc),r.writeByte(e.profileCompatibility),r.writeByte(e.levelIdc),r.writeByte(255),r.writeByte(225),r.writeShort(e.sps[0].length),r.writeBytes(e.sps[0]),r.writeByte(e.pps.length),i=0;i<e.pps.length;++i)r.writeShort(e.pps[i].length),r.writeBytes(e.pps[i]);return r},bi=function(e){var t=[],i=[],r;bi.prototype.init.call(this),this.push=function(a){Ir(e,a),e&&(e.audioobjecttype=a.audioobjecttype,e.channelcount=a.channelcount,e.samplerate=a.samplerate,e.samplingfrequencyindex=a.samplingfrequencyindex,e.samplesize=a.samplesize,e.extraData=e.audioobjecttype<<11|e.samplingfrequencyindex<<7|e.channelcount<<3),a.pts=Math.round(a.pts/90),a.dts=Math.round(a.dts/90),t.push(a)},this.flush=function(){var a,s,o,l=new rs;if(t.length===0){this.trigger("done","AudioSegmentStream");return}for(o=-1/0;t.length;)a=t.shift(),i.length&&a.pts>=i[0]&&(o=i.shift(),this.writeMetaDataTags(l,o)),(e.extraData!==r||a.pts-o>=1e3)&&(this.writeMetaDataTags(l,a.pts),r=e.extraData,o=a.pts),s=new ce(ce.AUDIO_TAG),s.pts=a.pts,s.dts=a.dts,s.writeBytes(a.data),l.push(s.finalize());i.length=0,r=null,this.trigger("data",{track:e,tags:l.list}),this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(a,s){var o;o=new ce(ce.METADATA_TAG),o.pts=s,o.dts=s,o.writeMetaDataDouble("audiocodecid",10),o.writeMetaDataBoolean("stereo",e.channelcount===2),o.writeMetaDataDouble("audiosamplerate",e.samplerate),o.writeMetaDataDouble("audiosamplesize",16),a.push(o.finalize()),o=new ce(ce.AUDIO_TAG,!0),o.pts=s,o.dts=s,o.view.setUint16(o.position,e.extraData),o.position+=2,o.length=Math.max(o.length,o.position),a.push(o.finalize())},this.onVideoKeyFrame=function(a){i.push(a)}},bi.prototype=new Rr,xi=function(e){var t=[],i,r;xi.prototype.init.call(this),this.finishFrame=function(a,s){if(s){if(i&&e&&e.newMetadata&&(s.keyFrame||a.length===0)){var o=ns(i,s.dts).finalize(),l=as(e,s.dts).finalize();o.metaDataTag=l.metaDataTag=!0,a.push(o),a.push(l),e.newMetadata=!1,this.trigger("keyframe",s.dts)}s.endNalUnit(),a.push(s.finalize()),r=null}},this.push=function(a){Ir(e,a),a.pts=Math.round(a.pts/90),a.dts=Math.round(a.dts/90),t.push(a)},this.flush=function(){for(var a,s=new rs;t.length&&t[0].nalUnitType!=="access_unit_delimiter_rbsp";)t.shift();if(t.length===0){this.trigger("done","VideoSegmentStream");return}for(;t.length;)a=t.shift(),a.nalUnitType==="seq_parameter_set_rbsp"?(e.newMetadata=!0,i=a.config,e.width=i.width,e.height=i.height,e.sps=[a.data],e.profileIdc=i.profileIdc,e.levelIdc=i.levelIdc,e.profileCompatibility=i.profileCompatibility,r.endNalUnit()):a.nalUnitType==="pic_parameter_set_rbsp"?(e.newMetadata=!0,e.pps=[a.data],r.endNalUnit()):a.nalUnitType==="access_unit_delimiter_rbsp"?(r&&this.finishFrame(s,r),r=new ce(ce.VIDEO_TAG),r.pts=a.pts,r.dts=a.dts):(a.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(r.keyFrame=!0),r.endNalUnit()),r.startNalUnit(),r.writeBytes(a.data);r&&this.finishFrame(s,r),this.trigger("data",{track:e,tags:s.list}),this.trigger("done","VideoSegmentStream")}},xi.prototype=new Rr,vi=function(e){var t=this,i,r,a,s,o,l,u,h,d,c,y,f;vi.prototype.init.call(this),e=e||{},this.metadataStream=new Ve.MetadataStream,e.metadataStream=this.metadataStream,i=new Ve.TransportPacketStream,r=new Ve.TransportParseStream,a=new Ve.ElementaryStream,s=new Ve.TimestampRolloverStream("video"),o=new Ve.TimestampRolloverStream("audio"),l=new Ve.TimestampRolloverStream("timed-metadata"),u=new Yu,h=new Ku,f=new Qu(e),i.pipe(r).pipe(a),a.pipe(s).pipe(h),a.pipe(o).pipe(u),a.pipe(l).pipe(this.metadataStream).pipe(f),y=new Ve.CaptionStream(e),h.pipe(y).pipe(f),a.on("data",function(g){var p,x,_;if(g.type==="metadata"){for(p=g.tracks.length;p--;)g.tracks[p].type==="video"?x=g.tracks[p]:g.tracks[p].type==="audio"&&(_=g.tracks[p]);x&&!d&&(f.numberOfTracks++,d=new xi(x),h.pipe(d).pipe(f)),_&&!c&&(f.numberOfTracks++,c=new bi(_),u.pipe(c).pipe(f),d&&d.on("keyframe",c.onVideoKeyFrame))}}),this.push=function(g){i.push(g)},this.flush=function(){i.flush()},this.resetCaptions=function(){y.reset()},f.on("data",function(g){t.trigger("data",g)}),f.on("done",function(){t.trigger("done")})},vi.prototype=new Rr;var ju=vi,ss=Ar,Ju=function(e,t,i){var r=new Uint8Array(9),a=new DataView(r.buffer),s,o,l;return e=e||0,t=t===void 0?!0:t,i=i===void 0?!0:i,a.setUint8(0,70),a.setUint8(1,76),a.setUint8(2,86),a.setUint8(3,1),a.setUint8(4,(t?4:0)|(i?1:0)),a.setUint32(5,r.byteLength),e<=0?(o=new Uint8Array(r.byteLength+4),o.set(r),o.set([0,0,0,0],r.byteLength),o):(s=new ss(ss.METADATA_TAG),s.pts=s.dts=0,s.writeMetaDataDouble("duration",e),l=s.finalize().length,o=new Uint8Array(r.byteLength+l),o.set(r),o.set(a.byteLength,l),o)},Zu=Ju,eh={tag:Ar,Transmuxer:ju,getFlvHeader:Zu},th=di,ih=le,Lr=Qt,Si=Na,Ti=Zt,rh=Be.ONE_SECOND_IN_TS,nh=Ja,os=function n(e,t){var i=[],r=0,a=0,s=0,o=1/0,l=null,u=null;t=t||{},n.prototype.init.call(this),this.push=function(h){Ti.collectDtsInfo(e,h),e&&nh.forEach(function(d){e[d]=h[d]}),i.push(h)},this.setEarliestDts=function(h){a=h},this.setVideoBaseMediaDecodeTime=function(h){o=h},this.setAudioAppendStart=function(h){s=h},this.processFrames_=function(){var h,d,c,y,f;i.length!==0&&(h=Si.trimAdtsFramesByEarliestDts(i,e,a),h.length!==0&&(e.baseMediaDecodeTime=Ti.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),Si.prefixWithSilence(e,h,s,o),e.samples=Si.generateSampleTable(h),c=Lr.mdat(Si.concatenateFrameData(h)),i=[],d=Lr.moof(r,[e]),r++,e.initSegment=Lr.initSegment([e]),y=new Uint8Array(d.byteLength+c.byteLength),y.set(d),y.set(c,d.byteLength),Ti.clearDtsInfo(e),l===null&&(u=l=h[0].pts),u+=h.length*(rh*1024/e.samplerate),f={start:l},this.trigger("timingInfo",f),this.trigger("data",{track:e,boxes:y})))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:l,end:u}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){Ti.clearDtsInfo(e),l=null,u=null},this.reset=function(){this.resetTiming_(),i=[],this.trigger("reset")}};os.prototype=new ih;var ah=os,sh=le,Cr=Qt,wi=Zt,Rt=Ua,oh=Za,ls=function n(e,t){var i=0,r=[],a=[],s,o,l=null,u=null,h,d=!0;t=t||{},n.prototype.init.call(this),this.push=function(c){wi.collectDtsInfo(e,c),typeof e.timelineStartInfo.dts>"u"&&(e.timelineStartInfo.dts=c.dts),c.nalUnitType==="seq_parameter_set_rbsp"&&!s&&(s=c.config,e.sps=[c.data],oh.forEach(function(y){e[y]=s[y]},this)),c.nalUnitType==="pic_parameter_set_rbsp"&&!o&&(o=c.data,e.pps=[c.data]),r.push(c)},this.processNals_=function(c){var y;for(r=a.concat(r);r.length&&r[0].nalUnitType!=="access_unit_delimiter_rbsp";)r.shift();if(r.length!==0){var f=Rt.groupNalsIntoFrames(r);if(f.length){if(a=f[f.length-1],c&&(f.pop(),f.duration-=a.duration,f.nalCount-=a.length,f.byteLength-=a.byteLength),!f.length){r=[];return}if(this.trigger("timelineStartInfo",e.timelineStartInfo),d){if(h=Rt.groupFramesIntoGops(f),!h[0][0].keyFrame){if(h=Rt.extendFirstKeyFrame(h),!h[0][0].keyFrame){r=[].concat.apply([],f).concat(a),a=[];return}f=[].concat.apply([],h),f.duration=h.duration}d=!1}for(l===null&&(l=f[0].pts,u=l),u+=f.duration,this.trigger("timingInfo",{start:l,end:u}),y=0;y<f.length;y++){var g=f[y];e.samples=Rt.generateSampleTableForFrame(g);var p=Cr.mdat(Rt.concatenateNalDataForFrame(g));wi.clearDtsInfo(e),wi.collectDtsInfo(e,g),e.baseMediaDecodeTime=wi.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps);var x=Cr.moof(i,[e]);i++,e.initSegment=Cr.initSegment([e]);var _=new Uint8Array(x.byteLength+p.byteLength);_.set(x),_.set(p,x.byteLength),this.trigger("data",{track:e,boxes:_,sequence:i,videoFrameDts:g.dts,videoFramePts:g.pts})}r=[]}}},this.resetTimingAndConfig_=function(){s=void 0,o=void 0,l=null,u=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),a=[],r=[],d=!0,this.trigger("reset")}};ls.prototype=new sh;var lh=ls,us=le,De=di,hs=Jn,ds=ah,uh=lh,cs=Zt,hh=ci.isLikelyAacData,dh=Xt,ch=ja,Dr=Be,fs=function(e){return e.prototype=new us,e.prototype.init.call(e),e},fh=function(e){var t={type:"ts",tracks:{audio:null,video:null},packet:new De.TransportPacketStream,parse:new De.TransportParseStream,elementary:new De.ElementaryStream,timestampRollover:new De.TimestampRolloverStream,adts:new hs.Adts,h264:new hs.h264.H264Stream,captionStream:new De.CaptionStream(e),metadataStream:new De.MetadataStream};return t.headOfPipeline=t.packet,t.packet.pipe(t.parse).pipe(t.elementary).pipe(t.timestampRollover),t.timestampRollover.pipe(t.h264),t.h264.pipe(t.captionStream),t.timestampRollover.pipe(t.metadataStream),t.timestampRollover.pipe(t.adts),t.elementary.on("data",function(i){if(i.type==="metadata"){for(var r=0;r<i.tracks.length;r++)t.tracks[i.tracks[r].type]||(t.tracks[i.tracks[r].type]=i.tracks[r],t.tracks[i.tracks[r].type].timelineStartInfo.baseMediaDecodeTime=e.baseMediaDecodeTime);t.tracks.video&&!t.videoSegmentStream&&(t.videoSegmentStream=new uh(t.tracks.video,e),t.videoSegmentStream.on("timelineStartInfo",function(a){t.tracks.audio&&!e.keepOriginalTimestamps&&t.audioSegmentStream.setEarliestDts(a.dts-e.baseMediaDecodeTime)}),t.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),t.videoSegmentStream.on("data",function(a){t.trigger("data",{type:"video",data:a})}),t.videoSegmentStream.on("done",t.trigger.bind(t,"done")),t.videoSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.videoSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.h264.pipe(t.videoSegmentStream)),t.tracks.audio&&!t.audioSegmentStream&&(t.audioSegmentStream=new ds(t.tracks.audio,e),t.audioSegmentStream.on("data",function(a){t.trigger("data",{type:"audio",data:a})}),t.audioSegmentStream.on("done",t.trigger.bind(t,"done")),t.audioSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.audioSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),t.adts.pipe(t.audioSegmentStream)),t.trigger("trackinfo",{hasAudio:!!t.tracks.audio,hasVideo:!!t.tracks.video})}}),t.captionStream.on("data",function(i){var r;t.tracks.video?r=t.tracks.video.timelineStartInfo.pts||0:r=0,i.startTime=Dr.metadataTsToSeconds(i.startPts,r,e.keepOriginalTimestamps),i.endTime=Dr.metadataTsToSeconds(i.endPts,r,e.keepOriginalTimestamps),t.trigger("caption",i)}),t=fs(t),t.metadataStream.on("data",t.trigger.bind(t,"id3Frame")),t},ph=function(e){var t={type:"aac",tracks:{audio:null},metadataStream:new De.MetadataStream,aacStream:new ch,audioRollover:new De.TimestampRolloverStream("audio"),timedMetadataRollover:new De.TimestampRolloverStream("timed-metadata"),adtsStream:new dh(!0)};return t.headOfPipeline=t.aacStream,t.aacStream.pipe(t.audioRollover).pipe(t.adtsStream),t.aacStream.pipe(t.timedMetadataRollover).pipe(t.metadataStream),t.metadataStream.on("timestamp",function(i){t.aacStream.setTimestamp(i.timeStamp)}),t.aacStream.on("data",function(i){i.type!=="timed-metadata"&&i.type!=="audio"||t.audioSegmentStream||(t.tracks.audio=t.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:e.baseMediaDecodeTime},codec:"adts",type:"audio"},t.audioSegmentStream=new ds(t.tracks.audio,e),t.audioSegmentStream.on("data",function(r){t.trigger("data",{type:"audio",data:r})}),t.audioSegmentStream.on("partialdone",t.trigger.bind(t,"partialdone")),t.audioSegmentStream.on("done",t.trigger.bind(t,"done")),t.audioSegmentStream.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),t.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),t.adtsStream.pipe(t.audioSegmentStream),t.trigger("trackinfo",{hasAudio:!!t.tracks.audio,hasVideo:!!t.tracks.video}))}),t=fs(t),t.metadataStream.on("data",t.trigger.bind(t,"id3Frame")),t},ps=function(e,t){e.on("data",t.trigger.bind(t,"data")),e.on("done",t.trigger.bind(t,"done")),e.on("partialdone",t.trigger.bind(t,"partialdone")),e.on("endedtimeline",t.trigger.bind(t,"endedtimeline")),e.on("audioTimingInfo",t.trigger.bind(t,"audioTimingInfo")),e.on("videoTimingInfo",t.trigger.bind(t,"videoTimingInfo")),e.on("trackinfo",t.trigger.bind(t,"trackinfo")),e.on("id3Frame",function(i){i.dispatchType=e.metadataStream.dispatchType,i.cueTime=Dr.videoTsToSeconds(i.pts),t.trigger("id3Frame",i)}),e.on("caption",function(i){t.trigger("caption",i)})},ms=function n(e){var t=null,i=!0;e=e||{},n.prototype.init.call(this),e.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.push=function(r){if(i){var a=hh(r);a&&(!t||t.type!=="aac")?(t=ph(e),ps(t,this)):!a&&(!t||t.type!=="ts")&&(t=fh(e),ps(t,this)),i=!1}t.headOfPipeline.push(r)},this.flush=function(){t&&(i=!0,t.headOfPipeline.flush())},this.partialFlush=function(){t&&t.headOfPipeline.partialFlush()},this.endTimeline=function(){t&&t.headOfPipeline.endTimeline()},this.reset=function(){t&&t.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(r){e.keepOriginalTimestamps||(e.baseMediaDecodeTime=r),t&&(t.tracks.audio&&(t.tracks.audio.timelineStartInfo.dts=void 0,t.tracks.audio.timelineStartInfo.pts=void 0,cs.clearDtsInfo(t.tracks.audio),t.audioRollover&&t.audioRollover.discontinuity()),t.tracks.video&&(t.videoSegmentStream&&(t.videoSegmentStream.gopCache_=[]),t.tracks.video.timelineStartInfo.dts=void 0,t.tracks.video.timelineStartInfo.pts=void 0,cs.clearDtsInfo(t.tracks.video)),t.timestampRollover&&t.timestampRollover.discontinuity())},this.setRemux=function(r){e.remux=r,t&&t.coalesceStream&&t.coalesceStream.setRemux(r)},this.setAudioAppendStart=function(r){!t||!t.tracks.audio||!t.audioSegmentStream||t.audioSegmentStream.setAudioAppendStart(r)},this.alignGopsWith=function(r){}};ms.prototype=new us;var mh=ms,gh={Transmuxer:mh},Fr,gs;function yh(){if(gs)return Fr;gs=1;var n=Math.pow(2,32),e=function(i){var r=new DataView(i.buffer,i.byteOffset,i.byteLength),a={version:i[0],flags:new Uint8Array(i.subarray(1,4)),references:[],referenceId:r.getUint32(4),timescale:r.getUint32(8)},s=12;a.version===0?(a.earliestPresentationTime=r.getUint32(s),a.firstOffset=r.getUint32(s+4),s+=8):(a.earliestPresentationTime=r.getUint32(s)*n+r.getUint32(s+4),a.firstOffset=r.getUint32(s+8)*n+r.getUint32(s+12),s+=16),s+=2;var o=r.getUint16(s);for(s+=2;o>0;s+=12,o--)a.references.push({referenceType:(i[s]&128)>>>7,referencedSize:r.getUint32(s)&2147483647,subsegmentDuration:r.getUint32(s+4),startsWithSap:!!(i[s+8]&128),sapType:(i[s+8]&112)>>>4,sapDeltaTime:r.getUint32(s+8)&268435455});return a};return Fr=e,Fr}var ys=Math.pow(2,32),ie,Mr,fe=function(e){return new Date(e*1e3-20828448e5)},It=ur,vh=hr,xh=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=[],r,a;for(r=0;r+4<e.length;r+=a){if(a=t.getUint32(r),r+=4,a<=0){i.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(e[r]&31){case 1:i.push("slice_layer_without_partitioning_rbsp");break;case 5:i.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:i.push("sei_rbsp");break;case 7:i.push("seq_parameter_set_rbsp");break;case 8:i.push("pic_parameter_set_rbsp");break;case 9:i.push("access_unit_delimiter_rbsp");break;default:i.push("UNKNOWN NAL - "+e[r]&31);break}}return i},ze={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:ie(e.subarray(78,e.byteLength))}},avcC:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:e[4]&3,sps:[],pps:[]},r=e[5]&31,a,s,o,l;for(o=6,l=0;l<r;l++)s=t.getUint16(o),o+=2,i.sps.push(new Uint8Array(e.subarray(o,o+s))),o+=s;for(a=e[o],o++,l=0;l<a;l++)s=t.getUint16(o),o+=2,i.pps.push(new Uint8Array(e.subarray(o,o+s))),o+=s;return i},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},edts:function(e){return{boxes:ie(e)}},elst:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),edits:[]},r=t.getUint32(4),a;for(a=8;r;r--)i.version===0?(i.edits.push({segmentDuration:t.getUint32(a),mediaTime:t.getInt32(a+4),mediaRate:t.getUint16(a+8)+t.getUint16(a+10)/(256*256)}),a+=12):(i.edits.push({segmentDuration:t.getUint32(a)*ys+t.getUint32(a+4),mediaTime:t.getUint32(a+8)*ys+t.getUint32(a+12),mediaRate:t.getUint16(a+16)+t.getUint16(a+18)/(256*256)}),a+=20);return i},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:e[8]&31,decoderConfig:{objectProfileIndication:e[11],streamType:e[12]>>>2&63,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:e[26]>>>3&31,samplingFrequencyIndex:(e[26]&7)<<1|e[27]>>>7&1,channelConfiguration:e[27]>>>3&15}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={majorBrand:It(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},r=8;r<e.byteLength;)i.compatibleBrands.push(It(e.subarray(r,r+4))),r+=4;return i},dinf:function(e){return{boxes:ie(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:ie(e.subarray(8))}},hdlr:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:It(e.subarray(8,12)),name:""},r=8;for(r=24;r<e.byteLength;r++){if(e[r]===0){r++;break}i.name+=String.fromCharCode(e[r])}return i.name=decodeURIComponent(escape(i.name)),i},mdat:function(e){return{byteLength:e.byteLength,nals:xh(e)}},mdhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r,a={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""};return a.version===1?(i+=4,a.creationTime=fe(t.getUint32(i)),i+=8,a.modificationTime=fe(t.getUint32(i)),i+=4,a.timescale=t.getUint32(i),i+=8,a.duration=t.getUint32(i)):(a.creationTime=fe(t.getUint32(i)),i+=4,a.modificationTime=fe(t.getUint32(i)),i+=4,a.timescale=t.getUint32(i),i+=4,a.duration=t.getUint32(i)),i+=4,r=t.getUint16(i),a.language+=String.fromCharCode((r>>10)+96),a.language+=String.fromCharCode(((r&992)>>5)+96),a.language+=String.fromCharCode((r&31)+96),a},mdia:function(e){return{boxes:ie(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:ie(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return e.byteLength>28&&(i.streamDescriptor=ie(e.subarray(28))[0]),i},moof:function(e){return{boxes:ie(e)}},moov:function(e){return{boxes:ie(e)}},mvex:function(e){return{boxes:ie(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return r.version===1?(i+=4,r.creationTime=fe(t.getUint32(i)),i+=8,r.modificationTime=fe(t.getUint32(i)),i+=4,r.timescale=t.getUint32(i),i+=8,r.duration=t.getUint32(i)):(r.creationTime=fe(t.getUint32(i)),i+=4,r.modificationTime=fe(t.getUint32(i)),i+=4,r.timescale=t.getUint32(i),i+=4,r.duration=t.getUint32(i)),i+=4,r.rate=t.getUint16(i)+t.getUint16(i+2)/16,i+=4,r.volume=t.getUint8(i)+t.getUint8(i+1)/8,i+=2,i+=2,i+=2*4,r.matrix=new Uint32Array(e.subarray(i,i+9*4)),i+=9*4,i+=6*4,r.nextTrackId=t.getUint32(i),r},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},i;for(i=4;i<e.byteLength;i++)t.samples.push({dependsOn:(e[i]&48)>>4,isDependedOn:(e[i]&12)>>2,hasRedundancy:e[i]&3});return t},sidx:yh(),smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:ie(e)}},ctts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),compositionOffsets:[]},r=t.getUint32(4),a;for(a=8;r;a+=8,r--)i.compositionOffsets.push({sampleCount:t.getUint32(a),sampleOffset:t[i.version===0?"getUint32":"getInt32"](a+4)});return i},stss:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),syncSamples:[]},r=t.getUint32(4),a;for(a=8;r;a+=4,r--)i.syncSamples.push(t.getUint32(a));return i},stco:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},r=t.getUint32(4),a;for(a=8;r;a+=4,r--)i.chunkOffsets.push(t.getUint32(a));return i},stsc:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=t.getUint32(4),r={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]},a;for(a=8;i;a+=12,i--)r.sampleToChunks.push({firstChunk:t.getUint32(a),samplesPerChunk:t.getUint32(a+4),sampleDescriptionIndex:t.getUint32(a+8)});return r},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:ie(e.subarray(8))}},stsz:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:t.getUint32(4),entries:[]},r;for(r=12;r<e.byteLength;r+=4)i.entries.push(t.getUint32(r));return i},stts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},r=t.getUint32(4),a;for(a=8;r;a+=8,r--)i.timeToSamples.push({sampleCount:t.getUint32(a),sampleDelta:t.getUint32(a+4)});return i},styp:function(e){return ze.ftyp(e)},tfdt:fr,tfhd:dr,tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),i=4,r={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return r.version===1?(i+=4,r.creationTime=fe(t.getUint32(i)),i+=8,r.modificationTime=fe(t.getUint32(i)),i+=4,r.trackId=t.getUint32(i),i+=4,i+=8,r.duration=t.getUint32(i)):(r.creationTime=fe(t.getUint32(i)),i+=4,r.modificationTime=fe(t.getUint32(i)),i+=4,r.trackId=t.getUint32(i),i+=4,i+=4,r.duration=t.getUint32(i)),i+=4,i+=2*4,r.layer=t.getUint16(i),i+=2,r.alternateGroup=t.getUint16(i),i+=2,r.volume=t.getUint8(i)+t.getUint8(i+1)/8,i+=2,i+=2,r.matrix=new Uint32Array(e.subarray(i,i+9*4)),i+=9*4,r.width=t.getUint16(i)+t.getUint16(i+2)/65536,i+=4,r.height=t.getUint16(i)+t.getUint16(i+2)/65536,r},traf:function(e){return{boxes:ie(e)}},trak:function(e){return{boxes:ie(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:e[20]&3,sampleIsDependedOn:(e[21]&192)>>6,sampleHasRedundancy:(e[21]&48)>>4,samplePaddingValue:(e[21]&14)>>1,sampleIsDifferenceSample:!!(e[21]&1),sampleDegradationPriority:t.getUint16(22)}},trun:cr,"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}};ie=function(e){for(var t=0,i=[],r,a,s,o,l,u=new ArrayBuffer(e.length),h=new Uint8Array(u),d=0;d<e.length;++d)h[d]=e[d];for(r=new DataView(u);t<e.byteLength;)a=r.getUint32(t),s=It(e.subarray(t+4,t+8)),o=a>1?t+a:e.byteLength,l=(ze[s]||function(c){return{data:c}})(e.subarray(t+8,o)),l.size=a,l.type=s,i.push(l),t=o;return i},Mr=function(e,t){var i;return t=t||0,i=new Array(t*2+1).join(" "),e.map(function(r,a){return i+r.type+`
`+Object.keys(r).filter(function(s){return s!=="type"&&s!=="boxes"}).map(function(s){var o=i+"  "+s+": ",l=r[s];if(l instanceof Uint8Array||l instanceof Uint32Array){var u=Array.prototype.slice.call(new Uint8Array(l.buffer,l.byteOffset,l.byteLength)).map(function(h){return" "+("00"+h.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return u?u.length===1?o+"<"+u.join("").slice(1)+">":o+`<
`+u.map(function(h){return i+"  "+h}).join(`
`)+`
`+i+"  >":o+"<>"}return o+JSON.stringify(l,null,2).split(`
`).map(function(h,d){return d===0?h:i+"  "+h}).join(`
`)}).join(`
`)+(r.boxes?`
`+Mr(r.boxes,t+1):"")}).join(`
`)};var bh={inspect:ie,textify:Mr,parseType:It,findBox:vh,parseTraf:ze.traf,parseTfdt:ze.tfdt,parseHdlr:ze.hdlr,parseTfhd:ze.tfhd,parseTrun:ze.trun,parseSidx:ze.sidx},Sh={8:"audio",9:"video",18:"metadata"},Th=function(e){return"0x"+("00"+e.toString(16)).slice(-2).toUpperCase()},kr=function(e){for(var t=[],i;e.byteLength>0;)i=0,t.push(Th(e[i++])),e=e.subarray(i);return t.join(" ")},wh=function(e,t){var i=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"],r=e[1]&parseInt("01111111",2)<<16|e[2]<<8|e[3];return t=t||{},t.avcPacketType=i[e[0]],t.CompositionTime=e[1]&parseInt("10000000",2)?-r:r,e[0]===1?t.nalUnitTypeRaw=kr(e.subarray(4,100)):t.data=kr(e.subarray(4)),t},Eh=function(e,t){var i=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"],r=e[0]&parseInt("00001111",2);return t=t||{},t.frameType=i[(e[0]&parseInt("11110000",2))>>>4],t.codecID=r,r===7?wh(e.subarray(1),t):t},_h=function(e,t){var i=["AAC Sequence Header","AAC Raw"];return t=t||{},t.aacPacketType=i[e[0]],t.data=kr(e.subarray(1)),t},Ph=function(e,t){var i=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"],r=["5.5-kHz","11-kHz","22-kHz","44-kHz"],a=(e[0]&parseInt("11110000",2))>>>4;return t=t||{},t.soundFormat=i[a],t.soundRate=r[(e[0]&parseInt("00001100",2))>>>2],t.soundSize=(e[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",t.soundType=e[0]&parseInt("00000001",2)?"Stereo":"Mono",a===10?_h(e.subarray(1),t):t},Ah=function(e){return{tagType:Sh[e[0]],dataSize:e[1]<<16|e[2]<<8|e[3],timestamp:e[7]<<24|e[4]<<16|e[5]<<8|e[6],streamID:e[8]<<16|e[9]<<8|e[10]}},vs=function(e){var t=Ah(e);switch(e[0]){case 8:Ph(e.subarray(11),t);break;case 9:Eh(e.subarray(11),t);break}return t},Oh=function(e){var t=9,i,r=[],a;for(t+=4;t<e.byteLength;)i=e[t+1]<<16,i|=e[t+2]<<8,i|=e[t+3],i+=11,a=e.subarray(t,t+i),r.push(vs(a)),t+=i+4;return r},Rh=function(e){return JSON.stringify(e,null,2)},Ih={inspectTag:vs,inspect:Oh,textify:Rh},Ur=ai,xs=function(e){var t=e[1]&31;return t<<=8,t|=e[2],t},Ei=function(e){return!!(e[1]&64)},_i=function(e){var t=0;return(e[3]&48)>>>4>1&&(t+=e[4]+1),t},Lh=function(e,t){var i=xs(e);return i===0?"pat":i===t?"pmt":t?"pes":null},Ch=function(e){var t=Ei(e),i=4+_i(e);return t&&(i+=e[i]+1),(e[i+10]&31)<<8|e[i+11]},Dh=function(e){var t={},i=Ei(e),r=4+_i(e);if(i&&(r+=e[r]+1),!!(e[r+5]&1)){var a,s,o;a=(e[r+1]&15)<<8|e[r+2],s=3+a-4,o=(e[r+10]&15)<<8|e[r+11];for(var l=12+o;l<s;){var u=r+l;t[(e[u+1]&31)<<8|e[u+2]]=e[u],l+=((e[u+3]&15)<<8|e[u+4])+5}return t}},Fh=function(e,t){var i=xs(e),r=t[i];switch(r){case Ur.H264_STREAM_TYPE:return"video";case Ur.ADTS_STREAM_TYPE:return"audio";case Ur.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},Mh=function(e){var t=Ei(e);if(!t)return null;var i=4+_i(e);if(i>=e.byteLength)return null;var r=null,a;return a=e[i+7],a&192&&(r={},r.pts=(e[i+9]&14)<<27|(e[i+10]&255)<<20|(e[i+11]&254)<<12|(e[i+12]&255)<<5|(e[i+13]&254)>>>3,r.pts*=4,r.pts+=(e[i+13]&6)>>>1,r.dts=r.pts,a&64&&(r.dts=(e[i+14]&14)<<27|(e[i+15]&255)<<20|(e[i+16]&254)<<12|(e[i+17]&255)<<5|(e[i+18]&254)>>>3,r.dts*=4,r.dts+=(e[i+18]&6)>>>1)),r},Nr=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},kh=function(e){for(var t=4+_i(e),i=e.subarray(t),r=0,a=0,s=!1,o;a<i.byteLength-3;a++)if(i[a+2]===1){r=a+5;break}for(;r<i.byteLength;)switch(i[r]){case 0:if(i[r-1]!==0){r+=2;break}else if(i[r-2]!==0){r++;break}a+3!==r-2&&(o=Nr(i[a+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(s=!0));do r++;while(i[r]!==1&&r<i.length);a=r-2,r+=3;break;case 1:if(i[r-1]!==0||i[r-2]!==0){r+=3;break}o=Nr(i[a+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(s=!0),a=r-2,r+=3;break;default:r+=3;break}return i=i.subarray(a),r-=a,a=0,i&&i.byteLength>3&&(o=Nr(i[a+3]&31),o==="slice_layer_without_partitioning_rbsp_idr"&&(s=!0)),s},Uh={parseType:Lh,parsePat:Ch,parsePmt:Dh,parsePayloadUnitStartIndicator:Ei,parsePesType:Fh,parsePesTime:Mh,videoPacketContainsKeyFrame:kh},bs=ai,ot=Ga.handleRollover,z={};z.ts=Uh,z.aac=ci;var Je=Be.ONE_SECOND_IN_TS,se=188,Te=71,Nh=function(e,t){for(var i=0,r=se,a,s;r<e.byteLength;){if(e[i]===Te&&e[r]===Te){switch(a=e.subarray(i,r),s=z.ts.parseType(a,t.pid),s){case"pat":t.pid=z.ts.parsePat(a);break;case"pmt":var o=z.ts.parsePmt(a);t.table=t.table||{},Object.keys(o).forEach(function(l){t.table[l]=o[l]});break}i+=se,r+=se;continue}i++,r++}},Ss=function(e,t,i){for(var r=0,a=se,s,o,l,u,h,d=!1;a<=e.byteLength;){if(e[r]===Te&&(e[a]===Te||a===e.byteLength)){switch(s=e.subarray(r,a),o=z.ts.parseType(s,t.pid),o){case"pes":l=z.ts.parsePesType(s,t.table),u=z.ts.parsePayloadUnitStartIndicator(s),l==="audio"&&u&&(h=z.ts.parsePesTime(s),h&&(h.type="audio",i.audio.push(h),d=!0));break}if(d)break;r+=se,a+=se;continue}r++,a++}for(a=e.byteLength,r=a-se,d=!1;r>=0;){if(e[r]===Te&&(e[a]===Te||a===e.byteLength)){switch(s=e.subarray(r,a),o=z.ts.parseType(s,t.pid),o){case"pes":l=z.ts.parsePesType(s,t.table),u=z.ts.parsePayloadUnitStartIndicator(s),l==="audio"&&u&&(h=z.ts.parsePesTime(s),h&&(h.type="audio",i.audio.push(h),d=!0));break}if(d)break;r-=se,a-=se;continue}r--,a--}},Bh=function(e,t,i){for(var r=0,a=se,s,o,l,u,h,d,c,y,f=!1,g={data:[],size:0};a<e.byteLength;){if(e[r]===Te&&e[a]===Te){switch(s=e.subarray(r,a),o=z.ts.parseType(s,t.pid),o){case"pes":if(l=z.ts.parsePesType(s,t.table),u=z.ts.parsePayloadUnitStartIndicator(s),l==="video"&&(u&&!f&&(h=z.ts.parsePesTime(s),h&&(h.type="video",i.video.push(h),f=!0)),!i.firstKeyFrame)){if(u&&g.size!==0){for(d=new Uint8Array(g.size),c=0;g.data.length;)y=g.data.shift(),d.set(y,c),c+=y.byteLength;if(z.ts.videoPacketContainsKeyFrame(d)){var p=z.ts.parsePesTime(d);p?(i.firstKeyFrame=p,i.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}g.size=0}g.data.push(s),g.size+=s.byteLength}break}if(f&&i.firstKeyFrame)break;r+=se,a+=se;continue}r++,a++}for(a=e.byteLength,r=a-se,f=!1;r>=0;){if(e[r]===Te&&e[a]===Te){switch(s=e.subarray(r,a),o=z.ts.parseType(s,t.pid),o){case"pes":l=z.ts.parsePesType(s,t.table),u=z.ts.parsePayloadUnitStartIndicator(s),l==="video"&&u&&(h=z.ts.parsePesTime(s),h&&(h.type="video",i.video.push(h),f=!0));break}if(f)break;r-=se,a-=se;continue}r--,a--}},$h=function(e,t){if(e.audio&&e.audio.length){var i=t;(typeof i>"u"||isNaN(i))&&(i=e.audio[0].dts),e.audio.forEach(function(s){s.dts=ot(s.dts,i),s.pts=ot(s.pts,i),s.dtsTime=s.dts/Je,s.ptsTime=s.pts/Je})}if(e.video&&e.video.length){var r=t;if((typeof r>"u"||isNaN(r))&&(r=e.video[0].dts),e.video.forEach(function(s){s.dts=ot(s.dts,r),s.pts=ot(s.pts,r),s.dtsTime=s.dts/Je,s.ptsTime=s.pts/Je}),e.firstKeyFrame){var a=e.firstKeyFrame;a.dts=ot(a.dts,r),a.pts=ot(a.pts,r),a.dtsTime=a.dts/Je,a.ptsTime=a.pts/Je}}},Vh=function(e){for(var t=!1,i=0,r=null,a=null,s=0,o=0,l;e.length-o>=3;){var u=z.aac.parseType(e,o);switch(u){case"timed-metadata":if(e.length-o<10){t=!0;break}if(s=z.aac.parseId3TagSize(e,o),s>e.length){t=!0;break}a===null&&(l=e.subarray(o,o+s),a=z.aac.parseAacTimestamp(l)),o+=s;break;case"audio":if(e.length-o<7){t=!0;break}if(s=z.aac.parseAdtsSize(e,o),s>e.length){t=!0;break}r===null&&(l=e.subarray(o,o+s),r=z.aac.parseSampleRate(l)),i++,o+=s;break;default:o++;break}if(t)return null}if(r===null||a===null)return null;var h=Je/r,d={audio:[{type:"audio",dts:a,pts:a},{type:"audio",dts:a+i*1024*h,pts:a+i*1024*h}]};return d},zh=function(e){var t={pid:null,table:null},i={};Nh(e,t);for(var r in t.table)if(t.table.hasOwnProperty(r)){var a=t.table[r];switch(a){case bs.H264_STREAM_TYPE:i.video=[],Bh(e,t,i),i.video.length===0&&delete i.video;break;case bs.ADTS_STREAM_TYPE:i.audio=[],Ss(e,t,i),i.audio.length===0&&delete i.audio;break}}return i},Hh=function(e,t){var i=z.aac.isLikelyAacData(e),r;return i?r=Vh(e):r=zh(e),!r||!r.audio&&!r.video?null:($h(r,t),r)},Gh={inspect:Hh,parseAudioPes_:Ss},Pi={codecs:Jn,mp4:Hu,flv:eh,mp2t:th,partial:gh};Pi.mp4.tools=bh,Pi.flv.tools=Ih,Pi.mp2t.tools=Gh;var qh=Pi;class Wh{constructor(e){m(this,"hls");m(this,"transmuxer");m(this,"remuxedSegments",[]);m(this,"remuxedInitSegment",null);m(this,"translate",e=>{this.transmuxer.push(new Uint8Array(e.arrayBuffer)),this.transmuxer.flush()});m(this,"onMuxedData",e=>{this.remuxedSegments.push(e);let t;this.remuxedInitSegment?t=new Uint8Array(e.data):(this.remuxedInitSegment=e.initSegment,t=new Uint8Array(e.initSegment.byteLength+e.data.byteLength),t.set(e.initSegment,0),t.set(e.data,e.initSegment.byteLength)),this.hls.emit(de.Muxed,t)});this.hls=e,this.transmuxer=new qh.mp4.Transmuxer,this.transmuxer.on("data",this.onMuxedData),this.register()}register(){this.hls.on(de.TsLoaded,this.translate)}}function Br(n,e){return Br=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},Br(n,e)}function $r(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,Br(n,e)}var Vr=function(){function n(){this.listeners={}}var e=n.prototype;return e.on=function(i,r){this.listeners[i]||(this.listeners[i]=[]),this.listeners[i].push(r)},e.off=function(i,r){if(!this.listeners[i])return!1;var a=this.listeners[i].indexOf(r);return this.listeners[i]=this.listeners[i].slice(0),this.listeners[i].splice(a,1),a>-1},e.trigger=function(i){var r=this.listeners[i];if(r)if(arguments.length===2)for(var a=r.length,s=0;s<a;++s)r[s].call(this,arguments[1]);else for(var o=Array.prototype.slice.call(arguments,1),l=r.length,u=0;u<l;++u)r[u].apply(this,o)},e.dispose=function(){this.listeners={}},e.pipe=function(i){this.on("data",function(r){i.push(r)})},n}();function Ai(){return Ai=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Ai.apply(this,arguments)}function Xh(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}var Lt;typeof window<"u"?Lt=window:typeof Hi<"u"?Lt=Hi:typeof self<"u"?Lt=self:Lt={};var Yh=Lt;const Ts=Gi(Yh);var Kh=function(e){return Ts.atob?Ts.atob(e):Buffer.from(e,"base64").toString("binary")};function Qh(n){for(var e=Kh(n),t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}/*! @name m3u8-parser @version 4.7.0 @license Apache-2.0 */var jh=function(n){$r(e,n);function e(){var i;return i=n.call(this)||this,i.buffer="",i}var t=e.prototype;return t.push=function(r){var a;for(this.buffer+=r,a=this.buffer.indexOf(`
`);a>-1;a=this.buffer.indexOf(`
`))this.trigger("data",this.buffer.substring(0,a)),this.buffer=this.buffer.substring(a+1)},e}(Vr),Jh=String.fromCharCode(9),zr=function(e){var t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),i={};return t[1]&&(i.length=parseInt(t[1],10)),t[2]&&(i.offset=parseInt(t[2],10)),i},Zh=function(){var e="[^=]*",t='"[^"]*"|[^,]*',i="(?:"+e+")=(?:"+t+")";return new RegExp("(?:^|,)("+i+")")},ye=function(e){for(var t=e.split(Zh()),i={},r=t.length,a;r--;)t[r]!==""&&(a=/([^=]*)=(.*)/.exec(t[r]).slice(1),a[0]=a[0].replace(/^\s+|\s+$/g,""),a[1]=a[1].replace(/^\s+|\s+$/g,""),a[1]=a[1].replace(/^['"](.*)['"]$/g,"$1"),i[a[0]]=a[1]);return i},ed=function(n){$r(e,n);function e(){var i;return i=n.call(this)||this,i.customParsers=[],i.tagMappers=[],i}var t=e.prototype;return t.push=function(r){var a=this,s,o;if(r=r.trim(),r.length!==0){if(r[0]!=="#"){this.trigger("data",{type:"uri",uri:r});return}var l=this.tagMappers.reduce(function(u,h){var d=h(r);return d===r?u:u.concat([d])},[r]);l.forEach(function(u){for(var h=0;h<a.customParsers.length;h++)if(a.customParsers[h].call(a,u))return;if(u.indexOf("#EXT")!==0){a.trigger("data",{type:"comment",text:u.slice(1)});return}if(u=u.replace("\r",""),s=/^#EXTM3U/.exec(u),s){a.trigger("data",{type:"tag",tagType:"m3u"});return}if(s=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(u),s){o={type:"tag",tagType:"inf"},s[1]&&(o.duration=parseFloat(s[1])),s[2]&&(o.title=s[2]),a.trigger("data",o);return}if(s=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(u),s){o={type:"tag",tagType:"targetduration"},s[1]&&(o.duration=parseInt(s[1],10)),a.trigger("data",o);return}if(s=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(u),s){o={type:"tag",tagType:"version"},s[1]&&(o.version=parseInt(s[1],10)),a.trigger("data",o);return}if(s=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(u),s){o={type:"tag",tagType:"media-sequence"},s[1]&&(o.number=parseInt(s[1],10)),a.trigger("data",o);return}if(s=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(u),s){o={type:"tag",tagType:"discontinuity-sequence"},s[1]&&(o.number=parseInt(s[1],10)),a.trigger("data",o);return}if(s=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(u),s){o={type:"tag",tagType:"playlist-type"},s[1]&&(o.playlistType=s[1]),a.trigger("data",o);return}if(s=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(u),s){o=Ai(zr(s[1]),{type:"tag",tagType:"byterange"}),a.trigger("data",o);return}if(s=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(u),s){o={type:"tag",tagType:"allow-cache"},s[1]&&(o.allowed=!/NO/.test(s[1])),a.trigger("data",o);return}if(s=/^#EXT-X-MAP:?(.*)$/.exec(u),s){if(o={type:"tag",tagType:"map"},s[1]){var d=ye(s[1]);d.URI&&(o.uri=d.URI),d.BYTERANGE&&(o.byterange=zr(d.BYTERANGE))}a.trigger("data",o);return}if(s=/^#EXT-X-STREAM-INF:?(.*)$/.exec(u),s){if(o={type:"tag",tagType:"stream-inf"},s[1]){if(o.attributes=ye(s[1]),o.attributes.RESOLUTION){var c=o.attributes.RESOLUTION.split("x"),y={};c[0]&&(y.width=parseInt(c[0],10)),c[1]&&(y.height=parseInt(c[1],10)),o.attributes.RESOLUTION=y}o.attributes.BANDWIDTH&&(o.attributes.BANDWIDTH=parseInt(o.attributes.BANDWIDTH,10)),o.attributes["PROGRAM-ID"]&&(o.attributes["PROGRAM-ID"]=parseInt(o.attributes["PROGRAM-ID"],10))}a.trigger("data",o);return}if(s=/^#EXT-X-MEDIA:?(.*)$/.exec(u),s){o={type:"tag",tagType:"media"},s[1]&&(o.attributes=ye(s[1])),a.trigger("data",o);return}if(s=/^#EXT-X-ENDLIST/.exec(u),s){a.trigger("data",{type:"tag",tagType:"endlist"});return}if(s=/^#EXT-X-DISCONTINUITY/.exec(u),s){a.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(s=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(u),s){o={type:"tag",tagType:"program-date-time"},s[1]&&(o.dateTimeString=s[1],o.dateTimeObject=new Date(s[1])),a.trigger("data",o);return}if(s=/^#EXT-X-KEY:?(.*)$/.exec(u),s){o={type:"tag",tagType:"key"},s[1]&&(o.attributes=ye(s[1]),o.attributes.IV&&(o.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(o.attributes.IV=o.attributes.IV.substring(2)),o.attributes.IV=o.attributes.IV.match(/.{8}/g),o.attributes.IV[0]=parseInt(o.attributes.IV[0],16),o.attributes.IV[1]=parseInt(o.attributes.IV[1],16),o.attributes.IV[2]=parseInt(o.attributes.IV[2],16),o.attributes.IV[3]=parseInt(o.attributes.IV[3],16),o.attributes.IV=new Uint32Array(o.attributes.IV))),a.trigger("data",o);return}if(s=/^#EXT-X-START:?(.*)$/.exec(u),s){o={type:"tag",tagType:"start"},s[1]&&(o.attributes=ye(s[1]),o.attributes["TIME-OFFSET"]=parseFloat(o.attributes["TIME-OFFSET"]),o.attributes.PRECISE=/YES/.test(o.attributes.PRECISE)),a.trigger("data",o);return}if(s=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(u),s){o={type:"tag",tagType:"cue-out-cont"},s[1]?o.data=s[1]:o.data="",a.trigger("data",o);return}if(s=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(u),s){o={type:"tag",tagType:"cue-out"},s[1]?o.data=s[1]:o.data="",a.trigger("data",o);return}if(s=/^#EXT-X-CUE-IN:?(.*)?$/.exec(u),s){o={type:"tag",tagType:"cue-in"},s[1]?o.data=s[1]:o.data="",a.trigger("data",o);return}if(s=/^#EXT-X-SKIP:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"skip"},o.attributes=ye(s[1]),o.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(o.attributes["SKIPPED-SEGMENTS"]=parseInt(o.attributes["SKIPPED-SEGMENTS"],10)),o.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(o.attributes["RECENTLY-REMOVED-DATERANGES"]=o.attributes["RECENTLY-REMOVED-DATERANGES"].split(Jh)),a.trigger("data",o);return}if(s=/^#EXT-X-PART:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"part"},o.attributes=ye(s[1]),["DURATION"].forEach(function(f){o.attributes.hasOwnProperty(f)&&(o.attributes[f]=parseFloat(o.attributes[f]))}),["INDEPENDENT","GAP"].forEach(function(f){o.attributes.hasOwnProperty(f)&&(o.attributes[f]=/YES/.test(o.attributes[f]))}),o.attributes.hasOwnProperty("BYTERANGE")&&(o.attributes.byterange=zr(o.attributes.BYTERANGE)),a.trigger("data",o);return}if(s=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"server-control"},o.attributes=ye(s[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach(function(f){o.attributes.hasOwnProperty(f)&&(o.attributes[f]=parseFloat(o.attributes[f]))}),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach(function(f){o.attributes.hasOwnProperty(f)&&(o.attributes[f]=/YES/.test(o.attributes[f]))}),a.trigger("data",o);return}if(s=/^#EXT-X-PART-INF:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"part-inf"},o.attributes=ye(s[1]),["PART-TARGET"].forEach(function(f){o.attributes.hasOwnProperty(f)&&(o.attributes[f]=parseFloat(o.attributes[f]))}),a.trigger("data",o);return}if(s=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"preload-hint"},o.attributes=ye(s[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach(function(f){if(o.attributes.hasOwnProperty(f)){o.attributes[f]=parseInt(o.attributes[f],10);var g=f==="BYTERANGE-LENGTH"?"length":"offset";o.attributes.byterange=o.attributes.byterange||{},o.attributes.byterange[g]=o.attributes[f],delete o.attributes[f]}}),a.trigger("data",o);return}if(s=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(u),s&&s[1]){o={type:"tag",tagType:"rendition-report"},o.attributes=ye(s[1]),["LAST-MSN","LAST-PART"].forEach(function(f){o.attributes.hasOwnProperty(f)&&(o.attributes[f]=parseInt(o.attributes[f],10))}),a.trigger("data",o);return}a.trigger("data",{type:"tag",data:u.slice(4)})})}},t.addParser=function(r){var a=this,s=r.expression,o=r.customType,l=r.dataParser,u=r.segment;typeof l!="function"&&(l=function(d){return d}),this.customParsers.push(function(h){var d=s.exec(h);if(d)return a.trigger("data",{type:"custom",data:l(h),customType:o,segment:u}),!0})},t.addTagMapper=function(r){var a=r.expression,s=r.map,o=function(u){return a.test(u)?s(u):u};this.tagMappers.push(o)},e}(Vr),td=function(e){return e.toLowerCase().replace(/-(\w)/g,function(t){return t[1].toUpperCase()})},lt=function(e){var t={};return Object.keys(e).forEach(function(i){t[td(i)]=e[i]}),t},Hr=function(e){var t=e.serverControl,i=e.targetDuration,r=e.partTargetDuration;if(t){var a="#EXT-X-SERVER-CONTROL",s="holdBack",o="partHoldBack",l=i&&i*3,u=r&&r*2;i&&!t.hasOwnProperty(s)&&(t[s]=l,this.trigger("info",{message:a+" defaulting HOLD-BACK to targetDuration * 3 ("+l+")."})),l&&t[s]<l&&(this.trigger("warn",{message:a+" clamping HOLD-BACK ("+t[s]+") to targetDuration * 3 ("+l+")"}),t[s]=l),r&&!t.hasOwnProperty(o)&&(t[o]=r*3,this.trigger("info",{message:a+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+t[o]+")."})),r&&t[o]<u&&(this.trigger("warn",{message:a+" clamping PART-HOLD-BACK ("+t[o]+") to partTargetDuration * 2 ("+u+")."}),t[o]=u)}},id=function(n){$r(e,n);function e(){var i;i=n.call(this)||this,i.lineStream=new jh,i.parseStream=new ed,i.lineStream.pipe(i.parseStream);var r=Xh(i),a=[],s={},o,l,u=!1,h=function(){},d={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},c="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",y=0;i.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var f=0,g=0;return i.on("end",function(){s.uri||!s.parts&&!s.preloadHints||(!s.map&&o&&(s.map=o),!s.key&&l&&(s.key=l),!s.timeline&&typeof y=="number"&&(s.timeline=y),i.manifest.preloadSegment=s)}),i.parseStream.on("data",function(p){var x,_;({tag:function(){({version:function(){p.version&&(this.manifest.version=p.version)},"allow-cache":function(){this.manifest.allowCache=p.allowed,"allowed"in p||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var P={};"length"in p&&(s.byterange=P,P.length=p.length,"offset"in p||(p.offset=f)),"offset"in p&&(s.byterange=P,P.offset=p.offset),f=P.offset+P.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),p.duration>0&&(s.duration=p.duration),p.duration===0&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=a},key:function(){if(!p.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(p.attributes.METHOD==="NONE"){l=null;return}if(!p.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(p.attributes.KEYFORMAT==="com.apple.streamingkeydelivery"){this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:p.attributes};return}if(p.attributes.KEYFORMAT===c){var P=["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"];if(P.indexOf(p.attributes.METHOD)===-1){this.trigger("warn",{message:"invalid key method provided for Widevine"});return}if(p.attributes.METHOD==="SAMPLE-AES-CENC"&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),p.attributes.URI.substring(0,23)!=="data:text/plain;base64,"){this.trigger("warn",{message:"invalid key URI provided for Widevine"});return}if(!(p.attributes.KEYID&&p.attributes.KEYID.substring(0,2)==="0x")){this.trigger("warn",{message:"invalid key ID provided for Widevine"});return}this.manifest.contentProtection=this.manifest.contentProtection||{},this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:p.attributes.KEYFORMAT,keyId:p.attributes.KEYID.substring(2)},pssh:Qh(p.attributes.URI.split(",")[1])};return}p.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),l={method:p.attributes.METHOD||"AES-128",uri:p.attributes.URI},typeof p.attributes.IV<"u"&&(l.iv=p.attributes.IV)},"media-sequence":function(){if(!isFinite(p.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+p.number});return}this.manifest.mediaSequence=p.number},"discontinuity-sequence":function(){if(!isFinite(p.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+p.number});return}this.manifest.discontinuitySequence=p.number,y=p.number},"playlist-type":function(){if(!/VOD|EVENT/.test(p.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+p.playlist});return}this.manifest.playlistType=p.playlistType},map:function(){o={},p.uri&&(o.uri=p.uri),p.byterange&&(o.byterange=p.byterange),l&&(o.key=l)},"stream-inf":function(){if(this.manifest.playlists=a,this.manifest.mediaGroups=this.manifest.mediaGroups||d,!p.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}s.attributes||(s.attributes={}),Ai(s.attributes,p.attributes)},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||d,!(p.attributes&&p.attributes.TYPE&&p.attributes["GROUP-ID"]&&p.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}var P=this.manifest.mediaGroups[p.attributes.TYPE];P[p.attributes["GROUP-ID"]]=P[p.attributes["GROUP-ID"]]||{},x=P[p.attributes["GROUP-ID"]],_={default:/yes/i.test(p.attributes.DEFAULT)},_.default?_.autoselect=!0:_.autoselect=/yes/i.test(p.attributes.AUTOSELECT),p.attributes.LANGUAGE&&(_.language=p.attributes.LANGUAGE),p.attributes.URI&&(_.uri=p.attributes.URI),p.attributes["INSTREAM-ID"]&&(_.instreamId=p.attributes["INSTREAM-ID"]),p.attributes.CHARACTERISTICS&&(_.characteristics=p.attributes.CHARACTERISTICS),p.attributes.FORCED&&(_.forced=/yes/i.test(p.attributes.FORCED)),x[p.attributes.NAME]=_},discontinuity:function(){y+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(a.length)},"program-date-time":function(){typeof this.manifest.dateTimeString>"u"&&(this.manifest.dateTimeString=p.dateTimeString,this.manifest.dateTimeObject=p.dateTimeObject),s.dateTimeString=p.dateTimeString,s.dateTimeObject=p.dateTimeObject},targetduration:function(){if(!isFinite(p.duration)||p.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+p.duration});return}this.manifest.targetDuration=p.duration,Hr.call(this,this.manifest)},start:function(){if(!p.attributes||isNaN(p.attributes["TIME-OFFSET"])){this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"});return}this.manifest.start={timeOffset:p.attributes["TIME-OFFSET"],precise:p.attributes.PRECISE}},"cue-out":function(){s.cueOut=p.data},"cue-out-cont":function(){s.cueOutCont=p.data},"cue-in":function(){s.cueIn=p.data},skip:function(){this.manifest.skip=lt(p.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",p.attributes,["SKIPPED-SEGMENTS"])},part:function(){var P=this;u=!0;var N=this.manifest.segments.length,H=lt(p.attributes);s.parts=s.parts||[],s.parts.push(H),H.byterange&&(H.byterange.hasOwnProperty("offset")||(H.byterange.offset=g),g=H.byterange.offset+H.byterange.length);var S=s.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+S+" for segment #"+N,p.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(function(F,v){F.hasOwnProperty("lastPart")||P.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+v+" lacks required attribute(s): LAST-PART"})})},"server-control":function(){var P=this.manifest.serverControl=lt(p.attributes);P.hasOwnProperty("canBlockReload")||(P.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),Hr.call(this,this.manifest),P.canSkipDateranges&&!P.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var P=this.manifest.segments.length,N=lt(p.attributes),H=N.type&&N.type==="PART";s.preloadHints=s.preloadHints||[],s.preloadHints.push(N),N.byterange&&(N.byterange.hasOwnProperty("offset")||(N.byterange.offset=H?g:0,H&&(g=N.byterange.offset+N.byterange.length)));var S=s.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+S+" for segment #"+P,p.attributes,["TYPE","URI"]),!!N.type)for(var F=0;F<s.preloadHints.length-1;F++){var v=s.preloadHints[F];v.type&&v.type===N.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+S+" for segment #"+P+" has the same TYPE "+N.type+" as preload hint #"+F})}},"rendition-report":function(){var P=lt(p.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(P);var N=this.manifest.renditionReports.length-1,H=["LAST-MSN","URI"];u&&H.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+N,p.attributes,H)},"part-inf":function(){this.manifest.partInf=lt(p.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",p.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),Hr.call(this,this.manifest)}}[p.tagType]||h).call(r)},uri:function(){s.uri=p.uri,a.push(s),this.manifest.targetDuration&&!("duration"in s)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),l&&(s.key=l),s.timeline=y,o&&(s.map=o),g=0,s={}},comment:function(){},custom:function(){p.segment?(s.custom=s.custom||{},s.custom[p.customType]=p.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[p.customType]=p.data)}})[p.type].call(r)}),i}var t=e.prototype;return t.warnOnMissingAttributes_=function(r,a,s){var o=[];s.forEach(function(l){a.hasOwnProperty(l)||o.push(l)}),o.length&&this.trigger("warn",{message:r+" lacks required attribute(s): "+o.join(", ")})},t.push=function(r){this.lineStream.push(r)},t.end=function(){this.lineStream.push(`
`),this.trigger("end")},t.addParser=function(r){this.parseStream.addParser(r)},t.addTagMapper=function(r){this.parseStream.addTagMapper(r)},e}(Vr);class rd{constructor(e){m(this,"parser");m(this,"hls");m(this,"playManifest");m(this,"segmentIndex",-1);m(this,"m3u8Promise");m(this,"origin","");this.hls=e,this.parser=new id}getM3u8Data(e){if(this.origin=new window.URL(e).origin,!this.origin){let i=`资源地址错误: ${e}`;return b.warn("Loader getM3u8Data error",i),Promise.reject(i)}let t=new Promise((i,r)=>{this.hls.emit(de.ManifestLoading),fetch(e,{}).then(a=>{if(a.ok&&a.status===200)return a.text();r("response not 200")}).then(a=>{this.hls.emit(de.ManifestLoaded,a),this.parser.push(a),this.parser.end(),this.playManifest=this.parser.manifest,this.setTotalDuration(),this.hls.emit(de.ManifestParsed,this.parser.manifest),i(this.parser.manifest)})});return this.m3u8Promise=t,t}getTsData(e){this.segmentIndex=e===void 0?this.segmentIndex+1:e;let t=this.playManifest.segments[this.segmentIndex],i=this.origin+t.uri;if(!i){b.warn(`Loader getTsData - TS Url not found, index: ${this.segmentIndex}`);return}this.hls.emit(de.TsLoading,t),fetch(i,{}).then(r=>{if(r.ok&&r.status===200)return r.arrayBuffer()}).then(r=>{this.hls.emit(de.TsLoaded,{segment:t,arrayBuffer:r})})}setTotalDuration(){let e=0,t=0;for(let i of this.playManifest.segments)e+=i.duration,i.index=t++;this.playManifest.totalDuration=e,this.playManifest.avgDuration=Number((e/t).toFixed(2))}}class nd extends Vn{constructor(){super();m(this,"video");m(this,"mseController");m(this,"loader");m(this,"muxer");this.mseController=new dl(this),this.loader=new rd(this),this.muxer=new Wh(this)}loadSource(t){this.loader.getM3u8Data(t)}attachMedia(t){this.mseController.attachMedia(t)}destroy(){}}const ad=nd;class sd extends Ht{constructor(e,t){super(e,t),b.info("HlsLitePlayer - 创建 HlsLitePlayer")}load(e,t=!1){return this.checkUrl(e,t)?(this.nPlayer&&this.recordPlayStatus(e),new Promise(i=>{this.createHlsInstance().then(r=>{r&&(this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}),this.setUrl(e),this.nPlayer.loadSource(e),this.nPlayer.attachMedia(this.video),i(!0)})})):Promise.reject(!1)}reload(){return this.load(this.cacheUrl||this.url,!0)}async createHlsInstance(){let e=await this.destroy();return this.nPlayer=new ad,e}destroy(){return new Promise(e=>{this.nPlayer?(this.nPlayer.destroy(),e(!0)):e(!1)})}getBandwidthEstimate(){return 0}}function od(n){let{scheduleOption:e}=n;return!e.enable&&e.debugPlayer?e.debugPlayer:X.Hls}function ws(n){var a;let{scheduleOption:e,type:t,liveOption:i}=n,{playerData:r}=e;if(t==="live"){let s=i.type;return!s||s==="auto"?+r.live_type==1?X.Hls:Z.isSupported()?X.Flv:X.Hls:s}else return(a=r.default_server)!=null&&a.mp4_domainnames?X.Native:od(n)}var ld=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),i=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var r=42;e[t]=r;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(e,t);if(s.value!==r||s.enumerable!==!0)return!1}return!0},Es=typeof Symbol<"u"&&Symbol,ud=ld,hd=function(){return typeof Es!="function"||typeof Symbol!="function"||typeof Es("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:ud()},dd="Function.prototype.bind called on incompatible ",Gr=Array.prototype.slice,cd=Object.prototype.toString,fd="[object Function]",pd=function(e){var t=this;if(typeof t!="function"||cd.call(t)!==fd)throw new TypeError(dd+t);for(var i=Gr.call(arguments,1),r,a=function(){if(this instanceof r){var h=t.apply(this,i.concat(Gr.call(arguments)));return Object(h)===h?h:this}else return t.apply(e,i.concat(Gr.call(arguments)))},s=Math.max(0,t.length-i.length),o=[],l=0;l<s;l++)o.push("$"+l);if(r=Function("binder","return function ("+o.join(",")+"){ return binder.apply(this,arguments); }")(a),t.prototype){var u=function(){};u.prototype=t.prototype,r.prototype=new u,u.prototype=null}return r},md=pd,qr=Function.prototype.bind||md,gd=qr,yd=gd.call(Function.call,Object.prototype.hasOwnProperty),D,ut=SyntaxError,_s=Function,ht=TypeError,Wr=function(n){try{return _s('"use strict"; return ('+n+").constructor;")()}catch{}},Ze=Object.getOwnPropertyDescriptor;if(Ze)try{Ze({},"")}catch{Ze=null}var Xr=function(){throw new ht},vd=Ze?function(){try{return arguments.callee,Xr}catch{try{return Ze(arguments,"callee").get}catch{return Xr}}}():Xr,dt=hd(),we=Object.getPrototypeOf||function(n){return n.__proto__},ct={},xd=typeof Uint8Array>"u"?D:we(Uint8Array),et={"%AggregateError%":typeof AggregateError>"u"?D:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?D:ArrayBuffer,"%ArrayIteratorPrototype%":dt?we([][Symbol.iterator]()):D,"%AsyncFromSyncIteratorPrototype%":D,"%AsyncFunction%":ct,"%AsyncGenerator%":ct,"%AsyncGeneratorFunction%":ct,"%AsyncIteratorPrototype%":ct,"%Atomics%":typeof Atomics>"u"?D:Atomics,"%BigInt%":typeof BigInt>"u"?D:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?D:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?D:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?D:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?D:Float32Array,"%Float64Array%":typeof Float64Array>"u"?D:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?D:FinalizationRegistry,"%Function%":_s,"%GeneratorFunction%":ct,"%Int8Array%":typeof Int8Array>"u"?D:Int8Array,"%Int16Array%":typeof Int16Array>"u"?D:Int16Array,"%Int32Array%":typeof Int32Array>"u"?D:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":dt?we(we([][Symbol.iterator]())):D,"%JSON%":typeof JSON=="object"?JSON:D,"%Map%":typeof Map>"u"?D:Map,"%MapIteratorPrototype%":typeof Map>"u"||!dt?D:we(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?D:Promise,"%Proxy%":typeof Proxy>"u"?D:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?D:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?D:Set,"%SetIteratorPrototype%":typeof Set>"u"||!dt?D:we(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?D:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":dt?we(""[Symbol.iterator]()):D,"%Symbol%":dt?Symbol:D,"%SyntaxError%":ut,"%ThrowTypeError%":vd,"%TypedArray%":xd,"%TypeError%":ht,"%Uint8Array%":typeof Uint8Array>"u"?D:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?D:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?D:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?D:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?D:WeakMap,"%WeakRef%":typeof WeakRef>"u"?D:WeakRef,"%WeakSet%":typeof WeakSet>"u"?D:WeakSet};try{null.error}catch(n){var bd=we(we(n));et["%Error.prototype%"]=bd}var Sd=function n(e){var t;if(e==="%AsyncFunction%")t=Wr("async function () {}");else if(e==="%GeneratorFunction%")t=Wr("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Wr("async function* () {}");else if(e==="%AsyncGenerator%"){var i=n("%AsyncGeneratorFunction%");i&&(t=i.prototype)}else if(e==="%AsyncIteratorPrototype%"){var r=n("%AsyncGenerator%");r&&(t=we(r.prototype))}return et[e]=t,t},Ps={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ct=qr,Oi=yd,Td=Ct.call(Function.call,Array.prototype.concat),wd=Ct.call(Function.apply,Array.prototype.splice),As=Ct.call(Function.call,String.prototype.replace),Ri=Ct.call(Function.call,String.prototype.slice),Ed=Ct.call(Function.call,RegExp.prototype.exec),_d=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Pd=/\\(\\)?/g,Ad=function(e){var t=Ri(e,0,1),i=Ri(e,-1);if(t==="%"&&i!=="%")throw new ut("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&t!=="%")throw new ut("invalid intrinsic syntax, expected opening `%`");var r=[];return As(e,_d,function(a,s,o,l){r[r.length]=o?As(l,Pd,"$1"):s||a}),r},Od=function(e,t){var i=e,r;if(Oi(Ps,i)&&(r=Ps[i],i="%"+r[0]+"%"),Oi(et,i)){var a=et[i];if(a===ct&&(a=Sd(i)),typeof a>"u"&&!t)throw new ht("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:i,value:a}}throw new ut("intrinsic "+e+" does not exist!")},Yr=function(e,t){if(typeof e!="string"||e.length===0)throw new ht("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new ht('"allowMissing" argument must be a boolean');if(Ed(/^%?[^%]*%?$/,e)===null)throw new ut("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=Ad(e),r=i.length>0?i[0]:"",a=Od("%"+r+"%",t),s=a.name,o=a.value,l=!1,u=a.alias;u&&(r=u[0],wd(i,Td([0,1],u)));for(var h=1,d=!0;h<i.length;h+=1){var c=i[h],y=Ri(c,0,1),f=Ri(c,-1);if((y==='"'||y==="'"||y==="`"||f==='"'||f==="'"||f==="`")&&y!==f)throw new ut("property names with quotes must have matching quotes");if((c==="constructor"||!d)&&(l=!0),r+="."+c,s="%"+r+"%",Oi(et,s))o=et[s];else if(o!=null){if(!(c in o)){if(!t)throw new ht("base intrinsic for "+e+" exists, but the property is not available.");return}if(Ze&&h+1>=i.length){var g=Ze(o,c);d=!!g,d&&"get"in g&&!("originalValue"in g.get)?o=g.get:o=o[c]}else d=Oi(o,c),o=o[c];d&&!l&&(et[s]=o)}}return o},Os={exports:{}};(function(n){var e=qr,t=Yr,i=t("%Function.prototype.apply%"),r=t("%Function.prototype.call%"),a=t("%Reflect.apply%",!0)||e.call(r,i),s=t("%Object.getOwnPropertyDescriptor%",!0),o=t("%Object.defineProperty%",!0),l=t("%Math.max%");if(o)try{o({},"a",{value:1})}catch{o=null}n.exports=function(d){var c=a(e,r,arguments);if(s&&o){var y=s(c,"length");y.configurable&&o(c,"length",{value:1+l(0,d.length-(arguments.length-1))})}return c};var u=function(){return a(e,i,arguments)};o?o(n.exports,"apply",{value:u}):n.exports.apply=u})(Os);var Rd=Os.exports,Rs=Yr,Is=Rd,Id=Is(Rs("String.prototype.indexOf")),Ld=function(e,t){var i=Rs(e,!!t);return typeof i=="function"&&Id(e,".prototype.")>-1?Is(i):i};const Cd=Mo(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Kr=typeof Map=="function"&&Map.prototype,Qr=Object.getOwnPropertyDescriptor&&Kr?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ii=Kr&&Qr&&typeof Qr.get=="function"?Qr.get:null,Ls=Kr&&Map.prototype.forEach,jr=typeof Set=="function"&&Set.prototype,Jr=Object.getOwnPropertyDescriptor&&jr?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Li=jr&&Jr&&typeof Jr.get=="function"?Jr.get:null,Cs=jr&&Set.prototype.forEach,Dd=typeof WeakMap=="function"&&WeakMap.prototype,Dt=Dd?WeakMap.prototype.has:null,Fd=typeof WeakSet=="function"&&WeakSet.prototype,Ft=Fd?WeakSet.prototype.has:null,Md=typeof WeakRef=="function"&&WeakRef.prototype,Ds=Md?WeakRef.prototype.deref:null,kd=Boolean.prototype.valueOf,Ud=Object.prototype.toString,Nd=Function.prototype.toString,Bd=String.prototype.match,Zr=String.prototype.slice,He=String.prototype.replace,$d=String.prototype.toUpperCase,Fs=String.prototype.toLowerCase,Ms=RegExp.prototype.test,ks=Array.prototype.concat,Ee=Array.prototype.join,Vd=Array.prototype.slice,Us=Math.floor,en=typeof BigInt=="function"?BigInt.prototype.valueOf:null,tn=Object.getOwnPropertySymbols,rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,ft=typeof Symbol=="function"&&typeof Symbol.iterator=="object",re=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===ft||"symbol")?Symbol.toStringTag:null,Ns=Object.prototype.propertyIsEnumerable,Bs=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function $s(n,e){if(n===1/0||n===-1/0||n!==n||n&&n>-1e3&&n<1e3||Ms.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof n=="number"){var i=n<0?-Us(-n):Us(n);if(i!==n){var r=String(i),a=Zr.call(e,r.length+1);return He.call(r,t,"$&_")+"."+He.call(He.call(a,/([0-9]{3})/g,"$&_"),/_$/,"")}}return He.call(e,t,"$&_")}var nn=Cd,Vs=nn.custom,zs=qs(Vs)?Vs:null,zd=function n(e,t,i,r){var a=t||{};if(Ge(a,"quoteStyle")&&a.quoteStyle!=="single"&&a.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ge(a,"maxStringLength")&&(typeof a.maxStringLength=="number"?a.maxStringLength<0&&a.maxStringLength!==1/0:a.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=Ge(a,"customInspect")?a.customInspect:!0;if(typeof s!="boolean"&&s!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ge(a,"indent")&&a.indent!==null&&a.indent!=="	"&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ge(a,"numericSeparator")&&typeof a.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var o=a.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Xs(e,a);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var l=String(e);return o?$s(e,l):l}if(typeof e=="bigint"){var u=String(e)+"n";return o?$s(e,u):u}var h=typeof a.depth>"u"?5:a.depth;if(typeof i>"u"&&(i=0),i>=h&&h>0&&typeof e=="object")return an(e)?"[Array]":"[Object]";var d=sc(a,i);if(typeof r>"u")r=[];else if(Ws(r,e)>=0)return"[Circular]";function c(M,oe,vt){if(oe&&(r=Vd.call(r),r.push(oe)),vt){var ve={depth:a.depth};return Ge(a,"quoteStyle")&&(ve.quoteStyle=a.quoteStyle),n(M,ve,i+1,r)}return n(M,a,i+1,r)}if(typeof e=="function"&&!Gs(e)){var y=jd(e),f=Ci(e,c);return"[Function"+(y?": "+y:" (anonymous)")+"]"+(f.length>0?" { "+Ee.call(f,", ")+" }":"")}if(qs(e)){var g=ft?He.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):rn.call(e);return typeof e=="object"&&!ft?Mt(g):g}if(rc(e)){for(var p="<"+Fs.call(String(e.nodeName)),x=e.attributes||[],_=0;_<x.length;_++)p+=" "+x[_].name+"="+Hs(Hd(x[_].value),"double",a);return p+=">",e.childNodes&&e.childNodes.length&&(p+="..."),p+="</"+Fs.call(String(e.nodeName))+">",p}if(an(e)){if(e.length===0)return"[]";var T=Ci(e,c);return d&&!ac(T)?"["+on(T,d)+"]":"[ "+Ee.call(T,", ")+" ]"}if(qd(e)){var E=Ci(e,c);return!("cause"in Error.prototype)&&"cause"in e&&!Ns.call(e,"cause")?"{ ["+String(e)+"] "+Ee.call(ks.call("[cause]: "+c(e.cause),E),", ")+" }":E.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+Ee.call(E,", ")+" }"}if(typeof e=="object"&&s){if(zs&&typeof e[zs]=="function"&&nn)return nn(e,{depth:h-i});if(s!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(Jd(e)){var P=[];return Ls&&Ls.call(e,function(M,oe){P.push(c(oe,e,!0)+" => "+c(M,e))}),Ys("Map",Ii.call(e),P,d)}if(tc(e)){var N=[];return Cs&&Cs.call(e,function(M){N.push(c(M,e))}),Ys("Set",Li.call(e),N,d)}if(Zd(e))return sn("WeakMap");if(ic(e))return sn("WeakSet");if(ec(e))return sn("WeakRef");if(Xd(e))return Mt(c(Number(e)));if(Kd(e))return Mt(c(en.call(e)));if(Yd(e))return Mt(kd.call(e));if(Wd(e))return Mt(c(String(e)));if(!Gd(e)&&!Gs(e)){var H=Ci(e,c),S=Bs?Bs(e)===Object.prototype:e instanceof Object||e.constructor===Object,F=e instanceof Object?"":"null prototype",v=!S&&re&&Object(e)===e&&re in e?Zr.call(qe(e),8,-1):F?"Object":"",L=S||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",A=L+(v||F?"["+Ee.call(ks.call([],v||[],F||[]),": ")+"] ":"");return H.length===0?A+"{}":d?A+"{"+on(H,d)+"}":A+"{ "+Ee.call(H,", ")+" }"}return String(e)};function Hs(n,e,t){var i=(t.quoteStyle||e)==="double"?'"':"'";return i+n+i}function Hd(n){return He.call(String(n),/"/g,"&quot;")}function an(n){return qe(n)==="[object Array]"&&(!re||!(typeof n=="object"&&re in n))}function Gd(n){return qe(n)==="[object Date]"&&(!re||!(typeof n=="object"&&re in n))}function Gs(n){return qe(n)==="[object RegExp]"&&(!re||!(typeof n=="object"&&re in n))}function qd(n){return qe(n)==="[object Error]"&&(!re||!(typeof n=="object"&&re in n))}function Wd(n){return qe(n)==="[object String]"&&(!re||!(typeof n=="object"&&re in n))}function Xd(n){return qe(n)==="[object Number]"&&(!re||!(typeof n=="object"&&re in n))}function Yd(n){return qe(n)==="[object Boolean]"&&(!re||!(typeof n=="object"&&re in n))}function qs(n){if(ft)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!rn)return!1;try{return rn.call(n),!0}catch{}return!1}function Kd(n){if(!n||typeof n!="object"||!en)return!1;try{return en.call(n),!0}catch{}return!1}var Qd=Object.prototype.hasOwnProperty||function(n){return n in this};function Ge(n,e){return Qd.call(n,e)}function qe(n){return Ud.call(n)}function jd(n){if(n.name)return n.name;var e=Bd.call(Nd.call(n),/^function\s*([\w$]+)/);return e?e[1]:null}function Ws(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,i=n.length;t<i;t++)if(n[t]===e)return t;return-1}function Jd(n){if(!Ii||!n||typeof n!="object")return!1;try{Ii.call(n);try{Li.call(n)}catch{return!0}return n instanceof Map}catch{}return!1}function Zd(n){if(!Dt||!n||typeof n!="object")return!1;try{Dt.call(n,Dt);try{Ft.call(n,Ft)}catch{return!0}return n instanceof WeakMap}catch{}return!1}function ec(n){if(!Ds||!n||typeof n!="object")return!1;try{return Ds.call(n),!0}catch{}return!1}function tc(n){if(!Li||!n||typeof n!="object")return!1;try{Li.call(n);try{Ii.call(n)}catch{return!0}return n instanceof Set}catch{}return!1}function ic(n){if(!Ft||!n||typeof n!="object")return!1;try{Ft.call(n,Ft);try{Dt.call(n,Dt)}catch{return!0}return n instanceof WeakSet}catch{}return!1}function rc(n){return!n||typeof n!="object"?!1:typeof HTMLElement<"u"&&n instanceof HTMLElement?!0:typeof n.nodeName=="string"&&typeof n.getAttribute=="function"}function Xs(n,e){if(n.length>e.maxStringLength){var t=n.length-e.maxStringLength,i="... "+t+" more character"+(t>1?"s":"");return Xs(Zr.call(n,0,e.maxStringLength),e)+i}var r=He.call(He.call(n,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,nc);return Hs(r,"single",e)}function nc(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+$d.call(e.toString(16))}function Mt(n){return"Object("+n+")"}function sn(n){return n+" { ? }"}function Ys(n,e,t,i){var r=i?on(t,i):Ee.call(t,", ");return n+" ("+e+") {"+r+"}"}function ac(n){for(var e=0;e<n.length;e++)if(Ws(n[e],`
`)>=0)return!1;return!0}function sc(n,e){var t;if(n.indent==="	")t="	";else if(typeof n.indent=="number"&&n.indent>0)t=Ee.call(Array(n.indent+1)," ");else return null;return{base:t,prev:Ee.call(Array(e+1),t)}}function on(n,e){if(n.length===0)return"";var t=`
`+e.prev+e.base;return t+Ee.call(n,","+t)+`
`+e.prev}function Ci(n,e){var t=an(n),i=[];if(t){i.length=n.length;for(var r=0;r<n.length;r++)i[r]=Ge(n,r)?e(n[r],n):""}var a=typeof tn=="function"?tn(n):[],s;if(ft){s={};for(var o=0;o<a.length;o++)s["$"+a[o]]=a[o]}for(var l in n)Ge(n,l)&&(t&&String(Number(l))===l&&l<n.length||ft&&s["$"+l]instanceof Symbol||(Ms.call(/[^\w$]/,l)?i.push(e(l,n)+": "+e(n[l],n)):i.push(l+": "+e(n[l],n))));if(typeof tn=="function")for(var u=0;u<a.length;u++)Ns.call(n,a[u])&&i.push("["+e(a[u])+"]: "+e(n[a[u]],n));return i}var ln=Yr,pt=Ld,oc=zd,lc=ln("%TypeError%"),Di=ln("%WeakMap%",!0),Fi=ln("%Map%",!0),uc=pt("WeakMap.prototype.get",!0),hc=pt("WeakMap.prototype.set",!0),dc=pt("WeakMap.prototype.has",!0),cc=pt("Map.prototype.get",!0),fc=pt("Map.prototype.set",!0),pc=pt("Map.prototype.has",!0),un=function(n,e){for(var t=n,i;(i=t.next)!==null;t=i)if(i.key===e)return t.next=i.next,i.next=n.next,n.next=i,i},mc=function(n,e){var t=un(n,e);return t&&t.value},gc=function(n,e,t){var i=un(n,e);i?i.value=t:n.next={key:e,next:n.next,value:t}},yc=function(n,e){return!!un(n,e)},vc=function(){var e,t,i,r={assert:function(a){if(!r.has(a))throw new lc("Side channel does not contain "+oc(a))},get:function(a){if(Di&&a&&(typeof a=="object"||typeof a=="function")){if(e)return uc(e,a)}else if(Fi){if(t)return cc(t,a)}else if(i)return mc(i,a)},has:function(a){if(Di&&a&&(typeof a=="object"||typeof a=="function")){if(e)return dc(e,a)}else if(Fi){if(t)return pc(t,a)}else if(i)return yc(i,a);return!1},set:function(a,s){Di&&a&&(typeof a=="object"||typeof a=="function")?(e||(e=new Di),hc(e,a,s)):Fi?(t||(t=new Fi),fc(t,a,s)):(i||(i={key:{},next:null}),gc(i,a,s))}};return r},xc=String.prototype.replace,bc=/%20/g,hn={RFC1738:"RFC1738",RFC3986:"RFC3986"},dn={default:hn.RFC3986,formatters:{RFC1738:function(n){return xc.call(n,bc,"+")},RFC3986:function(n){return String(n)}},RFC1738:hn.RFC1738,RFC3986:hn.RFC3986},Sc=dn,cn=Object.prototype.hasOwnProperty,tt=Array.isArray,_e=function(){for(var n=[],e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n}(),Tc=function(e){for(;e.length>1;){var t=e.pop(),i=t.obj[t.prop];if(tt(i)){for(var r=[],a=0;a<i.length;++a)typeof i[a]<"u"&&r.push(i[a]);t.obj[t.prop]=r}}},Ks=function(e,t){for(var i=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)typeof e[r]<"u"&&(i[r]=e[r]);return i},wc=function n(e,t,i){if(!t)return e;if(typeof t!="object"){if(tt(e))e.push(t);else if(e&&typeof e=="object")(i&&(i.plainObjects||i.allowPrototypes)||!cn.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var r=e;return tt(e)&&!tt(t)&&(r=Ks(e,i)),tt(e)&&tt(t)?(t.forEach(function(a,s){if(cn.call(e,s)){var o=e[s];o&&typeof o=="object"&&a&&typeof a=="object"?e[s]=n(o,a,i):e.push(a)}else e[s]=a}),e):Object.keys(t).reduce(function(a,s){var o=t[s];return cn.call(a,s)?a[s]=n(a[s],o,i):a[s]=o,a},r)},Ec=function(e,t){return Object.keys(t).reduce(function(i,r){return i[r]=t[r],i},e)},_c=function(n,e,t){var i=n.replace(/\+/g," ");if(t==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},Pc=function(e,t,i,r,a){if(e.length===0)return e;var s=e;if(typeof e=="symbol"?s=Symbol.prototype.toString.call(e):typeof e!="string"&&(s=String(e)),i==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(h){return"%26%23"+parseInt(h.slice(2),16)+"%3B"});for(var o="",l=0;l<s.length;++l){var u=s.charCodeAt(l);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||a===Sc.RFC1738&&(u===40||u===41)){o+=s.charAt(l);continue}if(u<128){o=o+_e[u];continue}if(u<2048){o=o+(_e[192|u>>6]+_e[128|u&63]);continue}if(u<55296||u>=57344){o=o+(_e[224|u>>12]+_e[128|u>>6&63]+_e[128|u&63]);continue}l+=1,u=65536+((u&1023)<<10|s.charCodeAt(l)&1023),o+=_e[240|u>>18]+_e[128|u>>12&63]+_e[128|u>>6&63]+_e[128|u&63]}return o},Ac=function(e){for(var t=[{obj:{o:e},prop:"o"}],i=[],r=0;r<t.length;++r)for(var a=t[r],s=a.obj[a.prop],o=Object.keys(s),l=0;l<o.length;++l){var u=o[l],h=s[u];typeof h=="object"&&h!==null&&i.indexOf(h)===-1&&(t.push({obj:s,prop:u}),i.push(h))}return Tc(t),e},Oc=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},Rc=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},Ic=function(e,t){return[].concat(e,t)},Lc=function(e,t){if(tt(e)){for(var i=[],r=0;r<e.length;r+=1)i.push(t(e[r]));return i}return t(e)},Qs={arrayToObject:Ks,assign:Ec,combine:Ic,compact:Ac,decode:_c,encode:Pc,isBuffer:Rc,isRegExp:Oc,maybeMap:Lc,merge:wc},js=vc,Mi=Qs,kt=dn,Cc=Object.prototype.hasOwnProperty,Js={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},Fe=Array.isArray,Dc=Array.prototype.push,Zs=function(n,e){Dc.apply(n,Fe(e)?e:[e])},Fc=Date.prototype.toISOString,eo=kt.default,ne={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:Mi.encode,encodeValuesOnly:!1,format:eo,formatter:kt.formatters[eo],indices:!1,serializeDate:function(e){return Fc.call(e)},skipNulls:!1,strictNullHandling:!1},Mc=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},fn={},kc=function n(e,t,i,r,a,s,o,l,u,h,d,c,y,f,g,p){for(var x=e,_=p,T=0,E=!1;(_=_.get(fn))!==void 0&&!E;){var P=_.get(e);if(T+=1,typeof P<"u"){if(P===T)throw new RangeError("Cyclic object value");E=!0}typeof _.get(fn)>"u"&&(T=0)}if(typeof l=="function"?x=l(t,x):x instanceof Date?x=d(x):i==="comma"&&Fe(x)&&(x=Mi.maybeMap(x,function(ve){return ve instanceof Date?d(ve):ve})),x===null){if(a)return o&&!f?o(t,ne.encoder,g,"key",c):t;x=""}if(Mc(x)||Mi.isBuffer(x)){if(o){var N=f?t:o(t,ne.encoder,g,"key",c);return[y(N)+"="+y(o(x,ne.encoder,g,"value",c))]}return[y(t)+"="+y(String(x))]}var H=[];if(typeof x>"u")return H;var S;if(i==="comma"&&Fe(x))f&&o&&(x=Mi.maybeMap(x,o)),S=[{value:x.length>0?x.join(",")||null:void 0}];else if(Fe(l))S=l;else{var F=Object.keys(x);S=u?F.sort(u):F}for(var v=r&&Fe(x)&&x.length===1?t+"[]":t,L=0;L<S.length;++L){var A=S[L],M=typeof A=="object"&&typeof A.value<"u"?A.value:x[A];if(!(s&&M===null)){var oe=Fe(x)?typeof i=="function"?i(v,A):v:v+(h?"."+A:"["+A+"]");p.set(e,T);var vt=js();vt.set(fn,p),Zs(H,n(M,oe,i,r,a,s,i==="comma"&&f&&Fe(x)?null:o,l,u,h,d,c,y,f,g,vt))}}return H},Uc=function(e){if(!e)return ne;if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||ne.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=kt.default;if(typeof e.format<"u"){if(!Cc.call(kt.formatters,e.format))throw new TypeError("Unknown format option provided.");i=e.format}var r=kt.formatters[i],a=ne.filter;return(typeof e.filter=="function"||Fe(e.filter))&&(a=e.filter),{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:ne.addQueryPrefix,allowDots:typeof e.allowDots>"u"?ne.allowDots:!!e.allowDots,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:ne.charsetSentinel,delimiter:typeof e.delimiter>"u"?ne.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:ne.encode,encoder:typeof e.encoder=="function"?e.encoder:ne.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:ne.encodeValuesOnly,filter:a,format:i,formatter:r,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:ne.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:ne.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:ne.strictNullHandling}},Nc=function(n,e){var t=n,i=Uc(e),r,a;typeof i.filter=="function"?(a=i.filter,t=a("",t)):Fe(i.filter)&&(a=i.filter,r=a);var s=[];if(typeof t!="object"||t===null)return"";var o;e&&e.arrayFormat in Js?o=e.arrayFormat:e&&"indices"in e?o=e.indices?"indices":"repeat":o="indices";var l=Js[o];if(e&&"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var u=l==="comma"&&e&&e.commaRoundTrip;r||(r=Object.keys(t)),i.sort&&r.sort(i.sort);for(var h=js(),d=0;d<r.length;++d){var c=r[d];i.skipNulls&&t[c]===null||Zs(s,kc(t[c],c,l,u,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,h))}var y=s.join(i.delimiter),f=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),y.length>0?f+y:""},mt=Qs,pn=Object.prototype.hasOwnProperty,Bc=Array.isArray,ee={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:mt.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},$c=function(n){return n.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},to=function(n,e){return n&&typeof n=="string"&&e.comma&&n.indexOf(",")>-1?n.split(","):n},Vc="utf8=%26%2310003%3B",zc="utf8=%E2%9C%93",Hc=function(e,t){var i={},r=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,a=t.parameterLimit===1/0?void 0:t.parameterLimit,s=r.split(t.delimiter,a),o=-1,l,u=t.charset;if(t.charsetSentinel)for(l=0;l<s.length;++l)s[l].indexOf("utf8=")===0&&(s[l]===zc?u="utf-8":s[l]===Vc&&(u="iso-8859-1"),o=l,l=s.length);for(l=0;l<s.length;++l)if(l!==o){var h=s[l],d=h.indexOf("]="),c=d===-1?h.indexOf("="):d+1,y,f;c===-1?(y=t.decoder(h,ee.decoder,u,"key"),f=t.strictNullHandling?null:""):(y=t.decoder(h.slice(0,c),ee.decoder,u,"key"),f=mt.maybeMap(to(h.slice(c+1),t),function(g){return t.decoder(g,ee.decoder,u,"value")})),f&&t.interpretNumericEntities&&u==="iso-8859-1"&&(f=$c(f)),h.indexOf("[]=")>-1&&(f=Bc(f)?[f]:f),pn.call(i,y)?i[y]=mt.combine(i[y],f):i[y]=f}return i},Gc=function(n,e,t,i){for(var r=i?e:to(e,t),a=n.length-1;a>=0;--a){var s,o=n[a];if(o==="[]"&&t.parseArrays)s=[].concat(r);else{s=t.plainObjects?Object.create(null):{};var l=o.charAt(0)==="["&&o.charAt(o.length-1)==="]"?o.slice(1,-1):o,u=parseInt(l,10);!t.parseArrays&&l===""?s={0:r}:!isNaN(u)&&o!==l&&String(u)===l&&u>=0&&t.parseArrays&&u<=t.arrayLimit?(s=[],s[u]=r):l!=="__proto__"&&(s[l]=r)}r=s}return r},qc=function(e,t,i,r){if(e){var a=i.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,s=/(\[[^[\]]*])/,o=/(\[[^[\]]*])/g,l=i.depth>0&&s.exec(a),u=l?a.slice(0,l.index):a,h=[];if(u){if(!i.plainObjects&&pn.call(Object.prototype,u)&&!i.allowPrototypes)return;h.push(u)}for(var d=0;i.depth>0&&(l=o.exec(a))!==null&&d<i.depth;){if(d+=1,!i.plainObjects&&pn.call(Object.prototype,l[1].slice(1,-1))&&!i.allowPrototypes)return;h.push(l[1])}return l&&h.push("["+a.slice(l.index)+"]"),Gc(h,t,i,r)}},Wc=function(e){if(!e)return ee;if(e.decoder!==null&&e.decoder!==void 0&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=typeof e.charset>"u"?ee.charset:e.charset;return{allowDots:typeof e.allowDots>"u"?ee.allowDots:!!e.allowDots,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:ee.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:ee.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:ee.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:ee.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:ee.comma,decoder:typeof e.decoder=="function"?e.decoder:ee.decoder,delimiter:typeof e.delimiter=="string"||mt.isRegExp(e.delimiter)?e.delimiter:ee.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:ee.depth,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:ee.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:ee.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:ee.plainObjects,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:ee.strictNullHandling}},Xc=function(n,e){var t=Wc(e);if(n===""||n===null||typeof n>"u")return t.plainObjects?Object.create(null):{};for(var i=typeof n=="string"?Hc(n,t):n,r=t.plainObjects?Object.create(null):{},a=Object.keys(i),s=0;s<a.length;++s){var o=a[s],l=qc(o,i[o],t,typeof n=="string");r=mt.merge(r,l,t)}return t.allowSparse===!0?r:mt.compact(r)},Yc=Nc,Kc=Xc,Qc=dn,jc={formats:Qc,parse:Kc,stringify:Yc};const mn=Gi(jc);class ki{constructor(e){m(this,"store");m(this,"xhr");m(this,"e");m(this,"onError");m(this,"onTimeout");m(this,"onLoad");m(this,"onLoadend");this.store=e,this.e={error:this._onError.bind(this),timeout:this._onTimeout.bind(this),load:this._onLoad.bind(this),loadend:this._onLoadend.bind(this)};let t=new XMLHttpRequest;Se.browser!=="ie"&&(t.responseType="json",t.timeout=5e3),t.onerror=this.e.error,t.ontimeout=this.e.timeout,t.onload=this.e.load,t.onloadend=this.e.loadend,this.xhr=t}_onError(e){this.onError&&this.onError(e.target),this.onError=null}_onTimeout(e){this.onTimeout&&this.onTimeout(e.target),this.onTimeout=null}_onLoad(e){if(!e.target){this._onError(e);return}let t=e.target.response;if(Se.browser==="ie"&&t&&typeof t=="string")try{t=JSON.parse(t)}catch{}let{code:i,data:r}=t;if(+i!=200){this._onError(e);return}this.onLoad&&this.onLoad(r),this.onLoad=null}_onLoadend(e){this.onLoadend&&this.onLoadend(e.target),this.onLoadend=null}fire(e,t={},i="POST"){if(!this.xhr)return;Se.isIOS&&Se.isUC&&(i="GET");let r=new FormData;if(this.store&&(r.set(te.CLIENT,this.store.getKV(te.CLIENT)),r.set(te.APP_ID,this.store.getKV(te.APP_ID)),r.set(te.THIRD_PARTY_USER_ID,this.store.getKV(te.THIRD_PARTY_USER_ID)),r.set(te.ACCESS_TOKEN,this.store.getKV(te.ACCESS_TOKEN)),r.set(te.PACKAGE_CHECK,this.store.getKV(te.PACKAGE_CHECK))),Object.keys(t).forEach(a=>{r.set(a,t[a])}),i==="POST")this.xhr.open(i,e),this.xhr.send(r);else if(i==="GET"){let a={};r.forEach((o,l)=>{a[l]=o});let s=mn.stringify(a);s&&(e+=`?${s}`),this.xhr.open(i,e),this.xhr.send()}}destroy(){this.xhr&&(this.xhr.onerror=null,this.xhr.onload=null,this.xhr.onloadend=null,this.xhr.ontimeout=null,this.xhr=null,this.onLoad=null,this.onLoadend=null,this.onTimeout=null,this.onError=null)}}class Jc{constructor(){m(this,"info");this.info={}}setKV(e,t){this.info[e]=t}getKV(e){return this.info[e]}deleteK(e){this.info.hasOwnProperty(e)&&delete this.info[e]}reset(){this.info={}}}class Zc{constructor(e){m(this,"store");m(this,"server");this.store=e,this.server=al.API_SERVER}init(){return new Promise((e,t)=>{const i=new ki(this.store);i.fire(this.server+Qi.INIT),i.onError=r=>t(r),i.onLoad=r=>e(r)})}initLive(e){return new Promise((t,i)=>{const r=new ki(this.store);r.fire(this.server+Qi.INIT_LIVE,{room_id:e}),r.onError=a=>i(a),r.onLoad=a=>t(a)})}initVod(e){return new Promise((t,i)=>{const r=new ki(this.store);r.fire(this.server+Qi.INIT_VOD,{record_id:e}),r.onError=a=>i(a),r.onLoad=a=>t(a)})}}function ef(n){let{appId:e,accountId:t,token:i,language:r="zh"}=n,a=new Jc;return a.setKV(te.APP_ID,e),a.setKV(te.THIRD_PARTY_USER_ID,t),a.setKV(te.ACCESS_TOKEN,i),a.setKV(te.PACKAGE_CHECK,"peter"),a.setKV(te.CLIENT,"pc_browser"),a.setKV(te.LANGUAGE,r),a}async function $f(n){let e=ef(n),t=new Zc(e),i=await t.init(),r;return n.type==="live"?r=await t.initLive(n.liveOption.roomId):r=await t.initVod(n.vodOption.recordId),{initData:i,playerData:r}}const Vf="",ke=class extends Vn{constructor(t){super();m(this,"plugins",{});m(this,"options");m(this,"root");m(this,"video");m(this,"vPlayer");m(this,"playerType");m(this,"def");m(this,"intervalLoader");m(this,"isFullscreen",!1);m(this,"enterFullscreen",()=>Promise.resolve(void 0));m(this,"exitFullscreen",()=>Promise.resolve(void 0));m(this,"toggleFullscreen",()=>Promise.resolve(void 0));m(this,"switch",()=>{});m(this,"setQuality",()=>{});m(this,"addBarrage",()=>{});m(this,"clearBarrage",()=>{});m(this,"openBarrage",()=>{});m(this,"closeBarrage",()=>{});m(this,"capture",()=>{});m(this,"selectVtt",()=>{});m(this,"closeVtt",()=>{});m(this,"handleTimeShift",()=>{});m(this,"openUI",()=>{});m(this,"hideUI",()=>{});this.options=new nl().merge(t),this.root=An("#"+t.videoNode),this.registerListeners(),this.createPlayer(),this.applyPlugins()}static use(t){const i=t.pluginName;return ke.plugins.some(r=>r.ctor===t)?ke:tl(i)?(b.warn(`VhPlayer use plugin error，plugin: ${t.name} - ${i} can not be used`),ke):(ke.plugins.push({name:i,ctor:t}),ke)}registerListeners(){this.on(w.SCHEDULER_COMPLETE,i=>{b.info("VhPlayer PlayerEvents.SCHEDULER_COMPLETE",i),i.timeShift||this.load(i.url)}),this.on(w.DEFINITION_CHANGE,i=>{b.info("VhPlayer PlayerEvents.DEFINITION_CHANGE",i),this.load(i.url)}),this.on(w.LINE_CHANGE,i=>{b.info("VhPlayer PlayerEvents.LINE_CHANGE",i),i.isReload?this.reload():this.load(i.url)}),this.on(w.LINE_CHANGED,()=>{b.info("VhPlayer PlayerEvents.LINE_CHANGED"),this.intervalLoader&&this.intervalLoader.destroy()}),this.on(w.PULL_STREAM_FAILED,i=>{b.info("VhPlayer PlayerEvents.PULL_STREAM_FAILED",i)}),window.ResizeObserver||Zo(),new ResizeObserver(()=>{this.emit(w.UIResize)}).observe(this.root)}createPlayer(){switch(this.playerType=ws(this.options),this.playerType){case X.Flv:this.vPlayer=new he(this.options,"flv",this);break;case X.Hls:Q.isSupported()?this.vPlayer=new Zi(this.options,this):this.vPlayer=new he(this.options,"native",this);break;case X.Native:case X.HlsNative:this.vPlayer=new he(this.options,"native",this);break;case X.Dash:this.vPlayer=new zn(this.options,this);break;default:throw Error("未提供支持的播放器类型")}this.video=this.vPlayer.video}applyPlugins(){ke.plugins.forEach(t=>{const i=t.ctor;typeof i=="function"&&(this.plugins[t.name]=new i(this))})}load(t){this.vPlayer.load(t)}reload(){this.vPlayer.reload()}async destroy(){b.warn("VhPlayer destroy，plugins：",Object.values(this.plugins));for(let t of Object.values(this.plugins))t.destroy&&t.destroy();await this.vPlayer.destroy(),this.video.remove()}play(){return this.video.play()}pause(){this.video.pause()}get isPaused(){return this.video.paused}get autoplay(){return this.video.autoplay}set autoplay(t){this.video.autoplay=t}get buffered(){return this.video.buffered}get bufferedMax(){let t=this.video.buffered;return t.length?t.end(t.length-1):0}get cdnName(){var t,i;return((t=this.def)==null?void 0:t.currentQualityCdnName)||((i=this.def)==null?void 0:i.currentQualityLineName)}get quality(){var t;return(t=this.def)==null?void 0:t.currentQuality}get qualities(){var t;return(t=this.def)==null?void 0:t.qualities}get controls(){return this.video.controls}set controls(t){this.video.controls=t}get crossOrigin(){return this.video.crossOrigin}set crossOrigin(t){this.video.crossOrigin=t}get currentTime(){return this.video.currentTime}set currentTime(t){this.video.currentTime=t}get defaultMuted(){return this.video.defaultMuted}set defaultMuted(t){this.video.defaultMuted=t}get duration(){return this.video.duration}get isEnded(){return this.video.ended}getEstimateNetSpeed(){return+this.vPlayer.getBandwidthEstimate().toFixed(3)}get loop(){return this.video.loop}set loop(t){this.video.loop=t}get muted(){return this.video.muted}set muted(t){this.video.muted=t}get networkState(){return this.video.networkState}get playbackRate(){return this.video.playbackRate}set playbackRate(t){this.video.playbackRate=t}get played(){return this.video.played}get preload(){return this.video.preload}set preload(t){this.video.preload=t}get readyState(){return this.video.readyState}get seekable(){return this.video.seekable}get isSeeking(){return this.video.seeking}get volume(){return this.video.volume}set volume(t){this.video.volume=t}static probe(){const t=document.createElement("video"),i=window.MediaSource||window.WebKitMediaSource;function r(a){return i&&i.isTypeSupported?i.isTypeSupported(a):t.canPlayType(a)}return{...Se,H264:t.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),H265:t.canPlayType('video/mp4; codecs="hevc"'),WebM_VP8:t.canPlayType('video/webm; codecs="vp8, vorbis"'),WebM_VP9:t.canPlayType('video/webm; codecs="vp9"'),MSE_H264:r('video/mp4; codecs="avc1.4D401E"'),MSE_H265:r('video/mp4; codecs="hevc"'),MSE_WebM_VP8:r('video/webm; codecs="vp8, vorbis"'),MSE_WebM_VP9:r('video/webm; codecs="vp9"'),MSE_AV1:r('video/mp4; codecs="av01.0.05M.08"'),WebSocket:!!window.WebSocket}}static async createInstance(t,i,r){try{Ji(t.debug===void 0?!1:t.debug);let{scheduleOption:a}=t;if(ws(t)===X.Hls&&Q.isSupported()){let{peer5Option:l}=t,u=l!=null&&l.enable?l.customerId:"";if(u)try{await On("script-peer5",`https://api.peer5.com/peer5.js?id=${u}`),await On("script-peer5-hls","https://api.peer5.com/peer5.hlsjs.loader.js")}catch(h){b.error("VhPlayer.createInstance - peer5 sdk load error: "+h.message)}}let o=new ke(t);return window.vp=o,i&&i(o),o}catch(a){b.warn("VhPlayer.createInstance error",a),r&&r({code:500,message:a.message})}}};let Ut=ke;m(Ut,"plugins",[]),m(Ut,"Events",w);const ae=Ut;var io={};/*! crc32.js (C) 2014-present SheetJS -- http://sheetjs.com */(function(n){(function(e){e(typeof DO_NOT_EXPORT_CRC>"u"?n:{})})(function(e){e.version="1.2.2";function t(){for(var S=0,F=new Array(256),v=0;v!=256;++v)S=v,S=S&1?-306674912^S>>>1:S>>>1,S=S&1?-306674912^S>>>1:S>>>1,S=S&1?-306674912^S>>>1:S>>>1,S=S&1?-306674912^S>>>1:S>>>1,S=S&1?-306674912^S>>>1:S>>>1,S=S&1?-306674912^S>>>1:S>>>1,S=S&1?-306674912^S>>>1:S>>>1,S=S&1?-306674912^S>>>1:S>>>1,F[v]=S;return typeof Int32Array<"u"?new Int32Array(F):F}var i=t();function r(S){var F=0,v=0,L=0,A=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(L=0;L!=256;++L)A[L]=S[L];for(L=0;L!=256;++L)for(v=S[L],F=256+L;F<4096;F+=256)v=A[F]=v>>>8^S[v&255];var M=[];for(L=1;L!=16;++L)M[L-1]=typeof Int32Array<"u"?A.subarray(L*256,L*256+256):A.slice(L*256,L*256+256);return M}var a=r(i),s=a[0],o=a[1],l=a[2],u=a[3],h=a[4],d=a[5],c=a[6],y=a[7],f=a[8],g=a[9],p=a[10],x=a[11],_=a[12],T=a[13],E=a[14];function P(S,F){for(var v=F^-1,L=0,A=S.length;L<A;)v=v>>>8^i[(v^S.charCodeAt(L++))&255];return~v}function N(S,F){for(var v=F^-1,L=S.length-15,A=0;A<L;)v=E[S[A++]^v&255]^T[S[A++]^v>>8&255]^_[S[A++]^v>>16&255]^x[S[A++]^v>>>24]^p[S[A++]]^g[S[A++]]^f[S[A++]]^y[S[A++]]^c[S[A++]]^d[S[A++]]^h[S[A++]]^u[S[A++]]^l[S[A++]]^o[S[A++]]^s[S[A++]]^i[S[A++]];for(L+=15;A<L;)v=v>>>8^i[(v^S[A++])&255];return~v}function H(S,F){for(var v=F^-1,L=0,A=S.length,M=0,oe=0;L<A;)M=S.charCodeAt(L++),M<128?v=v>>>8^i[(v^M)&255]:M<2048?(v=v>>>8^i[(v^(192|M>>6&31))&255],v=v>>>8^i[(v^(128|M&63))&255]):M>=55296&&M<57344?(M=(M&1023)+64,oe=S.charCodeAt(L++)&1023,v=v>>>8^i[(v^(240|M>>8&7))&255],v=v>>>8^i[(v^(128|M>>2&63))&255],v=v>>>8^i[(v^(128|oe>>6&15|(M&3)<<4))&255],v=v>>>8^i[(v^(128|oe&63))&255]):(v=v>>>8^i[(v^(224|M>>12&15))&255],v=v>>>8^i[(v^(128|M>>6&63))&255],v=v>>>8^i[(v^(128|M&63))&255]);return~v}e.table=i,e.bstr=P,e.buf=N,e.str=H})})(io);const tf=Gi(io);class gt{constructor(e=1e3*60*60){m(this,"oldToken");m(this,"newToken");m(this,"expireThreshold");m(this,"expireTime");this.oldToken="",this.newToken="",this.expireThreshold=e,this.expireTime=0}create(e){this.oldToken=e;let t=e.split("_")[0],i=e.split("_")[1],r=t.split("").reverse().join(""),s=`${(tf.str(r)>>>0).toString(16).toUpperCase()}_${i}`;return this.newToken=s,this.expireTime=Date.now()+this.expireThreshold,s}get isExpired(){return Date.now()>this.expireTime}static refreshToken(e){if(!e.token||e.token.isExpired){let t=new gt;e.token=t,e.tokenStr=t.create(e.tokenStr)}}}function rf(n,e){return e===X.Hls||e===X.HlsNative?{key:"hls_domainname",allQuality:n.hls_domainnames,tokenStr:n.token}:{key:"mp4_domainname",allQuality:n.mp4_domainnames,tokenStr:n.token}}function nf(n,e,t){var i,r;return e===X.Flv?{key:"httpflv_url",allQuality:n.httpflv_urls,allQualitySubtitles:n.httpflv_subtitle_urls,tokenStr:n.token}:e===X.Hls||e===X.HlsNative?t?{key:"hls_url",allQuality:(i=n.timeshift)==null?void 0:i.hls_urls,allQualitySubtitles:(r=n.timeshift_subtitle)==null?void 0:r.hls_urls,tokenStr:n.token}:{key:"hls_url",allQuality:n.hls_urls,allQualitySubtitles:n.hls_subtitle_urls,tokenStr:n.token}:{key:"rtmp_url",allQuality:n.rtmp_urls,allQualitySubtitles:n.rtmp_subtitle_urls,tokenStr:n.token}}function af(n,e){let{debugCDN:t}=e;return t&&n.find(i=>i.cdn_name===t)||n[0]}function sf(n,e,t){var p,x;let{scheduleOption:i}=e,r=e.type==="live",{live_type:a,live_subtitle:s}=i.playerData,o=r?((p=e.liveOption)==null?void 0:p.defaultDefinition)||Ue.PSame:((x=e.vodOption)==null?void 0:x.defaultDefinition)||Ue.PSame,l=a===1,u=s===1,h=r?nf(n,t,l):rf(n,t),d=u?h.allQualitySubtitles:h.allQuality,c=Object.keys(d);if(!c.length)throw Error("无可用清晰度");c.includes(o)||(o=c[0]);let y=d[o],f=af(y,i),g=y.map(_=>_.cdn_name||_.line);return{allQuality:h.allQuality,allQualitySubtitles:h.allQualitySubtitles,qualities:c,lines:g,currentQuality:o,currentQualityUrl:f[h.key],currentQualityCdnName:f.cdn_name,currentQualityLineName:f.line,currentQualityLines:y,key:h.key,tokenStr:h.tokenStr}}class ro{constructor(e){m(this,"player");m(this,"def");this.player=e}fetch(){let e=this.buildURL();const t=new ki;t.fire(e,{},"GET"),t.onError=i=>b.error("Schedule fetch error",i),t.onLoad=i=>this.resolveData(i)}buildURL(){return""}getRandom(){return(Math.random()*899999999>>0)+1e8}resolveData(e){let{options:t,playerType:i}=this.player;if(this.def=sf(e,t,i),b.info("Schedule get def",this.def),t.type==="live"){let r=new gt;this.def.token=r,this.def.tokenStr=r.create(this.def.tokenStr)}this.player.def=this.def,this.player.emit(w.SCHEDULER_COMPLETE,{url:this.def.currentQualityUrl+"?token="+this.def.tokenStr,timeShift:t.type==="live"&&t.scheduleOption.playerData.live_type===1})}}class of extends ro{constructor(e){super(e),this.fetch()}buildURL(){let{scheduleOption:e,vodOption:t}=this.player.options,{dispatch_server:i,default_server:r,safe_server:a,log_info:s}=e.playerData;const o=il(r.uri)==="m3u8",l=Se.browser==="ie",u=Se.supportMSE&&!(Se.os==="android"&&Se.browser==="qqbrowser"),h=!!(a!=null&&a.uri&&o&&!l&&u);let d={};d.webinar_id=t.recordId,d.rand=this.getRandom(),d.uid=s.uid,d.uri=this.getUri(h),d.bu=1;let c=this.getQuality(h);d.quality=c.length===0?'["same"]':`["${c.join('","')}"]`;let y=mn.stringify(d);return`${i}/api/dispatch_replay?${y}`}getUri(e){let{playerType:t}=this.player,{scheduleOption:i}=this.player.options,{dispatch_server:r,default_server:a,safe_server:s}=i.playerData,o=r+a.uri,l=e?r+s.uri:o,u=document.createElement("a");return u.href=t==="hls"?l:o,u.pathname}getQuality(e){let{scheduleOption:t}=this.player.options,{safe_definition:i,definition:r}=t.playerData;return(e?i:r)||["same"]}}class lf extends ro{constructor(e){super(e),this.fetch()}buildURL(){let{scheduleOption:e,liveOption:t}=this.player.options,{dispatch_server:i,log_info:r,app_type:a,live_subtitle:s,live_delay:o}=e.playerData,l={};l.webinar_id=t.roomId,l.uid=r.uid,l.bu=1,l.rand=this.getRandom(),l.app_type=a,l.is_subtitle=s,l.is_delay_stream=o;let u=mn.stringify(l);return`${i}/api/dispatch_play?${u}`}}class no{constructor(e){this.player=e;let{scheduleOption:t}=this.player.options;t.enable&&this.init()}init(){this.player.options.type==="live"?new lf(this.player):new of(this.player),this.player.setQuality=this.setQuality.bind(this)}setQuality(e){let{def:t}=this.player;if(!t.qualities){b.warn("Scheduler setQuality - 没有获取到可用清晰度");return}if(!t.qualities.includes(e)){b.warn(`Scheduler setQuality - 清晰度参数不可用-${e}；可设置清晰度：${t.qualities.join()}`);return}t.currentQuality=e,t.currentQualityLines=t.allQuality[e];let i=t.currentQualityLines.find(r=>r.line===t.currentQualityLineName);t.currentQualityUrl=i[t.key],gt.refreshToken(t),this.player.emit(w.DEFINITION_CHANGE,{url:t.currentQualityUrl+"?token="+t.tokenStr,quality:e})}destroy(){}}m(no,"pluginName","schedule");const ao=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],it=(()=>{let n={};for(let e of ao)if(e[1]in document){let t=0,i=e.length;for(;t<i;t++)n[ao[0][t]]=e[t];return n}return n})(),Pe={eventNameMap:{change:it.fullscreenchange,error:it.fullscreenerror},async request(n,e={navigationUI:"auto"}){if(n=n||document.documentElement,this.isEnabled)return await n[it.requestFullscreen](e)},async exit(){return await document[it.exitFullscreen]()},async toggle(n,e={navigationUI:"auto"}){return this.isFullscreen?await this.exit():await this.request(n,e)},onchange(n){this.on("change",n)},onerror(n){this.on("error",n)},on(n,e){this.eventNameMap[n]&&document.addEventListener(this.eventNameMap[n],e,!1)},off(n,e){this.eventNameMap[n]&&document.removeEventListener(this.eventNameMap[n],e,!1)},get isFullscreen(){return!!document[it.fullscreenElement]},get element(){return document[it.fullscreenElement]},get isEnabled(){return!!document[it.fullscreenEnabled]}},We={async request(n){if(this.isEnabled(n))return await n.webkitEnterFullscreen()},async exit(n){return await n.webkitExitFullscreen()},async toggle(n){return this.isFullscreen?await this.exit(n):await this.request(n)},get isFullscreen(){return document.fullScreen||document.webkitIsFullScreen||!1},isEnabled(n){return!!n.webkitEnterFullscreen}};class so{constructor(e){m(this,"fsChangeHandler");this.player=e,this.fsChangeHandler=()=>{this.player.emit(w.FULLSCREEN_CHANGED,Pe.element!==null)},this.init()}init(){Pe.isEnabled?(this.player.enterFullscreen=Pe.request.bind(Pe,this.player.root),this.player.exitFullscreen=Pe.exit,this.defineProperty(Pe),this.player.toggleFullscreen=Pe.toggle.bind(Pe,this.player.root)):We.isEnabled(this.player.video)&&(this.player.enterFullscreen=We.request.bind(We,this.player.video),this.player.exitFullscreen=We.exit.bind(We,this.player.video),this.defineProperty(We),this.player.toggleFullscreen=We.toggle.bind(We,this.player.video)),Pe.on("change",this.fsChangeHandler)}defineProperty(e){Object.defineProperty(this.player,"isFullscreen",{get(){return e.isFullscreen}})}destroy(){Pe.off("change",this.fsChangeHandler)}}m(so,"pluginName","fullscreen");class oo{constructor(e){m(this,"lagTimes",0);this.player=e,this.init()}init(){let{switchOption:e,type:t}=this.player.options;if(!e.enable){b.warn("Switcher 未开启切线功能");return}if(this.player.switch=this.switch.bind(this),t==="vod"){b.warn("Switcher 点播不运行卡顿切线");return}this.registerListeners()}registerListeners(){this.player.on(w.LAG_REPORT,this.lag,this),this.player.on(w.LAG_RECOVER,this.lagRecover,this)}lag(e){b.warn("Switcher LAG_REPORT",e),this.lagTimes+=1,this.lagTimes>=3&&(b.info("Switcher 开始卡顿切线"),this.lagTimes=0,this.switch())}lagRecover(e){b.info("Switcher LAG_RECOVER",e),this.lagTimes=0}switch(e){let{def:t}=this.player,i=t.currentQualityCdnName||t.currentQualityLineName;if(e&&e===i){b.warn("Switcher switch - 切线被忽略, 切换到了相同线路");return}let r=e?this.findLine(t.currentQualityLines,e):this.getNextLine(t.currentQualityLines,i);if(!r){b.warn("Switcher switch - 切线被忽略, 线路未找到");return}t.currentQualityUrl=r[t.key],t.currentQualityCdnName=r.cdn_name,t.currentQualityLineName=r.line,gt.refreshToken(t),this.player.emit(w.LINE_CHANGE,{url:t.currentQualityUrl+"?token="+t.tokenStr,line:r.cdn_name||r.line,isReload:(r.cdn_name||r.line)===i})}openLiveSubtitle(){}closeLiveSubtitle(){}getNextLine(e,t){let r=e.findIndex(a=>a.line===t)+1;return r>=e.length&&(r=0),e[r]}findLine(e,t){return e.find(i=>(i.cdn_name||i.line)===t)}destroy(){this.player.off(w.LAG_REPORT),this.player.off(w.LAG_RECOVER)}}m(oo,"pluginName","switcher");class lo{constructor(e){m(this,"pursueConfig");m(this,"isPursuing",!1);m(this,"_onTimeupdate");this.player=e,this.init()}init(){let{scheduleOption:e,pursueOption:t,type:i}=this.player.options;if(!t.enable){b.warn("Pursue - 未开启追播功能");return}if(i==="vod"){b.warn("Pursue - 点播不运行追播策略");return}let{playerType:r}=this.player;if(+e.playerData.live_type==1&&r===X.Hls){b.warn("Pursue - 时移直播不运行追播策略");return}if(r===X.Flash){b.warn("Pursue - flash不运行追播策略");return}if(r===X.HlsNative){b.warn("Pursue - 播放原生m3u8时，不运行追播策略");return}this.pursueConfig=t[r],b.info("Pursue 开启追播策略",this.pursueConfig),this.registerListeners()}registerListeners(){this._onTimeupdate=Ki(this.onTimeupdate.bind(this),1e3),this.player.video.addEventListener("timeupdate",this._onTimeupdate)}unRegisterListeners(){this.player.video.removeEventListener("timeupdate",this._onTimeupdate)}onTimeupdate(){let e=this.player.bufferedMax,t=e-this.player.currentTime,{bufferPursue:i,bufferSeek:r,bufferStop:a,pursueSpeed:s,mode:o}=this.pursueConfig;if(t>i||this.isPursuing&&t>a)switch(o){case"pursue":t>r?this.jumpTo(e-a):this.run(s);break;case"seek":this.jumpTo(e-a);break;default:b.warn(`Pursue 追播类型配置错误，只支持 pursue、seek，配置为 ${o}`);break}else this.walk()}jumpTo(e){e<=0||(b.info("Pursue jumpTo",e),this.player.currentTime=e,this.player.playbackRate=1,this.isPursuing=!1)}run(e){this.isPursuing||e<1||(b.info("Pursue run speed",e),this.player.playbackRate=e,this.isPursuing=!0)}walk(){this.player.playbackRate=1,this.isPursuing=!1}destroy(){this.unRegisterListeners()}}m(lo,"pluginName","pursue");class uo{constructor(e){m(this,"pauseTime",0);m(this,"firstTime",0);this.player=e,this.init()}init(){let{type:e}=this.player.options;if(e==="vod"){b.warn("Replay - 点播不运行暂停恢复逻辑");return}this.registerListeners()}registerListeners(){this.player.on(w.Play,this.onPlay,this),this.player.on(w.Pause,this.onPause,this),this.player.on(w.Loaded,this.onLoaded,this),this.player.on(w.LINE_CHANGE,this.onLineChange,this)}onLineChange(){this.pauseTime=0,this.firstTime=0}onPlay(){this.pauseTime?this.handleReplay((performance.now()-this.pauseTime)/1e3):this.onFirstPlay()}handleReplay(e){b.info("Replay 暂停时长",e);let t=this.player.bufferedMax,{scheduleOption:i,liveOption:r}=this.player.options,a=+i.playerData.live_type==1;if(r.type===X.Hls&&a&&this.player.cdnName===Ne.TX)isFinite(t)&&t>=this.player.currentTime+e?b.info("Replay - 时移直播暂停恢复(短暂停)，从暂停处接着播放"):b.info("Replay - 时移直播暂停恢复(长暂停)，定位到最新进度");else{if(r.type===X.Flash){this.player.reload();return}b.info("Replay - 直播暂停恢复，跳到最新"),this.player.currentTime=this.player.currentTime+e}}onFirstPlay(){if(b.info("Replay - 直播开始时，定位到最新进度"),this.firstTime)this.handleReplay((performance.now()-this.firstTime)/1e3);else{let{pursueOption:e}=this.player.options,t=e[this.player.playerType],i=this.player.bufferedMax-t.bufferStop;i>0&&(this.player.currentTime=this.player.currentTime+i)}}onLoaded(){this.player.playerType===X.Hls&&(this.firstTime=performance.now())}onPause(){this.pauseTime=performance.now()}destroy(){}}m(uo,"pluginName","replay");class ho{constructor(e){m(this,"lastCurrentTime",0);m(this,"lagTimes",0);m(this,"lagBeginTime",0);m(this,"detectInterval",0);m(this,"gapDetectTime",500);m(this,"gapEmitTime",3e3);m(this,"gapEmitLagTimes");this.player=e,this.init(),this.gapEmitLagTimes=this.gapEmitTime/this.gapDetectTime}init(){this.registerListeners()}registerListeners(){this.player.on(w.Play,this.startDetect,this),this.player.on(w.Pause,this.stopDetect,this),this.player.on(w.Ended,this.stopDetect,this),this.player.on(w.Error,this.onError,this),this.player.on(w.Stalled,this.onError,this),this.player.on(w.LINE_CHANGE,this.stopDetect,this),this.player.on(w.PULL_STREAM_FAILED,this.stopDetect,this)}onError(e){e&&e.target&&e.type==="stalled"||this.startDetect()}startDetect(){this.detectInterval||(b.info("Lag - 开始卡顿检测..."),this.detectInterval=window.setInterval(()=>{this.checkLag(this.player.currentTime),this.lagTimes&&this.lagTimes%this.gapEmitLagTimes===0?this.player.emit(w.LAG_REPORT,{times:this.lagTimes,beginTime:this.lagBeginTime}):!this.lagTimes&&this.lagBeginTime&&(this.player.emit(w.LAG_RECOVER,{lastTime:Date.now()-this.lagBeginTime}),this.lagBeginTime=0)},this.gapDetectTime))}stopDetect(){b.info("Lag - 停止卡顿检测"),clearInterval(this.detectInterval),this.detectInterval=0,this.lagTimes=0,this.lagBeginTime=0,this.lastCurrentTime=0}checkLag(e){this.lastCurrentTime===e?(this.lagTimes+=1,this.lagBeginTime||(this.lagBeginTime=Date.now()-this.gapDetectTime)):(this.lastCurrentTime=e,this.lagTimes=0)}destroy(){clearInterval(this.detectInterval),this.detectInterval=0,this.lagTimes=0,this.lagBeginTime=0,this.lastCurrentTime=0}}m(ho,"pluginName","lag");class Ae{static create(){return Ae.S4()+Ae.S4()+"-"+Ae.S4()+"-"+Ae.S4()+"-"+Ae.S4()+"-"+Ae.S4()+Ae.S4()+Ae.S4()}static S4(){return((1+Math.random())*65536|0).toString(16).substring(1)}}const zf="";let uf=(yn=class{constructor(e){m(this,"cssTransition");m(this,"elRoot");m(this,"elBarrageRoot");m(this,"rootWidth",0);m(this,"rootHeight",0);m(this,"tracksSize",30);m(this,"renderTopPosition",0);m(this,"renderBottomPosition",0);m(this,"tracker",[]);m(this,"renderQueue",[]);m(this,"renderTimer",0);m(this,"renderSuccessCount",0);m(this,"renderAborted",!1);m(this,"renderDelay",150);m(this,"opened",!0);this.player=e,this.init()}init(){let{videoNode:e,barrageOption:t}=this.player.options;if(!t.enable){b.warn("Barrage - 未开启弹幕功能");return}this.opened=t.defaultOpen??!0;let i=Rn();if(i===!1){b.warn("Barrage - not support css3 transition");return}this.cssTransition=i,this.elRoot=k("#"+e),this.elBarrageRoot=K("div",{},{class:"barrage-root"}),this.elRoot.appendChild(this.elBarrageRoot),this.registerListeners(),this.player.addBarrage=this.addBarrage.bind(this),this.player.clearBarrage=this.clearBarrage.bind(this),this.player.openBarrage=this.open.bind(this),this.player.closeBarrage=this.close.bind(this)}registerListeners(){this.player.on(w.Ended,this.clearBarrage,this),this.player.on(w.UIResize,this.resize,this),Cn(null,()=>{this.clearBarrage()})}open(){this.opened=!0,this.player.emit(w.OPEN_BARRAGE)}close(){this.opened=!1,this.player.emit(w.CLOSE_BARRAGE),this.clearBarrage()}addBarrage(e,t={}){if(!this.opened){b.warn("Barrage addBarrage - 添加弹幕失败，弹幕未开启");return}if(!this.tracker.length){b.warn("Barrage addBarrage - 添加弹幕失败，轨道数量为0");return}this.renderQueue.push({id:Ae.create(),msg:this.filterContent(e),style:{...this.player.options.barrageOption.style,...t},width:0,totalDistance:0,rollSpeed:this.player.options.barrageOption.speed,rollTime:0,useTracks:0,tracks:[]}),this.renderTimer||this.render()}render(){try{this.renderToDom()}finally{this.renderEnd()}}renderToDom(){if(this.renderQueue.length){const e=this.renderQueue[0];let t=e.node;if(!t){e.node=t=K("div",{},{class:"barrage-item"}),t.innerHTML=e.msg;for(let i of Object.keys(e.style))t.style[i]=e.style[i]}if(this.elBarrageRoot.appendChild(t),e.useTracks=Math.ceil(t.offsetHeight/this.tracksSize),e.useTracks>this.tracker.length){b.warn("Barrage renderToDom - 弹幕占用高度过高，丢弃"),this.renderQueue.shift(),this.elBarrageRoot.removeChild(t);return}e.width=t.offsetWidth,e.totalDistance=t.offsetWidth+this.rootWidth,e.rollTime=e.totalDistance/e.rollSpeed,this.addToTracks(e),e.tracks.length?(this.renderSuccessCount++,this.renderAborted=!1,this.renderQueue.shift(),t.setAttribute("data-y",e.tracks[0]+""),t.setAttribute("data-id",e.id),t.style.top=`${e.tracks[0]*this.tracksSize+this.renderTopPosition}px`,t.style[this.cssTransition.css]=`transform ${e.rollTime}s linear`,t.style.transform=`translate3d(-${e.totalDistance}px, 0, 0)`,t.addEventListener(this.cssTransition.event,()=>{this.removeFromTracker(e.tracks,e.id),this.elBarrageRoot.removeChild(t)},!1)):(this.renderAborted=!0,this.elBarrageRoot.removeChild(t))}}renderEnd(){this.renderQueue.length?(this.adaptRenderDelay(),this.renderTimer=window.setTimeout(()=>{this.render()},this.renderDelay)):this.renderTimer=0}adaptRenderDelay(){this.renderAborted?(this.renderDelay+=40,this.renderSuccessCount=0):this.renderSuccessCount>10&&(this.renderDelay-=50,this.renderSuccessCount=0)}addToTracks(e){let t,i,r=[];for(let a=0;a<this.tracker.length;a++)if(t=this.tracker[a],t.length?(i=t[t.length-1],-Ln(i.node)>i.width?r.push(a):r=[]):r.push(a),r.length>=e.useTracks){e.tracks=r,r.forEach(s=>{this.tracker[s].push(e)});break}}removeFromTracker(e,t){for(let i of e){const r=this.tracker[i];if(!r)continue;let a=0,s=r.length;for(;a<s;a++)if(r[a].id===t){r.splice(a,1);break}}}filterContent(e){return e&&e.replace(/<(?!img).*?>/gi,"")}clearBarrage(){this.eachNode(e=>{e.remove()}),this.tracker.forEach(e=>[]),this.renderQueue=[],this.player.emit(w.CLEAR_BARRAGE)}computedTracks(){let{positionRange:e}=this.player.options.barrageOption;this.player.isFullscreen?(this.renderTopPosition=window.innerHeight*e[0],this.renderBottomPosition=window.innerHeight*e[1]):(this.renderTopPosition=this.rootHeight*e[0],this.renderBottomPosition=this.rootHeight*e[1]);let t=this.renderBottomPosition-this.renderTopPosition;const i=Math.floor(t/this.tracksSize);this.tracker=new Array(i);for(let r=0;r<i;r++)this.tracker[r]=[];b.info("Barrage computedTracks",i)}resize(){b.info("Barrage resize"),this.rootWidth=this.elRoot.clientWidth,this.rootHeight=this.elRoot.clientHeight,this.clearBarrage(),this.computedTracks()}eachNode(e){let t=this.elBarrageRoot.firstChild,i,r;for(;t;)t.nodeType===1&&(r=t.getAttribute("data-y"),i=t.getAttribute("data-id"),r&&i&&e(t,+r,i)),t=t.nextSibling}destroy(){var e;this.clearBarrage(),(e=this.elBarrageRoot)==null||e.remove()}},m(yn,"pluginName","barrage"),yn);const Hf="";class co{constructor(e){m(this,"cssTransition");m(this,"elRoot");m(this,"elMarqueeRoot");m(this,"timer",0);m(this,"createMarqueeItem",e=>{if(e===1){const g=this.elMarqueeRoot.querySelector(".marquee");g&&g.remove()}else if(!this.checkPosition())return!1;let{text:t,position:i=1,duration:r=6,alpha:a,fontSize:s,fontColor:o,height:l}=this.player.options.marqueeOption;if(!t){b.warn("Marquee - 未提供配置：text");return}let u=K("div",{innerHTML:t},{class:"marquee",style:(a?`opacity: ${a/100};`:"")+(s?`font-size: ${s}px;`:"")+(o?`color: ${o};`:"")+(l?`line-height: ${l}px;`:"")});this.elMarqueeRoot.appendChild(u);const h=this.elMarqueeRoot.offsetWidth,d=this.elMarqueeRoot.offsetHeight,c=u.offsetWidth,y=u.offsetHeight,f={1:1,2:"20%",3:"50%",4:"80%"};switch(i){case 1:if(e===0){const g=d*.2,p=Math.floor(d*.6/y);let x=[g];for(let T=1;T<=p;T+=1)x.push(x[T-1]+y);let _=Math.floor(Math.random()*x.length);u.style.top=`${x[_]}px`}else d*.2>=y/2?(u.style.top=Math.random()*60+20+"%",u.style.transform="translateY(-50%)"):u.style.top=Math.random()*(d-y)+"px";break;case 2:d*.2>=y/2?(u.style.top=f[i],u.style.transform="translateY(-50%)"):u.style.top="0%";break;case 3:u.style.top=f[i],u.style.transform="translateY(-50%)";break;case 4:d*.2>=y/2?(u.style.top=f[i],u.style.transform="translateY(-50%)"):u.style.bottom="0%";break}if(e===0)u.style.left="100%",u.style[this.cssTransition.css]=`transform ${r}s linear`,this._stepMoveCss3({label:u,textWidth:c,rootWidth:h});else{const g=h&&c&&(h-c)/h*100,p=g&&Math.random()*g;u.style.left=`${p}%`}});this.player=e,this.init()}init(){let{videoNode:e,marqueeOption:t}=this.player.options;if(!t.enable){b.warn("Marquee - 未开启跑马灯功能");return}let i=Rn();if(i===!1){b.warn("Marquee - not support css3 transition");return}this.cssTransition=i,this.elRoot=k("#"+e),this.elMarqueeRoot=K("div",{},{class:"marquee-root"}),this.elRoot.appendChild(this.elMarqueeRoot),this.registerListeners(),this.createMarquee()}registerListeners(){Cn(()=>{this.timer||this.createMarquee()},()=>{this.destroy()})}createMarquee(){let{type:e=0,interval:t=5}=this.player.options.marqueeOption;this.timer=window.setInterval(this.createMarqueeItem,t*1e3,e),this.createMarqueeItem(e)}_stepMoveCss3(e){e.label.addEventListener(this.cssTransition.event,()=>{e.label.remove()}),e.label.style.transform=`translate(-${e.textWidth+e.rootWidth}px, -50%)`}checkPosition(){const e=this.elMarqueeRoot.querySelectorAll(".marquee");for(let t=0;t<e.length;t+=1)if(Ln(e[t])===0)return!1;return!0}destroy(){var a;let{marqueeOption:e}=this.player.options;if(!e.enable)return;clearInterval(this.timer),this.timer=0;const t=this.elMarqueeRoot.querySelectorAll(".marquee");let i=0,r=t.length;for(;i<r;i++)t[i].remove();(a=this.elMarqueeRoot)==null||a.remove()}}m(co,"pluginName","marquee");class fo{constructor(e){m(this,"elRoot");m(this,"elWatermarkRoot");m(this,"mutationObserver");m(this,"timer",0);this.player=e,this.init()}init(){let{videoNode:e,watermarkOption:t}=this.player.options;if(!t.enable){b.warn("Marquee - 未开启水印功能");return}this.elRoot=k("#"+e),this.elWatermarkRoot=K("div",{},{class:"watermark-root",style:"position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 3; overflow: hidden;"}),this.elRoot.appendChild(this.elWatermarkRoot),this.createWatermark(),this.registerListeners()}createWatermark(){let e=K("div",{},{});e.innerText="测试水印",this.elWatermarkRoot.appendChild(e)}registerListeners(){let e=this.player;function t(i,r){console.warn("请勿触碰水印",i),e.destroy()}this.mutationObserver=new MutationObserver(t),this.mutationObserver.observe(this.elWatermarkRoot,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.timer=window.setInterval(()=>{this.elRoot.querySelector(".watermark-root")||(console.warn("请勿触碰水印"),e.destroy())},3e3)}destroy(){var t;let{watermarkOption:e}=this.player.options;e.enable&&(this.mutationObserver&&this.mutationObserver.disconnect(),clearInterval(this.timer),this.timer=0,(t=this.elWatermarkRoot)==null||t.remove())}}m(fo,"pluginName","watermark");class po{constructor(e){m(this,"elCanvas");this.player=e,this.init()}init(){this.player.capture=this.capture.bind(this)}capture(){this.elCanvas||(this.elCanvas=document.createElement("canvas"));let e=this.player.video;this.elCanvas.width=e.videoWidth,this.elCanvas.height=e.videoHeight;let t=this.elCanvas.getContext("2d");return t==null||t.drawImage(e,0,0),this.elCanvas.toDataURL("image/jpeg")}destroy(){}}m(po,"pluginName","capture");class Me{constructor(e,t){m(this,"elRoot");m(this,"elMedia");m(this,"vhPlayer");this.elRoot=e,this.vhPlayer=t,this.elMedia=t.video}}class hf extends Me{constructor(t,i){super(t,i);m(this,"elBarRoot");m(this,"elBarCurrent");m(this,"elBarBuffered");m(this,"elPos");m(this,"_onTimeupdate");m(this,"_onProgress");m(this,"width",0);m(this,"cacheLayerX",0);m(this,"cacheX",-1);m(this,"cachePercent",-1);m(this,"isSeeking",!1);m(this,"onMouseDown",(t,i)=>{this.isSeeking=!0,this.cacheX=t.clientX;let r=t.clientX-i;t.target===this.elPos&&(r=t.clientX-i/2),this.cacheLayerX=t.target===this.elPos?r-8:r,this.percentMove(this.cacheLayerX/this.width*100)});m(this,"onMouseMove",t=>{this.cacheX!==-1&&this.percentMove((this.cacheLayerX+t.clientX-this.cacheX)/this.width*100)});m(this,"mouseUp",t=>{this.cacheX!==-1&&(this.isSeeking=!1,this.elMedia.currentTime=(this.cacheLayerX+t.clientX-this.cacheX)/this.width*this.elMedia.duration,this.cacheX=-1)});m(this,"onEnded",()=>{this.isSeeking||(this.elBarCurrent.style.transform="translateX(0%)",this.elBarBuffered.style.transform="translateX(0%)",this.elPos.style.transform=`translate(${this.width}px, -50%)`)});this.init(),this.registerListeners()}init(){this.elBarRoot=K("div",{},{class:"bar-root"}),this.elBarRoot.innerHTML=`
<div class="bar bar-current"></div>
<div class="bar bar-buffered"></div>
<div class="pos"></div>
`,this.elRoot.appendChild(this.elBarRoot),this.elBarCurrent=this.elBarRoot.querySelector(".bar-current"),this.elBarBuffered=this.elBarRoot.querySelector(".bar-buffered"),this.elPos=this.elBarRoot.querySelector(".pos"),setTimeout(()=>{this.width=this.elBarRoot.clientWidth},100)}registerListeners(){zi(this.elBarRoot,"down",this.onMouseDown),zi(this.elRoot,"move",this.onMouseMove),zi(this.elBarRoot,"up",this.mouseUp),this.elRoot.addEventListener("mouseleave",this.mouseUp),this._onTimeupdate=Ki(this.onTimeupdate.bind(this),500),this._onProgress=Ki(this.onProgress.bind(this),500),this.elMedia.addEventListener("timeupdate",this._onTimeupdate),this.elMedia.addEventListener("progress",this._onProgress),this.elMedia.addEventListener("ended",this.onEnded),this.vhPlayer.on(w.UIResize,this.onResize,this)}onResize(){this.width=this.elBarRoot.clientWidth,this.cachePercent!==-1&&this.percentMove(this.cachePercent)}onTimeupdate(){this.isSeeking||this.percentMove(this.elMedia.currentTime/this.elMedia.duration*100)}onProgress(){let t=Gt(this.elMedia)/this.elMedia.duration*100;this.elBarBuffered.style.transform=`translateX(${-100+t}%)`}percentMove(t){t>100||t<0||(this.cachePercent=t,this.elBarCurrent.style.transform=`translateX(${-100+t}%)`,this.elPos.style.transform=`translate(${t*this.width/100}px, -50%)`)}unRegisterListeners(){this.elMedia.removeEventListener("timeupdate",this._onTimeupdate),this.elMedia.removeEventListener("progress",this._onProgress),this.elMedia.removeEventListener("ended",this.onEnded)}destroy(){this.unRegisterListeners()}}class df extends Me{constructor(t,i){super(t,i);m(this,"elTsBarRoot");m(this,"elBarCurrent");m(this,"elPos");m(this,"width",0);m(this,"cacheLayerX",0);m(this,"cacheX",-1);m(this,"cachePercent",-1);m(this,"timeShiftMax",7200);m(this,"timeShiftDuration",7200-90);m(this,"onMouseDown",t=>{this.cacheX=t.clientX,this.cacheLayerX=t.target===this.elPos?t.layerX-8:t.layerX,this.percentMove(this.cacheLayerX/this.width*100)});m(this,"onMouseMove",t=>{this.cacheX!==-1&&this.percentMove((this.cacheLayerX+t.clientX-this.cacheX)/this.width*100)});m(this,"mouseUp",t=>{if(this.cacheX===-1)return;let i=(this.cacheLayerX+t.clientX-this.cacheX)/this.width*this.timeShiftDuration;i=this.timeShiftDuration-i+90,i=i>this.timeShiftMax?this.timeShiftMax:i,this.vhPlayer.handleTimeShift(i),this.cacheX=-1});this.init(),this.registerListeners()}init(){this.elTsBarRoot=K("div",{},{class:"bar-root"}),this.elTsBarRoot.innerHTML=`
<div class="bar bar-current"></div>
<div class="pos hide"></div>
`,this.elRoot.appendChild(this.elTsBarRoot),this.elBarCurrent=this.elTsBarRoot.querySelector(".bar-current"),this.elPos=this.elTsBarRoot.querySelector(".pos"),setTimeout(()=>{this.width=this.elTsBarRoot.clientWidth,this.percentMove(100),this.elPos.classList.remove("hide")},100)}registerListeners(){this.elTsBarRoot.addEventListener("mousedown",this.onMouseDown),this.elRoot.addEventListener("mousemove",this.onMouseMove),this.elRoot.addEventListener("mouseleave",this.mouseUp),this.elTsBarRoot.addEventListener("mouseup",this.mouseUp),this.vhPlayer.on(w.UIResize,this.onResize,this)}onResize(){this.width=this.elTsBarRoot.clientWidth,this.cachePercent!==-1&&this.percentMove(this.cachePercent)}percentMove(t){t>100||t<0||(this.cachePercent=t,this.elBarCurrent.style.transform=`translateX(${-100+t}%)`,this.elPos.style.transform=`translate(${t*this.width/100}px, -50%)`)}destroy(){}}class cf extends Me{constructor(t,i){super(t,i);m(this,"elPlayRoot");m(this,"elIcon");m(this,"onPlay",()=>{this.elIcon.classList.remove("icon-player-bofang"),this.elIcon.classList.add("icon-player-bofangzanting")});m(this,"onPause",()=>{this.elIcon.classList.remove("icon-player-bofangzanting"),this.elIcon.classList.add("icon-player-bofang")});m(this,"togglePlay",()=>{this.elMedia.paused?this.elMedia.play():this.elMedia.pause()});this.init(),this.registerListeners()}init(){this.elPlayRoot=K("div",{},{class:"ui-play-root"}),this.elPlayRoot.innerHTML=`
<i class="iconfont-player" title="播放/暂停"></i>
`,this.elRoot.appendChild(this.elPlayRoot),this.elIcon=this.elPlayRoot.querySelector(".iconfont-player"),this.elMedia.paused?this.onPause():this.onPlay()}registerListeners(){this.elIcon.addEventListener("click",this.togglePlay),this.elMedia.addEventListener("play",this.onPlay),this.elMedia.addEventListener("pause",this.onPause)}unRegisterListeners(){this.elMedia.removeEventListener("play",this.onPlay),this.elMedia.removeEventListener("pause",this.onPause)}destroy(){this.unRegisterListeners()}}class ff extends Me{constructor(t,i){super(t,i);m(this,"elReloadRoot");m(this,"elIcon");m(this,"reload",()=>{this.vhPlayer.emit(w.LINE_CHANGE,{isReload:!0})});this.init(),this.registerListeners()}init(){this.elReloadRoot=K("div",{},{class:"ui-reload-root"}),this.elReloadRoot.innerHTML=`
<i class="iconfont-player icon-player-reload" title="刷新"></i>
`,this.elRoot.appendChild(this.elReloadRoot),this.elIcon=this.elReloadRoot.querySelector(".iconfont-player")}registerListeners(){this.elIcon.addEventListener("click",this.reload)}destroy(){this.elIcon.removeEventListener("click",this.reload)}}class pf extends Me{constructor(t,i){super(t,i);m(this,"elDurationRoot");m(this,"elDurationCurrent");m(this,"elDurationTotal");m(this,"onTimeupdate",()=>{this.elDurationCurrent.textContent=this.timeFormat(this.elMedia.currentTime)});m(this,"onDurationChange",()=>{this.elDurationTotal.textContent=this.timeFormat(this.elMedia.duration)});m(this,"onEnd",()=>{this.elDurationCurrent.textContent=this.timeFormat(this.elMedia.duration)});this.init(),this.registerListeners()}init(){this.elDurationRoot=K("div",{},{class:"ui-duration-root"}),this.elDurationRoot.innerHTML=`
<span class="duration duration-current">00</span> / <span class="duration duration-total"></span>
`,this.elRoot.appendChild(this.elDurationRoot),this.elDurationCurrent=this.elDurationRoot.querySelector(".duration-current"),this.elDurationTotal=this.elDurationRoot.querySelector(".duration-total"),this.elDurationCurrent.textContent=this.timeFormat(0)}registerListeners(){this.elMedia.addEventListener("timeupdate",this.onTimeupdate),this.elMedia.addEventListener("durationchange",this.onDurationChange),this.elMedia.addEventListener("ended",this.onEnd)}timeFormat(t){let i=Math.floor(t/3600),r=Math.floor(t/60%60),a=Math.floor(t%60);return`${i>0?this.fillZero(i,!1)+":":""}${this.fillZero(r,!0)}:${this.fillZero(a,!0)}`}fillZero(t,i){return t>0?t<10?"0"+t:t+"":i?"00":""}unRegisterListeners(){this.elMedia.removeEventListener("timeupdate",this.onTimeupdate),this.elMedia.removeEventListener("durationchange",this.onDurationChange),this.elMedia.removeEventListener("ended",this.onEnd)}destroy(){this.unRegisterListeners()}}class mf extends Me{constructor(t,i){super(t,i);m(this,"elBarrageRoot");m(this,"elIcon");m(this,"opened",!0);m(this,"onClick",()=>{this.opened?(this.elIcon.classList.replace("icon-player-danmukaiqi","icon-player-danmuguanbi"),this.vhPlayer.closeBarrage()):(this.elIcon.classList.replace("icon-player-danmuguanbi","icon-player-danmukaiqi"),this.vhPlayer.openBarrage()),this.opened=!this.opened});this.init(),this.registerListeners()}init(){let{barrageOption:t}=this.vhPlayer.options;t.enable&&(this.elBarrageRoot=K("div",{},{class:"ui-barrage-root"}),this.elBarrageRoot.innerHTML=`
      <i class="iconfont-player icon-player-danmukaiqi"></i>
    `,this.elRoot.appendChild(this.elBarrageRoot),this.elIcon=this.elBarrageRoot.querySelector(".iconfont-player"))}registerListeners(){this.elIcon.addEventListener("click",this.onClick)}destroy(){this.elIcon.removeEventListener("click",this.onClick)}}class gf extends Me{constructor(t,i){super(t,i);m(this,"elVolRoot");m(this,"elIcon");m(this,"elSlider");m(this,"elSliderRoot");m(this,"elSliderVol");m(this,"elSliderPos");m(this,"height");m(this,"timer",0);m(this,"onClick",t=>{this.changeVolume(t.layerY-this.height)});m(this,"onMouseOverIcon",()=>{this.mouseOverShowSlider(),this.height||(this.height=this.elSliderRoot.clientHeight)});m(this,"mouseOverShowSlider",()=>{this.vhPlayer.emit(w.UISingleDisplay,this.constructor.name),this.elSlider.classList.add("active"),this.timer&&clearTimeout(this.timer)});m(this,"mouseLeaveHideSlider",()=>{this.timer&&clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.elSlider.classList.remove("active")},1e3)});m(this,"toggleMuted",()=>{this.vhPlayer.video.muted=!this.vhPlayer.video.muted});m(this,"onDrag",t=>{t.preventDefault(),t.clientY!==0&&this.changeLayout(t.layerY-2)});m(this,"onDragEnd",t=>{t.preventDefault(),this.changeVolume(t.layerY-2)});this.init(),this.registerListeners()}init(){this.elVolRoot=K("div",{},{class:"ui-volume-root"}),this.elVolRoot.innerHTML=`
<i class="iconfont-player iconfont-player-vol"></i>
<div class="volume-slider">
  <div class="slider-root">
    <div class="slider"></div>
  </div>
  <div class="pos" draggable="true"></div>
</div>
`,this.elRoot.appendChild(this.elVolRoot),this.elIcon=this.elVolRoot.querySelector(".iconfont-player"),this.elSlider=this.elVolRoot.querySelector(".volume-slider"),this.elSliderRoot=this.elVolRoot.querySelector(".slider-root"),this.elSliderVol=this.elVolRoot.querySelector(".slider"),this.elSliderPos=this.elVolRoot.querySelector(".pos"),this.onVolumechange()}registerListeners(){this.elIcon.addEventListener("click",this.toggleMuted),this.elIcon.addEventListener("mouseenter",this.onMouseOverIcon),this.elIcon.addEventListener("mouseleave",this.mouseLeaveHideSlider),this.elSlider.addEventListener("mouseenter",this.mouseOverShowSlider),this.elSlider.addEventListener("mouseleave",this.mouseLeaveHideSlider),this.elSliderRoot.addEventListener("click",this.onClick),this.elSliderPos.addEventListener("drag",this.onDrag),this.elSliderPos.addEventListener("dragend",this.onDragEnd),this.vhPlayer.on(w.Volumechange,this.onVolumechange,this)}onVolumechange(){let t=this.vhPlayer.video.muted?0:this.vhPlayer.video.volume;this.elSliderVol.style.transform=`translateY(${(1-t)*100}%)`,this.elSliderPos.style.transform=`translateY(${-t*70}px)`,this.vhPlayer.video.muted?(this.elIcon.classList.add("icon-player-jingyin"),this.elIcon.classList.remove("icon-player-shengyin")):(this.elIcon.classList.remove("icon-player-jingyin"),this.elIcon.classList.add("icon-player-shengyin"))}changeVolume(t){let i=this.height;t>0?t=0:t<-i&&(t=-i);let r=(i+t)/i;this.vhPlayer.video.volume=1-r,this.vhPlayer.video.muted=r===1}changeLayout(t){let i=this.height;t>0?t=0:t<-i&&(t=-i),this.elSliderVol.style.transform=`translateY(${(i+t)/i*100}%)`,this.elSliderPos.style.transform=`translateY(${t}px)`}destroy(){}}class yf extends Me{constructor(t,i){super(t,i);m(this,"elFsRoot");m(this,"elIcon");m(this,"toggleFs",()=>{this.vhPlayer.toggleFullscreen()});this.init(),this.registerListeners()}init(){this.elFsRoot=K("div",{},{class:"ui-fullscreen-root"}),this.elFsRoot.innerHTML=`
<i class="iconfont-player icon-player-quanping1" title="全屏"></i>
`,this.elRoot.appendChild(this.elFsRoot),this.elIcon=this.elFsRoot.querySelector(".iconfont-player")}registerListeners(){this.elIcon.addEventListener("click",this.toggleFs),this.vhPlayer.on(w.FULLSCREEN_CHANGED,this.onFsChange,this)}onFsChange(t){t?this.elIcon.classList.replace("icon-player-quanping1","icon-player-quanping"):this.elIcon.classList.replace("icon-player-quanping","icon-player-quanping1")}unRegisterListeners(){this.elIcon.removeEventListener("click",this.toggleFs),this.vhPlayer.off(w.FULLSCREEN_CHANGED)}destroy(){this.unRegisterListeners()}}class vf extends Me{constructor(t,i){super(t,i);m(this,"elSettingRoot");m(this,"elIcon");m(this,"elSettingContent");m(this,"elSettingContent2");m(this,"elContentVtt");m(this,"elContentLine");m(this,"elContentQuality");m(this,"mapping",{vtt:this.elContentVtt,line:this.elContentLine,quality:this.elContentQuality});m(this,"timer1",-1);m(this,"onContentMouseLeave",()=>{this.timer1=window.setTimeout(()=>{this.hide()},1e3)});m(this,"onClick",()=>{this.elSettingContent.classList.contains("active")?this.hide():(this.vhPlayer.emit(w.UISingleDisplay,this.constructor.name),this.elSettingContent.classList.add("active"))});this.init(),this.registerListeners()}init(){this.elSettingRoot=K("div",{},{class:"ui-setting-root"}),this.elSettingRoot.innerHTML=`
<i class="iconfont-player icon-player-diandiandian" title="设置"></i>
<ul class="setting-content"></ul>
`,this.elRoot.appendChild(this.elSettingRoot),this.elIcon=this.elSettingRoot.querySelector(".iconfont-player"),this.elSettingContent=this.elSettingRoot.querySelector(".setting-content")}registerListeners(){this.vhPlayer.on(w.SCHEDULER_COMPLETE,this.onScheduleComplete,this),this.vhPlayer.on(w.VTT_ADDED,this.addVttUI,this),this.vhPlayer.on(w.UISingleDisplay,this.onSingleDisplay,this),this.vhPlayer.on(w.DEFINITION_CHANGE,this.onQualityChange,this),this.vhPlayer.on(w.LINE_CHANGE,this.onLineChange,this),this.vhPlayer.on(w.VTT_SELECTED,this.onVttSelected,this),this.vhPlayer.on(w.VTT_CLOSED,this.onVttClosed,this),this.elIcon.addEventListener("click",this.onClick),this.elSettingContent.addEventListener("mouseleave",this.onContentMouseLeave)}bindMouseEvent(t){this.mapping[t].addEventListener("mouseenter",()=>{this.timer1&&window.clearTimeout(this.timer1)}),this.mapping[t].addEventListener("mouseleave",i=>{i.currentTarget.classList.remove("active")})}showSelectedUI(t){for(let i of Object.keys(this.mapping))i===t?this.mapping[i].classList.add("active"):this.mapping[i]&&this.mapping[i].classList.remove("active")}showSelectedUI2(t,i){let r=this.mapping[t].querySelectorAll("li");for(let a of r)a.dataset.val===i?a.classList.add("active"):a.classList.remove("active")}onQualityChange(t){this.showSelectedUI2("quality",t.quality)}onLineChange(t){this.showSelectedUI2("line",t.line)}onVttSelected(t){this.showSelectedUI2("vtt",t.vtt)}onVttClosed(){this.showSelectedUI2("vtt","")}onScheduleComplete(){let{scheduleOption:t}=this.vhPlayer.options;if(t.enable){let i=document.createElement("li"),r=document.createElement("li");i.textContent="线路",r.textContent="清晰度",i.addEventListener("click",()=>{this.showSelectedUI("line")}),r.addEventListener("click",()=>{this.showSelectedUI("quality")}),this.elSettingContent.appendChild(i),this.elSettingContent.appendChild(r),this.addLineUI(),this.addQualityUI()}}addLineUI(){this.elContentLine=K("ul",{},{class:"setting-content2 setting-content-line"}),this.elSettingRoot.appendChild(this.elContentLine),this.mapping.line=this.elContentLine,this.elSettingContent2=this.elSettingRoot.querySelectorAll(".setting-content2"),this.bindMouseEvent("line");let{lines:t,currentQualityCdnName:i,currentQualityLineName:r}=this.vhPlayer.def,{uiOptions:a}=this.vhPlayer.options;const s=a!=null&&a.line?a.line:!1;let o=document.createDocumentFragment();for(let l of t){let u=document.createElement("li");u.textContent=s&&s[l]?s[l]:l,u.dataset.val=l,l===(i||r)&&u.classList.add("active"),u.addEventListener("click",h=>{this.vhPlayer.switch(h.currentTarget.dataset.val),this.hide()}),o.appendChild(u)}this.elContentLine.appendChild(o)}addQualityUI(){this.elContentQuality=K("ul",{},{class:"setting-content2 setting-content-quality"}),this.elSettingRoot.appendChild(this.elContentQuality),this.mapping.quality=this.elContentQuality,this.elSettingContent2=this.elSettingRoot.querySelectorAll(".setting-content2"),this.bindMouseEvent("quality");let{qualities:t,currentQuality:i}=this.vhPlayer.def,{uiOptions:r}=this.vhPlayer.options;const a=r!=null&&r.quality?r.quality:!1;let s=document.createDocumentFragment();for(let o of t){let l=document.createElement("li");l.textContent=a&&a[o]?a[o]:o,l.dataset.val=o,o===i&&l.classList.add("active"),l.addEventListener("click",u=>{this.vhPlayer.setQuality(u.currentTarget.dataset.val),this.hide()}),s.appendChild(l)}this.elContentQuality.appendChild(s)}addVttUI(){let{vttOptions:t,type:i}=this.vhPlayer.options;if(t.enable&&i==="vod"){this.elContentVtt=K("ul",{},{class:"setting-content2 setting-content-vtt"}),this.elSettingRoot.appendChild(this.elContentVtt),this.mapping.vtt=this.elContentVtt,this.elSettingContent2=this.elSettingRoot.querySelectorAll(".setting-content2"),this.bindMouseEvent("vtt");let r=document.createElement("li");r.textContent="字幕",r.addEventListener("click",()=>{this.showSelectedUI("vtt")}),this.elSettingContent.appendChild(r);let a=document.createElement("li");a.textContent="关闭",a.dataset.val="",a.addEventListener("click",()=>{this.vhPlayer.closeVtt(),this.hide()}),this.elContentVtt.appendChild(a);let s=document.createDocumentFragment();for(let o of t.tracks){let l=document.createElement("li");l.textContent=o.label||o.srclang,l.dataset.val=o.srclang,o.default&&l.classList.add("active"),l.addEventListener("click",()=>{this.vhPlayer.selectVtt(o.srclang),this.hide()}),s.appendChild(l)}this.elContentVtt.appendChild(s)}}onSingleDisplay(t){t!==this.constructor.name&&this.hide()}hide(){this.elSettingContent.classList.remove("active"),this.elSettingContent2.forEach(t=>t.classList.remove("active"))}destroy(){}}const Gf="",qf="";class mo{constructor(e){m(this,"elRoot");m(this,"elLoadingWrapper");m(this,"elControlWrapper");m(this,"toggleShow",e=>{if(this.elControlWrapper.classList.contains("active")){let t=0,i=e.target;for(;t<6&&i&&i!==this.elControlWrapper;)i=i.parentNode,t+=1;i!==this.elControlWrapper&&this.elControlWrapper.classList.remove("active")}else this.elControlWrapper.classList.add("active")});this.player=e,this.init()}init(){let{videoNode:e,scheduleOption:t,vttOptions:i,type:r,controls:a}=this.player.options;if(a!=="custom"){b.warn("UI - 未开启自定义控制栏");return}this.elRoot=k("#"+e),this.elControlWrapper=K("div",{},{class:"player-control-wrapper active "+(r==="live"?"is-live":"")}),this.elLoadingWrapper=K("div",{},{class:"player-loading-wrapper hide"}),this.elLoadingWrapper.innerHTML=`
      <i class="iconfont-player icon-player-Loading"></i>
    `,this.elControlWrapper.innerHTML=`
      <div class="bar-wrapper"></div>
      <div class="tools-wrapper">
        <div class="tools-wrapper-left"></div>
        <div class="tools-wrapper-right"></div>
      </div>`,this.elRoot.appendChild(this.elLoadingWrapper),this.elRoot.appendChild(this.elControlWrapper);let s=this.elRoot.querySelector(".tools-wrapper-left"),o=this.elRoot.querySelector(".tools-wrapper-right"),l=this.elRoot.querySelector(".bar-wrapper");new cf(s,this.player),r==="live"&&new ff(s,this.player),r==="vod"?(new hf(l,this.player),new pf(s,this.player)):t.playerData.live_type===1?new df(l,this.player):l.remove(),new mf(o,this.player),Se.platform==="pc"&&new gf(o,this.player),new yf(o,this.player),(t.enable||i.enable&&r==="vod")&&new vf(o,this.player),this.player.openUI=this.openUI.bind(this),this.player.hideUI=this.hideUI.bind(this),this.registerListeners()}registerListeners(){this.elRoot.addEventListener("click",this.toggleShow),this.player.on(w.Waiting,()=>{this.elLoadingWrapper.classList.remove("hide")}),this.player.on(w.Canplay,()=>{this.elLoadingWrapper.classList.add("hide")})}openUI(){this.elControlWrapper.classList.add("active")}hideUI(){this.elControlWrapper.classList.remove("active")}destroy(){var e;(e=this.elControlWrapper)==null||e.remove()}}m(mo,"pluginName","UI");class go{constructor(e){this.player=e,this.init()}init(){var i;let{vttOptions:e,type:t}=this.player.options;if(t==="live"){b.warn("Vtt - 暂不支持对直播添加字幕");return}if(!e.enable){b.warn("Vtt - 未开启字幕");return}if(!((i=e.tracks)!=null&&i.length)){b.warn("Vtt - 字幕列表为空");return}this.loadTracks(),this.player.selectVtt=this.selectVtt.bind(this),this.player.closeVtt=this.closeVtt.bind(this)}loadTracks(){for(let e of this.player.options.vttOptions.tracks)this.addTracks(e);this.player.emit(w.VTT_ADDED)}selectVtt(e){for(let t of this.player.video.textTracks)t.language===e?(t.mode="showing",this.player.emit(w.VTT_SELECTED,{vtt:e})):t.mode="hidden"}closeVtt(){for(let e of this.player.video.textTracks)e.mode="hidden";this.player.emit(w.VTT_CLOSED)}addTracks(e){let t=K("track",{},{label:e.label||e.srclang,kind:e.kind,srclang:e.srclang,src:e.src});t.default=e.default===!0,this.player.video.appendChild(t)}destroy(){}}m(go,"pluginName","Vtt");const Bt=class{constructor(e){this.player=e,this.init()}init(){let{type:e}=this.player.options;if(e==="vod"){b.warn("TimeShift - 点播活动不运行直播时移");return}if(this.player.playerType!==X.Hls){b.warn(`TimeShift - 直播时移只支持hls，当前播放器类型：${this.player.playerType}`);return}this.player.handleTimeShift=this.handleTimeShift.bind(this),this.registerListeners()}registerListeners(){this.player.on(w.SCHEDULER_COMPLETE,this.onScheduleComplete,this)}handleTimeShift(e=0){if(this.player.cdnName!==Ne.TX){b.warn(`TimeShift - 直播时移只支持腾讯线路，当前线路：${this.player.cdnName}`);return}e<Bt.TENCENT_DELAY?e=Bt.TENCENT_DELAY:e=Math.round(e);let i=(this.player.vPlayer.url||this.player.vPlayer.cacheUrl).split("?")[0]+this.creatTencentTimeShiftUrl(e);this.player.load(i),this.player.emit(w.LIVE_TIMESHIFT,{delay:e,url:i})}onScheduleComplete(e){e.timeShift&&this.player.load(`${e.url}&delay=${Bt.TENCENT_DELAY}`)}creatAliyunTimeShiftUrl(e){return`?aliyunols=on&lhs_start_human_s_8=${e}`}creatTencentTimeShiftUrl(e){let{def:t}=this.player;return gt.refreshToken(t),`?delay=${e}&token=${t.tokenStr}`}destroy(){}};let Nt=Bt;m(Nt,"pluginName","timeShift"),m(Nt,"TENCENT_DELAY",90),ae.use(no),ae.use(so),ae.use(oo),ae.use(lo),ae.use(uo),ae.use(ho),ae.use(uf),ae.use(co),ae.use(fo),ae.use(po),ae.use(mo),ae.use(go),ae.use(Nt);const yo=document.querySelector.bind(document);function J(n,e,t="click"){typeof n=="string"&&(n=yo(n)),n&&n.addEventListener(t,e)}function vo(){let n={};return new window.URL(location.href).searchParams.forEach((e,t,i)=>{n[t]=e}),n}let gn;function xf(n){gn||(gn=yo("#log"));let e;typeof n=="object"?(e=document.createElement("pre"),e.textContent=JSON.stringify(n,null,2)):(e=document.createElement("p"),e.textContent=n),gn.appendChild(e)}const xo={dispatch_server:"https://gslb.e.vhall.com",log_info:{uid:"10000127"}},bo={...xo,safe_definition:["same","a","360p"],definition:["same","a","360p"],default_server:{uri:"/vhallyun/vhallrecord/lss_d2c47ede/20230423152534_43151633/record.m3u8",mp4_domainnames:""},subtitle_info:{}},So={...xo,app_type:0,live_type:0,live_subtitle:0,live_delay:0,live_duration:0};let bf=[location.pathname+"out.flv",location.pathname+"qhh.flv"],Sf=[location.pathname+"hls1/out.m3u8",location.pathname+"hls2/qhh.m3u8"];function yt(n="flv",e=0){let t=n==="flv"?bf:Sf;if(t.length===2){let i=vo();console.log("ana querystring",i),i.url&&t.unshift(i.url)}return e=e>=t.length?0:e,{index:e,url:t[e]+"?token=alibaba"}}const pe={videoNode:"vh-player",type:"vod",autoplay:!1,controls:"custom",muted:!1,debug:!0,flvOptions:{enableWorker:!1,statisticsInfoReportInterval:3e3},hlsOptions:{debug:!1,levelLoadingMaxRetry:-1}};function Tf(){let n=vo();console.log("ana querystring",n);const e=n.type;return e==="vod"&&n.schedule==="true"&&n.scheduleUri&&(bo.default_server.uri=n.scheduleUri),e==="live"&&n.timeshift==="true"&&(So.live_type=1),{...pe,type:e||"vod",appId:n.appId,accountId:405,token:"vhall",liveOption:{roomId:n.roomId,type:n.playerType||X.Flv},vodOption:{recordId:n.recordId},scheduleOption:{enable:n.schedule==="true",playerData:e==="live"?So:bo,debugUrl:n.url?n.url+(n.url.indexOf("?token")!==-1?"":"?token=alibaba"):"",debugCDN:n.cdn||Ne.TX,debugPlayer:n.playerType},peer5Option:{enable:n.peer5==="true",customerId:n.peer5CustomerId,fallback:!0},switchOption:{enable:!0},pursueOption:{enable:!0},marqueeOption:{enable:!1,type:1,text:"跑马灯文字"},watermarkOption:{enable:!0},vttOptions:{enable:!0,tracks:[{label:"英文",kind:"subtitles",srclang:"en",src:location.pathname+"vtt/subtitles_en.vtt"},{label:"中文",kind:"subtitles",srclang:"zh",src:location.pathname+"vtt/subtitles_zh.vtt",default:!0}]},uiOptions:{line:{[Ne.TX]:"腾讯线路",[Ne.ALI]:"备用线路1",[Ne.HW]:"备用线路2",[Ne.CY]:"备用线路3"},quality:{[Ue.PSame]:"原画",[Ue.P720]:"高清",[Ue.P480]:"标清",[Ue.P360]:"流畅",[Ue.Pa]:"音频"}}}}function wf(){xf(ae.probe());let n;function e(){const f=Tf();console.info("创建播放器 参数",f),ae.createInstance(f,g=>{if(n=g,console.info("创建播放器 成功",g),Ef(g),_f(g),!f.scheduleOption.enable)if(f.scheduleOption.debugUrl)n.load(f.scheduleOption.debugUrl);else{const p={flv:"out.flv",hls:"hls1/out.m3u8",native:"hls1/out.m3u8",flash:"",dash:"dash/qhh.mpd"};n.load(location.pathname+p[n.playerType])}},g=>{console.error(g)})}const t=k(".mask-info"),i=k("#bandwidth"),r=k("#cdn"),a=k("#quality"),s=k("#bufferedTime"),o=k("#playedTime"),l=k("#canSeekTime"),u=k(".mask-capture"),h=k(".mask-capture > img");let d=0,c=0;J(k("#btn-init-player"),()=>{e()}),J(k("#btn-toggle-play"),()=>{n.video.paused?n.play():n.pause()}),J(k("#btn-seek"),()=>{n.currentTime=70}),J(k("#btn-destroy"),()=>{n.destroy()}),J(k("#btn-capture"),()=>{u.style.display="block",h.src=n.capture(),window.clearTimeout(c),c=window.setTimeout(()=>{u.style.display="none"},3e3)}),J(k("#btn-add-barrage"),()=>{let f=new Array(100);for(let g of f)n.addBarrage("test barrage 测试弹幕",{color:"red"})}),J(k("#btn-clear-barrage"),()=>{n.clearBarrage()}),J(k("#btn-browser-hank"),()=>{k("#mask-all").style.display="block"}),J(k("#btn-horizontal-full"),()=>{n.root.classList.add("horizontal-fullscrren")});const y=()=>{r.textContent=n==null?void 0:n.cdnName,a.textContent=n==null?void 0:n.quality,i.textContent=(n==null?void 0:n.getEstimateNetSpeed())+"",s.textContent=(n==null?void 0:n.bufferedMax)+"",o.textContent=(n==null?void 0:n.currentTime)+"",l.textContent=(n==null?void 0:n.bufferedMax)-(n==null?void 0:n.currentTime)+""};J(k("#btn-mask-info"),()=>{t.style.display==="block"?(t.style.display="none",clearInterval(d)):(t.style.display="block",y(),d=window.setInterval(y,5e3))})}function Ef(n){n.on(ae.Events.FULLSCREEN_CHANGED,e=>{console.log("Events.FULLSCREEN_CHANGED",e)})}function _f(n){const e=["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","ratechange","seeked","seeking","stalled","suspend","waiting"];for(let t of e)n.video.addEventListener(t,()=>{console.log(`[vlog - origin event: ${t}]`)})}function Pf(){let n,e;J(k("#btn-flv-init"),()=>{pe.videoNode="flv-player",console.log("Flv Player Params:",pe),window.vp=n=new he(pe),e=yt("flv"),n.load(e.url).then(()=>{Af(n)})}),J(k("#btn-flv-toggle-play"),()=>{n.video.paused?n.video.play():n.video.pause()}),J(k("#btn-flv-switch"),()=>{e=yt("flv",e.index+1),n.load(e.url)})}function Af(n){n.nPlayer.on(he.Events.ERROR,(e,t,i)=>{console.log("FlvPlayer.Events.ERROR"),console.log("errorType: ",e),console.log("errorDetail: ",t),console.log("errorInfo: ",i)}),n.nPlayer.on(he.Events.LOADING_COMPLETE,e=>{console.log("FlvPlayer.Events.LOADING_COMPLETE",e)}),n.nPlayer.on(he.Events.MEDIA_INFO,e=>{console.log("FlvPlayer.Events.MEDIA_INFO",e)}),n.nPlayer.on(he.Events.METADATA_ARRIVED,e=>{console.log("FlvPlayer.Events.METADATA_ARRIVED",e)}),n.nPlayer.on(he.Events.RECOVERED_EARLY_EOF,e=>{console.log("FlvPlayer.Events.RECOVERED_EARLY_EOF",e)}),n.nPlayer.on(he.Events.SCRIPTDATA_ARRIVED,e=>{console.log("FlvPlayer.Events.SCRIPTDATA_ARRIVED",e)}),n.nPlayer.on(he.Events.STATISTICS_INFO,e=>{})}function Of(){let n,e;J(k("#btn-hls-init"),()=>{pe.videoNode="hls-player",console.log("Hls Player Params:",pe),Ji(pe.debug),window.vp=n=new Zi(pe),e=yt("hls"),n.load(e.url)}),J(k("#btn-hls-toggle-play"),()=>{n.video.paused?n.video.play():n.video.pause()}),J(k("#btn-hls-switch"),()=>{e=yt("hls",e.index+1),n.load(e.url)}),J(k("#btn-hls-seek"),()=>{n.video.currentTime=24*60})}function Rf(){let n,e;J(k("#btn-hlslite-init"),()=>{pe.videoNode="hls-lite-player",console.log("HlsLite Player Params:",pe),Ji(pe.debug),window.vp=n=new sd(pe),e=yt("hls"),n.load(e.url)}),J(k("#btn-hlslite-toggle-play"),()=>{n.video.paused?n.video.play():n.video.pause()}),J(k("#btn-hlslite-switch"),()=>{e=yt("hls",e.index+1),n.load(e.url)})}function If(){wf(),Pf(),Of(),Rf()}window.onload=If})(flvjs,Hls,dashjs);
