var VhPlayer=function(t,e,i){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(t),a=n(e),s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o={},l={},d={};Object.defineProperty(d,"__esModule",{value:!0});d.ContentRect=function(t){if("getBBox"in t){var e=t.getBBox();return Object.freeze({height:e.height,left:0,top:0,width:e.width})}var i=window.getComputedStyle(t);return Object.freeze({height:parseFloat(i.height||"0"),left:parseFloat(i.paddingLeft||"0"),top:parseFloat(i.paddingTop||"0"),width:parseFloat(i.width||"0")})},Object.defineProperty(l,"__esModule",{value:!0});var h=d,u=function(){function t(t){this.target=t,this.$$broadcastWidth=this.$$broadcastHeight=0}return Object.defineProperty(t.prototype,"broadcastWidth",{get:function(){return this.$$broadcastWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"broadcastHeight",{get:function(){return this.$$broadcastHeight},enumerable:!0,configurable:!0}),t.prototype.isActive=function(){var t=h.ContentRect(this.target);return!!t&&(t.width!==this.broadcastWidth||t.height!==this.broadcastHeight)},t}();l.ResizeObservation=u;var c={};Object.defineProperty(c,"__esModule",{value:!0});var p=d,f=function(t){this.target=t,this.contentRect=p.ContentRect(t)};c.ResizeObserverEntry=f,Object.defineProperty(o,"__esModule",{value:!0});var g=l,m=c,y=[],v=function(){function t(t){this.$$observationTargets=[],this.$$activeTargets=[],this.$$skippedTargets=[];var e=function(t){if(void 0===t)return"Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.";if("function"!=typeof t)return"Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function."}(t);if(e)throw TypeError(e);this.$$callback=t}return t.prototype.observe=function(t){var e=w("observe",t);if(e)throw TypeError(e);T(this.$$observationTargets,t)>=0||(this.$$observationTargets.push(new g.ResizeObservation(t)),function(t){var e=y.indexOf(t);e<0&&(y.push(t),A())}(this))},t.prototype.unobserve=function(t){var e=w("unobserve",t);if(e)throw TypeError(e);var i=T(this.$$observationTargets,t);i<0||(this.$$observationTargets.splice(i,1),0===this.$$observationTargets.length&&b(this))},t.prototype.disconnect=function(){this.$$observationTargets=[],this.$$activeTargets=[],b(this)},t}();function b(t){var e=y.indexOf(t);e>=0&&(y.splice(e,1),D())}function w(t,e){return void 0===e?"Failed to execute '"+t+"' on 'ResizeObserver': 1 argument required, but only 0 present.":e&&e.nodeType===window.Node.ELEMENT_NODE?void 0:"Failed to execute '"+t+"' on 'ResizeObserver': parameter 1 is not of type 'Element'."}function T(t,e){for(var i=0;i<t.length;i+=1)if(t[i].target===e)return i;return-1}o.ResizeObserver=v;var S,E,_,k=function(t){y.forEach((function(e){e.$$activeTargets=[],e.$$skippedTargets=[],e.$$observationTargets.forEach((function(i){i.isActive()&&(L(i.target)>t?e.$$activeTargets.push(i):e.$$skippedTargets.push(i))}))}))},P=function(){var t=1/0;return y.forEach((function(e){if(e.$$activeTargets.length){var i=[];e.$$activeTargets.forEach((function(e){var n=new m.ResizeObserverEntry(e.target);i.push(n),e.$$broadcastWidth=n.contentRect.width,e.$$broadcastHeight=n.contentRect.height;var r=L(e.target);r<t&&(t=r)})),e.$$callback(i,e),e.$$activeTargets=[]}})),t},L=function(t){for(var e=0;t.parentNode;)t=t.parentNode,e+=1;return e},C=function(){var t,e=0;for(k(e);y.some((function(t){return!!t.$$activeTargets.length}));)e=P(),k(e);y.some((function(t){return!!t.$$skippedTargets.length}))&&(t=new window.ErrorEvent("ResizeLoopError",{message:"ResizeObserver loop completed with undelivered notifications."}),window.dispatchEvent(t))},A=function(){S||R()},R=function(){S=window.requestAnimationFrame((function(){C(),R()}))},D=function(){S&&!y.some((function(t){return!!t.$$observationTargets.length}))&&(window.cancelAnimationFrame(S),S=void 0)},I=o.install=function(){return window.ResizeObserver=v},x={exports:{}};E=x,_=x.exports,function(t,e){var i="function",n="undefined",r="object",a="string",s="major",o="model",l="name",d="type",h="vendor",u="version",c="architecture",p="console",f="mobile",g="tablet",m="smarttv",y="wearable",v="embedded",b="Amazon",w="Apple",T="ASUS",S="BlackBerry",k="Browser",P="Chrome",L="Firefox",C="Google",A="Huawei",R="LG",D="Microsoft",I="Motorola",x="Opera",O="Samsung",U="Sharp",M="Sony",N="Xiaomi",B="Zebra",F="Facebook",V="Chromium OS",q="Mac OS",z=function(t){for(var e={},i=0;i<t.length;i++)e[t[i].toUpperCase()]=t[i];return e},H=function(t,e){return typeof t===a&&-1!==G(e).indexOf(G(t))},G=function(t){return t.toLowerCase()},W=function(t,e){if(typeof t===a)return t=t.replace(/^\s\s*/,""),typeof e===n?t:t.substring(0,350)},$=function(t,n){for(var a,s,o,l,d,h,u=0;u<n.length&&!d;){var c=n[u],p=n[u+1];for(a=s=0;a<c.length&&!d&&c[a];)if(d=c[a++].exec(t))for(o=0;o<p.length;o++)h=d[++s],typeof(l=p[o])===r&&l.length>0?2===l.length?typeof l[1]==i?this[l[0]]=l[1].call(this,h):this[l[0]]=l[1]:3===l.length?typeof l[1]!==i||l[1].exec&&l[1].test?this[l[0]]=h?h.replace(l[1],l[2]):e:this[l[0]]=h?l[1].call(this,h,l[2]):e:4===l.length&&(this[l[0]]=h?l[3].call(this,h.replace(l[1],l[2])):e):this[l]=h||e;u+=2}},X=function(t,i){for(var n in i)if(typeof i[n]===r&&i[n].length>0){for(var a=0;a<i[n].length;a++)if(H(i[n][a],t))return"?"===n?e:n}else if(H(i[n],t))return"?"===n?e:n;return t},j={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Y={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[u,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[u,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,u],[/opios[\/ ]+([\w\.]+)/i],[u,[l,x+" Mini"]],[/\bopr\/([\w\.]+)/i],[u,[l,x]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[l,u],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[u,[l,"UC"+k]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[u,[l,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[u,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[u,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[u,[l,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[u,[l,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+k],u],[/\bfocus\/([\w\.]+)/i],[u,[l,L+" Focus"]],[/\bopt\/([\w\.]+)/i],[u,[l,x+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[u,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[u,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[u,[l,x+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[u,[l,"MIUI "+k]],[/fxios\/([-\w\.]+)/i],[u,[l,L]],[/\bqihu|(qi?ho?o?|360)browser/i],[[l,"360 "+k]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1 "+k],u],[/(comodo_dragon)\/([\w\.]+)/i],[[l,/_/g," "],u],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[l,u],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,F],u],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[l,u],[/\bgsa\/([\w\.]+) .*safari\//i],[u,[l,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[u,[l,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[u,[l,P+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,P+" WebView"],u],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[u,[l,"Android "+k]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,u],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[u,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[u,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[u,X,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,u],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],u],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[u,[l,L+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[l,u],[/(cobalt)\/([\w\.]+)/i],[l,[u,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[c,"amd64"]],[/(ia32(?=;))/i],[[c,G]],[/((?:i[346]|x)86)[;\)]/i],[[c,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[c,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[c,"armhf"]],[/windows (ce|mobile); ppc;/i],[[c,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[c,/ower/,"",G]],[/(sun4\w)[;\)]/i],[[c,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[c,G]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[o,[h,O],[d,g]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[o,[h,O],[d,f]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[o,[h,w],[d,f]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[o,[h,w],[d,g]],[/(macintosh);/i],[o,[h,w]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[o,[h,U],[d,f]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[o,[h,A],[d,g]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[o,[h,A],[d,f]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[o,/_/g," "],[h,N],[d,f]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[o,/_/g," "],[h,N],[d,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[o,[h,"OPPO"],[d,f]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[o,[h,"Vivo"],[d,f]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[o,[h,"Realme"],[d,f]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[o,[h,I],[d,f]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[o,[h,I],[d,g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[o,[h,R],[d,g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[o,[h,R],[d,f]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[o,[h,"Lenovo"],[d,g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[o,/_/g," "],[h,"Nokia"],[d,f]],[/(pixel c)\b/i],[o,[h,C],[d,g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[o,[h,C],[d,f]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[o,[h,M],[d,f]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[o,"Xperia Tablet"],[h,M],[d,g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[o,[h,"OnePlus"],[d,f]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[o,[h,b],[d,g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[o,/(.+)/g,"Fire Phone $1"],[h,b],[d,f]],[/(playbook);[-\w\),; ]+(rim)/i],[o,h,[d,g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[o,[h,S],[d,f]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[o,[h,T],[d,g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[o,[h,T],[d,f]],[/(nexus 9)/i],[o,[h,"HTC"],[d,g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[o,/_/g," "],[d,f]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[o,[h,"Acer"],[d,g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[o,[h,"Meizu"],[d,f]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,o,[d,f]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,o,[d,g]],[/(surface duo)/i],[o,[h,D],[d,g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[o,[h,"Fairphone"],[d,f]],[/(u304aa)/i],[o,[h,"AT&T"],[d,f]],[/\bsie-(\w*)/i],[o,[h,"Siemens"],[d,f]],[/\b(rct\w+) b/i],[o,[h,"RCA"],[d,g]],[/\b(venue[\d ]{2,7}) b/i],[o,[h,"Dell"],[d,g]],[/\b(q(?:mv|ta)\w+) b/i],[o,[h,"Verizon"],[d,g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[o,[h,"Barnes & Noble"],[d,g]],[/\b(tm\d{3}\w+) b/i],[o,[h,"NuVision"],[d,g]],[/\b(k88) b/i],[o,[h,"ZTE"],[d,g]],[/\b(nx\d{3}j) b/i],[o,[h,"ZTE"],[d,f]],[/\b(gen\d{3}) b.+49h/i],[o,[h,"Swiss"],[d,f]],[/\b(zur\d{3}) b/i],[o,[h,"Swiss"],[d,g]],[/\b((zeki)?tb.*\b) b/i],[o,[h,"Zeki"],[d,g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],o,[d,g]],[/\b(ns-?\w{0,9}) b/i],[o,[h,"Insignia"],[d,g]],[/\b((nxa|next)-?\w{0,9}) b/i],[o,[h,"NextBook"],[d,g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],o,[d,f]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],o,[d,f]],[/\b(ph-1) /i],[o,[h,"Essential"],[d,f]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[o,[h,"Envizen"],[d,g]],[/\b(trio[-\w\. ]+) b/i],[o,[h,"MachSpeed"],[d,g]],[/\btu_(1491) b/i],[o,[h,"Rotor"],[d,g]],[/(shield[\w ]+) b/i],[o,[h,"Nvidia"],[d,g]],[/(sprint) (\w+)/i],[h,o,[d,f]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[h,D],[d,f]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[o,[h,B],[d,g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[o,[h,B],[d,f]],[/smart-tv.+(samsung)/i],[h,[d,m]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[h,O],[d,m]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,R],[d,m]],[/(apple) ?tv/i],[h,[o,w+" TV"],[d,m]],[/crkey/i],[[o,P+"cast"],[h,C],[d,m]],[/droid.+aft(\w)( bui|\))/i],[o,[h,b],[d,m]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[o,[h,U],[d,m]],[/(bravia[\w ]+)( bui|\))/i],[o,[h,M],[d,m]],[/(mitv-\w{5}) bui/i],[o,[h,N],[d,m]],[/Hbbtv.*(technisat) (.*);/i],[h,o,[d,m]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,W],[o,W],[d,m]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,m]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,o,[d,p]],[/droid.+; (shield) bui/i],[o,[h,"Nvidia"],[d,p]],[/(playstation [345portablevi]+)/i],[o,[h,M],[d,p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[o,[h,D],[d,p]],[/((pebble))app/i],[h,o,[d,y]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[o,[h,w],[d,y]],[/droid.+; (glass) \d/i],[o,[h,C],[d,y]],[/droid.+; (wt63?0{2,3})\)/i],[o,[h,B],[d,y]],[/(quest( 2| pro)?)/i],[o,[h,F],[d,y]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[d,v]],[/(aeobc)\b/i],[o,[h,b],[d,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[o,[d,f]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[o,[d,g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,f]],[/(android[-\w\. ]{0,9});.+buil/i],[o,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[u,[l,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[u,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[l,u],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[u,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,u],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[l,[u,X,j]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[l,"Windows"],[u,X,j]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[u,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,q],[u,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[u,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,u],[/\(bb(10);/i],[u,[l,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[u,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[u,[l,L+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[u,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[u,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[u,[l,P+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,V],u],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,u],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],u],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[l,u]]},K=function(p,m){if(typeof p===r&&(m=p,p=e),!(this instanceof K))return new K(p,m).getResult();var y=typeof t!==n&&t.navigator?t.navigator:e,v=p||(y&&y.userAgent?y.userAgent:""),b=y&&y.userAgentData?y.userAgentData:e,w=m?function(t,e){var i={};for(var n in t)e[n]&&e[n].length%2==0?i[n]=e[n].concat(t[n]):i[n]=t[n];return i}(Y,m):Y,T=y&&y.userAgent==v;return this.getBrowser=function(){var t,n={};return n[l]=e,n[u]=e,$.call(n,v,w.browser),n[s]=typeof(t=n[u])===a?t.replace(/[^\d\.]/g,"").split(".")[0]:e,T&&y&&y.brave&&typeof y.brave.isBrave==i&&(n[l]="Brave"),n},this.getCPU=function(){var t={};return t[c]=e,$.call(t,v,w.cpu),t},this.getDevice=function(){var t={};return t[h]=e,t[o]=e,t[d]=e,$.call(t,v,w.device),T&&!t[d]&&b&&b.mobile&&(t[d]=f),T&&"Macintosh"==t[o]&&y&&typeof y.standalone!==n&&y.maxTouchPoints&&y.maxTouchPoints>2&&(t[o]="iPad",t[d]=g),t},this.getEngine=function(){var t={};return t[l]=e,t[u]=e,$.call(t,v,w.engine),t},this.getOS=function(){var t={};return t[l]=e,t[u]=e,$.call(t,v,w.os),T&&!t[l]&&b&&"Unknown"!=b.platform&&(t[l]=b.platform.replace(/chrome os/i,V).replace(/macos/i,q)),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return v},this.setUA=function(t){return v=typeof t===a&&t.length>350?W(t,350):t,this},this.setUA(v),this};K.VERSION="0.7.35",K.BROWSER=z([l,u,s]),K.CPU=z([c]),K.DEVICE=z([o,h,d,p,f,m,g,y,v]),K.ENGINE=K.OS=z([l,u]),E.exports&&(_=E.exports=K),_.UAParser=K;var Q=typeof t!==n&&(t.jQuery||t.Zepto);if(Q&&!Q.ua){var Z=new K;Q.ua=Z.getResult(),Q.ua.get=function(){return Z.getUA()},Q.ua.set=function(t){Z.setUA(t);var e=Z.getResult();for(var i in e)Q.ua[i]=e[i]}}}("object"==typeof window?window:s);const O=function(){let t=(new x.exports.UAParser).getResult(),e=/mqqbrowser|qzone|qqbrowser|qq|micromessenger/i.test(t.ua),i=/android|adr/i.test(t.ua.toLowerCase());return{isTencent:e,browser:t.browser.name?.toLowerCase(),browserVersion:t.browser.version,os:t.os.name?.toLowerCase(),osVersion:t.os.version,platform:/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i.test(t.ua)?"mobile":"pc",isIOS:/\(i[^;]+;( U;)? CPU.+Mac OS X/.test(t.ua),isAndroid:i,isX5:e&&i,isUC:/ucbrowser/.test(t.ua.toLowerCase()),supportMSE:!(!window.MediaSource&&!window.WebKitMediaSource)}}();function U(t,e){let i=Date.now(),n=null;return(...r)=>{n=Date.now(),n-i>e&&(t(...r),i=n)}}const M=document.querySelector.bind(document);function N(t="div",e={},i={}){const n=document.createElement(t);return Object.getOwnPropertyNames(e).forEach((t=>{n[t]=e[t]})),Object.getOwnPropertyNames(i).forEach((t=>{n.setAttribute(t,i[t])})),n}function B(t){return"string"==typeof t?M(t):t}function F(t,e){return new Promise(((i,n)=>{if(document.getElementById(t))i(!0);else{let r=document.createElement("script");r.setAttribute("id",t),r.setAttribute("src",e),document.head.appendChild(r),r.onload=()=>i(!0),r.onerror=()=>n(Error("network error")),setTimeout((()=>{n(Error("timeout"))}),1e4)}}))}function V(){const t={transition:"transitionend",WebkitTransition:"webkitTransitionEnd"};let e=document.createElement("div"),i=Object.keys(t);for(let n of i)if(void 0!==e.style[n])return{css:n,event:t[n]};return!1}const q=window.WebKitCSSMatrix||window.DOMMatrix||window.MSCSSMatrix;function z(t){const e=window.getComputedStyle(t,null).getPropertyValue("transform");return Number(q?new q(e).m41:e.match(/[+-]?\d+/g)[4])}function H(t,e){let i=void 0!==document.hidden?["hidden","visibilitychange","visibilityState"]:"webkitHidden"in document?["webkitHidden","webkitvisibilitychange","webkitVisibilityState"]:void 0;i&&document.addEventListener(i[1],(function(){"visible"===document[i[2]]?t&&t():e&&e()}),!1)}const G=function(){let t=!1;try{const e={get passive(){return t=!0,!0}},i=()=>{};window.addEventListener("test",i,e),window.removeEventListener("test",i)}catch(e){t=!1}return t}();function W(t,e,i){const n="ontouchend"in document,r={down:{t:"touchstart",f:"mousedown"},move:{t:"touchmove",f:"mousemove"},up:{t:"touchend",f:"mouseup"}};let a=t.getBoundingClientRect(),s=n?r[e].t:r[e].f;t.addEventListener(s,(t=>{n&&function(t,e){e.clientX="touchend"===t?e.changedTouches[0].clientX:e.touches[0].clientX}(s,t),i(t,a.x)}),!!G&&{passive:!0})}class ${videoNode;type;autoplay=!0;controls="native";poster="";debug=!1;constructor(){}merge(t){if(!t)return this;for(let e in t)"object"==typeof t[e]?this[e]={...this[e],...t[e]}:this[e]=t[e];return this}}class X extends ${appId;accountId;token;language="en";liveOption;vodOption;scheduleOption={enable:!0,playerData:{dispatch_server:"",log_info:{uid:""},default_server:{uri:""},app_type:0,live_type:0,live_subtitle:0,live_delay:0,live_duration:0}};pursueOption;switchOption={enable:!0};marqueeOption={enable:!1};watermarkOption={enable:!1};barrageOption={enable:!0,positionRange:[0,.5],speed:100,style:{opacity:80,backgroundColor:"transparent"}};reportOption;peer5Option={enable:!1,customerId:"",fallback:!0};vttOptions={enable:!1};uiOptions;constructor(){super();let t={bufferPursue:20,bufferSeek:30,bufferStop:10,pursueSpeed:1.2,mode:"pursue"},e={bufferPursue:30,bufferSeek:40,bufferStop:20,pursueSpeed:1.2,mode:"pursue"};this.pursueOption={enable:!0,flv:t,hls:e,dash:e,native:t}}}const j="//api.vhallyun.com/sdk",Y=(Date.now(),{APP_ID:"app_id",THIRD_PARTY_USER_ID:"third_party_user_id",CLIENT:"client",ACCESS_TOKEN:"access_token",PACKAGE_CHECK:"package_check",LANGUAGE:"language"}),K="/v2/init/start",Q="/v2/room/get-watch-info",Z="/v2/demand/get-record-watch-info";var J,tt,et,it;!function(t){t.Flv="flv",t.Hls="hls",t.HlsNative="hlsnative",t.Flash="flash",t.Native="native",t.Dash="dash"}(J||(J={})),function(t){t.P360="360p",t.P480="480p",t.P720="720p",t.Pa="a",t.PSame="same"}(tt||(tt={})),function(t){t.TX="tx",t.ALI="ali",t.HW="hw",t.CY="cy"}(et||(et={})),function(t){t.UISingleDisplay="UISingleDisplay",t.UIResize="UIResize"}(it||(it={})),function(t){t.Error="error",t.Waiting="waiting",t.Ended="ended",t.Loaded="loadeddata",t.Play="play",t.Canplay="canplay",t.Pause="pause",t.Ratechange="ratechange",t.Stalled="stalled",t.Volumechange="volumechange"}(it||(it={})),function(t){t.VTT_ADDED="vttAdded",t.VTT_SELECTED="vttSelected",t.VTT_CLOSED="vttClosed",t.DEFINITION_CHANGE="definitionChange",t.LIVESUBTITLE_OPENED="liveSubtitleOpened",t.LIVESUBTITLE_CLOSED="liveSubtitleClosed",t.AUTOPLAY_FAILED="autoplayFailed",t.FULLSCREEN_CHANGED="fullscreenChanged",t.LAG_REPORT="lagReport",t.LAG_RECOVER="lagRecover",t.OPEN_BARRAGE="openBarrage",t.CLOSE_BARRAGE="closeBarrage",t.CLEAR_BARRAGE="clearBarrage",t.SCHEDULER_COMPLETE="scheduleComplete",t.PULL_STREAM_FAILED="PULL_STREAM_FAILED",t.LINE_CHANGE="lineChange",t.LINE_CHANGED="lineChanged",t.LIVE_TIMESHIFT="liveTimeShift",t.TOUCH_PLAY="touchPlay",t.HLS_ERROR="hlsError",t.FLV_ERROR="flvError"}(it||(it={}));var nt,rt={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,i="~";function n(){}function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function a(t,e,n,a,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new r(n,a||t,s),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],o]:t._events[l].push(o):(t._events[l]=o,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),o.prototype.eventNames=function(){var t,n,r=[];if(0===this._eventsCount)return r;for(n in t=this._events)e.call(t,n)&&r.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},o.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,a=n.length,s=new Array(a);r<a;r++)s[r]=n[r].fn;return s},o.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},o.prototype.emit=function(t,e,n,r,a,s){var o=i?i+t:t;if(!this._events[o])return!1;var l,d,h=this._events[o],u=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,r),!0;case 5:return h.fn.call(h.context,e,n,r,a),!0;case 6:return h.fn.call(h.context,e,n,r,a,s),!0}for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];h.fn.apply(h.context,l)}else{var c,p=h.length;for(d=0;d<p;d++)switch(h[d].once&&this.removeListener(t,h[d].fn,void 0,!0),u){case 1:h[d].fn.call(h[d].context);break;case 2:h[d].fn.call(h[d].context,e);break;case 3:h[d].fn.call(h[d].context,e,n);break;case 4:h[d].fn.call(h[d].context,e,n,r);break;default:if(!l)for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];h[d].fn.apply(h[d].context,l)}}return!0},o.prototype.on=function(t,e,i){return a(this,t,e,i,!1)},o.prototype.once=function(t,e,i){return a(this,t,e,i,!0)},o.prototype.removeListener=function(t,e,n,r){var a=i?i+t:t;if(!this._events[a])return this;if(!e)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==e||r&&!o.once||n&&o.context!==n||s(this,a);else{for(var l=0,d=[],h=o.length;l<h;l++)(o[l].fn!==e||r&&!o[l].once||n&&o[l].context!==n)&&d.push(o[l]);d.length?this._events[a]=1===d.length?d[0]:d:s(this,a)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&s(this,e)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o}(rt);class at{_emitter=new rt.exports.EventEmitter;constructor(){}emit(t,e){return this._emitter.emit(t,e)}listenerCount(t){return this._emitter.listenerCount(t)}listeners(t){return this._emitter.listeners(t)}on(t,e,i=this){this._emitter.on(t,e,i)}once(t,e,i=this){this._emitter.once(t,e,i)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,i=this,n){this._emitter.off(t,e,i,n)}}!function(t){t.Trace="trace",t.Debug="debug",t.Log="log",t.Warn="warn",t.Info="info",t.Error="error"}(nt||(nt={}));const st=function(){},ot={trace:st,debug:st,log:st,warn:st,info:st,error:st};let lt=ot;function dt(t,...e){!1!==t&&e.forEach((function(e){lt[e]="object"==typeof t&&t[e]?t[e].bind(t):function(t){const e=self.console[t];if(e){const i={trace:"green",debug:"purple",log:"indigo",warn:"coral",info:"blue",error:"red"};return e.bind(self.console,`%c[vlog ${t}]`,`color:${i[t]};font-size:14px;`)}return st}(e)}))}const ht=lt;class ut{video;options;playedTime=0;playBackRate=1;isPaused=!0;url="";cacheUrl="";autoPlayed=!1;context;constructor(t,e){this.options=t,this.context=e,this.video=this.initVideo(t,B("#"+t.videoNode)),this.registerListeners()}initVideo(t,e=document.body){let i={playsinline:!0,"webkit-playsinline":!0,"x5-playsinline":!0,"mtt-playsinline":!0},n=N("video",{autoplay:!!t.autoplay,controls:"native"===t.controls,muted:!!t.muted},{width:"100%",height:"100%",crossOrigin:"anonymous","z-index":0,...i,...t.poster?{poster:t.poster}:{}});return e.style.position="relative",e.appendChild(n),n}checkUrl(t,e=!1){return t?this.url!==t||e?(this.cacheUrl||(this.cacheUrl=t),!0):(ht.warn("BasePlayer checkUrl - url 未改变"),!1):(ht.warn("BasePlayer checkUrl - url 未提供"),!1)}setUrl(t){this.context?.emit(it.LINE_CHANGED,{old:this.url,new:t}),this.url=t,this.cacheUrl=""}recordPlayStatus(t){ht.info("BasePlayer change line old => ",this.url),ht.info("BasePlayer change line new => ",t),this.playedTime=this.video.currentTime,this.playBackRate=this.video.playbackRate,this.isPaused=this.video.paused}recoverPlayStatus(){ht.info("BasePlayer 还原切线前播放状态:"),"vod"===this.options.type&&(ht.info("BasePlayer playedTime:",this.playedTime),this.video.currentTime=this.playedTime),ht.info("BasePlayer playBackRate:",this.playBackRate),this.video.playbackRate=this.playBackRate,this.isPaused||this.video.play()}registerListeners(){this.video.addEventListener("play",(t=>{this.context?.emit(it.Play,t)})),this.video.addEventListener("pause",(t=>{this.context?.emit(it.Pause,t)})),this.video.addEventListener("canplay",(t=>{this.context?.emit(it.Canplay,t)})),this.video.addEventListener("waiting",(t=>{this.context?.emit(it.Waiting,t)})),this.video.addEventListener("ended",(t=>{this.context?.emit(it.Ended,t)})),this.video.addEventListener("error",(t=>{this.context?.emit(it.Error,t),ht.error(`BasePlayer video error, type: ${t.type}; details: ${t.details}`);let e=t.target&&t.target.error;e&&ht.error(`BasePlayer video error, code: ${e.code}; details: ${e.message}`)})),this.video.addEventListener("stalled",(t=>{this.context?.emit(it.Stalled,t)})),this.video.addEventListener("loadeddata",(t=>{this.context?.emit(it.Loaded,t)})),this.video.addEventListener("ratechange",(t=>{ht.info("BasePlayer video ratechange",this.video.playbackRate),this.context?.emit(it.Ratechange,t)})),this.video.addEventListener("volumechange",(t=>{this.context?.emit(it.Volumechange,t)})),this.video.addEventListener("canplaythrough",(t=>{this.options.autoplay&&!this.autoPlayed&&this.video.paused&&(this.autoPlayed=!0,this.video.play().catch((t=>{ht.warn("BasePlayer - not support autoplay"),this.context?.emit(it.AUTOPLAY_FAILED,t)})))}))}}class ct extends ut{nPlayer;static Events=r.default.Events;type;cacheInfo={};constructor(t,e="flv",i){super(t,i),ht.info(`FlvPlayer - 创建 ${e} player`,t),this.type=e}load(t,e=!1){return this.checkUrl(t,e)?(this.nPlayer&&this.recordPlayStatus(t),new Promise((e=>{this.createInstance({type:this.type,isLive:"live"===this.options.type,url:t},this.options.flvOptions||{}).then((i=>{i&&this.nPlayer.on(r.default.Events.METADATA_ARRIVED,(()=>{this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}})),this.registerFlvListeners(),this.nPlayer.on(r.default.Events.METADATA_ARRIVED,(()=>{this.setUrl(t)})),this.nPlayer.attachMediaElement(this.video),this.nPlayer.load(),e(!0)}))}))):Promise.reject(!1)}reload(){return this.load(this.cacheUrl||this.url,!0)}async createInstance(t,e){if("flv"===this.type&&!r.default.isSupported())throw ht.error("FlvPlayer createInstance - flv not supported!"),Error("flv not supported!");const i=!!this.nPlayer;return await this.destroy(),this.nPlayer=r.default.createPlayer(t,e),i}destroy(){return this.nPlayer?.destroy(),Promise.resolve(!0)}registerFlvListeners(){this.nPlayer.on(r.default.Events.ERROR,((t,...e)=>{ht.error("FlvPlayer Events.ERROR",t,e),this.context?.emit(it.FLV_ERROR,{errType:t,data:e}),t===r.default.ErrorTypes.NETWORK_ERROR&&(e[0]===r.default.ErrorDetails.NETWORK_STATUS_CODE_INVALID&&404===e[1].code||e[0]===r.default.ErrorDetails.NETWORK_TIMEOUT||void 0===e[1].code)&&this.context?.emit(it.PULL_STREAM_FAILED,this.url)})),this.nPlayer.on(r.default.Events.LOADING_COMPLETE,(t=>{ht.info("FlvPlayer Events.LOADING_COMPLETE",t),this.context?.emit(it.PULL_STREAM_FAILED,this.url)})),this.nPlayer.on(r.default.Events.STATISTICS_INFO,(t=>{this.cacheInfo=t}))}getBandwidthEstimate(){return this.cacheInfo.speed||0}}class pt extends ut{nPlayer;static Events=a.default.Events;constructor(t,e){super(t,e),ht.info("HlsPlayer - 创建 HlsPlayer",t)}load(t,e=!1){return this.checkUrl(t,e)?(this.nPlayer&&this.recordPlayStatus(t),new Promise((e=>{this.createHlsInstance().then((i=>{i&&(this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}),this.registerHlsListeners(),this.nPlayer.on(a.default.Events.MANIFEST_LOADED,(()=>{this.setUrl(t)})),this.nPlayer.loadSource(t),this.nPlayer.attachMedia(this.video),e(!0)}))}))):Promise.reject(!1)}reload(){return this.load(this.cacheUrl||this.url,!0)}async createHlsInstance(){if(!a.default.isSupported())throw ht.error("HlsPlayer - hls not supported"),Error("hls not supported");let t=await this.destroy();return this.nPlayer=new a.default({...this.options.hlsOptions||{},fLoader:window.peer5&&window.peer5.HlsJsFragmentLoader,pLoader:window.peer5&&window.peer5.HlsJsPlaylistLoader}),t}destroy(){return new Promise((t=>{this.nPlayer?(this.nPlayer.once(a.default.Events.MEDIA_DETACHED,(()=>{t(!0)})),this.nPlayer.destroy()):t(!1)}))}registerHlsListeners(){this.nPlayer.on(a.default.Events.ERROR,((t,e)=>{ht.error("HlsPlayer Events.ERROR",t,e),this.context?.emit(it.HLS_ERROR,e);let{details:i,type:n}=e;n===a.default.ErrorTypes.NETWORK_ERROR&&(i!==a.default.ErrorDetails.MANIFEST_LOAD_ERROR&&i!==a.default.ErrorDetails.MANIFEST_LOAD_TIMEOUT&&i!==a.default.ErrorDetails.LEVEL_LOAD_ERROR&&i!==a.default.ErrorDetails.LEVEL_LOAD_TIMEOUT||this.context?.emit(it.PULL_STREAM_FAILED,this.url))}))}getBandwidthEstimate(){return this.nPlayer.bandwidthEstimate/8192}}class ft extends ut{nPlayer;static Events=i.MediaPlayer.events;constructor(t,e){super(t,e),ht.info("DashPlayer - 创建 DashPlayer")}load(t,e){return this.checkUrl(t,e)?(this.nPlayer&&this.recordPlayStatus(t),new Promise((e=>{this.createHlsInstance().then((n=>{n&&(this.video.onloadedmetadata=()=>{this.recoverPlayStatus()}),this.registerHlsListeners(),this.nPlayer.on(i.MediaPlayer.events.MANIFEST_LOADED,(()=>{this.setUrl(t)})),this.nPlayer.initialize(this.video,t,!0),e(!0)}))}))):Promise.reject(!1)}async createHlsInstance(){if(!i.supportsMediaSource())throw ht.error("DashPlayer - dash not supported"),Error("dash not supported");let t=await this.destroy();return this.nPlayer=i.MediaPlayer().create(),t}registerHlsListeners(){}reload(){return this.load(this.cacheUrl||this.url,!0)}destroy(){return new Promise((t=>{this.nPlayer?(this.nPlayer.destroy(),t(!0)):t(!1)}))}getBandwidthEstimate(){return 0}}const gt={length:0,start:()=>0,end:()=>0};function mt(t){try{let e=function(t){try{return t.buffered}catch(t){return ht.warn("failed to get media.buffered",t),gt}}(t);return e.length?e.end(e.length-1):0}catch(t){return ht.warn("failed to get last media.buffered",t),0}}var yt,vt;!function(t){t.ManifestLoading="ManifestLoading",t.ManifestLoaded="ManifestLoaded",t.ManifestParsed="ManifestParsed",t.TsLoading="TsLoading",t.TsLoaded="TsLoaded",t.Muxed="Muxed",t.Play="play",t.Pause="pause",t.Ratechange="ratechange",t.Stalled="stalled"}(yt||(yt={})),function(t){t.Idle="Idle",t.TsLoading="TsLoading",t.TsLoaded="TsLoaded",t.Ended="Ended"}(vt||(vt={}));var bt=function(){this.init=function(){var t={};this.on=function(e,i){t[e]||(t[e]=[]),t[e]=t[e].concat(i)},this.off=function(e,i){var n;return!!t[e]&&(n=t[e].indexOf(i),t[e]=t[e].slice(),t[e].splice(n,1),n>-1)},this.trigger=function(e){var i,n,r,a;if(i=t[e])if(2===arguments.length)for(r=i.length,n=0;n<r;++n)i[n].call(this,arguments[1]);else{for(a=[],n=arguments.length,n=1;n<arguments.length;++n)a.push(arguments[n]);for(r=i.length,n=0;n<r;++n)i[n].apply(this,a)}},this.dispose=function(){t={}}}};bt.prototype.pipe=function(t){return this.on("data",(function(e){t.push(e)})),this.on("done",(function(e){t.flush(e)})),this.on("partialdone",(function(e){t.partialFlush(e)})),this.on("endedtimeline",(function(e){t.endTimeline(e)})),this.on("reset",(function(e){t.reset(e)})),t},bt.prototype.push=function(t){this.trigger("data",t)},bt.prototype.flush=function(t){this.trigger("done",t)},bt.prototype.partialFlush=function(t){this.trigger("partialdone",t)},bt.prototype.endTimeline=function(t){this.trigger("endedtimeline",t)},bt.prototype.reset=function(t){this.trigger("reset",t)};var wt,Tt,St,Et,_t,kt,Pt,Lt=bt,Ct=9e4;_t=function(t,e){return wt(Et(t,e))},kt=function(t,e){return Tt(St(t),e)},Pt=function(t,e,i){return St(i?t:t-e)};var At,Rt={ONE_SECOND_IN_TS:Ct,secondsToVideoTs:wt=function(t){return t*Ct},secondsToAudioTs:Tt=function(t,e){return t*e},videoTsToSeconds:St=function(t){return t/Ct},audioTsToSeconds:Et=function(t,e){return t/e},audioTsToVideoTs:_t,videoTsToAudioTs:kt,metadataTsToSeconds:Pt},Dt=Rt.ONE_SECOND_IN_TS,It=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(At=function(t){var e,i=0;At.prototype.init.call(this),this.skipWarn_=function(t,e){this.trigger("log",{level:"warn",message:"adts skiping bytes "+t+" to "+e+" in frame "+i+" outside syncword"})},this.push=function(n){var r,a,s,o,l,d=0;if(t||(i=0),"audio"===n.type){var h;for(e&&e.length?(s=e,(e=new Uint8Array(s.byteLength+n.data.byteLength)).set(s),e.set(n.data,s.byteLength)):e=n.data;d+7<e.length;)if(255===e[d]&&240==(246&e[d+1])){if("number"==typeof h&&(this.skipWarn_(h,d),h=null),a=2*(1&~e[d+1]),r=(3&e[d+3])<<11|e[d+4]<<3|(224&e[d+5])>>5,l=(o=1024*(1+(3&e[d+6])))*Dt/It[(60&e[d+2])>>>2],e.byteLength-d<r)break;this.trigger("data",{pts:n.pts+i*l,dts:n.dts+i*l,sampleCount:o,audioobjecttype:1+(e[d+2]>>>6&3),channelcount:(1&e[d+2])<<2|(192&e[d+3])>>>6,samplerate:It[(60&e[d+2])>>>2],samplingfrequencyindex:(60&e[d+2])>>>2,samplesize:16,data:e.subarray(d+7+a,d+r)}),i++,d+=r}else"number"!=typeof h&&(h=d),d++;"number"==typeof h&&(this.skipWarn_(h,d),h=null),e=e.subarray(d)}},this.flush=function(){i=0,this.trigger("done")},this.reset=function(){e=void 0,this.trigger("reset")},this.endTimeline=function(){e=void 0,this.trigger("endedtimeline")}}).prototype=new Lt;var xt,Ot,Ut,Mt=At,Nt=Lt,Bt=function(t){var e=t.byteLength,i=0,n=0;this.length=function(){return 8*e},this.bitsAvailable=function(){return 8*e+n},this.loadWord=function(){var r=t.byteLength-e,a=new Uint8Array(4),s=Math.min(4,e);if(0===s)throw new Error("no bytes available");a.set(t.subarray(r,r+s)),i=new DataView(a.buffer).getUint32(0),n=8*s,e-=s},this.skipBits=function(t){var r;n>t?(i<<=t,n-=t):(t-=n,t-=8*(r=Math.floor(t/8)),e-=r,this.loadWord(),i<<=t,n-=t)},this.readBits=function(t){var r=Math.min(n,t),a=i>>>32-r;return(n-=r)>0?i<<=r:e>0&&this.loadWord(),(r=t-r)>0?a<<r|this.readBits(r):a},this.skipLeadingZeros=function(){var t;for(t=0;t<n;++t)if(0!=(i&2147483648>>>t))return i<<=t,n-=t,t;return this.loadWord(),t+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var t=this.skipLeadingZeros();return this.readBits(t+1)-1},this.readExpGolomb=function(){var t=this.readUnsignedExpGolomb();return 1&t?1+t>>>1:-1*(t>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};(Ot=function(){var t,e,i=0;Ot.prototype.init.call(this),this.push=function(n){var r;e?((r=new Uint8Array(e.byteLength+n.data.byteLength)).set(e),r.set(n.data,e.byteLength),e=r):e=n.data;for(var a=e.byteLength;i<a-3;i++)if(1===e[i+2]){t=i+5;break}for(;t<a;)switch(e[t]){case 0:if(0!==e[t-1]){t+=2;break}if(0!==e[t-2]){t++;break}i+3!==t-2&&this.trigger("data",e.subarray(i+3,t-2));do{t++}while(1!==e[t]&&t<a);i=t-2,t+=3;break;case 1:if(0!==e[t-1]||0!==e[t-2]){t+=3;break}this.trigger("data",e.subarray(i+3,t-2)),i=t-2,t+=3;break;default:t+=3}e=e.subarray(i),t-=i,i=0},this.reset=function(){e=null,i=0,this.trigger("reset")},this.flush=function(){e&&e.byteLength>3&&this.trigger("data",e.subarray(i+3)),e=null,i=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new Nt,Ut={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},xt=function(){var t,e,i,n,r,a,s,o=new Ot;xt.prototype.init.call(this),t=this,this.push=function(t){"video"===t.type&&(e=t.trackId,i=t.pts,n=t.dts,o.push(t))},o.on("data",(function(s){var o={trackId:e,pts:i,dts:n,data:s,nalUnitTypeCode:31&s[0]};switch(o.nalUnitTypeCode){case 5:o.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:o.nalUnitType="sei_rbsp",o.escapedRBSP=r(s.subarray(1));break;case 7:o.nalUnitType="seq_parameter_set_rbsp",o.escapedRBSP=r(s.subarray(1)),o.config=a(o.escapedRBSP);break;case 8:o.nalUnitType="pic_parameter_set_rbsp";break;case 9:o.nalUnitType="access_unit_delimiter_rbsp"}t.trigger("data",o)})),o.on("done",(function(){t.trigger("done")})),o.on("partialdone",(function(){t.trigger("partialdone")})),o.on("reset",(function(){t.trigger("reset")})),o.on("endedtimeline",(function(){t.trigger("endedtimeline")})),this.flush=function(){o.flush()},this.partialFlush=function(){o.partialFlush()},this.reset=function(){o.reset()},this.endTimeline=function(){o.endTimeline()},s=function(t,e){var i,n=8,r=8;for(i=0;i<t;i++)0!==r&&(r=(n+e.readExpGolomb()+256)%256),n=0===r?n:r},r=function(t){for(var e,i,n=t.byteLength,r=[],a=1;a<n-2;)0===t[a]&&0===t[a+1]&&3===t[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return t;e=n-r.length,i=new Uint8Array(e);var s=0;for(a=0;a<e;s++,a++)s===r[0]&&(s++,r.shift()),i[a]=t[s];return i},a=function(t){var e,i,n,r,a,o,l,d,h,u,c,p,f=0,g=0,m=0,y=0,v=[1,1];if(i=(e=new Bt(t)).readUnsignedByte(),r=e.readUnsignedByte(),n=e.readUnsignedByte(),e.skipUnsignedExpGolomb(),Ut[i]&&(3===(a=e.readUnsignedExpGolomb())&&e.skipBits(1),e.skipUnsignedExpGolomb(),e.skipUnsignedExpGolomb(),e.skipBits(1),e.readBoolean()))for(c=3!==a?8:12,p=0;p<c;p++)e.readBoolean()&&s(p<6?16:64,e);if(e.skipUnsignedExpGolomb(),0===(o=e.readUnsignedExpGolomb()))e.readUnsignedExpGolomb();else if(1===o)for(e.skipBits(1),e.skipExpGolomb(),e.skipExpGolomb(),l=e.readUnsignedExpGolomb(),p=0;p<l;p++)e.skipExpGolomb();if(e.skipUnsignedExpGolomb(),e.skipBits(1),d=e.readUnsignedExpGolomb(),h=e.readUnsignedExpGolomb(),0===(u=e.readBits(1))&&e.skipBits(1),e.skipBits(1),e.readBoolean()&&(f=e.readUnsignedExpGolomb(),g=e.readUnsignedExpGolomb(),m=e.readUnsignedExpGolomb(),y=e.readUnsignedExpGolomb()),e.readBoolean()&&e.readBoolean()){switch(e.readUnsignedByte()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[e.readUnsignedByte()<<8|e.readUnsignedByte(),e.readUnsignedByte()<<8|e.readUnsignedByte()]}v&&(v[0],v[1])}return{profileIdc:i,levelIdc:n,profileCompatibility:r,width:16*(d+1)-2*f-2*g,height:(2-u)*(h+1)*16-2*m-2*y,sarRatio:v}}},xt.prototype=new Nt;var Ft,Vt,qt,zt,Ht,Gt,Wt,$t,Xt,jt,Yt,Kt,Qt,Zt,Jt,te,ee,ie,ne,re,ae,se,oe,le,de,he,ue,ce,pe,fe,ge,me,ye,ve,be,we,Te,Se,Ee,_e,ke={H264Stream:xt,NalByteStream:Ot},Pe={Adts:Mt,h264:ke},Le=Math.pow(2,32)-1;!function(){var t;if(se={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(t in se)se.hasOwnProperty(t)&&(se[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);oe=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),de=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),le=new Uint8Array([0,0,0,1]),he=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),ue=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),ce={video:he,audio:ue},ge=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),fe=new Uint8Array([0,0,0,0,0,0,0,0]),me=new Uint8Array([0,0,0,0,0,0,0,0]),ye=me,ve=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),be=me,pe=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}(),Ft=function(t){var e,i,n=[],r=0;for(e=1;e<arguments.length;e++)n.push(arguments[e]);for(e=n.length;e--;)r+=n[e].byteLength;for(i=new Uint8Array(r+8),new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,i.byteLength),i.set(t,4),e=0,r=8;e<n.length;e++)i.set(n[e],r),r+=n[e].byteLength;return i},Vt=function(){return Ft(se.dinf,Ft(se.dref,ge))},qt=function(t){return Ft(se.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,t.audioobjecttype<<3|t.samplingfrequencyindex>>>1,t.samplingfrequencyindex<<7|t.channelcount<<3,6,1,2]))},Jt=function(t){return Ft(se.hdlr,ce[t])},Zt=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.samplerate&&(e[12]=t.samplerate>>>24&255,e[13]=t.samplerate>>>16&255,e[14]=t.samplerate>>>8&255,e[15]=255&t.samplerate),Ft(se.mdhd,e)},Qt=function(t){return Ft(se.mdia,Zt(t),Jt(t.type),Gt(t))},Ht=function(t){return Ft(se.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},Gt=function(t){return Ft(se.minf,"video"===t.type?Ft(se.vmhd,pe):Ft(se.smhd,fe),Vt(),ee(t))},Wt=function(t,e){for(var i=[],n=e.length;n--;)i[n]=ne(e[n]);return Ft.apply(null,[se.moof,Ht(t)].concat(i))},$t=function(t){for(var e=t.length,i=[];e--;)i[e]=Yt(t[e]);return Ft.apply(null,[se.moov,jt(4294967295)].concat(i).concat(Xt(t)))},Xt=function(t){for(var e=t.length,i=[];e--;)i[e]=re(t[e]);return Ft.apply(null,[se.mvex].concat(i))},jt=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Ft(se.mvhd,e)},te=function(t){var e,i,n=t.samples||[],r=new Uint8Array(4+n.length);for(i=0;i<n.length;i++)e=n[i].flags,r[i+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return Ft(se.sdtp,r)},ee=function(t){return Ft(se.stbl,ie(t),Ft(se.stts,be),Ft(se.stsc,ye),Ft(se.stsz,ve),Ft(se.stco,me))},ie=function(t){return Ft(se.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===t.type?we(t):Te(t))},we=function(t){var e,i,n=t.sps||[],r=t.pps||[],a=[],s=[];for(e=0;e<n.length;e++)a.push((65280&n[e].byteLength)>>>8),a.push(255&n[e].byteLength),a=a.concat(Array.prototype.slice.call(n[e]));for(e=0;e<r.length;e++)s.push((65280&r[e].byteLength)>>>8),s.push(255&r[e].byteLength),s=s.concat(Array.prototype.slice.call(r[e]));if(i=[se.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),Ft(se.avcC,new Uint8Array([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([n.length],a,[r.length],s))),Ft(se.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],t.sarRatio){var o=t.sarRatio[0],l=t.sarRatio[1];i.push(Ft(se.pasp,new Uint8Array([(4278190080&o)>>24,(16711680&o)>>16,(65280&o)>>8,255&o,(4278190080&l)>>24,(16711680&l)>>16,(65280&l)>>8,255&l])))}return Ft.apply(null,i)},Te=function(t){return Ft(se.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelcount)>>8,255&t.channelcount,(65280&t.samplesize)>>8,255&t.samplesize,0,0,0,0,(65280&t.samplerate)>>8,255&t.samplerate,0,0]),qt(t))},Kt=function(t){var e=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return Ft(se.tkhd,e)},ne=function(t){var e,i,n,r,a,s;return e=Ft(se.tfhd,new Uint8Array([0,0,0,58,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),a=Math.floor(t.baseMediaDecodeTime/(Le+1)),s=Math.floor(t.baseMediaDecodeTime%(Le+1)),i=Ft(se.tfdt,new Uint8Array([1,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),92,"audio"===t.type?(n=ae(t,92),Ft(se.traf,e,i,n)):(r=te(t),n=ae(t,r.length+92),Ft(se.traf,e,i,n,r))},Yt=function(t){return t.duration=t.duration||4294967295,Ft(se.trak,Kt(t),Qt(t))},re=function(t){var e=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==t.type&&(e[e.length-1]=0),Ft(se.trex,e)},_e=function(t,e){var i=0,n=0,r=0,a=0;return t.length&&(void 0!==t[0].duration&&(i=1),void 0!==t[0].size&&(n=2),void 0!==t[0].flags&&(r=4),void 0!==t[0].compositionTimeOffset&&(a=8)),[0,0,i|n|r|a,1,(4278190080&t.length)>>>24,(16711680&t.length)>>>16,(65280&t.length)>>>8,255&t.length,(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},Ee=function(t,e){var i,n,r,a,s,o;for(e+=20+16*(a=t.samples||[]).length,r=_e(a,e),(n=new Uint8Array(r.length+16*a.length)).set(r),i=r.length,o=0;o<a.length;o++)s=a[o],n[i++]=(4278190080&s.duration)>>>24,n[i++]=(16711680&s.duration)>>>16,n[i++]=(65280&s.duration)>>>8,n[i++]=255&s.duration,n[i++]=(4278190080&s.size)>>>24,n[i++]=(16711680&s.size)>>>16,n[i++]=(65280&s.size)>>>8,n[i++]=255&s.size,n[i++]=s.flags.isLeading<<2|s.flags.dependsOn,n[i++]=s.flags.isDependedOn<<6|s.flags.hasRedundancy<<4|s.flags.paddingValue<<1|s.flags.isNonSyncSample,n[i++]=61440&s.flags.degradationPriority,n[i++]=15&s.flags.degradationPriority,n[i++]=(4278190080&s.compositionTimeOffset)>>>24,n[i++]=(16711680&s.compositionTimeOffset)>>>16,n[i++]=(65280&s.compositionTimeOffset)>>>8,n[i++]=255&s.compositionTimeOffset;return Ft(se.trun,n)},Se=function(t,e){var i,n,r,a,s,o;for(e+=20+8*(a=t.samples||[]).length,r=_e(a,e),(i=new Uint8Array(r.length+8*a.length)).set(r),n=r.length,o=0;o<a.length;o++)s=a[o],i[n++]=(4278190080&s.duration)>>>24,i[n++]=(16711680&s.duration)>>>16,i[n++]=(65280&s.duration)>>>8,i[n++]=255&s.duration,i[n++]=(4278190080&s.size)>>>24,i[n++]=(16711680&s.size)>>>16,i[n++]=(65280&s.size)>>>8,i[n++]=255&s.size;return Ft(se.trun,i)},ae=function(t,e){return"audio"===t.type?Se(t,e):Ee(t,e)};var Ce,Ae,Re,De,Ie,xe,Oe={ftyp:zt=function(){return Ft(se.ftyp,oe,le,oe,de)},mdat:function(t){return Ft(se.mdat,t)},moof:Wt,moov:$t,initSegment:function(t){var e,i=zt(),n=$t(t);return(e=new Uint8Array(i.byteLength+n.byteLength)).set(i),e.set(n,i.byteLength),e}},Ue=function(t){return t>>>0},Me=function(t){var e="";return e+=String.fromCharCode(t[0]),e+=String.fromCharCode(t[1]),e+=String.fromCharCode(t[2]),e+=String.fromCharCode(t[3])},Ne=Ue,Be=Me,Fe=function t(e,i){var n,r,a,s,o,l=[];if(!i.length)return null;for(n=0;n<e.byteLength;)r=Ne(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),a=Be(e.subarray(n+4,n+8)),s=r>1?n+r:e.byteLength,a===i[0]&&(1===i.length?l.push(e.subarray(n+8,s)):(o=t(e.subarray(n+8,s),i.slice(1))).length&&(l=l.concat(o))),n=s;return l},Ve=function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:i.getUint32(4)},r=1&n.flags[2],a=2&n.flags[2],s=8&n.flags[2],o=16&n.flags[2],l=32&n.flags[2],d=65536&n.flags[0],h=131072&n.flags[0];return e=8,r&&(e+=4,n.baseDataOffset=i.getUint32(12),e+=4),a&&(n.sampleDescriptionIndex=i.getUint32(e),e+=4),s&&(n.defaultSampleDuration=i.getUint32(e),e+=4),o&&(n.defaultSampleSize=i.getUint32(e),e+=4),l&&(n.defaultSampleFlags=i.getUint32(e)),d&&(n.durationIsEmpty=!0),!r&&h&&(n.baseDataOffsetIsMoof=!0),n},qe=function(t){return{isLeading:(12&t[0])>>>2,dependsOn:3&t[0],isDependedOn:(192&t[1])>>>6,hasRedundancy:(48&t[1])>>>4,paddingValue:(14&t[1])>>>1,isNonSyncSample:1&t[1],degradationPriority:t[2]<<8|t[3]}},ze=function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]},n=new DataView(t.buffer,t.byteOffset,t.byteLength),r=1&i.flags[2],a=4&i.flags[2],s=1&i.flags[1],o=2&i.flags[1],l=4&i.flags[1],d=8&i.flags[1],h=n.getUint32(4),u=8;for(r&&(i.dataOffset=n.getInt32(u),u+=4),a&&h&&(e={flags:qe(t.subarray(u,u+4))},u+=4,s&&(e.duration=n.getUint32(u),u+=4),o&&(e.size=n.getUint32(u),u+=4),d&&(1===i.version?e.compositionTimeOffset=n.getInt32(u):e.compositionTimeOffset=n.getUint32(u),u+=4),i.samples.push(e),h--);h--;)e={},s&&(e.duration=n.getUint32(u),u+=4),o&&(e.size=n.getUint32(u),u+=4),l&&(e.flags=qe(t.subarray(u,u+4)),u+=4),d&&(1===i.version?e.compositionTimeOffset=n.getInt32(u):e.compositionTimeOffset=n.getUint32(u),u+=4),i.samples.push(e);return i},He=Ue,Ge=function(t){var e={version:t[0],flags:new Uint8Array(t.subarray(1,4)),baseMediaDecodeTime:He(t[4]<<24|t[5]<<16|t[6]<<8|t[7])};return 1===e.version&&(e.baseMediaDecodeTime*=Math.pow(2,32),e.baseMediaDecodeTime+=He(t[8]<<24|t[9]<<16|t[10]<<8|t[11])),e},We=Ue,$e=function(t){return("00"+t.toString(16)).slice(-2)},Xe=Fe,je=Me,Ye=Ve,Ke=ze,Qe=Ge;Ce=function(t){return Xe(t,["moov","trak"]).reduce((function(t,e){var i,n,r,a,s;return(i=Xe(e,["tkhd"])[0])?(n=i[0],a=We(i[r=0===n?12:20]<<24|i[r+1]<<16|i[r+2]<<8|i[r+3]),(s=Xe(e,["mdia","mdhd"])[0])?(r=0===(n=s[0])?12:20,t[a]=We(s[r]<<24|s[r+1]<<16|s[r+2]<<8|s[r+3]),t):null):null}),{})},Ae=function(t,e){var i,n,r;return i=Xe(e,["moof","traf"]),n=[].concat.apply([],i.map((function(e){return Xe(e,["tfhd"]).map((function(i){var n,r,a;return n=We(i[4]<<24|i[5]<<16|i[6]<<8|i[7]),r=t[n]||9e4,a=Xe(e,["tfdt"]).map((function(t){var e,i;return e=t[0],i=We(t[4]<<24|t[5]<<16|t[6]<<8|t[7]),1===e&&(i*=Math.pow(2,32),i+=We(t[8]<<24|t[9]<<16|t[10]<<8|t[11])),i}))[0],(a="number"!=typeof a||isNaN(a)?1/0:a)/r}))}))),r=Math.min.apply(null,n),isFinite(r)?r:0},Re=function(t,e){var i,n=Xe(e,["moof","traf"]),r=0,a=0;if(n&&n.length){var s=Xe(n[0],["tfhd"])[0],o=Xe(n[0],["trun"])[0],l=Xe(n[0],["tfdt"])[0];if(s)i=Ye(s).trackId;if(l)r=Qe(l).baseMediaDecodeTime;if(o){var d=Ke(o);d.samples&&d.samples.length&&(a=d.samples[0].compositionTimeOffset||0)}}return(r+a)/(t[i]||9e4)},De=function(t){var e=Xe(t,["moov","trak"]),i=[];return e.forEach((function(t){var e=Xe(t,["mdia","hdlr"]),n=Xe(t,["tkhd"]);e.forEach((function(t,e){var r,a,s=je(t.subarray(8,12)),o=n[e];"vide"===s&&(a=0===(r=new DataView(o.buffer,o.byteOffset,o.byteLength)).getUint8(0)?r.getUint32(12):r.getUint32(20),i.push(a))}))})),i},xe=function(t){var e=0===t[0]?12:20;return We(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])},Ie=function(t){var e=Xe(t,["moov","trak"]),i=[];return e.forEach((function(t){var e,n,r={},a=Xe(t,["tkhd"])[0];a&&(n=(e=new DataView(a.buffer,a.byteOffset,a.byteLength)).getUint8(0),r.id=0===n?e.getUint32(12):e.getUint32(20));var s=Xe(t,["mdia","hdlr"])[0];if(s){var o=je(s.subarray(8,12));r.type="vide"===o?"video":"soun"===o?"audio":o}var l=Xe(t,["mdia","minf","stbl","stsd"])[0];if(l){var d=l.subarray(8);r.codec=je(d.subarray(4,8));var h,u=Xe(d,[r.codec])[0];u&&(/^[asm]vc[1-9]$/i.test(r.codec)?(h=u.subarray(78),"avcC"===je(h.subarray(4,8))&&h.length>11?(r.codec+=".",r.codec+=$e(h[9]),r.codec+=$e(h[10]),r.codec+=$e(h[11])):r.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(r.codec)?(h=u.subarray(28),"esds"===je(h.subarray(4,8))&&h.length>20&&0!==h[19]?(r.codec+="."+$e(h[19]),r.codec+="."+$e(h[20]>>>2&63).replace(/^0/,"")):r.codec="mp4a.40.2"):r.codec=r.codec.toLowerCase())}var c=Xe(t,["mdia","mdhd"])[0];c&&(r.timescale=xe(c)),i.push(r)})),i};var Ze,Je={findBox:Xe,parseType:je,timescale:Ce,startTime:Ae,compositionStartTime:Re,videoTrackIds:De,tracks:Ie,getTimescaleFromMediaHeader:xe},ti=function(t,e){var i={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return i.dataOffset=e,i.compositionTimeOffset=t.pts-t.dts,i.duration=t.duration,i.size=4*t.length,i.size+=t.byteLength,t.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i},ei={groupNalsIntoFrames:function(t){var e,i,n=[],r=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,n.byteLength=0,e=0;e<t.length;e++)"access_unit_delimiter_rbsp"===(i=t[e]).nalUnitType?(n.length&&(n.duration=i.dts-n.dts,r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n)),(n=[i]).byteLength=i.data.byteLength,n.pts=i.pts,n.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(n.keyFrame=!0),n.duration=i.dts-n.dts,n.byteLength+=i.data.byteLength,n.push(i));return r.length&&(!n.duration||n.duration<=0)&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n),r},groupFramesIntoGops:function(t){var e,i,n=[],r=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=t[0].pts,n.dts=t[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=t[0].pts,r.dts=t[0].dts,e=0;e<t.length;e++)(i=t[e]).keyFrame?(n.length&&(r.push(n),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration),(n=[i]).nalCount=i.length,n.byteLength=i.byteLength,n.pts=i.pts,n.dts=i.dts,n.duration=i.duration):(n.duration+=i.duration,n.nalCount+=i.length,n.byteLength+=i.byteLength,n.push(i));return r.length&&n.duration<=0&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration,r.push(n),r},extendFirstKeyFrame:function(t){var e;return!t[0][0].keyFrame&&t.length>1&&(e=t.shift(),t.byteLength-=e.byteLength,t.nalCount-=e.nalCount,t[0][0].dts=e.dts,t[0][0].pts=e.pts,t[0][0].duration+=e.duration),t},generateSampleTable:function(t,e){var i,n,r,a,s,o=e||0,l=[];for(i=0;i<t.length;i++)for(a=t[i],n=0;n<a.length;n++)s=a[n],o+=(r=ti(s,o)).size,l.push(r);return l},concatenateNalData:function(t){var e,i,n,r,a,s,o=0,l=t.byteLength,d=t.nalCount,h=new Uint8Array(l+4*d),u=new DataView(h.buffer);for(e=0;e<t.length;e++)for(r=t[e],i=0;i<r.length;i++)for(a=r[i],n=0;n<a.length;n++)s=a[n],u.setUint32(o,s.data.byteLength),o+=4,h.set(s.data,o),o+=s.data.byteLength;return h},generateSampleTableForFrame:function(t,e){var i,n=[];return i=ti(t,e||0),n.push(i),n},concatenateNalDataForFrame:function(t){var e,i,n=0,r=t.byteLength,a=t.length,s=new Uint8Array(r+4*a),o=new DataView(s.buffer);for(e=0;e<t.length;e++)i=t[e],o.setUint32(n,i.data.byteLength),n+=4,s.set(i.data,n),n+=i.data.byteLength;return s}},ii=[33,16,5,32,164,27],ni=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],ri=function(t){for(var e=[];t--;)e.push(0);return e},ai=function(){if(!Ze){var t={96e3:[ii,[227,64],ri(154),[56]],88200:[ii,[231],ri(170),[56]],64e3:[ii,[248,192],ri(240),[56]],48e3:[ii,[255,192],ri(268),[55,148,128],ri(54),[112]],44100:[ii,[255,192],ri(268),[55,163,128],ri(84),[112]],32e3:[ii,[255,192],ri(268),[55,234],ri(226),[112]],24e3:[ii,[255,192],ri(268),[55,255,128],ri(268),[111,112],ri(126),[224]],16e3:[ii,[255,192],ri(268),[55,255,128],ri(268),[111,255],ri(269),[223,108],ri(195),[1,192]],12e3:[ni,ri(268),[3,127,248],ri(268),[6,255,240],ri(268),[13,255,224],ri(268),[27,253,128],ri(259),[56]],11025:[ni,ri(268),[3,127,248],ri(268),[6,255,240],ri(268),[13,255,224],ri(268),[27,255,192],ri(268),[55,175,128],ri(108),[112]],8e3:[ni,ri(268),[3,121,16],ri(47),[7]]};e=t,Ze=Object.keys(e).reduce((function(t,i){return t[i]=new Uint8Array(e[i].reduce((function(t,e){return t.concat(e)}),[])),t}),{})}var e;return Ze},si=Rt,oi={prefixWithSilence:function(t,e,i,n){var r,a,s,o,l,d=0,h=0,u=0;if(e.length&&(r=si.audioTsToVideoTs(t.baseMediaDecodeTime,t.samplerate),a=Math.ceil(si.ONE_SECOND_IN_TS/(t.samplerate/1024)),i&&n&&(d=r-Math.max(i,n),u=(h=Math.floor(d/a))*a),!(h<1||u>si.ONE_SECOND_IN_TS/2))){for((s=ai()[t.samplerate])||(s=e[0].data),o=0;o<h;o++)l=e[0],e.splice(0,0,{data:s,dts:l.dts-a,pts:l.pts-a});return t.baseMediaDecodeTime-=Math.floor(si.videoTsToAudioTs(u,t.samplerate)),u}},trimAdtsFramesByEarliestDts:function(t,e,i){return e.minSegmentDts>=i?t:(e.minSegmentDts=1/0,t.filter((function(t){return t.dts>=i&&(e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.minSegmentPts=e.minSegmentDts,!0)})))},generateSampleTable:function(t){var e,i,n=[];for(e=0;e<t.length;e++)i=t[e],n.push({size:i.data.byteLength,duration:1024});return n},concatenateFrameData:function(t){var e,i,n=0,r=new Uint8Array(function(t){var e,i=0;for(e=0;e<t.length;e++)i+=t[e].data.byteLength;return i}(t));for(e=0;e<t.length;e++)i=t[e],r.set(i.data,n),n+=i.data.byteLength;return r}},li=Rt.ONE_SECOND_IN_TS,di={clearDtsInfo:function(t){delete t.minSegmentDts,delete t.maxSegmentDts,delete t.minSegmentPts,delete t.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(t,e){var i,n=t.minSegmentDts;return e||(n-=t.timelineStartInfo.dts),i=t.timelineStartInfo.baseMediaDecodeTime,i+=n,i=Math.max(0,i),"audio"===t.type&&(i*=t.samplerate/li,i=Math.floor(i)),i},collectDtsInfo:function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts&&(t.timelineStartInfo.pts=e.pts),void 0===t.minSegmentPts?t.minSegmentPts=e.pts:t.minSegmentPts=Math.min(t.minSegmentPts,e.pts),void 0===t.maxSegmentPts?t.maxSegmentPts=e.pts:t.maxSegmentPts=Math.max(t.maxSegmentPts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts&&(t.timelineStartInfo.dts=e.dts),void 0===t.minSegmentDts?t.minSegmentDts=e.dts:t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),void 0===t.maxSegmentDts?t.maxSegmentDts=e.dts:t.maxSegmentDts=Math.max(t.maxSegmentDts,e.dts))}},hi={parseSei:function(t){for(var e=0,i={payloadType:-1,payloadSize:0},n=0,r=0;e<t.byteLength&&128!==t[e];){for(;255===t[e];)n+=255,e++;for(n+=t[e++];255===t[e];)r+=255,e++;if(r+=t[e++],!i.payload&&4===n){if("GA94"===String.fromCharCode(t[e+3],t[e+4],t[e+5],t[e+6])){i.payloadType=n,i.payloadSize=r,i.payload=t.subarray(e,e+r);break}i.payload=void 0}e+=r,n=0,r=0}return i},parseUserData:function(t){return 181!==t.payload[0]||49!=(t.payload[1]<<8|t.payload[2])||"GA94"!==String.fromCharCode(t.payload[3],t.payload[4],t.payload[5],t.payload[6])||3!==t.payload[7]?null:t.payload.subarray(8,t.payload.length-1)},parseCaptionPackets:function(t,e){var i,n,r,a,s=[];if(!(64&e[0]))return s;for(n=31&e[0],i=0;i<n;i++)a={type:3&e[(r=3*i)+2],pts:t},4&e[r+2]&&(a.ccData=e[r+3]<<8|e[r+4],s.push(a));return s},discardEmulationPreventionBytes:function(t){for(var e,i,n=t.byteLength,r=[],a=1;a<n-2;)0===t[a]&&0===t[a+1]&&3===t[a+2]?(r.push(a+2),a+=2):a++;if(0===r.length)return t;e=n-r.length,i=new Uint8Array(e);var s=0;for(a=0;a<e;s++,a++)s===r[0]&&(s++,r.shift()),i[a]=t[s];return i},USER_DATA_REGISTERED_ITU_T_T35:4},ui=Lt,ci=hi,pi=function t(e){e=e||{},t.prototype.init.call(this),this.parse708captions_="boolean"!=typeof e.parse708captions||e.parse708captions,this.captionPackets_=[],this.ccStreams_=[new Ei(0,0),new Ei(0,1),new Ei(1,0),new Ei(1,1)],this.parse708captions_&&(this.cc708Stream_=new vi({captionServices:e.captionServices})),this.reset(),this.ccStreams_.forEach((function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))}),this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))};(pi.prototype=new ui).push=function(t){var e,i,n;if("sei_rbsp"===t.nalUnitType&&(e=ci.parseSei(t.escapedRBSP)).payload&&e.payloadType===ci.USER_DATA_REGISTERED_ITU_T_T35&&(i=ci.parseUserData(e)))if(t.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(t.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));n=ci.parseCaptionPackets(t.pts,i),this.captionPackets_=this.captionPackets_.concat(n),this.latestDts_!==t.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=t.dts}},pi.prototype.flushCCStreams=function(t){this.ccStreams_.forEach((function(e){return"flush"===t?e.flush():e.partialFlush()}),this)},pi.prototype.flushStream=function(t){this.captionPackets_.length?(this.captionPackets_.forEach((function(t,e){t.presortIndex=e})),this.captionPackets_.sort((function(t,e){return t.pts===e.pts?t.presortIndex-e.presortIndex:t.pts-e.pts})),this.captionPackets_.forEach((function(t){t.type<2?this.dispatchCea608Packet(t):this.dispatchCea708Packet(t)}),this),this.captionPackets_.length=0,this.flushCCStreams(t)):this.flushCCStreams(t)},pi.prototype.flush=function(){return this.flushStream("flush")},pi.prototype.partialFlush=function(){return this.flushStream("partialFlush")},pi.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach((function(t){t.reset()}))},pi.prototype.dispatchCea608Packet=function(t){this.setsTextOrXDSActive(t)?this.activeCea608Channel_[t.type]=null:this.setsChannel1Active(t)?this.activeCea608Channel_[t.type]=0:this.setsChannel2Active(t)&&(this.activeCea608Channel_[t.type]=1),null!==this.activeCea608Channel_[t.type]&&this.ccStreams_[(t.type<<1)+this.activeCea608Channel_[t.type]].push(t)},pi.prototype.setsChannel1Active=function(t){return 4096==(30720&t.ccData)},pi.prototype.setsChannel2Active=function(t){return 6144==(30720&t.ccData)},pi.prototype.setsTextOrXDSActive=function(t){return 256==(28928&t.ccData)||4138==(30974&t.ccData)||6186==(30974&t.ccData)},pi.prototype.dispatchCea708Packet=function(t){this.parse708captions_&&this.cc708Stream_.push(t)};var fi={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600},gi=function(t){return 32<=t&&t<=127||160<=t&&t<=255},mi=function(t){this.windowNum=t,this.reset()};mi.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},mi.prototype.getText=function(){return this.rows.join("\n")},mi.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},mi.prototype.newLine=function(t){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(t),this.rows.length>0&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},mi.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},mi.prototype.addText=function(t){this.rows[this.rowIdx]+=t},mi.prototype.backspace=function(){if(!this.isEmpty()){var t=this.rows[this.rowIdx];this.rows[this.rowIdx]=t.substr(0,t.length-1)}};var yi=function(t,e,i){this.serviceNum=t,this.text="",this.currentWindow=new mi(-1),this.windows=[],this.stream=i,"string"==typeof e&&this.createTextDecoder(e)};yi.prototype.init=function(t,e){this.startPts=t;for(var i=0;i<8;i++)this.windows[i]=new mi(i),"function"==typeof e&&(this.windows[i].beforeRowOverflow=e)},yi.prototype.setCurrentWindow=function(t){this.currentWindow=this.windows[t]},yi.prototype.createTextDecoder=function(t){if("undefined"==typeof TextDecoder)this.stream.trigger("log",{level:"warn",message:"The `encoding` option is unsupported without TextDecoder support"});else try{this.textDecoder_=new TextDecoder(t)}catch(e){this.stream.trigger("log",{level:"warn",message:"TextDecoder could not be created with "+t+" encoding. "+e})}};var vi=function t(e){e=e||{},t.prototype.init.call(this);var i,n=this,r=e.captionServices||{},a={};Object.keys(r).forEach((function(t){i=r[t],/^SERVICE/.test(t)&&(a[t]=i.encoding)})),this.serviceEncodings=a,this.current708Packet=null,this.services={},this.push=function(t){3===t.type?(n.new708Packet(),n.add708Bytes(t)):(null===n.current708Packet&&n.new708Packet(),n.add708Bytes(t))}};vi.prototype=new ui,vi.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},vi.prototype.add708Bytes=function(t){var e=t.ccData,i=e>>>8,n=255&e;this.current708Packet.ptsVals.push(t.pts),this.current708Packet.data.push(i),this.current708Packet.data.push(n)},vi.prototype.push708Packet=function(){var t=this.current708Packet,e=t.data,i=null,n=null,r=0,a=e[r++];for(t.seq=a>>6,t.sizeCode=63&a;r<e.length;r++)n=31&(a=e[r++]),7===(i=a>>5)&&n>0&&(i=a=e[r++]),this.pushServiceBlock(i,r,n),n>0&&(r+=n-1)},vi.prototype.pushServiceBlock=function(t,e,i){var n,r=e,a=this.current708Packet.data,s=this.services[t];for(s||(s=this.initService(t,r));r<e+i&&r<a.length;r++)n=a[r],gi(n)?r=this.handleText(r,s):24===n?r=this.multiByteCharacter(r,s):16===n?r=this.extendedCommands(r,s):128<=n&&n<=135?r=this.setCurrentWindow(r,s):152<=n&&n<=159?r=this.defineWindow(r,s):136===n?r=this.clearWindows(r,s):140===n?r=this.deleteWindows(r,s):137===n?r=this.displayWindows(r,s):138===n?r=this.hideWindows(r,s):139===n?r=this.toggleWindows(r,s):151===n?r=this.setWindowAttributes(r,s):144===n?r=this.setPenAttributes(r,s):145===n?r=this.setPenColor(r,s):146===n?r=this.setPenLocation(r,s):143===n?s=this.reset(r,s):8===n?s.currentWindow.backspace():12===n?s.currentWindow.clearText():13===n?s.currentWindow.pendingNewLine=!0:14===n?s.currentWindow.clearText():141===n&&r++},vi.prototype.extendedCommands=function(t,e){var i=this.current708Packet.data[++t];return gi(i)&&(t=this.handleText(t,e,{isExtended:!0})),t},vi.prototype.getPts=function(t){return this.current708Packet.ptsVals[Math.floor(t/2)]},vi.prototype.initService=function(t,e){var i,n,r=this;return(i="SERVICE"+t)in this.serviceEncodings&&(n=this.serviceEncodings[i]),this.services[t]=new yi(t,n,r),this.services[t].init(this.getPts(e),(function(e){r.flushDisplayed(e,r.services[t])})),this.services[t]},vi.prototype.handleText=function(t,e,i){var n,r,a,s,o=i&&i.isExtended,l=i&&i.isMultiByte,d=this.current708Packet.data,h=o?4096:0,u=d[t],c=d[t+1],p=e.currentWindow;return e.textDecoder_&&!o?(l?(r=[u,c],t++):r=[u],n=e.textDecoder_.decode(new Uint8Array(r))):(s=fi[a=h|u]||a,n=4096&a&&a===s?"":String.fromCharCode(s)),p.pendingNewLine&&!p.isEmpty()&&p.newLine(this.getPts(t)),p.pendingNewLine=!1,p.addText(n),t},vi.prototype.multiByteCharacter=function(t,e){var i=this.current708Packet.data,n=i[t+1],r=i[t+2];return gi(n)&&gi(r)&&(t=this.handleText(++t,e,{isMultiByte:!0})),t},vi.prototype.setCurrentWindow=function(t,e){var i=7&this.current708Packet.data[t];return e.setCurrentWindow(i),t},vi.prototype.defineWindow=function(t,e){var i=this.current708Packet.data,n=i[t],r=7&n;e.setCurrentWindow(r);var a=e.currentWindow;return n=i[++t],a.visible=(32&n)>>5,a.rowLock=(16&n)>>4,a.columnLock=(8&n)>>3,a.priority=7&n,n=i[++t],a.relativePositioning=(128&n)>>7,a.anchorVertical=127&n,n=i[++t],a.anchorHorizontal=n,n=i[++t],a.anchorPoint=(240&n)>>4,a.rowCount=15&n,n=i[++t],a.columnCount=63&n,n=i[++t],a.windowStyle=(56&n)>>3,a.penStyle=7&n,a.virtualRowCount=a.rowCount+1,t},vi.prototype.setWindowAttributes=function(t,e){var i=this.current708Packet.data,n=i[t],r=e.currentWindow.winAttr;return n=i[++t],r.fillOpacity=(192&n)>>6,r.fillRed=(48&n)>>4,r.fillGreen=(12&n)>>2,r.fillBlue=3&n,n=i[++t],r.borderType=(192&n)>>6,r.borderRed=(48&n)>>4,r.borderGreen=(12&n)>>2,r.borderBlue=3&n,n=i[++t],r.borderType+=(128&n)>>5,r.wordWrap=(64&n)>>6,r.printDirection=(48&n)>>4,r.scrollDirection=(12&n)>>2,r.justify=3&n,n=i[++t],r.effectSpeed=(240&n)>>4,r.effectDirection=(12&n)>>2,r.displayEffect=3&n,t},vi.prototype.flushDisplayed=function(t,e){for(var i=[],n=0;n<8;n++)e.windows[n].visible&&!e.windows[n].isEmpty()&&i.push(e.windows[n].getText());e.endPts=t,e.text=i.join("\n\n"),this.pushCaption(e),e.startPts=t},vi.prototype.pushCaption=function(t){""!==t.text&&(this.trigger("data",{startPts:t.startPts,endPts:t.endPts,text:t.text,stream:"cc708_"+t.serviceNum}),t.text="",t.startPts=t.endPts)},vi.prototype.displayWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var r=0;r<8;r++)i&1<<r&&(e.windows[r].visible=1);return t},vi.prototype.hideWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var r=0;r<8;r++)i&1<<r&&(e.windows[r].visible=0);return t},vi.prototype.toggleWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var r=0;r<8;r++)i&1<<r&&(e.windows[r].visible^=1);return t},vi.prototype.clearWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var r=0;r<8;r++)i&1<<r&&e.windows[r].clearText();return t},vi.prototype.deleteWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var r=0;r<8;r++)i&1<<r&&e.windows[r].reset();return t},vi.prototype.setPenAttributes=function(t,e){var i=this.current708Packet.data,n=i[t],r=e.currentWindow.penAttr;return n=i[++t],r.textTag=(240&n)>>4,r.offset=(12&n)>>2,r.penSize=3&n,n=i[++t],r.italics=(128&n)>>7,r.underline=(64&n)>>6,r.edgeType=(56&n)>>3,r.fontStyle=7&n,t},vi.prototype.setPenColor=function(t,e){var i=this.current708Packet.data,n=i[t],r=e.currentWindow.penColor;return n=i[++t],r.fgOpacity=(192&n)>>6,r.fgRed=(48&n)>>4,r.fgGreen=(12&n)>>2,r.fgBlue=3&n,n=i[++t],r.bgOpacity=(192&n)>>6,r.bgRed=(48&n)>>4,r.bgGreen=(12&n)>>2,r.bgBlue=3&n,n=i[++t],r.edgeRed=(48&n)>>4,r.edgeGreen=(12&n)>>2,r.edgeBlue=3&n,t},vi.prototype.setPenLocation=function(t,e){var i=this.current708Packet.data,n=i[t],r=e.currentWindow.penLoc;return e.currentWindow.pendingNewLine=!0,n=i[++t],r.row=15&n,n=i[++t],r.column=63&n,t},vi.prototype.reset=function(t,e){var i=this.getPts(t);return this.flushDisplayed(i,e),this.initService(e.serviceNum,t)};var bi={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},wi=function(t){return null===t?"":(t=bi[t]||t,String.fromCharCode(t))},Ti=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Si=function(){for(var t=[],e=15;e--;)t.push("");return t},Ei=function t(e,i){t.prototype.init.call(this),this.field_=e||0,this.dataChannel_=i||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(t){var e,i,n,r,a;if((e=32639&t.ccData)!==this.lastControlCode_){if(4096==(61440&e)?this.lastControlCode_=e:e!==this.PADDING_&&(this.lastControlCode_=null),n=e>>>8,r=255&e,e!==this.PADDING_)if(e===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(e===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(t.pts),this.flushDisplayed(t.pts),i=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=i,this.startPts_=t.pts;else if(e===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(t.pts);else if(e===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(t.pts);else if(e===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(t.pts);else if(e===this.CARRIAGE_RETURN_)this.clearFormatting(t.pts),this.flushDisplayed(t.pts),this.shiftRowsUp_(),this.startPts_=t.pts;else if(e===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(e===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(t.pts),this.displayed_=Si();else if(e===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Si();else if(e===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(t.pts),this.displayed_=Si()),this.mode_="paintOn",this.startPts_=t.pts;else if(this.isSpecialCharacter(n,r))a=wi((n=(3&n)<<8)|r),this[this.mode_](t.pts,a),this.column_++;else if(this.isExtCharacter(n,r))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),a=wi((n=(3&n)<<8)|r),this[this.mode_](t.pts,a),this.column_++;else if(this.isMidRowCode(n,r))this.clearFormatting(t.pts),this[this.mode_](t.pts," "),this.column_++,14==(14&r)&&this.addFormatting(t.pts,["i"]),1==(1&r)&&this.addFormatting(t.pts,["u"]);else if(this.isOffsetControlCode(n,r))this.column_+=3&r;else if(this.isPAC(n,r)){var s=Ti.indexOf(7968&e);"rollUp"===this.mode_&&(s-this.rollUpRows_+1<0&&(s=this.rollUpRows_-1),this.setRollUp(t.pts,s)),s!==this.row_&&(this.clearFormatting(t.pts),this.row_=s),1&r&&-1===this.formatting_.indexOf("u")&&this.addFormatting(t.pts,["u"]),16==(16&e)&&(this.column_=4*((14&e)>>1)),this.isColorPAC(r)&&14==(14&r)&&this.addFormatting(t.pts,["i"])}else this.isNormalChar(n)&&(0===r&&(r=null),a=wi(n),a+=wi(r),this[this.mode_](t.pts,a),this.column_+=a.length)}else this.lastControlCode_=null}};Ei.prototype=new ui,Ei.prototype.flushDisplayed=function(t){var e=this.displayed_.map((function(t,e){try{return t.trim()}catch(t){return this.trigger("log",{level:"warn",message:"Skipping a malformed 608 caption at index "+e+"."}),""}}),this).join("\n").replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:t,text:e,stream:this.name_})},Ei.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Si(),this.nonDisplayed_=Si(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},Ei.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Ei.prototype.isSpecialCharacter=function(t,e){return t===this.EXT_&&e>=48&&e<=63},Ei.prototype.isExtCharacter=function(t,e){return(t===this.EXT_+1||t===this.EXT_+2)&&e>=32&&e<=63},Ei.prototype.isMidRowCode=function(t,e){return t===this.EXT_&&e>=32&&e<=47},Ei.prototype.isOffsetControlCode=function(t,e){return t===this.OFFSET_&&e>=33&&e<=35},Ei.prototype.isPAC=function(t,e){return t>=this.BASE_&&t<this.BASE_+8&&e>=64&&e<=127},Ei.prototype.isColorPAC=function(t){return t>=64&&t<=79||t>=96&&t<=127},Ei.prototype.isNormalChar=function(t){return t>=32&&t<=127},Ei.prototype.setRollUp=function(t,e){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(t),this.nonDisplayed_=Si(),this.displayed_=Si()),void 0!==e&&e!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[e-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===e&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},Ei.prototype.addFormatting=function(t,e){this.formatting_=this.formatting_.concat(e);var i=e.reduce((function(t,e){return t+"<"+e+">"}),"");this[this.mode_](t,i)},Ei.prototype.clearFormatting=function(t){if(this.formatting_.length){var e=this.formatting_.reverse().reduce((function(t,e){return t+"</"+e+">"}),"");this.formatting_=[],this[this.mode_](t,e)}},Ei.prototype.popOn=function(t,e){var i=this.nonDisplayed_[this.row_];i+=e,this.nonDisplayed_[this.row_]=i},Ei.prototype.rollUp=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i},Ei.prototype.shiftRowsUp_=function(){var t;for(t=0;t<this.topRow_;t++)this.displayed_[t]="";for(t=this.row_+1;t<15;t++)this.displayed_[t]="";for(t=this.topRow_;t<this.row_;t++)this.displayed_[t]=this.displayed_[t+1];this.displayed_[this.row_]=""},Ei.prototype.paintOn=function(t,e){var i=this.displayed_[this.row_];i+=e,this.displayed_[this.row_]=i};var _i={CaptionStream:pi,Cea608Stream:Ei,Cea708Stream:vi},ki={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},Pi="shared",Li=function(t,e){var i=1;for(t>e&&(i=-1);Math.abs(e-t)>4294967296;)t+=8589934592*i;return t},Ci=function t(e){var i,n;t.prototype.init.call(this),this.type_=e||Pi,this.push=function(t){this.type_!==Pi&&t.type!==this.type_||(void 0===n&&(n=t.dts),t.dts=Li(t.dts,n),t.pts=Li(t.pts,n),i=t.dts,this.trigger("data",t))},this.flush=function(){n=i,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){n=void 0,i=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Ci.prototype=new Lt;var Ai,Ri=Ci,Di=Li,Ii=ki,xi=function(t,e,i){var n,r="";for(n=e;n<i;n++)r+="%"+("00"+t[n].toString(16)).slice(-2);return r},Oi=function(t,e,i){return decodeURIComponent(xi(t,e,i))},Ui=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},Mi={TXXX:function(t){var e;if(3===t.data[0]){for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=Oi(t.data,1,e),t.value=Oi(t.data,e+1,t.data.length).replace(/\0*$/,"");break}t.data=t.value}},WXXX:function(t){var e;if(3===t.data[0])for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=Oi(t.data,1,e),t.url=Oi(t.data,e+1,t.data.length);break}},PRIV:function(t){var e,i;for(e=0;e<t.data.length;e++)if(0===t.data[e]){t.owner=(i=t.data,unescape(xi(i,0,e)));break}t.privateData=t.data.subarray(e+1),t.data=t.privateData}};(Ai=function(t){var e,i={descriptor:t&&t.descriptor},n=0,r=[],a=0;if(Ai.prototype.init.call(this),this.dispatchType=Ii.METADATA_STREAM_TYPE.toString(16),i.descriptor)for(e=0;e<i.descriptor.length;e++)this.dispatchType+=("00"+i.descriptor[e].toString(16)).slice(-2);this.push=function(t){var e,i,s,o,l;if("timed-metadata"===t.type)if(t.dataAlignmentIndicator&&(a=0,r.length=0),0===r.length&&(t.data.length<10||t.data[0]!=="I".charCodeAt(0)||t.data[1]!=="D".charCodeAt(0)||t.data[2]!=="3".charCodeAt(0)))this.trigger("log",{level:"warn",message:"Skipping unrecognized metadata packet"});else if(r.push(t),a+=t.data.byteLength,1===r.length&&(n=Ui(t.data.subarray(6,10)),n+=10),!(a<n)){for(e={data:new Uint8Array(n),frames:[],pts:r[0].pts,dts:r[0].dts},l=0;l<n;)e.data.set(r[0].data.subarray(0,n-l),l),l+=r[0].data.byteLength,a-=r[0].data.byteLength,r.shift();i=10,64&e.data[5]&&(i+=4,i+=Ui(e.data.subarray(10,14)),n-=Ui(e.data.subarray(16,20)));do{if((s=Ui(e.data.subarray(i+4,i+8)))<1)return void this.trigger("log",{level:"warn",message:"Malformed ID3 frame encountered. Skipping metadata parsing."});if((o={id:String.fromCharCode(e.data[i],e.data[i+1],e.data[i+2],e.data[i+3]),data:e.data.subarray(i+10,i+s+10)}).key=o.id,Mi[o.id]&&(Mi[o.id](o),"com.apple.streaming.transportStreamTimestamp"===o.owner)){var d=o.data,h=(1&d[3])<<30|d[4]<<22|d[5]<<14|d[6]<<6|d[7]>>>2;h*=4,h+=3&d[7],o.timeStamp=h,void 0===e.pts&&void 0===e.dts&&(e.pts=o.timeStamp,e.dts=o.timeStamp),this.trigger("timestamp",o)}e.frames.push(o),i+=10,i+=s}while(i<n);this.trigger("data",e)}}}).prototype=new Lt;var Ni,Bi,Fi,Vi=Ai,qi=Lt,zi=_i,Hi=ki,Gi=Ri,Wi=188;(Ni=function(){var t=new Uint8Array(Wi),e=0;Ni.prototype.init.call(this),this.push=function(i){var n,r=0,a=Wi;for(e?((n=new Uint8Array(i.byteLength+e)).set(t.subarray(0,e)),n.set(i,e),e=0):n=i;a<n.byteLength;)71!==n[r]||71!==n[a]?(r++,a++):(this.trigger("data",n.subarray(r,a)),r+=Wi,a+=Wi);r<n.byteLength&&(t.set(n.subarray(r),0),e=n.byteLength-r)},this.flush=function(){e===Wi&&71===t[0]&&(this.trigger("data",t),e=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){e=0,this.trigger("reset")}}).prototype=new qi,Bi=function(){var t,e,i,n;Bi.prototype.init.call(this),n=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,t=function(t,n){var r=0;n.payloadUnitStartIndicator&&(r+=t[r]+1),"pat"===n.type?e(t.subarray(r),n):i(t.subarray(r),n)},e=function(t,e){e.section_number=t[7],e.last_section_number=t[8],n.pmtPid=(31&t[10])<<8|t[11],e.pmtPid=n.pmtPid},i=function(t,e){var i,r;if(1&t[5]){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},i=3+((15&t[1])<<8|t[2])-4,r=12+((15&t[10])<<8|t[11]);r<i;){var a=t[r],s=(31&t[r+1])<<8|t[r+2];a===Hi.H264_STREAM_TYPE&&null===n.programMapTable.video?n.programMapTable.video=s:a===Hi.ADTS_STREAM_TYPE&&null===n.programMapTable.audio?n.programMapTable.audio=s:a===Hi.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][s]=a),r+=5+((15&t[r+3])<<8|t[r+4])}e.programMapTable=n.programMapTable}},this.push=function(e){var i={},n=4;if(i.payloadUnitStartIndicator=!!(64&e[1]),i.pid=31&e[1],i.pid<<=8,i.pid|=e[2],(48&e[3])>>>4>1&&(n+=e[n]+1),0===i.pid)i.type="pat",t(e.subarray(n),i),this.trigger("data",i);else if(i.pid===this.pmtPid)for(i.type="pmt",t(e.subarray(n),i),this.trigger("data",i);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([e,n,i]):this.processPes_(e,n,i)},this.processPes_=function(t,e,i){i.pid===this.programMapTable.video?i.streamType=Hi.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=Hi.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=t.subarray(e),this.trigger("data",i)}},Bi.prototype=new qi,Bi.STREAM_TYPES={h264:27,adts:15},Fi=function(){var t,e=this,i=!1,n={data:[],size:0},r={data:[],size:0},a={data:[],size:0},s=function(t,i,n){var r,a,s=new Uint8Array(t.size),o={type:i},l=0,d=0;if(t.data.length&&!(t.size<9)){for(o.trackId=t.data[0].pid,l=0;l<t.data.length;l++)a=t.data[l],s.set(a.data,d),d+=a.data.byteLength;var h,u,c,p;u=o,p=(h=s)[0]<<16|h[1]<<8|h[2],u.data=new Uint8Array,1===p&&(u.packetLength=6+(h[4]<<8|h[5]),u.dataAlignmentIndicator=0!=(4&h[6]),192&(c=h[7])&&(u.pts=(14&h[9])<<27|(255&h[10])<<20|(254&h[11])<<12|(255&h[12])<<5|(254&h[13])>>>3,u.pts*=4,u.pts+=(6&h[13])>>>1,u.dts=u.pts,64&c&&(u.dts=(14&h[14])<<27|(255&h[15])<<20|(254&h[16])<<12|(255&h[17])<<5|(254&h[18])>>>3,u.dts*=4,u.dts+=(6&h[18])>>>1)),u.data=h.subarray(9+h[8])),r="video"===i||o.packetLength<=t.size,(n||r)&&(t.size=0,t.data.length=0),r&&e.trigger("data",o)}};Fi.prototype.init.call(this),this.push=function(o){({pat:function(){},pes:function(){var t,e;switch(o.streamType){case Hi.H264_STREAM_TYPE:t=n,e="video";break;case Hi.ADTS_STREAM_TYPE:t=r,e="audio";break;case Hi.METADATA_STREAM_TYPE:t=a,e="timed-metadata";break;default:return}o.payloadUnitStartIndicator&&s(t,e,!0),t.data.push(o),t.size+=o.data.byteLength},pmt:function(){var n={type:"metadata",tracks:[]};null!==(t=o.programMapTable).video&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.video,codec:"avc",type:"video"}),null!==t.audio&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.audio,codec:"adts",type:"audio"}),i=!0,e.trigger("data",n)}})[o.type]()},this.reset=function(){n.size=0,n.data.length=0,r.size=0,r.data.length=0,this.trigger("reset")},this.flushStreams_=function(){s(n,"video"),s(r,"audio"),s(a,"timed-metadata")},this.flush=function(){if(!i&&t){var n={type:"metadata",tracks:[]};null!==t.video&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.video,codec:"avc",type:"video"}),null!==t.audio&&n.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.audio,codec:"adts",type:"audio"}),e.trigger("data",n)}i=!1,this.flushStreams_(),this.trigger("done")}},Fi.prototype=new qi;var $i={PAT_PID:0,MP2T_PACKET_LENGTH:Wi,TransportPacketStream:Ni,TransportParseStream:Bi,ElementaryStream:Fi,TimestampRolloverStream:Gi,CaptionStream:zi.CaptionStream,Cea608Stream:zi.Cea608Stream,Cea708Stream:zi.Cea708Stream,MetadataStream:Vi};for(var Xi in Hi)Hi.hasOwnProperty(Xi)&&($i[Xi]=Hi[Xi]);var ji,Yi=$i,Ki=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Qi=function(t,e){var i=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9];return i=i>=0?i:0,(16&t[e+5])>>4?i+20:i+10},Zi=function t(e,i){return e.length-i<10||e[i]!=="I".charCodeAt(0)||e[i+1]!=="D".charCodeAt(0)||e[i+2]!=="3".charCodeAt(0)?i:t(e,i+=Qi(e,i))},Ji=function(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]},tn={isLikelyAacData:function(t){var e=Zi(t,0);return t.length>=e+2&&255==(255&t[e])&&240==(240&t[e+1])&&16==(22&t[e+1])},parseId3TagSize:Qi,parseAdtsSize:function(t,e){var i=(224&t[e+5])>>5,n=t[e+4]<<3;return 6144&t[e+3]|n|i},parseType:function(t,e){return t[e]==="I".charCodeAt(0)&&t[e+1]==="D".charCodeAt(0)&&t[e+2]==="3".charCodeAt(0)?"timed-metadata":!0&t[e]&&240==(240&t[e+1])?"audio":null},parseSampleRate:function(t){for(var e=0;e+5<t.length;){if(255===t[e]&&240==(246&t[e+1]))return Ki[(60&t[e+2])>>>2];e++}return null},parseAacTimestamp:function(t){var e,i,n;e=10,64&t[5]&&(e+=4,e+=Ji(t.subarray(10,14)));do{if((i=Ji(t.subarray(e+4,e+8)))<1)return null;if("PRIV"===String.fromCharCode(t[e],t[e+1],t[e+2],t[e+3])){n=t.subarray(e+10,e+i+10);for(var r=0;r<n.byteLength;r++)if(0===n[r]){var a=unescape(function(t,e,i){var n,r="";for(n=e;n<i;n++)r+="%"+("00"+t[n].toString(16)).slice(-2);return r}(n,0,r));if("com.apple.streaming.transportStreamTimestamp"===a){var s=n.subarray(r+1),o=(1&s[3])<<30|s[4]<<22|s[5]<<14|s[6]<<6|s[7]>>>2;return o*=4,o+=3&s[7]}break}}e+=10,e+=i}while(e<t.byteLength);return null}},en=tn;(ji=function(){var t=new Uint8Array,e=0;ji.prototype.init.call(this),this.setTimestamp=function(t){e=t},this.push=function(i){var n,r,a,s,o=0,l=0;for(t.length?(s=t.length,(t=new Uint8Array(i.byteLength+s)).set(t.subarray(0,s)),t.set(i,s)):t=i;t.length-l>=3;)if(t[l]!=="I".charCodeAt(0)||t[l+1]!=="D".charCodeAt(0)||t[l+2]!=="3".charCodeAt(0))if(255!=(255&t[l])||240!=(240&t[l+1]))l++;else{if(t.length-l<7)break;if(l+(o=en.parseAdtsSize(t,l))>t.length)break;a={type:"audio",data:t.subarray(l,l+o),pts:e,dts:e},this.trigger("data",a),l+=o}else{if(t.length-l<10)break;if(l+(o=en.parseId3TagSize(t,l))>t.length)break;r={type:"timed-metadata",data:t.subarray(l,l+o)},this.trigger("data",r),l+=o}n=t.length-l,t=n>0?t.subarray(l):new Uint8Array},this.reset=function(){t=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){t=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new Lt;var nn,rn,an,sn,on=ji,ln=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],dn=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],hn=Lt,un=Oe,cn=ei,pn=oi,fn=di,gn=Yi,mn=Rt,yn=Mt,vn=ke.H264Stream,bn=on,wn=tn.isLikelyAacData,Tn=Rt.ONE_SECOND_IN_TS,Sn=ln,En=dn,_n=function(t,e){e.stream=t,this.trigger("log",e)},kn=function(t,e){for(var i=Object.keys(e),n=0;n<i.length;n++){var r=i[n];"headOfPipeline"!==r&&e[r].on&&e[r].on("log",_n.bind(t,r))}},Pn=function(t,e){var i;if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},Ln=function(t,e,i,n,r,a){return{start:{dts:t,pts:t+(i-e)},end:{dts:t+(n-e),pts:t+(r-i)},prependedContentDuration:a,baseMediaDecodeTime:t}};rn=function(t,e){var i,n=[],r=0,a=0,s=1/0;i=(e=e||{}).firstSequenceNumber||0,rn.prototype.init.call(this),this.push=function(e){fn.collectDtsInfo(t,e),t&&Sn.forEach((function(i){t[i]=e[i]})),n.push(e)},this.setEarliestDts=function(t){r=t},this.setVideoBaseMediaDecodeTime=function(t){s=t},this.setAudioAppendStart=function(t){a=t},this.flush=function(){var o,l,d,h,u,c,p;0!==n.length?(o=pn.trimAdtsFramesByEarliestDts(n,t,r),t.baseMediaDecodeTime=fn.calculateTrackBaseMediaDecodeTime(t,e.keepOriginalTimestamps),p=pn.prefixWithSilence(t,o,a,s),t.samples=pn.generateSampleTable(o),d=un.mdat(pn.concatenateFrameData(o)),n=[],l=un.moof(i,[t]),h=new Uint8Array(l.byteLength+d.byteLength),i++,h.set(l),h.set(d,l.byteLength),fn.clearDtsInfo(t),u=Math.ceil(1024*Tn/t.samplerate),o.length&&(c=o.length*u,this.trigger("segmentTimingInfo",Ln(mn.audioTsToVideoTs(t.baseMediaDecodeTime,t.samplerate),o[0].dts,o[0].pts,o[0].dts+c,o[0].pts+c,p||0)),this.trigger("timingInfo",{start:o[0].pts,end:o[0].pts+c})),this.trigger("data",{track:t,boxes:h}),this.trigger("done","AudioSegmentStream")):this.trigger("done","AudioSegmentStream")},this.reset=function(){fn.clearDtsInfo(t),n=[],this.trigger("reset")}},rn.prototype=new hn,nn=function(t,e){var i,n,r,a=[],s=[];i=(e=e||{}).firstSequenceNumber||0,nn.prototype.init.call(this),delete t.minPTS,this.gopCache_=[],this.push=function(e){fn.collectDtsInfo(t,e),"seq_parameter_set_rbsp"!==e.nalUnitType||n||(n=e.config,t.sps=[e.data],En.forEach((function(e){t[e]=n[e]}),this)),"pic_parameter_set_rbsp"!==e.nalUnitType||r||(r=e.data,t.pps=[e.data]),a.push(e)},this.flush=function(){for(var n,r,o,l,d,h,u,c,p=0;a.length&&"access_unit_delimiter_rbsp"!==a[0].nalUnitType;)a.shift();if(0===a.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(n=cn.groupNalsIntoFrames(a),(o=cn.groupFramesIntoGops(n))[0][0].keyFrame||((r=this.getGopForFusion_(a[0],t))?(p=r.duration,o.unshift(r),o.byteLength+=r.byteLength,o.nalCount+=r.nalCount,o.pts=r.pts,o.dts=r.dts,o.duration+=r.duration):o=cn.extendFirstKeyFrame(o)),s.length){var f;if(!(f=e.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o)))return this.gopCache_.unshift({gop:o.pop(),pps:t.pps,sps:t.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");fn.clearDtsInfo(t),o=f}fn.collectDtsInfo(t,o),t.samples=cn.generateSampleTable(o),d=un.mdat(cn.concatenateNalData(o)),t.baseMediaDecodeTime=fn.calculateTrackBaseMediaDecodeTime(t,e.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map((function(t){return{pts:t.pts,dts:t.dts,byteLength:t.byteLength}}))),u=o[0],c=o[o.length-1],this.trigger("segmentTimingInfo",Ln(t.baseMediaDecodeTime,u.dts,u.pts,c.dts+c.duration,c.pts+c.duration,p)),this.trigger("timingInfo",{start:o[0].pts,end:o[o.length-1].pts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:t.pps,sps:t.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),a=[],this.trigger("baseMediaDecodeTime",t.baseMediaDecodeTime),this.trigger("timelineStartInfo",t.timelineStartInfo),l=un.moof(i,[t]),h=new Uint8Array(l.byteLength+d.byteLength),i++,h.set(l),h.set(d,l.byteLength),this.trigger("data",{track:t,boxes:h}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),a=[],this.gopCache_.length=0,s.length=0,this.trigger("reset")},this.resetStream_=function(){fn.clearDtsInfo(t),n=void 0,r=void 0},this.getGopForFusion_=function(e){var i,n,r,a,s,o=1/0;for(s=0;s<this.gopCache_.length;s++)r=(a=this.gopCache_[s]).gop,t.pps&&Pn(t.pps[0],a.pps[0])&&t.sps&&Pn(t.sps[0],a.sps[0])&&(r.dts<t.timelineStartInfo.dts||(i=e.dts-r.dts-r.duration)>=-1e4&&i<=45e3&&(!n||o>i)&&(n=a,o=i));return n?n.gop:null},this.alignGopsAtStart_=function(t){var e,i,n,r,a,o,l,d;for(a=t.byteLength,o=t.nalCount,l=t.duration,e=i=0;e<s.length&&i<t.length&&(n=s[e],r=t[i],n.pts!==r.pts);)r.pts>n.pts?e++:(i++,a-=r.byteLength,o-=r.nalCount,l-=r.duration);return 0===i?t:i===t.length?null:((d=t.slice(i)).byteLength=a,d.duration=l,d.nalCount=o,d.pts=d[0].pts,d.dts=d[0].dts,d)},this.alignGopsAtEnd_=function(t){var e,i,n,r,a,o,l;for(e=s.length-1,i=t.length-1,a=null,o=!1;e>=0&&i>=0;){if(n=s[e],r=t[i],n.pts===r.pts){o=!0;break}n.pts>r.pts?e--:(e===s.length-1&&(a=i),i--)}if(!o&&null===a)return null;if(0===(l=o?i:a))return t;var d=t.slice(l),h=d.reduce((function(t,e){return t.byteLength+=e.byteLength,t.duration+=e.duration,t.nalCount+=e.nalCount,t}),{byteLength:0,duration:0,nalCount:0});return d.byteLength=h.byteLength,d.duration=h.duration,d.nalCount=h.nalCount,d.pts=d[0].pts,d.dts=d[0].dts,d},this.alignGopsWith=function(t){s=t}},nn.prototype=new hn,sn=function(t,e){this.numberOfTracks=0,this.metadataStream=e,void 0!==(t=t||{}).remux?this.remuxTracks=!!t.remux:this.remuxTracks=!0,"boolean"==typeof t.keepOriginalTimestamps?this.keepOriginalTimestamps=t.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,sn.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):(this.pendingTracks.push(t.track),this.pendingBytes+=t.boxes.byteLength,"video"===t.track.type&&(this.videoTrack=t.track,this.pendingBoxes.push(t.boxes)),void("audio"===t.track.type&&(this.audioTrack=t.track,this.pendingBoxes.unshift(t.boxes))))}},sn.prototype=new hn,sn.prototype.flush=function(t){var e,i,n,r,a=0,s={captions:[],captionStreams:{},metadata:[],info:{}},o=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(o=this.videoTrack.timelineStartInfo.pts,En.forEach((function(t){s.info[t]=this.videoTrack[t]}),this)):this.audioTrack&&(o=this.audioTrack.timelineStartInfo.pts,Sn.forEach((function(t){s.info[t]=this.audioTrack[t]}),this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?s.type=this.pendingTracks[0].type:s.type="combined",this.emittedTracks+=this.pendingTracks.length,n=un.initSegment(this.pendingTracks),s.initSegment=new Uint8Array(n.byteLength),s.initSegment.set(n),s.data=new Uint8Array(this.pendingBytes),r=0;r<this.pendingBoxes.length;r++)s.data.set(this.pendingBoxes[r],a),a+=this.pendingBoxes[r].byteLength;for(r=0;r<this.pendingCaptions.length;r++)(e=this.pendingCaptions[r]).startTime=mn.metadataTsToSeconds(e.startPts,o,this.keepOriginalTimestamps),e.endTime=mn.metadataTsToSeconds(e.endPts,o,this.keepOriginalTimestamps),s.captionStreams[e.stream]=!0,s.captions.push(e);for(r=0;r<this.pendingMetadata.length;r++)(i=this.pendingMetadata[r]).cueTime=mn.metadataTsToSeconds(i.pts,o,this.keepOriginalTimestamps),s.metadata.push(i);for(s.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",s),r=0;r<s.captions.length;r++)e=s.captions[r],this.trigger("caption",e);for(r=0;r<s.metadata.length;r++)i=s.metadata[r],this.trigger("id3Frame",i)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},sn.prototype.setRemux=function(t){this.remuxTracks=t},(an=function(t){var e,i,n=this,r=!0;an.prototype.init.call(this),t=t||{},this.baseMediaDecodeTime=t.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="aac",r.metadataStream=new gn.MetadataStream,r.aacStream=new bn,r.audioTimestampRolloverStream=new gn.TimestampRolloverStream("audio"),r.timedMetadataTimestampRolloverStream=new gn.TimestampRolloverStream("timed-metadata"),r.adtsStream=new yn,r.coalesceStream=new sn(t,r.metadataStream),r.headOfPipeline=r.aacStream,r.aacStream.pipe(r.audioTimestampRolloverStream).pipe(r.adtsStream),r.aacStream.pipe(r.timedMetadataTimestampRolloverStream).pipe(r.metadataStream).pipe(r.coalesceStream),r.metadataStream.on("timestamp",(function(t){r.aacStream.setTimestamp(t.timeStamp)})),r.aacStream.on("data",(function(a){"timed-metadata"!==a.type&&"audio"!==a.type||r.audioSegmentStream||(i=i||{timelineStartInfo:{baseMediaDecodeTime:n.baseMediaDecodeTime},codec:"adts",type:"audio"},r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new rn(i,t),r.audioSegmentStream.on("log",n.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!e}))})),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),kn(this,r)},this.setupTsPipeline=function(){var r={};this.transmuxPipeline_=r,r.type="ts",r.metadataStream=new gn.MetadataStream,r.packetStream=new gn.TransportPacketStream,r.parseStream=new gn.TransportParseStream,r.elementaryStream=new gn.ElementaryStream,r.timestampRolloverStream=new gn.TimestampRolloverStream,r.adtsStream=new yn,r.h264Stream=new vn,r.captionStream=new gn.CaptionStream(t),r.coalesceStream=new sn(t,r.metadataStream),r.headOfPipeline=r.packetStream,r.packetStream.pipe(r.parseStream).pipe(r.elementaryStream).pipe(r.timestampRolloverStream),r.timestampRolloverStream.pipe(r.h264Stream),r.timestampRolloverStream.pipe(r.adtsStream),r.timestampRolloverStream.pipe(r.metadataStream).pipe(r.coalesceStream),r.h264Stream.pipe(r.captionStream).pipe(r.coalesceStream),r.elementaryStream.on("data",(function(a){var s;if("metadata"===a.type){for(s=a.tracks.length;s--;)e||"video"!==a.tracks[s].type?i||"audio"!==a.tracks[s].type||((i=a.tracks[s]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime):(e=a.tracks[s]).timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime;e&&!r.videoSegmentStream&&(r.coalesceStream.numberOfTracks++,r.videoSegmentStream=new nn(e,t),r.videoSegmentStream.on("log",n.getLogTrigger_("videoSegmentStream")),r.videoSegmentStream.on("timelineStartInfo",(function(e){i&&!t.keepOriginalTimestamps&&(i.timelineStartInfo=e,r.audioSegmentStream.setEarliestDts(e.dts-n.baseMediaDecodeTime))})),r.videoSegmentStream.on("processedGopsInfo",n.trigger.bind(n,"gopInfo")),r.videoSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"videoSegmentTimingInfo")),r.videoSegmentStream.on("baseMediaDecodeTime",(function(t){i&&r.audioSegmentStream.setVideoBaseMediaDecodeTime(t)})),r.videoSegmentStream.on("timingInfo",n.trigger.bind(n,"videoTimingInfo")),r.h264Stream.pipe(r.videoSegmentStream).pipe(r.coalesceStream)),i&&!r.audioSegmentStream&&(r.coalesceStream.numberOfTracks++,r.audioSegmentStream=new rn(i,t),r.audioSegmentStream.on("log",n.getLogTrigger_("audioSegmentStream")),r.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),r.audioSegmentStream.on("segmentTimingInfo",n.trigger.bind(n,"audioSegmentTimingInfo")),r.adtsStream.pipe(r.audioSegmentStream).pipe(r.coalesceStream)),n.trigger("trackinfo",{hasAudio:!!i,hasVideo:!!e})}})),r.coalesceStream.on("data",this.trigger.bind(this,"data")),r.coalesceStream.on("id3Frame",(function(t){t.dispatchType=r.metadataStream.dispatchType,n.trigger("id3Frame",t)})),r.coalesceStream.on("caption",this.trigger.bind(this,"caption")),r.coalesceStream.on("done",this.trigger.bind(this,"done")),kn(this,r)},this.setBaseMediaDecodeTime=function(n){var r=this.transmuxPipeline_;t.keepOriginalTimestamps||(this.baseMediaDecodeTime=n),i&&(i.timelineStartInfo.dts=void 0,i.timelineStartInfo.pts=void 0,fn.clearDtsInfo(i),r.audioTimestampRolloverStream&&r.audioTimestampRolloverStream.discontinuity()),e&&(r.videoSegmentStream&&(r.videoSegmentStream.gopCache_=[]),e.timelineStartInfo.dts=void 0,e.timelineStartInfo.pts=void 0,fn.clearDtsInfo(e),r.captionStream.reset()),r.timestampRolloverStream&&r.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(t){i&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(t)},this.setRemux=function(e){var i=this.transmuxPipeline_;t.remux=e,i&&i.coalesceStream&&i.coalesceStream.setRemux(e)},this.alignGopsWith=function(t){e&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(t)},this.getLogTrigger_=function(t){var e=this;return function(i){i.stream=t,e.trigger("log",i)}},this.push=function(t){if(r){var e=wn(t);e&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():e||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),r=!1}this.transmuxPipeline_.headOfPipeline.push(t)},this.flush=function(){r=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new hn;var Cn,An={Transmuxer:an,VideoSegmentStream:nn,AudioSegmentStream:rn,AUDIO_PROPERTIES:Sn,VIDEO_PROPERTIES:En,generateSegmentTimingInfo:Ln},Rn=hi.discardEmulationPreventionBytes,Dn=_i.CaptionStream,In=Fe,xn=Ge,On=ze,Un=Ve,Mn=function(t,e){for(var i=t,n=0;n<e.length;n++){var r=e[n];if(i<r.size)return r;i-=r.size}return null},Nn=function(t,e){var i=In(t,["moof","traf"]),n=In(t,["mdat"]),r={},a=[];return n.forEach((function(t,e){var n=i[e];a.push({mdat:t,traf:n})})),a.forEach((function(t){var i,n,a=t.mdat,s=t.traf,o=In(s,["tfhd"]),l=Un(o[0]),d=l.trackId,h=In(s,["tfdt"]),u=h.length>0?xn(h[0]).baseMediaDecodeTime:0,c=In(s,["trun"]);e===d&&c.length>0&&(i=function(t,e,i){var n=e,r=i.defaultSampleDuration||0,a=i.defaultSampleSize||0,s=i.trackId,o=[];return t.forEach((function(t){var e=On(t).samples;e.forEach((function(t){void 0===t.duration&&(t.duration=r),void 0===t.size&&(t.size=a),t.trackId=s,t.dts=n,void 0===t.compositionTimeOffset&&(t.compositionTimeOffset=0),t.pts=n+t.compositionTimeOffset,n+=t.duration})),o=o.concat(e)})),o}(c,u,l),n=function(t,e,i){var n,r,a,s,o=new DataView(t.buffer,t.byteOffset,t.byteLength),l={logs:[],seiNals:[]};for(r=0;r+4<t.length;r+=a)if(a=o.getUint32(r),r+=4,!(a<=0))switch(31&t[r]){case 6:var d=t.subarray(r+1,r+1+a),h=Mn(r,e);if(n={nalUnitType:"sei_rbsp",size:a,data:d,escapedRBSP:Rn(d),trackId:i},h)n.pts=h.pts,n.dts=h.dts,s=h;else{if(!s){l.logs.push({level:"warn",message:"We've encountered a nal unit without data at "+r+" for trackId "+i+". See mux.js#223."});break}n.pts=s.pts,n.dts=s.dts}l.seiNals.push(n)}return l}(a,i,d),r[d]||(r[d]={seiNals:[],logs:[]}),r[d].seiNals=r[d].seiNals.concat(n.seiNals),r[d].logs=r[d].logs.concat(n.logs))})),r},Bn=function(){var t,e,i,n,r,a,s=!1;this.isInitialized=function(){return s},this.init=function(e){t=new Dn,s=!0,a=!!e&&e.isPartial,t.on("data",(function(t){t.startTime=t.startPts/n,t.endTime=t.endPts/n,r.captions.push(t),r.captionStreams[t.stream]=!0})),t.on("log",(function(t){r.logs.push(t)}))},this.isNewInit=function(t,e){return!(t&&0===t.length||e&&"object"==typeof e&&0===Object.keys(e).length)&&(i!==t[0]||n!==e[i])},this.parse=function(t,a,s){var o;if(!this.isInitialized())return null;if(!a||!s)return null;if(this.isNewInit(a,s))i=a[0],n=s[i];else if(null===i||!n)return e.push(t),null;for(;e.length>0;){var l=e.shift();this.parse(l,a,s)}return o=function(t,e,i){if(null===e)return null;var n=Nn(t,e)[e]||{};return{seiNals:n.seiNals,logs:n.logs,timescale:i}}(t,i,n),o&&o.logs&&(r.logs=r.logs.concat(o.logs)),null!==o&&o.seiNals?(this.pushNals(o.seiNals),this.flushStream(),r):r.logs.length?{logs:r.logs,captions:[],captionStreams:[]}:null},this.pushNals=function(e){if(!this.isInitialized()||!e||0===e.length)return null;e.forEach((function(e){t.push(e)}))},this.flushStream=function(){if(!this.isInitialized())return null;a?t.partialFlush():t.flush()},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={},r.logs=[]},this.resetCaptionStream=function(){if(!this.isInitialized())return null;t.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){e=[],i=null,n=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{},logs:[]},this.resetCaptionStream()},this.reset()},Fn={generator:Oe,probe:Je,Transmuxer:An.Transmuxer,AudioSegmentStream:An.AudioSegmentStream,VideoSegmentStream:An.VideoSegmentStream,CaptionParser:Bn};Cn=function(t,e){var i,n=0,r=16384,a=function(t,e){var i,n=t.position+e;n<t.bytes.byteLength||((i=new Uint8Array(2*n)).set(t.bytes.subarray(0,t.position),0),t.bytes=i,t.view=new DataView(t.bytes.buffer))},s=Cn.widthBytes||new Uint8Array(5),o=Cn.heightBytes||new Uint8Array(6),l=Cn.videocodecidBytes||new Uint8Array(12);if(!Cn.widthBytes){for(i=0;i<5;i++)s[i]="width".charCodeAt(i);for(i=0;i<6;i++)o[i]="height".charCodeAt(i);for(i=0;i<12;i++)l[i]="videocodecid".charCodeAt(i);Cn.widthBytes=s,Cn.heightBytes=o,Cn.videocodecidBytes=l}switch(this.keyFrame=!1,t){case Cn.VIDEO_TAG:this.length=16,r*=6;break;case Cn.AUDIO_TAG:this.length=13,this.keyFrame=!0;break;case Cn.METADATA_TAG:this.length=29,this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(r),this.view=new DataView(this.bytes.buffer),this.bytes[0]=t,this.position=this.length,this.keyFrame=e,this.pts=0,this.dts=0,this.writeBytes=function(t,e,i){var n,r=e||0;n=r+(i=i||t.byteLength),a(this,i),this.bytes.set(t.subarray(r,n),this.position),this.position+=i,this.length=Math.max(this.length,this.position)},this.writeByte=function(t){a(this,1),this.bytes[this.position]=t,this.position++,this.length=Math.max(this.length,this.position)},this.writeShort=function(t){a(this,2),this.view.setUint16(this.position,t),this.position+=2,this.length=Math.max(this.length,this.position)},this.negIndex=function(t){return this.bytes[this.length-t]},this.nalUnitSize=function(){return 0===n?0:this.length-(n+4)},this.startNalUnit=function(){if(n>0)throw new Error("Attempted to create new NAL wihout closing the old one");n=this.length,this.length+=4,this.position=this.length},this.endNalUnit=function(t){var e,i;this.length===n+4?this.length-=4:n>0&&(e=n+4,i=this.length-e,this.position=n,this.view.setUint32(this.position,i),this.position=this.length,t&&t.push(this.bytes.subarray(e,e+i))),n=0},this.writeMetaDataDouble=function(t,e){var i;if(a(this,2+t.length+9),this.view.setUint16(this.position,t.length),this.position+=2,"width"===t)this.bytes.set(s,this.position),this.position+=5;else if("height"===t)this.bytes.set(o,this.position),this.position+=6;else if("videocodecid"===t)this.bytes.set(l,this.position),this.position+=12;else for(i=0;i<t.length;i++)this.bytes[this.position]=t.charCodeAt(i),this.position++;this.position++,this.view.setFloat64(this.position,e),this.position+=8,this.length=Math.max(this.length,this.position),++n},this.writeMetaDataBoolean=function(t,e){var i;for(a(this,2),this.view.setUint16(this.position,t.length),this.position+=2,i=0;i<t.length;i++)a(this,1),this.bytes[this.position]=t.charCodeAt(i),this.position++;a(this,2),this.view.setUint8(this.position,1),this.position++,this.view.setUint8(this.position,e?1:0),this.position++,this.length=Math.max(this.length,this.position),++n},this.finalize=function(){var t,i;switch(this.bytes[0]){case Cn.VIDEO_TAG:this.bytes[11]=7|(this.keyFrame||e?16:32),this.bytes[12]=e?0:1,t=this.pts-this.dts,this.bytes[13]=(16711680&t)>>>16,this.bytes[14]=(65280&t)>>>8,this.bytes[15]=(255&t)>>>0;break;case Cn.AUDIO_TAG:this.bytes[11]=175,this.bytes[12]=e?0:1;break;case Cn.METADATA_TAG:this.position=11,this.view.setUint8(this.position,2),this.position++,this.view.setUint16(this.position,10),this.position+=2,this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position),this.position+=10,this.bytes[this.position]=8,this.position++,this.view.setUint32(this.position,n),this.position=this.length,this.bytes.set([0,0,9],this.position),this.position+=3,this.length=this.position}return i=this.length-11,this.bytes[1]=(16711680&i)>>>16,this.bytes[2]=(65280&i)>>>8,this.bytes[3]=(255&i)>>>0,this.bytes[4]=(16711680&this.dts)>>>16,this.bytes[5]=(65280&this.dts)>>>8,this.bytes[6]=(255&this.dts)>>>0,this.bytes[7]=(4278190080&this.dts)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,a(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=Cn.frameTime(this.bytes),this}},Cn.AUDIO_TAG=8,Cn.VIDEO_TAG=9,Cn.METADATA_TAG=18,Cn.isAudioFrame=function(t){return Cn.AUDIO_TAG===t[0]},Cn.isVideoFrame=function(t){return Cn.VIDEO_TAG===t[0]},Cn.isMetaData=function(t){return Cn.METADATA_TAG===t[0]},Cn.isKeyFrame=function(t){return Cn.isVideoFrame(t)?23===t[11]:!!Cn.isAudioFrame(t)||!!Cn.isMetaData(t)},Cn.frameTime=function(t){var e=t[4]<<16;return e|=t[5]<<8,e|=t[6]<<0,e|=t[7]<<24};var Vn=Cn,qn=function t(e){this.numberOfTracks=0,this.metadataStream=e.metadataStream,this.videoTags=[],this.audioTags=[],this.videoTrack=null,this.audioTrack=null,this.pendingCaptions=[],this.pendingMetadata=[],this.pendingTracks=0,this.processedTracks=0,t.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):("video"===t.track.type&&(this.videoTrack=t.track,this.videoTags=t.tags,this.pendingTracks++),void("audio"===t.track.type&&(this.audioTrack=t.track,this.audioTags=t.tags,this.pendingTracks++)))}};(qn.prototype=new Lt).flush=function(t){var e,i,n,r,a={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t)return;if(0===this.pendingTracks&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?r=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(r=this.audioTrack.timelineStartInfo.pts),a.tags.videoTags=this.videoTags,a.tags.audioTags=this.audioTags,n=0;n<this.pendingCaptions.length;n++)(i=this.pendingCaptions[n]).startTime=i.startPts-r,i.startTime/=9e4,i.endTime=i.endPts-r,i.endTime/=9e4,a.captionStreams[i.stream]=!0,a.captions.push(i);for(n=0;n<this.pendingMetadata.length;n++)(e=this.pendingMetadata[n]).cueTime=e.pts-r,e.cueTime/=9e4,a.metadata.push(e);a.metadata.dispatchType=this.metadataStream.dispatchType,this.videoTrack=null,this.audioTrack=null,this.videoTags=[],this.audioTags=[],this.pendingCaptions.length=0,this.pendingMetadata.length=0,this.pendingTracks=0,this.processedTracks=0,this.trigger("data",a),this.trigger("done")}};var zn,Hn,Gn,Wn,$n,Xn,jn=Lt,Yn=Vn,Kn=Yi,Qn=Mt,Zn=ke.H264Stream,Jn=qn,tr=function(){var t=this;this.list=[],this.push=function(t){this.list.push({bytes:t.bytes,dts:t.dts,pts:t.pts,keyFrame:t.keyFrame,metaDataTag:t.metaDataTag})},Object.defineProperty(this,"length",{get:function(){return t.list.length}})};Wn=function(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts?t.timelineStartInfo.pts=e.pts:t.timelineStartInfo.pts=Math.min(t.timelineStartInfo.pts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts?t.timelineStartInfo.dts=e.dts:t.timelineStartInfo.dts=Math.min(t.timelineStartInfo.dts,e.dts))},$n=function(t,e){var i=new Yn(Yn.METADATA_TAG);return i.dts=e,i.pts=e,i.writeMetaDataDouble("videocodecid",7),i.writeMetaDataDouble("width",t.width),i.writeMetaDataDouble("height",t.height),i},Xn=function(t,e){var i,n=new Yn(Yn.VIDEO_TAG,!0);for(n.dts=e,n.pts=e,n.writeByte(1),n.writeByte(t.profileIdc),n.writeByte(t.profileCompatibility),n.writeByte(t.levelIdc),n.writeByte(255),n.writeByte(225),n.writeShort(t.sps[0].length),n.writeBytes(t.sps[0]),n.writeByte(t.pps.length),i=0;i<t.pps.length;++i)n.writeShort(t.pps[i].length),n.writeBytes(t.pps[i]);return n},(Gn=function(t){var e,i=[],n=[];Gn.prototype.init.call(this),this.push=function(e){Wn(t,e),t&&(t.audioobjecttype=e.audioobjecttype,t.channelcount=e.channelcount,t.samplerate=e.samplerate,t.samplingfrequencyindex=e.samplingfrequencyindex,t.samplesize=e.samplesize,t.extraData=t.audioobjecttype<<11|t.samplingfrequencyindex<<7|t.channelcount<<3),e.pts=Math.round(e.pts/90),e.dts=Math.round(e.dts/90),i.push(e)},this.flush=function(){var r,a,s,o=new tr;if(0!==i.length){for(s=-1/0;i.length;)r=i.shift(),n.length&&r.pts>=n[0]&&(s=n.shift(),this.writeMetaDataTags(o,s)),(t.extraData!==e||r.pts-s>=1e3)&&(this.writeMetaDataTags(o,r.pts),e=t.extraData,s=r.pts),(a=new Yn(Yn.AUDIO_TAG)).pts=r.pts,a.dts=r.dts,a.writeBytes(r.data),o.push(a.finalize());n.length=0,e=null,this.trigger("data",{track:t,tags:o.list}),this.trigger("done","AudioSegmentStream")}else this.trigger("done","AudioSegmentStream")},this.writeMetaDataTags=function(e,i){var n;(n=new Yn(Yn.METADATA_TAG)).pts=i,n.dts=i,n.writeMetaDataDouble("audiocodecid",10),n.writeMetaDataBoolean("stereo",2===t.channelcount),n.writeMetaDataDouble("audiosamplerate",t.samplerate),n.writeMetaDataDouble("audiosamplesize",16),e.push(n.finalize()),(n=new Yn(Yn.AUDIO_TAG,!0)).pts=i,n.dts=i,n.view.setUint16(n.position,t.extraData),n.position+=2,n.length=Math.max(n.length,n.position),e.push(n.finalize())},this.onVideoKeyFrame=function(t){n.push(t)}}).prototype=new jn,(Hn=function(t){var e,i,n=[];Hn.prototype.init.call(this),this.finishFrame=function(n,r){if(r){if(e&&t&&t.newMetadata&&(r.keyFrame||0===n.length)){var a=$n(e,r.dts).finalize(),s=Xn(t,r.dts).finalize();a.metaDataTag=s.metaDataTag=!0,n.push(a),n.push(s),t.newMetadata=!1,this.trigger("keyframe",r.dts)}r.endNalUnit(),n.push(r.finalize()),i=null}},this.push=function(e){Wn(t,e),e.pts=Math.round(e.pts/90),e.dts=Math.round(e.dts/90),n.push(e)},this.flush=function(){for(var r,a=new tr;n.length&&"access_unit_delimiter_rbsp"!==n[0].nalUnitType;)n.shift();if(0!==n.length){for(;n.length;)"seq_parameter_set_rbsp"===(r=n.shift()).nalUnitType?(t.newMetadata=!0,e=r.config,t.width=e.width,t.height=e.height,t.sps=[r.data],t.profileIdc=e.profileIdc,t.levelIdc=e.levelIdc,t.profileCompatibility=e.profileCompatibility,i.endNalUnit()):"pic_parameter_set_rbsp"===r.nalUnitType?(t.newMetadata=!0,t.pps=[r.data],i.endNalUnit()):"access_unit_delimiter_rbsp"===r.nalUnitType?(i&&this.finishFrame(a,i),(i=new Yn(Yn.VIDEO_TAG)).pts=r.pts,i.dts=r.dts):("slice_layer_without_partitioning_rbsp_idr"===r.nalUnitType&&(i.keyFrame=!0),i.endNalUnit()),i.startNalUnit(),i.writeBytes(r.data);i&&this.finishFrame(a,i),this.trigger("data",{track:t,tags:a.list}),this.trigger("done","VideoSegmentStream")}else this.trigger("done","VideoSegmentStream")}}).prototype=new jn,zn=function(t){var e,i,n,r,a,s,o,l,d,h,u,c,p=this;zn.prototype.init.call(this),t=t||{},this.metadataStream=new Kn.MetadataStream,t.metadataStream=this.metadataStream,e=new Kn.TransportPacketStream,i=new Kn.TransportParseStream,n=new Kn.ElementaryStream,r=new Kn.TimestampRolloverStream("video"),a=new Kn.TimestampRolloverStream("audio"),s=new Kn.TimestampRolloverStream("timed-metadata"),o=new Qn,l=new Zn,c=new Jn(t),e.pipe(i).pipe(n),n.pipe(r).pipe(l),n.pipe(a).pipe(o),n.pipe(s).pipe(this.metadataStream).pipe(c),u=new Kn.CaptionStream(t),l.pipe(u).pipe(c),n.on("data",(function(t){var e,i,n;if("metadata"===t.type){for(e=t.tracks.length;e--;)"video"===t.tracks[e].type?i=t.tracks[e]:"audio"===t.tracks[e].type&&(n=t.tracks[e]);i&&!d&&(c.numberOfTracks++,d=new Hn(i),l.pipe(d).pipe(c)),n&&!h&&(c.numberOfTracks++,h=new Gn(n),o.pipe(h).pipe(c),d&&d.on("keyframe",h.onVideoKeyFrame))}})),this.push=function(t){e.push(t)},this.flush=function(){e.flush()},this.resetCaptions=function(){u.reset()},c.on("data",(function(t){p.trigger("data",t)})),c.on("done",(function(){p.trigger("done")}))},zn.prototype=new jn;var er=Vn,ir={tag:Vn,Transmuxer:zn,getFlvHeader:function(t,e,i){var n,r,a,s=new Uint8Array(9),o=new DataView(s.buffer);return t=t||0,e=void 0===e||e,i=void 0===i||i,o.setUint8(0,70),o.setUint8(1,76),o.setUint8(2,86),o.setUint8(3,1),o.setUint8(4,(e?4:0)|(i?1:0)),o.setUint32(5,s.byteLength),t<=0?((r=new Uint8Array(s.byteLength+4)).set(s),r.set([0,0,0,0],s.byteLength),r):((n=new er(er.METADATA_TAG)).pts=n.dts=0,n.writeMetaDataDouble("duration",t),a=n.finalize().length,(r=new Uint8Array(s.byteLength+a)).set(s),r.set(o.byteLength,a),r)}},nr=Yi,rr=Oe,ar=oi,sr=di,or=Rt.ONE_SECOND_IN_TS,lr=ln,dr=function t(e,i){var n=[],r=0,a=0,s=0,o=1/0,l=null,d=null;i=i||{},t.prototype.init.call(this),this.push=function(t){sr.collectDtsInfo(e,t),e&&lr.forEach((function(i){e[i]=t[i]})),n.push(t)},this.setEarliestDts=function(t){a=t},this.setVideoBaseMediaDecodeTime=function(t){o=t},this.setAudioAppendStart=function(t){s=t},this.processFrames_=function(){var t,h,u,c,p;0!==n.length&&0!==(t=ar.trimAdtsFramesByEarliestDts(n,e,a)).length&&(e.baseMediaDecodeTime=sr.calculateTrackBaseMediaDecodeTime(e,i.keepOriginalTimestamps),ar.prefixWithSilence(e,t,s,o),e.samples=ar.generateSampleTable(t),u=rr.mdat(ar.concatenateFrameData(t)),n=[],h=rr.moof(r,[e]),r++,e.initSegment=rr.initSegment([e]),(c=new Uint8Array(h.byteLength+u.byteLength)).set(h),c.set(u,h.byteLength),sr.clearDtsInfo(e),null===l&&(d=l=t[0].pts),d+=t.length*(1024*or/e.samplerate),p={start:l},this.trigger("timingInfo",p),this.trigger("data",{track:e,boxes:c}))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:l,end:d}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){sr.clearDtsInfo(e),l=null,d=null},this.reset=function(){this.resetTiming_(),n=[],this.trigger("reset")}};dr.prototype=new Lt;var hr=dr,ur=Oe,cr=di,pr=ei,fr=dn,gr=function t(e,i){var n,r,a,s=0,o=[],l=[],d=null,h=null,u=!0;i=i||{},t.prototype.init.call(this),this.push=function(t){cr.collectDtsInfo(e,t),void 0===e.timelineStartInfo.dts&&(e.timelineStartInfo.dts=t.dts),"seq_parameter_set_rbsp"!==t.nalUnitType||n||(n=t.config,e.sps=[t.data],fr.forEach((function(t){e[t]=n[t]}),this)),"pic_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.data,e.pps=[t.data]),o.push(t)},this.processNals_=function(t){var n;for(o=l.concat(o);o.length&&"access_unit_delimiter_rbsp"!==o[0].nalUnitType;)o.shift();if(0!==o.length){var r=pr.groupNalsIntoFrames(o);if(r.length)if(l=r[r.length-1],t&&(r.pop(),r.duration-=l.duration,r.nalCount-=l.length,r.byteLength-=l.byteLength),r.length){if(this.trigger("timelineStartInfo",e.timelineStartInfo),u){if(!(a=pr.groupFramesIntoGops(r))[0][0].keyFrame){if(!(a=pr.extendFirstKeyFrame(a))[0][0].keyFrame)return o=[].concat.apply([],r).concat(l),void(l=[]);(r=[].concat.apply([],a)).duration=a.duration}u=!1}for(null===d&&(d=r[0].pts,h=d),h+=r.duration,this.trigger("timingInfo",{start:d,end:h}),n=0;n<r.length;n++){var c=r[n];e.samples=pr.generateSampleTableForFrame(c);var p=ur.mdat(pr.concatenateNalDataForFrame(c));cr.clearDtsInfo(e),cr.collectDtsInfo(e,c),e.baseMediaDecodeTime=cr.calculateTrackBaseMediaDecodeTime(e,i.keepOriginalTimestamps);var f=ur.moof(s,[e]);s++,e.initSegment=ur.initSegment([e]);var g=new Uint8Array(f.byteLength+p.byteLength);g.set(f),g.set(p,f.byteLength),this.trigger("data",{track:e,boxes:g,sequence:s,videoFrameDts:c.dts,videoFramePts:c.pts})}o=[]}else o=[]}},this.resetTimingAndConfig_=function(){n=void 0,r=void 0,d=null,h=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),l=[],o=[],u=!0,this.trigger("reset")}};gr.prototype=new Lt;var mr=Lt,yr=Yi,vr=Pe,br=hr,wr=gr,Tr=di,Sr=tn.isLikelyAacData,Er=Mt,_r=on,kr=Rt,Pr=function(t){return t.prototype=new mr,t.prototype.init.call(t),t},Lr=function(t,e){t.on("data",e.trigger.bind(e,"data")),t.on("done",e.trigger.bind(e,"done")),t.on("partialdone",e.trigger.bind(e,"partialdone")),t.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),t.on("audioTimingInfo",e.trigger.bind(e,"audioTimingInfo")),t.on("videoTimingInfo",e.trigger.bind(e,"videoTimingInfo")),t.on("trackinfo",e.trigger.bind(e,"trackinfo")),t.on("id3Frame",(function(i){i.dispatchType=t.metadataStream.dispatchType,i.cueTime=kr.videoTsToSeconds(i.pts),e.trigger("id3Frame",i)})),t.on("caption",(function(t){e.trigger("caption",t)}))},Cr=function t(e){var i=null,n=!0;e=e||{},t.prototype.init.call(this),e.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.push=function(t){if(n){var r=Sr(t);!r||i&&"aac"===i.type?r||i&&"ts"===i.type||(i=function(t){var e={type:"ts",tracks:{audio:null,video:null},packet:new yr.TransportPacketStream,parse:new yr.TransportParseStream,elementary:new yr.ElementaryStream,timestampRollover:new yr.TimestampRolloverStream,adts:new vr.Adts,h264:new vr.h264.H264Stream,captionStream:new yr.CaptionStream(t),metadataStream:new yr.MetadataStream};return e.headOfPipeline=e.packet,e.packet.pipe(e.parse).pipe(e.elementary).pipe(e.timestampRollover),e.timestampRollover.pipe(e.h264),e.h264.pipe(e.captionStream),e.timestampRollover.pipe(e.metadataStream),e.timestampRollover.pipe(e.adts),e.elementary.on("data",(function(i){if("metadata"===i.type){for(var n=0;n<i.tracks.length;n++)e.tracks[i.tracks[n].type]||(e.tracks[i.tracks[n].type]=i.tracks[n],e.tracks[i.tracks[n].type].timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime);e.tracks.video&&!e.videoSegmentStream&&(e.videoSegmentStream=new wr(e.tracks.video,t),e.videoSegmentStream.on("timelineStartInfo",(function(i){e.tracks.audio&&!t.keepOriginalTimestamps&&e.audioSegmentStream.setEarliestDts(i.dts-t.baseMediaDecodeTime)})),e.videoSegmentStream.on("timingInfo",e.trigger.bind(e,"videoTimingInfo")),e.videoSegmentStream.on("data",(function(t){e.trigger("data",{type:"video",data:t})})),e.videoSegmentStream.on("done",e.trigger.bind(e,"done")),e.videoSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.videoSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.h264.pipe(e.videoSegmentStream)),e.tracks.audio&&!e.audioSegmentStream&&(e.audioSegmentStream=new br(e.tracks.audio,t),e.audioSegmentStream.on("data",(function(t){e.trigger("data",{type:"audio",data:t})})),e.audioSegmentStream.on("done",e.trigger.bind(e,"done")),e.audioSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.audioSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.audioSegmentStream.on("timingInfo",e.trigger.bind(e,"audioTimingInfo")),e.adts.pipe(e.audioSegmentStream)),e.trigger("trackinfo",{hasAudio:!!e.tracks.audio,hasVideo:!!e.tracks.video})}})),e.captionStream.on("data",(function(i){var n;n=e.tracks.video&&e.tracks.video.timelineStartInfo.pts||0,i.startTime=kr.metadataTsToSeconds(i.startPts,n,t.keepOriginalTimestamps),i.endTime=kr.metadataTsToSeconds(i.endPts,n,t.keepOriginalTimestamps),e.trigger("caption",i)})),(e=Pr(e)).metadataStream.on("data",e.trigger.bind(e,"id3Frame")),e}(e),Lr(i,this)):(i=function(t){var e={type:"aac",tracks:{audio:null},metadataStream:new yr.MetadataStream,aacStream:new _r,audioRollover:new yr.TimestampRolloverStream("audio"),timedMetadataRollover:new yr.TimestampRolloverStream("timed-metadata"),adtsStream:new Er(!0)};return e.headOfPipeline=e.aacStream,e.aacStream.pipe(e.audioRollover).pipe(e.adtsStream),e.aacStream.pipe(e.timedMetadataRollover).pipe(e.metadataStream),e.metadataStream.on("timestamp",(function(t){e.aacStream.setTimestamp(t.timeStamp)})),e.aacStream.on("data",(function(i){"timed-metadata"!==i.type&&"audio"!==i.type||e.audioSegmentStream||(e.tracks.audio=e.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:t.baseMediaDecodeTime},codec:"adts",type:"audio"},e.audioSegmentStream=new br(e.tracks.audio,t),e.audioSegmentStream.on("data",(function(t){e.trigger("data",{type:"audio",data:t})})),e.audioSegmentStream.on("partialdone",e.trigger.bind(e,"partialdone")),e.audioSegmentStream.on("done",e.trigger.bind(e,"done")),e.audioSegmentStream.on("endedtimeline",e.trigger.bind(e,"endedtimeline")),e.audioSegmentStream.on("timingInfo",e.trigger.bind(e,"audioTimingInfo")),e.adtsStream.pipe(e.audioSegmentStream),e.trigger("trackinfo",{hasAudio:!!e.tracks.audio,hasVideo:!!e.tracks.video}))})),(e=Pr(e)).metadataStream.on("data",e.trigger.bind(e,"id3Frame")),e}(e),Lr(i,this)),n=!1}i.headOfPipeline.push(t)},this.flush=function(){i&&(n=!0,i.headOfPipeline.flush())},this.partialFlush=function(){i&&i.headOfPipeline.partialFlush()},this.endTimeline=function(){i&&i.headOfPipeline.endTimeline()},this.reset=function(){i&&i.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(t){e.keepOriginalTimestamps||(e.baseMediaDecodeTime=t),i&&(i.tracks.audio&&(i.tracks.audio.timelineStartInfo.dts=void 0,i.tracks.audio.timelineStartInfo.pts=void 0,Tr.clearDtsInfo(i.tracks.audio),i.audioRollover&&i.audioRollover.discontinuity()),i.tracks.video&&(i.videoSegmentStream&&(i.videoSegmentStream.gopCache_=[]),i.tracks.video.timelineStartInfo.dts=void 0,i.tracks.video.timelineStartInfo.pts=void 0,Tr.clearDtsInfo(i.tracks.video)),i.timestampRollover&&i.timestampRollover.discontinuity())},this.setRemux=function(t){e.remux=t,i&&i.coalesceStream&&i.coalesceStream.setRemux(t)},this.setAudioAppendStart=function(t){i&&i.tracks.audio&&i.audioSegmentStream&&i.audioSegmentStream.setAudioAppendStart(t)},this.alignGopsWith=function(t){}};Cr.prototype=new mr;var Ar,Rr,Dr={Transmuxer:Cr},Ir=Math.pow(2,32),xr=function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:e.getUint32(4),timescale:e.getUint32(8)},n=12;0===i.version?(i.earliestPresentationTime=e.getUint32(n),i.firstOffset=e.getUint32(n+4),n+=8):(i.earliestPresentationTime=e.getUint32(n)*Ir+e.getUint32(n+4),i.firstOffset=e.getUint32(n+8)*Ir+e.getUint32(n+12),n+=16),n+=2;var r=e.getUint16(n);for(n+=2;r>0;n+=12,r--)i.references.push({referenceType:(128&t[n])>>>7,referencedSize:2147483647&e.getUint32(n),subsegmentDuration:e.getUint32(n+4),startsWithSap:!!(128&t[n+8]),sapType:(112&t[n+8])>>>4,sapDeltaTime:268435455&e.getUint32(n+8)});return i},Or=Math.pow(2,32),Ur=function(t){return new Date(1e3*t-20828448e5)},Mr=Me,Nr=function(t){var e,i,n=new DataView(t.buffer,t.byteOffset,t.byteLength),r=[];for(e=0;e+4<t.length;e+=i)if(i=n.getUint32(e),e+=4,i<=0)r.push("<span style='color:red;'>MALFORMED DATA</span>");else switch(31&t[e]){case 1:r.push("slice_layer_without_partitioning_rbsp");break;case 5:r.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:r.push("sei_rbsp");break;case 7:r.push("seq_parameter_set_rbsp");break;case 8:r.push("pic_parameter_set_rbsp");break;case 9:r.push("access_unit_delimiter_rbsp");break;default:r.push("UNKNOWN NAL - "+t[e]&31)}return r},Br={avc1:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{dataReferenceIndex:e.getUint16(6),width:e.getUint16(24),height:e.getUint16(26),horizresolution:e.getUint16(28)+e.getUint16(30)/16,vertresolution:e.getUint16(32)+e.getUint16(34)/16,frameCount:e.getUint16(40),depth:e.getUint16(74),config:Ar(t.subarray(78,t.byteLength))}},avcC:function(t){var e,i,n,r,a=new DataView(t.buffer,t.byteOffset,t.byteLength),s={configurationVersion:t[0],avcProfileIndication:t[1],profileCompatibility:t[2],avcLevelIndication:t[3],lengthSizeMinusOne:3&t[4],sps:[],pps:[]},o=31&t[5];for(n=6,r=0;r<o;r++)i=a.getUint16(n),n+=2,s.sps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;for(e=t[n],n++,r=0;r<e;r++)i=a.getUint16(n),n+=2,s.pps.push(new Uint8Array(t.subarray(n,n+i))),n+=i;return s},btrt:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{bufferSizeDB:e.getUint32(0),maxBitrate:e.getUint32(4),avgBitrate:e.getUint32(8)}},edts:function(t){return{boxes:Ar(t)}},elst:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),edits:[]},r=i.getUint32(4);for(e=8;r;r--)0===n.version?(n.edits.push({segmentDuration:i.getUint32(e),mediaTime:i.getInt32(e+4),mediaRate:i.getUint16(e+8)+i.getUint16(e+10)/65536}),e+=12):(n.edits.push({segmentDuration:i.getUint32(e)*Or+i.getUint32(e+4),mediaTime:i.getUint32(e+8)*Or+i.getUint32(e+12),mediaRate:i.getUint16(e+16)+i.getUint16(e+18)/65536}),e+=20);return n},esds:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),esId:t[6]<<8|t[7],streamPriority:31&t[8],decoderConfig:{objectProfileIndication:t[11],streamType:t[12]>>>2&63,bufferSize:t[13]<<16|t[14]<<8|t[15],maxBitrate:t[16]<<24|t[17]<<16|t[18]<<8|t[19],avgBitrate:t[20]<<24|t[21]<<16|t[22]<<8|t[23],decoderConfigDescriptor:{tag:t[24],length:t[25],audioObjectType:t[26]>>>3&31,samplingFrequencyIndex:(7&t[26])<<1|t[27]>>>7&1,channelConfiguration:t[27]>>>3&15}}}},ftyp:function(t){for(var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={majorBrand:Mr(t.subarray(0,4)),minorVersion:e.getUint32(4),compatibleBrands:[]},n=8;n<t.byteLength;)i.compatibleBrands.push(Mr(t.subarray(n,n+4))),n+=4;return i},dinf:function(t){return{boxes:Ar(t)}},dref:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),dataReferences:Ar(t.subarray(8))}},hdlr:function(t){var e={version:new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0),flags:new Uint8Array(t.subarray(1,4)),handlerType:Mr(t.subarray(8,12)),name:""},i=8;for(i=24;i<t.byteLength;i++){if(0===t[i]){i++;break}e.name+=String.fromCharCode(t[i])}return e.name=decodeURIComponent(escape(e.name)),e},mdat:function(t){return{byteLength:t.byteLength,nals:Nr(t)}},mdhd:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=4,r={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),language:""};return 1===r.version?(n+=4,r.creationTime=Ur(i.getUint32(n)),n+=8,r.modificationTime=Ur(i.getUint32(n)),n+=4,r.timescale=i.getUint32(n),n+=8,r.duration=i.getUint32(n)):(r.creationTime=Ur(i.getUint32(n)),n+=4,r.modificationTime=Ur(i.getUint32(n)),n+=4,r.timescale=i.getUint32(n),n+=4,r.duration=i.getUint32(n)),n+=4,e=i.getUint16(n),r.language+=String.fromCharCode(96+(e>>10)),r.language+=String.fromCharCode(96+((992&e)>>5)),r.language+=String.fromCharCode(96+(31&e)),r},mdia:function(t){return{boxes:Ar(t)}},mfhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sequenceNumber:t[4]<<24|t[5]<<16|t[6]<<8|t[7]}},minf:function(t){return{boxes:Ar(t)}},mp4a:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={dataReferenceIndex:e.getUint16(6),channelcount:e.getUint16(16),samplesize:e.getUint16(18),samplerate:e.getUint16(24)+e.getUint16(26)/65536};return t.byteLength>28&&(i.streamDescriptor=Ar(t.subarray(28))[0]),i},moof:function(t){return{boxes:Ar(t)}},moov:function(t){return{boxes:Ar(t)}},mvex:function(t){return{boxes:Ar(t)}},mvhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=Ur(e.getUint32(i)),i+=8,n.modificationTime=Ur(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=8,n.duration=e.getUint32(i)):(n.creationTime=Ur(e.getUint32(i)),i+=4,n.modificationTime=Ur(e.getUint32(i)),i+=4,n.timescale=e.getUint32(i),i+=4,n.duration=e.getUint32(i)),i+=4,n.rate=e.getUint16(i)+e.getUint16(i+2)/16,i+=4,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,i+=8,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,i+=24,n.nextTrackId=e.getUint32(i),n},pdin:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),rate:e.getUint32(4),initialDelay:e.getUint32(8)}},sdtp:function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]};for(e=4;e<t.byteLength;e++)i.samples.push({dependsOn:(48&t[e])>>4,isDependedOn:(12&t[e])>>2,hasRedundancy:3&t[e]});return i},sidx:xr,smhd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),balance:t[4]+t[5]/256}},stbl:function(t){return{boxes:Ar(t)}},ctts:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),compositionOffsets:[]},r=i.getUint32(4);for(e=8;r;e+=8,r--)n.compositionOffsets.push({sampleCount:i.getUint32(e),sampleOffset:i[0===n.version?"getUint32":"getInt32"](e+4)});return n},stss:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:i.getUint8(0),flags:new Uint8Array(t.subarray(1,4)),syncSamples:[]},r=i.getUint32(4);for(e=8;r;e+=4,r--)n.syncSamples.push(i.getUint32(e));return n},stco:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),chunkOffsets:[]},r=i.getUint32(4);for(e=8;r;e+=4,r--)n.chunkOffsets.push(i.getUint32(e));return n},stsc:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n=i.getUint32(4),r={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleToChunks:[]};for(e=8;n;e+=12,n--)r.sampleToChunks.push({firstChunk:i.getUint32(e),samplesPerChunk:i.getUint32(e+4),sampleDescriptionIndex:i.getUint32(e+8)});return r},stsd:function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleDescriptions:Ar(t.subarray(8))}},stsz:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),sampleSize:i.getUint32(4),entries:[]};for(e=12;e<t.byteLength;e+=4)n.entries.push(i.getUint32(e));return n},stts:function(t){var e,i=new DataView(t.buffer,t.byteOffset,t.byteLength),n={version:t[0],flags:new Uint8Array(t.subarray(1,4)),timeToSamples:[]},r=i.getUint32(4);for(e=8;r;e+=8,r--)n.timeToSamples.push({sampleCount:i.getUint32(e),sampleDelta:i.getUint32(e+4)});return n},styp:function(t){return Br.ftyp(t)},tfdt:Ge,tfhd:Ve,tkhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i=4,n={version:e.getUint8(0),flags:new Uint8Array(t.subarray(1,4))};return 1===n.version?(i+=4,n.creationTime=Ur(e.getUint32(i)),i+=8,n.modificationTime=Ur(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=8,n.duration=e.getUint32(i)):(n.creationTime=Ur(e.getUint32(i)),i+=4,n.modificationTime=Ur(e.getUint32(i)),i+=4,n.trackId=e.getUint32(i),i+=4,i+=4,n.duration=e.getUint32(i)),i+=4,i+=8,n.layer=e.getUint16(i),i+=2,n.alternateGroup=e.getUint16(i),i+=2,n.volume=e.getUint8(i)+e.getUint8(i+1)/8,i+=2,i+=2,n.matrix=new Uint32Array(t.subarray(i,i+36)),i+=36,n.width=e.getUint16(i)+e.getUint16(i+2)/65536,i+=4,n.height=e.getUint16(i)+e.getUint16(i+2)/65536,n},traf:function(t){return{boxes:Ar(t)}},trak:function(t){return{boxes:Ar(t)}},trex:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:e.getUint32(4),defaultSampleDescriptionIndex:e.getUint32(8),defaultSampleDuration:e.getUint32(12),defaultSampleSize:e.getUint32(16),sampleDependsOn:3&t[20],sampleIsDependedOn:(192&t[21])>>6,sampleHasRedundancy:(48&t[21])>>4,samplePaddingValue:(14&t[21])>>1,sampleIsDifferenceSample:!!(1&t[21]),sampleDegradationPriority:e.getUint16(22)}},trun:ze,"url ":function(t){return{version:t[0],flags:new Uint8Array(t.subarray(1,4))}},vmhd:function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);return{version:t[0],flags:new Uint8Array(t.subarray(1,4)),graphicsmode:e.getUint16(4),opcolor:new Uint16Array([e.getUint16(6),e.getUint16(8),e.getUint16(10)])}}};Ar=function(t){for(var e,i,n,r,a,s=0,o=[],l=new ArrayBuffer(t.length),d=new Uint8Array(l),h=0;h<t.length;++h)d[h]=t[h];for(e=new DataView(l);s<t.byteLength;)i=e.getUint32(s),n=Mr(t.subarray(s+4,s+8)),r=i>1?s+i:t.byteLength,(a=(Br[n]||function(t){return{data:t}})(t.subarray(s+8,r))).size=i,a.type=n,o.push(a),s=r;return o},Rr=function(t,e){var i;return e=e||0,i=new Array(2*e+1).join(" "),t.map((function(t,n){return i+t.type+"\n"+Object.keys(t).filter((function(t){return"type"!==t&&"boxes"!==t})).map((function(e){var n=i+"  "+e+": ",r=t[e];if(r instanceof Uint8Array||r instanceof Uint32Array){var a=Array.prototype.slice.call(new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).map((function(t){return" "+("00"+t.toString(16)).slice(-2)})).join("").match(/.{1,24}/g);return a?1===a.length?n+"<"+a.join("").slice(1)+">":n+"<\n"+a.map((function(t){return i+"  "+t})).join("\n")+"\n"+i+"  >":n+"<>"}return n+JSON.stringify(r,null,2).split("\n").map((function(t,e){return 0===e?t:i+"  "+t})).join("\n")})).join("\n")+(t.boxes?"\n"+Rr(t.boxes,e+1):"")})).join("\n")};var Fr={inspect:Ar,textify:Rr,parseType:Mr,findBox:Fe,parseTraf:Br.traf,parseTfdt:Br.tfdt,parseHdlr:Br.hdlr,parseTfhd:Br.tfhd,parseTrun:Br.trun,parseSidx:Br.sidx},Vr={8:"audio",9:"video",18:"metadata"},qr=function(t){for(var e,i=[];t.byteLength>0;)e=0,i.push("0x"+("00"+t[e++].toString(16)).slice(-2).toUpperCase()),t=t.subarray(1);return i.join(" ")},zr=function(t,e){var i=t[0]&parseInt("00001111",2);return(e=e||{}).frameType=["Unknown","Keyframe (for AVC, a seekable frame)","Inter frame (for AVC, a nonseekable frame)","Disposable inter frame (H.263 only)","Generated keyframe (reserved for server use only)","Video info/command frame"][(t[0]&parseInt("11110000",2))>>>4],e.codecID=i,7===i?function(t,e){var i=t[1]&parseInt("01111111",2)<<16|t[2]<<8|t[3];return(e=e||{}).avcPacketType=["AVC Sequence Header","AVC NALU","AVC End-of-Sequence"][t[0]],e.CompositionTime=t[1]&parseInt("10000000",2)?-i:i,1===t[0]?e.nalUnitTypeRaw=qr(t.subarray(4,100)):e.data=qr(t.subarray(4)),e}(t.subarray(1),e):e},Hr=function(t,e){var i=(t[0]&parseInt("11110000",2))>>>4;return(e=e||{}).soundFormat=["Linear PCM, platform endian","ADPCM","MP3","Linear PCM, little endian","Nellymoser 16-kHz mono","Nellymoser 8-kHz mono","Nellymoser","G.711 A-law logarithmic PCM","G.711 mu-law logarithmic PCM","reserved","AAC","Speex","MP3 8-Khz","Device-specific sound"][i],e.soundRate=["5.5-kHz","11-kHz","22-kHz","44-kHz"][(t[0]&parseInt("00001100",2))>>>2],e.soundSize=(t[0]&parseInt("00000010",2))>>>1?"16-bit":"8-bit",e.soundType=t[0]&parseInt("00000001",2)?"Stereo":"Mono",10===i?function(t,e){return(e=e||{}).aacPacketType=["AAC Sequence Header","AAC Raw"][t[0]],e.data=qr(t.subarray(1)),e}(t.subarray(1),e):e},Gr=function(t){var e=function(t){return{tagType:Vr[t[0]],dataSize:t[1]<<16|t[2]<<8|t[3],timestamp:t[7]<<24|t[4]<<16|t[5]<<8|t[6],streamID:t[8]<<16|t[9]<<8|t[10]}}(t);switch(t[0]){case 8:Hr(t.subarray(11),e);break;case 9:zr(t.subarray(11),e)}return e},Wr={inspectTag:Gr,inspect:function(t){var e,i,n=9,r=[];for(n+=4;n<t.byteLength;)e=t[n+1]<<16,e|=t[n+2]<<8,e|=t[n+3],e+=11,i=t.subarray(n,n+e),r.push(Gr(i)),n+=e+4;return r},textify:function(t){return JSON.stringify(t,null,2)}},$r=ki,Xr=function(t){var e=31&t[1];return e<<=8,e|=t[2]},jr=function(t){return!!(64&t[1])},Yr=function(t){var e=0;return(48&t[3])>>>4>1&&(e+=t[4]+1),e},Kr=function(t){switch(t){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},Qr={parseType:function(t,e){var i=Xr(t);return 0===i?"pat":i===e?"pmt":e?"pes":null},parsePat:function(t){var e=jr(t),i=4+Yr(t);return e&&(i+=t[i]+1),(31&t[i+10])<<8|t[i+11]},parsePmt:function(t){var e={},i=jr(t),n=4+Yr(t);if(i&&(n+=t[n]+1),1&t[n+5]){var r;r=3+((15&t[n+1])<<8|t[n+2])-4;for(var a=12+((15&t[n+10])<<8|t[n+11]);a<r;){var s=n+a;e[(31&t[s+1])<<8|t[s+2]]=t[s],a+=5+((15&t[s+3])<<8|t[s+4])}return e}},parsePayloadUnitStartIndicator:jr,parsePesType:function(t,e){switch(e[Xr(t)]){case $r.H264_STREAM_TYPE:return"video";case $r.ADTS_STREAM_TYPE:return"audio";case $r.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},parsePesTime:function(t){if(!jr(t))return null;var e=4+Yr(t);if(e>=t.byteLength)return null;var i,n=null;return 192&(i=t[e+7])&&((n={}).pts=(14&t[e+9])<<27|(255&t[e+10])<<20|(254&t[e+11])<<12|(255&t[e+12])<<5|(254&t[e+13])>>>3,n.pts*=4,n.pts+=(6&t[e+13])>>>1,n.dts=n.pts,64&i&&(n.dts=(14&t[e+14])<<27|(255&t[e+15])<<20|(254&t[e+16])<<12|(255&t[e+17])<<5|(254&t[e+18])>>>3,n.dts*=4,n.dts+=(6&t[e+18])>>>1)),n},videoPacketContainsKeyFrame:function(t){for(var e=4+Yr(t),i=t.subarray(e),n=0,r=0,a=!1;r<i.byteLength-3;r++)if(1===i[r+2]){n=r+5;break}for(;n<i.byteLength;)switch(i[n]){case 0:if(0!==i[n-1]){n+=2;break}if(0!==i[n-2]){n++;break}r+3!==n-2&&"slice_layer_without_partitioning_rbsp_idr"===Kr(31&i[r+3])&&(a=!0);do{n++}while(1!==i[n]&&n<i.length);r=n-2,n+=3;break;case 1:if(0!==i[n-1]||0!==i[n-2]){n+=3;break}"slice_layer_without_partitioning_rbsp_idr"===Kr(31&i[r+3])&&(a=!0),r=n-2,n+=3;break;default:n+=3}return i=i.subarray(r),n-=r,r=0,i&&i.byteLength>3&&"slice_layer_without_partitioning_rbsp_idr"===Kr(31&i[r+3])&&(a=!0),a}},Zr=ki,Jr=Di,ta={};ta.ts=Qr,ta.aac=tn;var ea=Rt.ONE_SECOND_IN_TS,ia=188,na=71,ra=function(t,e,i){for(var n,r,a,s,o=0,l=ia,d=!1;l<=t.byteLength;)if(t[o]!==na||t[l]!==na&&l!==t.byteLength)o++,l++;else{if(n=t.subarray(o,l),"pes"===ta.ts.parseType(n,e.pid))r=ta.ts.parsePesType(n,e.table),a=ta.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&a&&(s=ta.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),d=!0);if(d)break;o+=ia,l+=ia}for(o=(l=t.byteLength)-ia,d=!1;o>=0;)if(t[o]!==na||t[l]!==na&&l!==t.byteLength)o--,l--;else{if(n=t.subarray(o,l),"pes"===ta.ts.parseType(n,e.pid))r=ta.ts.parsePesType(n,e.table),a=ta.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&a&&(s=ta.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),d=!0);if(d)break;o-=ia,l-=ia}},aa=function(t,e,i){for(var n,r,a,s,o,l,d,h=0,u=ia,c=!1,p={data:[],size:0};u<t.byteLength;)if(t[h]!==na||t[u]!==na)h++,u++;else{if(n=t.subarray(h,u),"pes"===ta.ts.parseType(n,e.pid))if(r=ta.ts.parsePesType(n,e.table),a=ta.ts.parsePayloadUnitStartIndicator(n),"video"===r&&(a&&!c&&(s=ta.ts.parsePesTime(n))&&(s.type="video",i.video.push(s),c=!0),!i.firstKeyFrame)){if(a&&0!==p.size){for(o=new Uint8Array(p.size),l=0;p.data.length;)d=p.data.shift(),o.set(d,l),l+=d.byteLength;if(ta.ts.videoPacketContainsKeyFrame(o)){var f=ta.ts.parsePesTime(o);f?(i.firstKeyFrame=f,i.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}p.size=0}p.data.push(n),p.size+=n.byteLength}if(c&&i.firstKeyFrame)break;h+=ia,u+=ia}for(h=(u=t.byteLength)-ia,c=!1;h>=0;)if(t[h]!==na||t[u]!==na)h--,u--;else{if(n=t.subarray(h,u),"pes"===ta.ts.parseType(n,e.pid))r=ta.ts.parsePesType(n,e.table),a=ta.ts.parsePayloadUnitStartIndicator(n),"video"===r&&a&&(s=ta.ts.parsePesTime(n))&&(s.type="video",i.video.push(s),c=!0);if(c)break;h-=ia,u-=ia}},sa=function(t){var e={pid:null,table:null},i={};for(var n in function(t,e){for(var i,n=0,r=ia;r<t.byteLength;)if(t[n]!==na||t[r]!==na)n++,r++;else{switch(i=t.subarray(n,r),ta.ts.parseType(i,e.pid)){case"pat":e.pid=ta.ts.parsePat(i);break;case"pmt":var a=ta.ts.parsePmt(i);e.table=e.table||{},Object.keys(a).forEach((function(t){e.table[t]=a[t]}))}n+=ia,r+=ia}}(t,e),e.table){if(e.table.hasOwnProperty(n))switch(e.table[n]){case Zr.H264_STREAM_TYPE:i.video=[],aa(t,e,i),0===i.video.length&&delete i.video;break;case Zr.ADTS_STREAM_TYPE:i.audio=[],ra(t,e,i),0===i.audio.length&&delete i.audio}}return i},oa={inspect:function(t,e){var i;return i=ta.aac.isLikelyAacData(t)?function(t){for(var e,i=!1,n=0,r=null,a=null,s=0,o=0;t.length-o>=3;){switch(ta.aac.parseType(t,o)){case"timed-metadata":if(t.length-o<10){i=!0;break}if((s=ta.aac.parseId3TagSize(t,o))>t.length){i=!0;break}null===a&&(e=t.subarray(o,o+s),a=ta.aac.parseAacTimestamp(e)),o+=s;break;case"audio":if(t.length-o<7){i=!0;break}if((s=ta.aac.parseAdtsSize(t,o))>t.length){i=!0;break}null===r&&(e=t.subarray(o,o+s),r=ta.aac.parseSampleRate(e)),n++,o+=s;break;default:o++}if(i)return null}if(null===r||null===a)return null;var l=ea/r;return{audio:[{type:"audio",dts:a,pts:a},{type:"audio",dts:a+1024*n*l,pts:a+1024*n*l}]}}(t):sa(t),i&&(i.audio||i.video)?(function(t,e){if(t.audio&&t.audio.length){var i=e;(void 0===i||isNaN(i))&&(i=t.audio[0].dts),t.audio.forEach((function(t){t.dts=Jr(t.dts,i),t.pts=Jr(t.pts,i),t.dtsTime=t.dts/ea,t.ptsTime=t.pts/ea}))}if(t.video&&t.video.length){var n=e;if((void 0===n||isNaN(n))&&(n=t.video[0].dts),t.video.forEach((function(t){t.dts=Jr(t.dts,n),t.pts=Jr(t.pts,n),t.dtsTime=t.dts/ea,t.ptsTime=t.pts/ea})),t.firstKeyFrame){var r=t.firstKeyFrame;r.dts=Jr(r.dts,n),r.pts=Jr(r.pts,n),r.dtsTime=r.dts/ea,r.ptsTime=r.pts/ea}}}(i,e),i):null},parseAudioPes_:ra},la={codecs:Pe,mp4:Fn,flv:ir,mp2t:nr,partial:Dr};la.mp4.tools=Fr,la.flv.tools=Wr,la.mp2t.tools=oa;var da={},ha={exports:{}},ua={exports:{}};!function(t){function e(i,n){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.default=t.exports,t.exports.__esModule=!0,e(i,n)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0}(ua),function(t){var e=ua.exports;t.exports=function(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,e(t,i)},t.exports.default=t.exports,t.exports.__esModule=!0}(ha);var ca={exports:{}};!function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var i=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(i,1),i>-1},e.trigger=function(t){var e=this.listeners[t];if(e)if(2===arguments.length)for(var i=e.length,n=0;n<i;++n)e[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),a=e.length,s=0;s<a;++s)e[s].apply(this,r)},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",(function(e){t.push(e)}))},t}();e.default=i,t.exports=e.default}(ca,ca.exports);var pa={exports:{}};!function(t){function e(){return t.exports=e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},t.exports.default=t.exports,t.exports.__esModule=!0,e.apply(this,arguments)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0}(pa);var fa={exports:{}};!function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0}(fa);var ga={exports:{}},ma={exports:{}};!function(t){t.exports=function(t){return t&&t.__esModule?t:{default:t}},t.exports.default=t.exports,t.exports.__esModule=!0}(ma);var ya="undefined"!=typeof window?window:void 0!==s?s:"undefined"!=typeof self?self:{};!function(t,e){var i=ma.exports;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e=r(t),i=new Uint8Array(e.length),n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return i};var n=i(ya),r=function(t){return n.default.atob?n.default.atob(t):Buffer.from(t,"base64").toString("binary")};t.exports=e.default}(ga,ga.exports),
/*! @name m3u8-parser @version 4.7.0 @license Apache-2.0 */
Object.defineProperty(da,"__esModule",{value:!0});var va=ca.exports,ba=pa.exports,wa=fa.exports,Ta=ga.exports;function Sa(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var Ea=Sa(ha.exports),_a=Sa(va),ka=Sa(ba),Pa=Sa(wa),La=Sa(Ta),Ca=function(t){function e(){var e;return(e=t.call(this)||this).buffer="",e}return Ea.default(e,t),e.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},e}(_a.default),Aa=String.fromCharCode(9),Ra=function(t){var e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||""),i={};return e[1]&&(i.length=parseInt(e[1],10)),e[2]&&(i.offset=parseInt(e[2],10)),i},Da=function(t){for(var e,i=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),n={},r=i.length;r--;)""!==i[r]&&((e=/([^=]*)=(.*)/.exec(i[r]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),n[e[0]]=e[1]);return n},Ia=function(t){function e(){var e;return(e=t.call(this)||this).customParsers=[],e.tagMappers=[],e}Ea.default(e,t);var i=e.prototype;return i.push=function(t){var e,i,n=this;0!==(t=t.trim()).length&&("#"===t[0]?this.tagMappers.reduce((function(e,i){var n=i(t);return n===t?e:e.concat([n])}),[t]).forEach((function(t){for(var r=0;r<n.customParsers.length;r++)if(n.customParsers[r].call(n,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))n.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return i={type:"tag",tagType:"inf"},e[1]&&(i.duration=parseFloat(e[1])),e[2]&&(i.title=e[2]),void n.trigger("data",i);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"targetduration"},e[1]&&(i.duration=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"version"},e[1]&&(i.version=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return i={type:"tag",tagType:"media-sequence"},e[1]&&(i.number=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return i={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(i.number=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return i={type:"tag",tagType:"playlist-type"},e[1]&&(i.playlistType=e[1]),void n.trigger("data",i);if(e=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(t))return i=ka.default(Ra(e[1]),{type:"tag",tagType:"byterange"}),void n.trigger("data",i);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return i={type:"tag",tagType:"allow-cache"},e[1]&&(i.allowed=!/NO/.test(e[1])),void n.trigger("data",i);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(i={type:"tag",tagType:"map"},e[1]){var a=Da(e[1]);a.URI&&(i.uri=a.URI),a.BYTERANGE&&(i.byterange=Ra(a.BYTERANGE))}n.trigger("data",i)}else if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(i={type:"tag",tagType:"stream-inf"},e[1]){if(i.attributes=Da(e[1]),i.attributes.RESOLUTION){var s=i.attributes.RESOLUTION.split("x"),o={};s[0]&&(o.width=parseInt(s[0],10)),s[1]&&(o.height=parseInt(s[1],10)),i.attributes.RESOLUTION=o}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}n.trigger("data",i)}else{if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return i={type:"tag",tagType:"media"},e[1]&&(i.attributes=Da(e[1])),void n.trigger("data",i);if(e=/^#EXT-X-ENDLIST/.exec(t))n.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(t))n.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return i={type:"tag",tagType:"program-date-time"},e[1]&&(i.dateTimeString=e[1],i.dateTimeObject=new Date(e[1])),void n.trigger("data",i);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return i={type:"tag",tagType:"key"},e[1]&&(i.attributes=Da(e[1]),i.attributes.IV&&("0x"===i.attributes.IV.substring(0,2).toLowerCase()&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),void n.trigger("data",i);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return i={type:"tag",tagType:"start"},e[1]&&(i.attributes=Da(e[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),void n.trigger("data",i);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return i={type:"tag",tagType:"cue-out-cont"},e[1]?i.data=e[1]:i.data="",void n.trigger("data",i);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return i={type:"tag",tagType:"cue-out"},e[1]?i.data=e[1]:i.data="",void n.trigger("data",i);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return i={type:"tag",tagType:"cue-in"},e[1]?i.data=e[1]:i.data="",void n.trigger("data",i);if((e=/^#EXT-X-SKIP:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"skip"}).attributes=Da(e[1]),i.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(i.attributes["SKIPPED-SEGMENTS"]=parseInt(i.attributes["SKIPPED-SEGMENTS"],10)),i.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(i.attributes["RECENTLY-REMOVED-DATERANGES"]=i.attributes["RECENTLY-REMOVED-DATERANGES"].split(Aa)),void n.trigger("data",i);if((e=/^#EXT-X-PART:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"part"}).attributes=Da(e[1]),["DURATION"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseFloat(i.attributes[t]))})),["INDEPENDENT","GAP"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=/YES/.test(i.attributes[t]))})),i.attributes.hasOwnProperty("BYTERANGE")&&(i.attributes.byterange=Ra(i.attributes.BYTERANGE)),void n.trigger("data",i);if((e=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"server-control"}).attributes=Da(e[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseFloat(i.attributes[t]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=/YES/.test(i.attributes[t]))})),void n.trigger("data",i);if((e=/^#EXT-X-PART-INF:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"part-inf"}).attributes=Da(e[1]),["PART-TARGET"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseFloat(i.attributes[t]))})),void n.trigger("data",i);if((e=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"preload-hint"}).attributes=Da(e[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(t){if(i.attributes.hasOwnProperty(t)){i.attributes[t]=parseInt(i.attributes[t],10);var e="BYTERANGE-LENGTH"===t?"length":"offset";i.attributes.byterange=i.attributes.byterange||{},i.attributes.byterange[e]=i.attributes[t],delete i.attributes[t]}})),void n.trigger("data",i);if((e=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"rendition-report"}).attributes=Da(e[1]),["LAST-MSN","LAST-PART"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseInt(i.attributes[t],10))})),void n.trigger("data",i);n.trigger("data",{type:"tag",data:t.slice(4)})}}}else n.trigger("data",{type:"comment",text:t.slice(1)})})):this.trigger("data",{type:"uri",uri:t}))},i.addParser=function(t){var e=this,i=t.expression,n=t.customType,r=t.dataParser,a=t.segment;"function"!=typeof r&&(r=function(t){return t}),this.customParsers.push((function(t){if(i.exec(t))return e.trigger("data",{type:"custom",data:r(t),customType:n,segment:a}),!0}))},i.addTagMapper=function(t){var e=t.expression,i=t.map;this.tagMappers.push((function(t){return e.test(t)?i(t):t}))},e}(_a.default),xa=function(t){var e={};return Object.keys(t).forEach((function(i){var n;e[(n=i,n.toLowerCase().replace(/-(\w)/g,(function(t){return t[1].toUpperCase()})))]=t[i]})),e},Oa=function(t){var e=t.serverControl,i=t.targetDuration,n=t.partTargetDuration;if(e){var r="#EXT-X-SERVER-CONTROL",a="holdBack",s="partHoldBack",o=i&&3*i,l=n&&2*n;i&&!e.hasOwnProperty(a)&&(e[a]=o,this.trigger("info",{message:r+" defaulting HOLD-BACK to targetDuration * 3 ("+o+")."})),o&&e[a]<o&&(this.trigger("warn",{message:r+" clamping HOLD-BACK ("+e[a]+") to targetDuration * 3 ("+o+")"}),e[a]=o),n&&!e.hasOwnProperty(s)&&(e[s]=3*n,this.trigger("info",{message:r+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+e[s]+")."})),n&&e[s]<l&&(this.trigger("warn",{message:r+" clamping PART-HOLD-BACK ("+e[s]+") to partTargetDuration * 2 ("+l+")."}),e[s]=l)}},Ua=function(t){function e(){var e;(e=t.call(this)||this).lineStream=new Ca,e.parseStream=new Ia,e.lineStream.pipe(e.parseStream);var i,n,r=Pa.default(e),a=[],s={},o=!1,l=function(){},d={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},h=0;e.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var u=0,c=0;return e.on("end",(function(){s.uri||!s.parts&&!s.preloadHints||(!s.map&&i&&(s.map=i),!s.key&&n&&(s.key=n),s.timeline||"number"!=typeof h||(s.timeline=h),e.manifest.preloadSegment=s)})),e.parseStream.on("data",(function(t){var e,p;({tag:function(){({version:function(){t.version&&(this.manifest.version=t.version)},"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(s.byterange=e,e.length=t.length,"offset"in t||(t.offset=u)),"offset"in t&&(s.byterange=e,e.offset=t.offset),u=e.offset+e.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(s.duration=t.duration),0===t.duration&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=a},key:function(){if(t.attributes)if("NONE"!==t.attributes.METHOD)if(t.attributes.URI){if("com.apple.streamingkeydelivery"===t.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:t.attributes});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===t.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(t.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===t.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==t.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:La.default(t.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),n={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void 0!==t.attributes.IV&&(n.iv=t.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else n=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(t.number)?this.manifest.mediaSequence=t.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){isFinite(t.number)?(this.manifest.discontinuitySequence=t.number,h=t.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){/VOD|EVENT/.test(t.playlistType)?this.manifest.playlistType=t.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},map:function(){i={},t.uri&&(i.uri=t.uri),t.byterange&&(i.byterange=t.byterange),n&&(i.key=n)},"stream-inf":function(){this.manifest.playlists=a,this.manifest.mediaGroups=this.manifest.mediaGroups||d,t.attributes?(s.attributes||(s.attributes={}),ka.default(s.attributes,t.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||d,t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME){var i=this.manifest.mediaGroups[t.attributes.TYPE];i[t.attributes["GROUP-ID"]]=i[t.attributes["GROUP-ID"]]||{},e=i[t.attributes["GROUP-ID"]],(p={default:/yes/i.test(t.attributes.DEFAULT)}).default?p.autoselect=!0:p.autoselect=/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(p.language=t.attributes.LANGUAGE),t.attributes.URI&&(p.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(p.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(p.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(p.forced=/yes/i.test(t.attributes.FORCED)),e[t.attributes.NAME]=p}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){h+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(a.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),s.dateTimeString=t.dateTimeString,s.dateTimeObject=t.dateTimeObject},targetduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):(this.manifest.targetDuration=t.duration,Oa.call(this,this.manifest))},start:function(){t.attributes&&!isNaN(t.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){s.cueOut=t.data},"cue-out-cont":function(){s.cueOutCont=t.data},"cue-in":function(){s.cueIn=t.data},skip:function(){this.manifest.skip=xa(t.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",t.attributes,["SKIPPED-SEGMENTS"])},part:function(){var e=this;o=!0;var i=this.manifest.segments.length,n=xa(t.attributes);s.parts=s.parts||[],s.parts.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=c),c=n.byterange.offset+n.byterange.length);var r=s.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+r+" for segment #"+i,t.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((function(t,i){t.hasOwnProperty("lastPart")||e.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+i+" lacks required attribute(s): LAST-PART"})}))},"server-control":function(){var e=this.manifest.serverControl=xa(t.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),Oa.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var e=this.manifest.segments.length,i=xa(t.attributes),n=i.type&&"PART"===i.type;s.preloadHints=s.preloadHints||[],s.preloadHints.push(i),i.byterange&&(i.byterange.hasOwnProperty("offset")||(i.byterange.offset=n?c:0,n&&(c=i.byterange.offset+i.byterange.length)));var r=s.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+r+" for segment #"+e,t.attributes,["TYPE","URI"]),i.type)for(var a=0;a<s.preloadHints.length-1;a++){var o=s.preloadHints[a];o.type&&(o.type===i.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+r+" for segment #"+e+" has the same TYPE "+i.type+" as preload hint #"+a}))}},"rendition-report":function(){var e=xa(t.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);var i=this.manifest.renditionReports.length-1,n=["LAST-MSN","URI"];o&&n.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+i,t.attributes,n)},"part-inf":function(){this.manifest.partInf=xa(t.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",t.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),Oa.call(this,this.manifest)}}[t.tagType]||l).call(r)},uri:function(){s.uri=t.uri,a.push(s),this.manifest.targetDuration&&!("duration"in s)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),n&&(s.key=n),s.timeline=h,i&&(s.map=i),c=0,s={}},comment:function(){},custom:function(){t.segment?(s.custom=s.custom||{},s.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(r)})),e}Ea.default(e,t);var i=e.prototype;return i.warnOnMissingAttributes_=function(t,e,i){var n=[];i.forEach((function(t){e.hasOwnProperty(t)||n.push(t)})),n.length&&this.trigger("warn",{message:t+" lacks required attribute(s): "+n.join(", ")})},i.push=function(t){this.lineStream.push(t)},i.end=function(){this.lineStream.push("\n"),this.trigger("end")},i.addParser=function(t){this.parseStream.addParser(t)},i.addTagMapper=function(t){this.parseStream.addTagMapper(t)},e}(_a.default);function Ma(t){let{scheduleOption:e,type:i,liveOption:n}=t,{playerData:a}=e;if("live"===i){let t=n.type;if(t&&"auto"!==t)return t;return 1==+a.live_type?J.Hls:r.default.isSupported()?J.Flv:J.Hls}return a.default_server?.mp4_domainnames?J.Native:function(t){let{scheduleOption:e}=t;return!e.enable&&e.debugPlayer?e.debugPlayer:J.Hls}(t)}function Na(t,e){return Object.prototype.hasOwnProperty.call(t,e)}da.LineStream=Ca,da.ParseStream=Ia,da.Parser=Ua;var Ba=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function Fa(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}function Va(t,e,i,n){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?qa(za(t),(function(n){var r=encodeURIComponent(Fa(n))+i;return Ba(t[n])?qa(t[n],(function(t){return r+encodeURIComponent(Fa(t))})).join(e):r+encodeURIComponent(Fa(t[n]))})).join(e):n?encodeURIComponent(Fa(n))+i+encodeURIComponent(Fa(t)):""}function qa(t,e){if(t.map)return t.map(e);for(var i=[],n=0;n<t.length;n++)i.push(e(t[n],n));return i}var za=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e};function Ha(t,e,i,n){e=e||"&",i=i||"=";var r={};if("string"!=typeof t||0===t.length)return r;var a=/\+/g;t=t.split(e);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var o=t.length;s>0&&o>s&&(o=s);for(var l=0;l<o;++l){var d,h,u,c,p=t[l].replace(a,"%20"),f=p.indexOf(i);f>=0?(d=p.substr(0,f),h=p.substr(f+1)):(d=p,h=""),u=decodeURIComponent(d),c=decodeURIComponent(h),Na(r,u)?Ba(r[u])?r[u].push(c):r[u]=[r[u],c]:r[u]=c}return r}var Ga={encode:Va,stringify:Va,decode:Ha,parse:Ha};class Wa{store;xhr;e;onError;onTimeout;onLoad;onLoadend;constructor(t){this.store=t,this.e={error:this._onError.bind(this),timeout:this._onTimeout.bind(this),load:this._onLoad.bind(this),loadend:this._onLoadend.bind(this)};let e=new XMLHttpRequest;"ie"!==O.browser&&(e.responseType="json",e.timeout=5e3),e.onerror=this.e.error,e.ontimeout=this.e.timeout,e.onload=this.e.load,e.onloadend=this.e.loadend,this.xhr=e}_onError(t){this.onError&&this.onError(t.target),this.onError=null}_onTimeout(t){this.onTimeout&&this.onTimeout(t.target),this.onTimeout=null}_onLoad(t){if(!t.target)return void this._onError(t);let e=t.target.response;if("ie"===O.browser&&e&&"string"==typeof e)try{e=JSON.parse(e)}catch(t){}let{code:i,data:n}=e;200==+i?(this.onLoad&&this.onLoad(n),this.onLoad=null):this._onError(t)}_onLoadend(t){this.onLoadend&&this.onLoadend(t.target),this.onLoadend=null}fire(t,e={},i="POST"){if(!this.xhr)return;O.isIOS&&O.isUC&&(i="GET");let n=new FormData;if(this.store&&(n.set(Y.CLIENT,this.store.getKV(Y.CLIENT)),n.set(Y.APP_ID,this.store.getKV(Y.APP_ID)),n.set(Y.THIRD_PARTY_USER_ID,this.store.getKV(Y.THIRD_PARTY_USER_ID)),n.set(Y.ACCESS_TOKEN,this.store.getKV(Y.ACCESS_TOKEN)),n.set(Y.PACKAGE_CHECK,this.store.getKV(Y.PACKAGE_CHECK))),Object.keys(e).forEach((t=>{n.set(t,e[t])})),"POST"===i)this.xhr.open(i,t),this.xhr.send(n);else if("GET"===i){let e={};n.forEach(((t,i)=>{e[i]=t}));let r=Ga.stringify(e);r&&(t+=`?${r}`),this.xhr.open(i,t),this.xhr.send()}}destroy(){this.xhr&&(this.xhr.onerror=null,this.xhr.onload=null,this.xhr.onloadend=null,this.xhr.ontimeout=null,this.xhr=null,this.onLoad=null,this.onLoadend=null,this.onTimeout=null,this.onError=null)}}class $a{info;constructor(){this.info={}}setKV(t,e){this.info[t]=e}getKV(t){return this.info[t]}deleteK(t){this.info.hasOwnProperty(t)&&delete this.info[t]}reset(){this.info={}}}class Xa{store;server;constructor(t){this.store=t,this.server=j}init(){return new Promise(((t,e)=>{const i=new Wa(this.store);i.fire(this.server+K),i.onError=t=>e(t),i.onLoad=e=>t(e)}))}initLive(t){return new Promise(((e,i)=>{const n=new Wa(this.store);n.fire(this.server+Q,{room_id:t}),n.onError=t=>i(t),n.onLoad=t=>e(t)}))}initVod(t){return new Promise(((e,i)=>{const n=new Wa(this.store);n.fire(this.server+Z,{record_id:t}),n.onError=t=>i(t),n.onLoad=t=>e(t)}))}}async function ja(t){let e,i=function(t){let{appId:e,accountId:i,token:n,language:r="zh"}=t,a=new $a;return a.setKV(Y.APP_ID,e),a.setKV(Y.THIRD_PARTY_USER_ID,i),a.setKV(Y.ACCESS_TOKEN,n),a.setKV(Y.PACKAGE_CHECK,"peter"),a.setKV(Y.CLIENT,"pc_browser"),a.setKV(Y.LANGUAGE,r),a}(t),n=new Xa(i),r=await n.init();return e="live"===t.type?await n.initLive(t.liveOption.roomId):await n.initVod(t.vodOption.recordId),{initData:r,playerData:e}}function Ya(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===i&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}Ya(":-webkit-full-screen video,\n:fullscreen video {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n}\n");class Ka extends at{static plugins=[];static Events=it;plugins={};options;root;video;vPlayer;playerType;def;intervalLoader;isFullscreen=!1;enterFullscreen=()=>Promise.resolve(void 0);exitFullscreen=()=>Promise.resolve(void 0);toggleFullscreen=()=>Promise.resolve(void 0);switch=()=>{};setQuality=()=>{};addBarrage=()=>{};clearBarrage=()=>{};openBarrage=()=>{};closeBarrage=()=>{};capture=()=>{};selectVtt=()=>{};closeVtt=()=>{};handleTimeShift=()=>{};openUI=()=>{};hideUI=()=>{};static use(t){const e=t.pluginName;return Ka.plugins.some((e=>e.ctor===t))?Ka:null==e?(ht.warn(`VhPlayer use plugin error，plugin: ${t.name} - ${e} can not be used`),Ka):(Ka.plugins.push({name:e,ctor:t}),Ka)}constructor(t){super(),this.options=(new X).merge(t),this.root=B("#"+t.videoNode),this.registerListeners(),this.createPlayer(),this.applyPlugins()}registerListeners(){this.on(it.SCHEDULER_COMPLETE,(t=>{ht.info("VhPlayer PlayerEvents.SCHEDULER_COMPLETE",t),t.timeShift||this.load(t.url)})),this.on(it.DEFINITION_CHANGE,(t=>{ht.info("VhPlayer PlayerEvents.DEFINITION_CHANGE",t),this.load(t.url)})),this.on(it.LINE_CHANGE,(t=>{ht.info("VhPlayer PlayerEvents.LINE_CHANGE",t),t.isReload?this.reload():this.load(t.url)})),this.on(it.LINE_CHANGED,(()=>{ht.info("VhPlayer PlayerEvents.LINE_CHANGED"),this.intervalLoader&&this.intervalLoader.destroy()})),this.on(it.PULL_STREAM_FAILED,(t=>{ht.info("VhPlayer PlayerEvents.PULL_STREAM_FAILED",t)})),window.ResizeObserver||I();new ResizeObserver((()=>{this.emit(it.UIResize)})).observe(this.root)}createPlayer(){switch(this.playerType=Ma(this.options),this.playerType){case J.Flv:this.vPlayer=new ct(this.options,"flv",this);break;case J.Hls:a.default.isSupported()?this.vPlayer=new pt(this.options,this):this.vPlayer=new ct(this.options,"native",this);break;case J.Native:case J.HlsNative:this.vPlayer=new ct(this.options,"native",this);break;case J.Dash:this.vPlayer=new ft(this.options,this);break;default:throw Error("未提供支持的播放器类型")}this.video=this.vPlayer.video}applyPlugins(){Ka.plugins.forEach((t=>{const e=t.ctor;"function"==typeof e&&(this.plugins[t.name]=new e(this))}))}load(t){this.vPlayer.load(t)}reload(){this.vPlayer.reload()}async destroy(){ht.warn("VhPlayer destroy，plugins：",Object.values(this.plugins));for(let t of Object.values(this.plugins))t.destroy&&t.destroy();await this.vPlayer.destroy(),this.video.remove()}play(){return this.video.play()}pause(){this.video.pause()}get isPaused(){return this.video.paused}get autoplay(){return this.video.autoplay}set autoplay(t){this.video.autoplay=t}get buffered(){return this.video.buffered}get bufferedMax(){let t=this.video.buffered;return t.length?t.end(t.length-1):0}get cdnName(){return this.def?.currentQualityCdnName||this.def?.currentQualityLineName}get quality(){return this.def?.currentQuality}get qualities(){return this.def?.qualities}get controls(){return this.video.controls}set controls(t){this.video.controls=t}get crossOrigin(){return this.video.crossOrigin}set crossOrigin(t){this.video.crossOrigin=t}get currentTime(){return this.video.currentTime}set currentTime(t){this.video.currentTime=t}get defaultMuted(){return this.video.defaultMuted}set defaultMuted(t){this.video.defaultMuted=t}get duration(){return this.video.duration}get isEnded(){return this.video.ended}getEstimateNetSpeed(){return+this.vPlayer.getBandwidthEstimate().toFixed(3)}get loop(){return this.video.loop}set loop(t){this.video.loop=t}get muted(){return this.video.muted}set muted(t){this.video.muted=t}get networkState(){return this.video.networkState}get playbackRate(){return this.video.playbackRate}set playbackRate(t){this.video.playbackRate=t}get played(){return this.video.played}get preload(){return this.video.preload}set preload(t){this.video.preload=t}get readyState(){return this.video.readyState}get seekable(){return this.video.seekable}get isSeeking(){return this.video.seeking}get volume(){return this.video.volume}set volume(t){this.video.volume=t}static probe(){const t=document.createElement("video"),e=window.MediaSource||window.WebKitMediaSource;function i(i){return e&&e.isTypeSupported?e.isTypeSupported(i):t.canPlayType(i)}return{...O,H264:t.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),H265:t.canPlayType('video/mp4; codecs="hevc"'),WebM_VP8:t.canPlayType('video/webm; codecs="vp8, vorbis"'),WebM_VP9:t.canPlayType('video/webm; codecs="vp9"'),MSE_H264:i('video/mp4; codecs="avc1.4D401E"'),MSE_H265:i('video/mp4; codecs="hevc"'),MSE_WebM_VP8:i('video/webm; codecs="vp8, vorbis"'),MSE_WebM_VP9:i('video/webm; codecs="vp9"'),MSE_AV1:i('video/mp4; codecs="av01.0.05M.08"'),WebSocket:!!window.WebSocket}}static async createInstance(t,e,i){try{!function(t){if(self.console&&!0===t||"object"==typeof t){dt(t,nt.Debug,nt.Log,nt.Info,nt.Warn,nt.Error);try{lt.log()}catch(t){lt=ot}}else lt=ot}(void 0!==t.debug&&t.debug);let{scheduleOption:i}=t;{!function(t){const e={appId:["string"],accountId:["string","number"],token:["string"],videoNode:["string"],type:["string"]};for(let i of Object.getOwnPropertyNames(e)){if(!t.hasOwnProperty(i))throw Error(`参数缺失，请确认提供 ${i}`);{let n=e[i],r=typeof t[i];if(!n.includes(r))throw Error(`参数类型错误，${i} 必须是 ${n.join()} 类型`)}}if("live"===t.type){if(!t.liveOption)throw Error("直播需提供参数 liveOption");if(!t.liveOption.roomId)throw Error("直播配置 liveOption 缺少参数 roomId")}else{if(!t.vodOption)throw Error("点播需提供参数 vodOption");if(!t.vodOption.recordId)throw Error("点播配置 vodOption 缺少参数 recordId")}}(t);let e=await ja(t);i.playerData=e.playerData}if(Ma(t)===J.Hls&&a.default.isSupported()){let{peer5Option:e}=t,i=e?.enable?e.customerId:"";if(i)try{await F("script-peer5",`https://api.peer5.com/peer5.js?id=${i}`),await F("script-peer5-hls","https://api.peer5.com/peer5.hlsjs.loader.js")}catch(t){ht.error("VhPlayer.createInstance - peer5 sdk load error: "+t.message)}}let n=new Ka(t);return window.vp=n,e&&e(n),n}catch(t){ht.warn("VhPlayer.createInstance error",t),i&&i({code:500,message:t.message})}}}const Qa=Ka;var Za={};
/*! crc32.js (C) 2014-present SheetJS -- http://sheetjs.com */!function(t){var e;e=function(t){t.version="1.2.2";var e=function(){for(var t=0,e=new Array(256),i=0;256!=i;++i)t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=i)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1,e[i]=t;return"undefined"!=typeof Int32Array?new Int32Array(e):e}(),i=function(t){var e=0,i=0,n=0,r="undefined"!=typeof Int32Array?new Int32Array(4096):new Array(4096);for(n=0;256!=n;++n)r[n]=t[n];for(n=0;256!=n;++n)for(i=t[n],e=256+n;e<4096;e+=256)i=r[e]=i>>>8^t[255&i];var a=[];for(n=1;16!=n;++n)a[n-1]="undefined"!=typeof Int32Array?r.subarray(256*n,256*n+256):r.slice(256*n,256*n+256);return a}(e),n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],d=i[6],h=i[7],u=i[8],c=i[9],p=i[10],f=i[11],g=i[12],m=i[13],y=i[14];t.table=e,t.bstr=function(t,i){for(var n=-1^i,r=0,a=t.length;r<a;)n=n>>>8^e[255&(n^t.charCodeAt(r++))];return~n},t.buf=function(t,i){for(var v=-1^i,b=t.length-15,w=0;w<b;)v=y[t[w++]^255&v]^m[t[w++]^v>>8&255]^g[t[w++]^v>>16&255]^f[t[w++]^v>>>24]^p[t[w++]]^c[t[w++]]^u[t[w++]]^h[t[w++]]^d[t[w++]]^l[t[w++]]^o[t[w++]]^s[t[w++]]^a[t[w++]]^r[t[w++]]^n[t[w++]]^e[t[w++]];for(b+=15;w<b;)v=v>>>8^e[255&(v^t[w++])];return~v},t.str=function(t,i){for(var n=-1^i,r=0,a=t.length,s=0,o=0;r<a;)(s=t.charCodeAt(r++))<128?n=n>>>8^e[255&(n^s)]:s<2048?n=(n=n>>>8^e[255&(n^(192|s>>6&31))])>>>8^e[255&(n^(128|63&s))]:s>=55296&&s<57344?(s=64+(1023&s),o=1023&t.charCodeAt(r++),n=(n=(n=(n=n>>>8^e[255&(n^(240|s>>8&7))])>>>8^e[255&(n^(128|s>>2&63))])>>>8^e[255&(n^(128|o>>6&15|(3&s)<<4))])>>>8^e[255&(n^(128|63&o))]):n=(n=(n=n>>>8^e[255&(n^(224|s>>12&15))])>>>8^e[255&(n^(128|s>>6&63))])>>>8^e[255&(n^(128|63&s))];return~n}},"undefined"==typeof DO_NOT_EXPORT_CRC?e(t):e({})}(Za);class Ja{oldToken;newToken;expireThreshold;expireTime;constructor(t=36e5){this.oldToken="",this.newToken="",this.expireThreshold=t,this.expireTime=0}create(t){this.oldToken=t;let e=t.split("_")[0],i=t.split("_")[1],n=e.split("").reverse().join(""),r=`${(Za.str(n)>>>0).toString(16).toUpperCase()}_${i}`;return this.newToken=r,this.expireTime=Date.now()+this.expireThreshold,r}get isExpired(){return Date.now()>this.expireTime}static refreshToken(t){if(!t.token||t.token.isExpired){let e=new Ja;t.token=e,t.tokenStr=e.create(t.tokenStr)}}}function ts(t,e,i){let{scheduleOption:n}=e,r="live"===e.type,{live_type:a,live_subtitle:s}=n.playerData,o=r?e.liveOption?.defaultDefinition||tt.PSame:e.vodOption?.defaultDefinition||tt.PSame,l=1===s,d=r?function(t,e,i){return e===J.Flv?{key:"httpflv_url",allQuality:t.httpflv_urls,allQualitySubtitles:t.httpflv_subtitle_urls,tokenStr:t.token}:e===J.Hls||e===J.HlsNative?i?{key:"hls_url",allQuality:t.timeshift?.hls_urls,allQualitySubtitles:t.timeshift_subtitle?.hls_urls,tokenStr:t.token}:{key:"hls_url",allQuality:t.hls_urls,allQualitySubtitles:t.hls_subtitle_urls,tokenStr:t.token}:{key:"rtmp_url",allQuality:t.rtmp_urls,allQualitySubtitles:t.rtmp_subtitle_urls,tokenStr:t.token}}(t,i,1===a):function(t,e){return e===J.Hls||e===J.HlsNative?{key:"hls_domainname",allQuality:t.hls_domainnames,tokenStr:t.token}:{key:"mp4_domainname",allQuality:t.mp4_domainnames,tokenStr:t.token}}(t,i),h=l?d.allQualitySubtitles:d.allQuality,u=Object.keys(h);if(!u.length)throw Error("无可用清晰度");u.includes(o)||(o=u[0]);let c=h[o],p=function(t,e){let{debugCDN:i}=e;return i&&t.find((t=>t.cdn_name===i))||t[0]}(c,n),f=c.map((t=>t.cdn_name||t.line));return{allQuality:d.allQuality,allQualitySubtitles:d.allQualitySubtitles,qualities:u,lines:f,currentQuality:o,currentQualityUrl:p[d.key],currentQualityCdnName:p.cdn_name,currentQualityLineName:p.line,currentQualityLines:c,key:d.key,tokenStr:d.tokenStr}}class es{player;def;constructor(t){this.player=t}fetch(){let t=this.buildURL();const e=new Wa;e.fire(t,{},"GET"),e.onError=t=>ht.error("Schedule fetch error",t),e.onLoad=t=>this.resolveData(t)}buildURL(){return""}getRandom(){return 1e8+(899999999*Math.random()>>0)}resolveData(t){let{options:e,playerType:i}=this.player;if(this.def=ts(t,e,i),ht.info("Schedule get def",this.def),"live"===e.type){let t=new Ja;this.def.token=t,this.def.tokenStr=t.create(this.def.tokenStr)}this.player.def=this.def,this.player.emit(it.SCHEDULER_COMPLETE,{url:this.def.currentQualityUrl+"?token="+this.def.tokenStr,timeShift:"live"===e.type&&1===e.scheduleOption.playerData.live_type})}}class is extends es{constructor(t){super(t),this.fetch()}buildURL(){let{scheduleOption:t,vodOption:e}=this.player.options,{dispatch_server:i,default_server:n,safe_server:r,log_info:a}=t.playerData;const s="m3u8"===n.uri.split(".").pop();const o="ie"===O.browser,l=O.supportMSE&&!("android"===O.os&&"qqbrowser"===O.browser),d=!(!r?.uri||!s||o||!l);let h={};h.webinar_id=e.recordId,h.rand=this.getRandom(),h.uid=a.uid,h.uri=this.getUri(d),h.bu=1;let u=this.getQuality(d);return h.quality=0===u.length?'["same"]':`["${u.join('","')}"]`,`${i}/api/dispatch_replay?${Ga.stringify(h)}`}getUri(t){let{playerType:e}=this.player,{scheduleOption:i}=this.player.options,{dispatch_server:n,default_server:r,safe_server:a}=i.playerData,s=n+r.uri,o=t?n+a.uri:s,l=document.createElement("a");return l.href="hls"===e?o:s,l.pathname}getQuality(t){let{scheduleOption:e}=this.player.options,{safe_definition:i,definition:n}=e.playerData;return(t?i:n)||["same"]}}class ns extends es{constructor(t){super(t),this.fetch()}buildURL(){let{scheduleOption:t,liveOption:e}=this.player.options,{dispatch_server:i,log_info:n,app_type:r,live_subtitle:a,live_delay:s}=t.playerData,o={};return o.webinar_id=e.roomId,o.uid=n.uid,o.bu=1,o.rand=this.getRandom(),o.app_type=r,o.is_subtitle=a,o.is_delay_stream=s,`${i}/api/dispatch_play?${Ga.stringify(o)}`}}const rs=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],as=(()=>{let t={};for(let e of rs)if(e[1]in document){let i=0,n=e.length;for(;i<n;i++)t[rs[0][i]]=e[i];return t}return t})(),ss={eventNameMap:{change:as.fullscreenchange,error:as.fullscreenerror},async request(t,e={navigationUI:"auto"}){if(t=t||document.documentElement,this.isEnabled)return await t[as.requestFullscreen](e)},exit:async()=>await document[as.exitFullscreen](),async toggle(t,e={navigationUI:"auto"}){return this.isFullscreen?await this.exit():await this.request(t,e)},onchange(t){this.on("change",t)},onerror(t){this.on("error",t)},on(t,e){this.eventNameMap[t]&&document.addEventListener(this.eventNameMap[t],e,!1)},off(t,e){this.eventNameMap[t]&&document.removeEventListener(this.eventNameMap[t],e,!1)},get isFullscreen(){return Boolean(document[as.fullscreenElement])},get element(){return document[as.fullscreenElement]},get isEnabled(){return Boolean(document[as.fullscreenEnabled])}},os={async request(t){if(this.isEnabled(t))return await t.webkitEnterFullscreen()},exit:async t=>await t.webkitExitFullscreen(),async toggle(t){return this.isFullscreen?await this.exit(t):await this.request(t)},get isFullscreen(){return document.fullScreen||document.webkitIsFullScreen||!1},isEnabled:t=>!!t.webkitEnterFullscreen};class ls{static create(){return ls.S4()+ls.S4()+"-"+ls.S4()+"-"+ls.S4()+"-"+ls.S4()+"-"+ls.S4()+ls.S4()+ls.S4()}static S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}}Ya(".barrage-root {\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  z-index: 3;\n  overflow: hidden\n}\n.barrage-root .barrage-item{\n  padding: 0 6px;\n  position: absolute;\n  left: 100%;\n  z-index: 4;\n  will-change: transform;\n  cursor: pointer;\n  font-size: 14px;\n  color: #fff;\n  white-space: nowrap;\n  border: none;\n}\n.barrage-root .barrage-item img{\n  max-height: 120px;\n}\n");var ds;Ya(".marquee-root{\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  z-index: 2;\n  overflow: hidden\n}\n.marquee-root .marquee{\n  position: absolute;\n  white-space: nowrap;\n  user-select: none;\n  font-size: 18px;\n  color: #ff8d41;\n}\n");class hs{elRoot;elMedia;vhPlayer;constructor(t,e){this.elRoot=t,this.vhPlayer=e,this.elMedia=e.video}}class us extends hs{elBarRoot;elBarCurrent;elBarBuffered;elPos;_onTimeupdate;_onProgress;width=0;cacheLayerX=0;cacheX=-1;cachePercent=-1;isSeeking=!1;constructor(t,e){super(t,e),this.init(),this.registerListeners()}init(){this.elBarRoot=N("div",{},{class:"bar-root"}),this.elBarRoot.innerHTML='\n<div class="bar bar-current"></div>\n<div class="bar bar-buffered"></div>\n<div class="pos"></div>\n',this.elRoot.appendChild(this.elBarRoot),this.elBarCurrent=this.elBarRoot.querySelector(".bar-current"),this.elBarBuffered=this.elBarRoot.querySelector(".bar-buffered"),this.elPos=this.elBarRoot.querySelector(".pos"),setTimeout((()=>{this.width=this.elBarRoot.clientWidth}),100)}registerListeners(){W(this.elBarRoot,"down",this.onMouseDown),W(this.elRoot,"move",this.onMouseMove),W(this.elBarRoot,"up",this.mouseUp),this.elRoot.addEventListener("mouseleave",this.mouseUp),this._onTimeupdate=U(this.onTimeupdate.bind(this),500),this._onProgress=U(this.onProgress.bind(this),500),this.elMedia.addEventListener("timeupdate",this._onTimeupdate),this.elMedia.addEventListener("progress",this._onProgress),this.elMedia.addEventListener("ended",this.onEnded),this.vhPlayer.on(it.UIResize,this.onResize,this)}onResize(){this.width=this.elBarRoot.clientWidth,-1!==this.cachePercent&&this.percentMove(this.cachePercent)}onMouseDown=(t,e)=>{this.isSeeking=!0,this.cacheX=t.clientX;let i=t.clientX-e;t.target===this.elPos&&(i=t.clientX-e/2),this.cacheLayerX=t.target===this.elPos?i-8:i,this.percentMove(this.cacheLayerX/this.width*100)};onMouseMove=t=>{-1!==this.cacheX&&this.percentMove((this.cacheLayerX+t.clientX-this.cacheX)/this.width*100)};mouseUp=t=>{-1!==this.cacheX&&(this.isSeeking=!1,this.elMedia.currentTime=(this.cacheLayerX+t.clientX-this.cacheX)/this.width*this.elMedia.duration,this.cacheX=-1)};onTimeupdate(){this.isSeeking||this.percentMove(this.elMedia.currentTime/this.elMedia.duration*100)}onProgress(){let t=mt(this.elMedia)/this.elMedia.duration*100;this.elBarBuffered.style.transform=`translateX(${-100+t}%)`}onEnded=()=>{this.isSeeking||(this.elBarCurrent.style.transform="translateX(0%)",this.elBarBuffered.style.transform="translateX(0%)",this.elPos.style.transform=`translate(${this.width}px, -50%)`)};percentMove(t){t>100||t<0||(this.cachePercent=t,this.elBarCurrent.style.transform=`translateX(${-100+t}%)`,this.elPos.style.transform=`translate(${t*this.width/100}px, -50%)`)}unRegisterListeners(){this.elMedia.removeEventListener("timeupdate",this._onTimeupdate),this.elMedia.removeEventListener("progress",this._onProgress),this.elMedia.removeEventListener("ended",this.onEnded)}destroy(){this.unRegisterListeners()}}class cs extends hs{elTsBarRoot;elBarCurrent;elPos;width=0;cacheLayerX=0;cacheX=-1;cachePercent=-1;timeShiftMax=7200;timeShiftDuration=7110;constructor(t,e){super(t,e),this.init(),this.registerListeners()}init(){this.elTsBarRoot=N("div",{},{class:"bar-root"}),this.elTsBarRoot.innerHTML='\n<div class="bar bar-current"></div>\n<div class="pos hide"></div>\n',this.elRoot.appendChild(this.elTsBarRoot),this.elBarCurrent=this.elTsBarRoot.querySelector(".bar-current"),this.elPos=this.elTsBarRoot.querySelector(".pos"),setTimeout((()=>{this.width=this.elTsBarRoot.clientWidth,this.percentMove(100),this.elPos.classList.remove("hide")}),100)}registerListeners(){this.elTsBarRoot.addEventListener("mousedown",this.onMouseDown),this.elRoot.addEventListener("mousemove",this.onMouseMove),this.elRoot.addEventListener("mouseleave",this.mouseUp),this.elTsBarRoot.addEventListener("mouseup",this.mouseUp),this.vhPlayer.on(it.UIResize,this.onResize,this)}onResize(){this.width=this.elTsBarRoot.clientWidth,-1!==this.cachePercent&&this.percentMove(this.cachePercent)}onMouseDown=t=>{this.cacheX=t.clientX,this.cacheLayerX=t.target===this.elPos?t.layerX-8:t.layerX,this.percentMove(this.cacheLayerX/this.width*100)};onMouseMove=t=>{-1!==this.cacheX&&this.percentMove((this.cacheLayerX+t.clientX-this.cacheX)/this.width*100)};mouseUp=t=>{if(-1===this.cacheX)return;let e=(this.cacheLayerX+t.clientX-this.cacheX)/this.width*this.timeShiftDuration;e=this.timeShiftDuration-e+90,e=e>this.timeShiftMax?this.timeShiftMax:e,this.vhPlayer.handleTimeShift(e),this.cacheX=-1};percentMove(t){t>100||t<0||(this.cachePercent=t,this.elBarCurrent.style.transform=`translateX(${-100+t}%)`,this.elPos.style.transform=`translate(${t*this.width/100}px, -50%)`)}destroy(){}}class ps extends hs{elPlayRoot;elIcon;constructor(t,e){super(t,e),this.init(),this.registerListeners()}init(){this.elPlayRoot=N("div",{},{class:"ui-play-root"}),this.elPlayRoot.innerHTML='\n<i class="iconfont-player" title="播放/暂停"></i>\n',this.elRoot.appendChild(this.elPlayRoot),this.elIcon=this.elPlayRoot.querySelector(".iconfont-player"),this.elMedia.paused?this.onPause():this.onPlay()}registerListeners(){this.elIcon.addEventListener("click",this.togglePlay),this.elMedia.addEventListener("play",this.onPlay),this.elMedia.addEventListener("pause",this.onPause)}onPlay=()=>{this.elIcon.classList.remove("icon-player-bofang"),this.elIcon.classList.add("icon-player-bofangzanting")};onPause=()=>{this.elIcon.classList.remove("icon-player-bofangzanting"),this.elIcon.classList.add("icon-player-bofang")};togglePlay=()=>{this.elMedia.paused?this.elMedia.play():this.elMedia.pause()};unRegisterListeners(){this.elMedia.removeEventListener("play",this.onPlay),this.elMedia.removeEventListener("pause",this.onPause)}destroy(){this.unRegisterListeners()}}class fs extends hs{elReloadRoot;elIcon;constructor(t,e){super(t,e),this.init(),this.registerListeners()}init(){this.elReloadRoot=N("div",{},{class:"ui-reload-root"}),this.elReloadRoot.innerHTML='\n<i class="iconfont-player icon-player-reload" title="刷新"></i>\n',this.elRoot.appendChild(this.elReloadRoot),this.elIcon=this.elReloadRoot.querySelector(".iconfont-player")}registerListeners(){this.elIcon.addEventListener("click",this.reload)}reload=()=>{this.vhPlayer.emit(it.LINE_CHANGE,{isReload:!0})};destroy(){this.elIcon.removeEventListener("click",this.reload)}}class gs extends hs{elDurationRoot;elDurationCurrent;elDurationTotal;constructor(t,e){super(t,e),this.init(),this.registerListeners()}init(){this.elDurationRoot=N("div",{},{class:"ui-duration-root"}),this.elDurationRoot.innerHTML='\n<span class="duration duration-current">00</span> / <span class="duration duration-total"></span>\n',this.elRoot.appendChild(this.elDurationRoot),this.elDurationCurrent=this.elDurationRoot.querySelector(".duration-current"),this.elDurationTotal=this.elDurationRoot.querySelector(".duration-total"),this.elDurationCurrent.textContent=this.timeFormat(0)}registerListeners(){this.elMedia.addEventListener("timeupdate",this.onTimeupdate),this.elMedia.addEventListener("durationchange",this.onDurationChange),this.elMedia.addEventListener("ended",this.onEnd)}onTimeupdate=()=>{this.elDurationCurrent.textContent=this.timeFormat(this.elMedia.currentTime)};onDurationChange=()=>{this.elDurationTotal.textContent=this.timeFormat(this.elMedia.duration)};onEnd=()=>{this.elDurationCurrent.textContent=this.timeFormat(this.elMedia.duration)};timeFormat(t){let e=Math.floor(t/3600),i=Math.floor(t/60%60),n=Math.floor(t%60);return`${e>0?this.fillZero(e,!1)+":":""}${this.fillZero(i,!0)}:${this.fillZero(n,!0)}`}fillZero(t,e){return t>0?t<10?"0"+t:t+"":e?"00":""}unRegisterListeners(){this.elMedia.removeEventListener("timeupdate",this.onTimeupdate),this.elMedia.removeEventListener("durationchange",this.onDurationChange),this.elMedia.removeEventListener("ended",this.onEnd)}destroy(){this.unRegisterListeners()}}class ms extends hs{elBarrageRoot;elIcon;opened=!0;constructor(t,e){super(t,e),this.init(),this.registerListeners()}init(){let{barrageOption:t}=this.vhPlayer.options;t.enable&&(this.elBarrageRoot=N("div",{},{class:"ui-barrage-root"}),this.elBarrageRoot.innerHTML='\n      <i class="iconfont-player icon-player-danmukaiqi"></i>\n    ',this.elRoot.appendChild(this.elBarrageRoot),this.elIcon=this.elBarrageRoot.querySelector(".iconfont-player"))}registerListeners(){this.elIcon.addEventListener("click",this.onClick)}onClick=()=>{this.opened?(this.elIcon.classList.replace("icon-player-danmukaiqi","icon-player-danmuguanbi"),this.vhPlayer.closeBarrage()):(this.elIcon.classList.replace("icon-player-danmuguanbi","icon-player-danmukaiqi"),this.vhPlayer.openBarrage()),this.opened=!this.opened};destroy(){this.elIcon.removeEventListener("click",this.onClick)}}class ys extends hs{elVolRoot;elIcon;elSlider;elSliderRoot;elSliderVol;elSliderPos;height;timer=0;constructor(t,e){super(t,e),this.init(),this.registerListeners()}init(){this.elVolRoot=N("div",{},{class:"ui-volume-root"}),this.elVolRoot.innerHTML='\n<i class="iconfont-player iconfont-player-vol"></i>\n<div class="volume-slider">\n  <div class="slider-root">\n    <div class="slider"></div>\n  </div>\n  <div class="pos" draggable="true"></div>\n</div>\n',this.elRoot.appendChild(this.elVolRoot),this.elIcon=this.elVolRoot.querySelector(".iconfont-player"),this.elSlider=this.elVolRoot.querySelector(".volume-slider"),this.elSliderRoot=this.elVolRoot.querySelector(".slider-root"),this.elSliderVol=this.elVolRoot.querySelector(".slider"),this.elSliderPos=this.elVolRoot.querySelector(".pos"),this.onVolumechange()}registerListeners(){this.elIcon.addEventListener("click",this.toggleMuted),this.elIcon.addEventListener("mouseenter",this.onMouseOverIcon),this.elIcon.addEventListener("mouseleave",this.mouseLeaveHideSlider),this.elSlider.addEventListener("mouseenter",this.mouseOverShowSlider),this.elSlider.addEventListener("mouseleave",this.mouseLeaveHideSlider),this.elSliderRoot.addEventListener("click",this.onClick),this.elSliderPos.addEventListener("drag",this.onDrag),this.elSliderPos.addEventListener("dragend",this.onDragEnd),this.vhPlayer.on(it.Volumechange,this.onVolumechange,this)}onClick=t=>{this.changeVolume(t.layerY-this.height)};onMouseOverIcon=()=>{this.mouseOverShowSlider(),this.height||(this.height=this.elSliderRoot.clientHeight)};mouseOverShowSlider=()=>{this.vhPlayer.emit(it.UISingleDisplay,this.constructor.name),this.elSlider.classList.add("active"),this.timer&&clearTimeout(this.timer)};mouseLeaveHideSlider=()=>{this.timer&&clearTimeout(this.timer),this.timer=window.setTimeout((()=>{this.elSlider.classList.remove("active")}),1e3)};toggleMuted=()=>{this.vhPlayer.video.muted=!this.vhPlayer.video.muted};onVolumechange(){let t=this.vhPlayer.video.muted?0:this.vhPlayer.video.volume;this.elSliderVol.style.transform=`translateY(${100*(1-t)}%)`,this.elSliderPos.style.transform=`translateY(${70*-t}px)`,this.vhPlayer.video.muted?(this.elIcon.classList.add("icon-player-jingyin"),this.elIcon.classList.remove("icon-player-shengyin")):(this.elIcon.classList.remove("icon-player-jingyin"),this.elIcon.classList.add("icon-player-shengyin"))}onDrag=t=>{t.preventDefault(),0!==t.clientY&&this.changeLayout(t.layerY-2)};onDragEnd=t=>{t.preventDefault(),this.changeVolume(t.layerY-2)};changeVolume(t){let e=this.height;t>0?t=0:t<-e&&(t=-e);let i=(e+t)/e;this.vhPlayer.video.volume=1-i,this.vhPlayer.video.muted=1===i}changeLayout(t){let e=this.height;t>0?t=0:t<-e&&(t=-e),this.elSliderVol.style.transform=`translateY(${(e+t)/e*100}%)`,this.elSliderPos.style.transform=`translateY(${t}px)`}destroy(){}}class vs extends hs{elFsRoot;elIcon;constructor(t,e){super(t,e),this.init(),this.registerListeners()}init(){this.elFsRoot=N("div",{},{class:"ui-fullscreen-root"}),this.elFsRoot.innerHTML='\n<i class="iconfont-player icon-player-quanping1" title="全屏"></i>\n',this.elRoot.appendChild(this.elFsRoot),this.elIcon=this.elFsRoot.querySelector(".iconfont-player")}registerListeners(){this.elIcon.addEventListener("click",this.toggleFs),this.vhPlayer.on(it.FULLSCREEN_CHANGED,this.onFsChange,this)}toggleFs=()=>{this.vhPlayer.toggleFullscreen()};onFsChange(t){t?this.elIcon.classList.replace("icon-player-quanping1","icon-player-quanping"):this.elIcon.classList.replace("icon-player-quanping","icon-player-quanping1")}unRegisterListeners(){this.elIcon.removeEventListener("click",this.toggleFs),this.vhPlayer.off(it.FULLSCREEN_CHANGED)}destroy(){this.unRegisterListeners()}}!function(t){t.Vtt="vtt",t.Line="line",t.Quality="quality"}(ds||(ds={}));class bs extends hs{elSettingRoot;elIcon;elSettingContent;elSettingContent2;elContentVtt;elContentLine;elContentQuality;mapping={[ds.Vtt]:this.elContentVtt,[ds.Line]:this.elContentLine,[ds.Quality]:this.elContentQuality};timer1=-1;constructor(t,e){super(t,e),this.init(),this.registerListeners()}init(){this.elSettingRoot=N("div",{},{class:"ui-setting-root"}),this.elSettingRoot.innerHTML='\n<i class="iconfont-player icon-player-diandiandian" title="设置"></i>\n<ul class="setting-content"></ul>\n',this.elRoot.appendChild(this.elSettingRoot),this.elIcon=this.elSettingRoot.querySelector(".iconfont-player"),this.elSettingContent=this.elSettingRoot.querySelector(".setting-content")}registerListeners(){this.vhPlayer.on(it.SCHEDULER_COMPLETE,this.onScheduleComplete,this),this.vhPlayer.on(it.VTT_ADDED,this.addVttUI,this),this.vhPlayer.on(it.UISingleDisplay,this.onSingleDisplay,this),this.vhPlayer.on(it.DEFINITION_CHANGE,this.onQualityChange,this),this.vhPlayer.on(it.LINE_CHANGE,this.onLineChange,this),this.vhPlayer.on(it.VTT_SELECTED,this.onVttSelected,this),this.vhPlayer.on(it.VTT_CLOSED,this.onVttClosed,this),this.elIcon.addEventListener("click",this.onClick),this.elSettingContent.addEventListener("mouseleave",this.onContentMouseLeave)}onContentMouseLeave=()=>{this.timer1=window.setTimeout((()=>{this.hide()}),1e3)};bindMouseEvent(t){this.mapping[t].addEventListener("mouseenter",(()=>{this.timer1&&window.clearTimeout(this.timer1)})),this.mapping[t].addEventListener("mouseleave",(t=>{t.currentTarget.classList.remove("active")}))}showSelectedUI(t){for(let e of Object.keys(this.mapping))e===t?this.mapping[e].classList.add("active"):this.mapping[e]&&this.mapping[e].classList.remove("active")}showSelectedUI2(t,e){let i=this.mapping[t].querySelectorAll("li");for(let t of i)t.dataset.val===e?t.classList.add("active"):t.classList.remove("active")}onQualityChange(t){this.showSelectedUI2(ds.Quality,t.quality)}onLineChange(t){this.showSelectedUI2(ds.Line,t.line)}onVttSelected(t){this.showSelectedUI2(ds.Vtt,t.vtt)}onVttClosed(){this.showSelectedUI2(ds.Vtt,"")}onScheduleComplete(){let{scheduleOption:t}=this.vhPlayer.options;if(t.enable){let t=document.createElement("li"),e=document.createElement("li");t.textContent="线路",e.textContent="清晰度",t.addEventListener("click",(()=>{this.showSelectedUI(ds.Line)})),e.addEventListener("click",(()=>{this.showSelectedUI(ds.Quality)})),this.elSettingContent.appendChild(t),this.elSettingContent.appendChild(e),this.addLineUI(),this.addQualityUI()}}addLineUI(){this.elContentLine=N("ul",{},{class:"setting-content2 setting-content-line"}),this.elSettingRoot.appendChild(this.elContentLine),this.mapping.line=this.elContentLine,this.elSettingContent2=this.elSettingRoot.querySelectorAll(".setting-content2"),this.bindMouseEvent(ds.Line);let{lines:t,currentQualityCdnName:e,currentQualityLineName:i}=this.vhPlayer.def,{uiOptions:n}=this.vhPlayer.options;const r=!!n?.line&&n.line;let a=document.createDocumentFragment();for(let n of t){let t=document.createElement("li");t.textContent=r&&r[n]?r[n]:n,t.dataset.val=n,n===(e||i)&&t.classList.add("active"),t.addEventListener("click",(t=>{this.vhPlayer.switch(t.currentTarget.dataset.val),this.hide()})),a.appendChild(t)}this.elContentLine.appendChild(a)}addQualityUI(){this.elContentQuality=N("ul",{},{class:"setting-content2 setting-content-quality"}),this.elSettingRoot.appendChild(this.elContentQuality),this.mapping.quality=this.elContentQuality,this.elSettingContent2=this.elSettingRoot.querySelectorAll(".setting-content2"),this.bindMouseEvent(ds.Quality);let{qualities:t,currentQuality:e}=this.vhPlayer.def,{uiOptions:i}=this.vhPlayer.options;const n=!!i?.quality&&i.quality;let r=document.createDocumentFragment();for(let i of t){let t=document.createElement("li");t.textContent=n&&n[i]?n[i]:i,t.dataset.val=i,i===e&&t.classList.add("active"),t.addEventListener("click",(t=>{this.vhPlayer.setQuality(t.currentTarget.dataset.val),this.hide()})),r.appendChild(t)}this.elContentQuality.appendChild(r)}addVttUI(){let{vttOptions:t,type:e}=this.vhPlayer.options;if(t.enable&&"vod"===e){this.elContentVtt=N("ul",{},{class:"setting-content2 setting-content-vtt"}),this.elSettingRoot.appendChild(this.elContentVtt),this.mapping.vtt=this.elContentVtt,this.elSettingContent2=this.elSettingRoot.querySelectorAll(".setting-content2"),this.bindMouseEvent(ds.Vtt);let e=document.createElement("li");e.textContent="字幕",e.addEventListener("click",(()=>{this.showSelectedUI(ds.Vtt)})),this.elSettingContent.appendChild(e);let i=document.createElement("li");i.textContent="关闭",i.dataset.val="",i.addEventListener("click",(()=>{this.vhPlayer.closeVtt(),this.hide()})),this.elContentVtt.appendChild(i);let n=document.createDocumentFragment();for(let e of t.tracks){let t=document.createElement("li");t.textContent=e.label||e.srclang,t.dataset.val=e.srclang,e.default&&t.classList.add("active"),t.addEventListener("click",(()=>{this.vhPlayer.selectVtt(e.srclang),this.hide()})),n.appendChild(t)}this.elContentVtt.appendChild(n)}}onClick=()=>{this.elSettingContent.classList.contains("active")?this.hide():(this.vhPlayer.emit(it.UISingleDisplay,this.constructor.name),this.elSettingContent.classList.add("active"))};onSingleDisplay(t){t!==this.constructor.name&&this.hide()}hide(){this.elSettingContent.classList.remove("active"),this.elSettingContent2.forEach((t=>t.classList.remove("active")))}destroy(){}}Ya('@font-face {\n  font-family: "iconfont-player"; /* Project id 2982367 */\n  src: url(\'//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.eot?t=1644487605199\'); /* IE9 */\n  src: url(\'//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.eot?t=1644487605199#iefix\') format(\'embedded-opentype\'), /* IE6-IE8 */\n  url(\'//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.woff2?t=1644487605199\') format(\'woff2\'),\n  url(\'//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.woff?t=1644487605199\') format(\'woff\'),\n  url(\'//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.ttf?t=1644487605199\') format(\'truetype\'),\n  url(\'//at.alicdn.com/t/font_2982367_7hc2i5lgn5u.svg?t=1644487605199#iconfont-player\') format(\'svg\');\n}\n\n.iconfont-player {\n  font-family: "iconfont-player" !important;\n  font-size: 18px;\n  font-style: normal;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.icon-player-Loading:before {\n  content: "\\e65d";\n}\n\n.icon-player-danmukaiqi:before {\n  content: "\\e613";\n}\n\n.icon-player-danmuguanbi:before {\n  content: "\\e614";\n}\n\n.icon-player-reload:before {\n  content: "\\e602";\n}\n\n.icon-player-diandiandian:before {\n  content: "\\e8f5";\n}\n\n.icon-player-bofang:before {\n  content: "\\e61c";\n}\n\n.icon-player-bofangzanting:before {\n  content: "\\e61d";\n}\n\n.icon-player-jingyin:before {\n  content: "\\e61e";\n}\n\n.icon-player-shengyin:before {\n  content: "\\e62c";\n}\n\n.icon-player-quanping:before {\n  content: "\\e646";\n}\n\n.icon-player-quanping1:before {\n  content: "\\e672";\n}\n');Ya("@supports ((--a: 0)) {\n  .player-loading-wrapper,\n  .player-control-wrapper {\n    --colorMain: #3967FF;\n    --colorBg: rgba(0,0,0,.8);\n    --colorBgBar: #eee;\n    --colorFont: #fff;\n    --colorPoint: #fff;\n    --colorSuccess: #54b946;\n    --margin: 12px;\n    --padding: 8px;\n    --paddingVol: 10px;\n    --borderRadius: 4px;\n  }\n}\n\n.player-loading-wrapper,\n.player-control-wrapper{\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 5;\n}\n.player-loading-wrapper{\n  top: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.player-loading-wrapper.hide{\n  display: none;\n}\n.player-control-wrapper{\n  font-size: 14px;\n  color: var(--colorFont);\n  background: linear-gradient(0deg, black, transparent);\n  display: none;\n  user-select: none;\n}\n.player-control-wrapper.active{\n  display: block;\n}\n.player-control-wrapper *{\n  box-sizing: content-box !important;\n}\n.player-control-wrapper .hide{\n  display: none;\n}\n.player-control-wrapper ul{\n  margin: 0;\n  padding: 4px var(--padding);\n  position: absolute;\n  z-index: 9;\n  list-style: none;\n  border-radius: var(--borderRadius);\n  background-color: var(--colorBg);\n}\n.player-control-wrapper ul.active{\n  display: block;\n}\n.player-control-wrapper li{\n  line-height: 1.6;\n  cursor: pointer;\n}\n.player-control-wrapper li.active{\n  color: var(--colorMain);\n}\n.player-control-wrapper.is-live .tools-wrapper{\n  padding: var(--padding);\n}\n.player-control-wrapper .tools-wrapper{\n  padding: 0 var(--padding) 2px;\n  justify-content: space-between;\n}\n.player-control-wrapper .bar-wrapper{\n  flex: 1;\n  margin: 0 8px;\n  padding: 8px 0;\n  overflow: hidden;\n}\n.player-control-wrapper .tools-wrapper,\n.player-control-wrapper .tools-wrapper-left,\n.player-control-wrapper .tools-wrapper-right{\n  display: flex;\n  align-items: center;\n}\n.icon-player-bofang,\n.icon-player-bofangzanting,\n.icon-player-shengyin,\n.icon-player-jingyin{\n  font-weight: bold;\n}\n.icon-player-Loading{\n  font-size: 28px;\n  color: var(--colorMain);\n  animation: loading-circle 1.3s linear infinite;\n}\n.icon-player-danmukaiqi,\n.icon-player-danmuguanbi{\n  font-size: 24px;\n}\n.icon-player-danmukaiqi{\n  color: var(--colorSuccess);\n}\n\n\n/*play*/\n.player-control-wrapper .ui-reload-root,\n.player-control-wrapper .ui-play-root,\n.player-control-wrapper .ui-barrage-root,\n.player-control-wrapper .ui-volume-root,\n.player-control-wrapper .ui-fullscreen-root{\n  margin-right: var(--margin);\n}\n\n/*duration*/\n.player-control-wrapper .ui-duration-root{\n  min-width: 94px;\n}\n\n/*bar*/\n.player-control-wrapper .bar-root{\n  height: 4px;\n  position: relative;\n  background-color: var(--colorBgBar);\n  cursor: pointer;\n}\n.player-control-wrapper .bar-root .bar{\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  transform: translateX(-100%); /*-100 ～ 0*/\n}\n.player-control-wrapper .bar-root .pos{\n  position: absolute;\n  top: 50%;\n  left: -8px;\n  z-index: 8;\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  background-color: var(--colorPoint);\n  border: 4px solid var(--colorMain);\n  transform: translate(0, -50%);\n}\n.player-control-wrapper .bar-root .bar.bar-current{\n  background-color: var(--colorMain);\n  z-index: 7;\n}\n.player-control-wrapper .bar-root .bar.bar-buffered{\n  background-color: #999;\n  z-index: 6;\n}\n\n/*volume*/\n.player-control-wrapper .ui-volume-root{\n  position: relative;\n}\n.player-control-wrapper .volume-slider,\n.player-control-wrapper .slider-root{\n  position: absolute;\n  width: 4px;\n}\n.player-control-wrapper .volume-slider{\n  padding: var(--paddingVol);\n  left: 0;\n  bottom: 26px;\n  z-index: 9;\n  height: 70px;\n  display: none;\n  border-radius: var(--borderRadius);\n  background-color: var(--colorBg);\n}\n.player-control-wrapper .volume-slider.active{\n  display: block;\n}\n.player-control-wrapper .slider-root{\n  left: var(--paddingVol);\n  top: var(--paddingVol);\n  bottom: var(--paddingVol);\n  border-radius: var(--borderRadius);\n  overflow: hidden;\n  cursor: pointer;\n  background-color: var(--colorBgBar);\n}\n.player-control-wrapper .slider-root .slider{\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  transform: translateY(100%); /*100 ～ 0*/\n  background-color: var(--colorMain);\n}\n.player-control-wrapper .volume-slider .pos{\n  position: absolute;\n  left: calc(var(--paddingVol) - 2px);\n  bottom: calc(var(--paddingVol) - 4px);\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  transform: translateY(0px); /*0 ~ -70*/\n  cursor: pointer;\n  background-color: var(--colorPoint);\n}\n\n/*设置*/\n.player-control-wrapper .ui-setting-root{\n  position: relative;\n}\n.player-control-wrapper .setting-content2,\n.player-control-wrapper .setting-content{\n  bottom: 26px;\n  text-align: center;\n  display: none;\n}\n.player-control-wrapper .setting-content{\n  right: 0;\n  width: 50px;\n}\n.player-control-wrapper .setting-content2{\n  right: 68px;\n  width: 66px;\n}\n\n/*字幕*/\nvideo::cue{\n  color: #fff;\n  background: none;\n  text-shadow: 0 1px #000, 1px 0 #000, -1px 0 #000, 0 -1px #000;\n}\n\n/*loading animation*/\n@keyframes loading-circle {\n  from{\n    transform: rotateZ(0);\n  }\n  to{\n    transform: rotateZ(360deg);\n  }\n}\n\n/*解决bug：移动端展示hover样式*/\n@media (any-hover: hover) {\n  .iconfont-player:hover{\n    color: var(--colorMain);\n    cursor: pointer;\n  }\n  .player-control-wrapper li:hover{\n    color: var(--colorMain);\n  }\n}\n");class ws{player;static pluginName="timeShift";static TENCENT_DELAY=90;constructor(t){this.player=t,this.init()}init(){let{type:t}=this.player.options;"vod"!==t?this.player.playerType===J.Hls?(this.player.handleTimeShift=this.handleTimeShift.bind(this),this.registerListeners()):ht.warn(`TimeShift - 直播时移只支持hls，当前播放器类型：${this.player.playerType}`):ht.warn("TimeShift - 点播活动不运行直播时移")}registerListeners(){this.player.on(it.SCHEDULER_COMPLETE,this.onScheduleComplete,this)}handleTimeShift(t=0){if(this.player.cdnName!==et.TX)return void ht.warn(`TimeShift - 直播时移只支持腾讯线路，当前线路：${this.player.cdnName}`);t=t<ws.TENCENT_DELAY?ws.TENCENT_DELAY:Math.round(t);let e=(this.player.vPlayer.url||this.player.vPlayer.cacheUrl).split("?")[0]+this.creatTencentTimeShiftUrl(t);this.player.load(e),this.player.emit(it.LIVE_TIMESHIFT,{delay:t,url:e})}onScheduleComplete(t){t.timeShift&&this.player.load(`${t.url}&delay=${ws.TENCENT_DELAY}`)}creatAliyunTimeShiftUrl(t){return`?aliyunols=on&lhs_start_human_s_8=${t}`}creatTencentTimeShiftUrl(t){let{def:e}=this.player;return Ja.refreshToken(e),`?delay=${t}&token=${e.tokenStr}`}destroy(){}}return Qa.use(class{player;static pluginName="schedule";constructor(t){this.player=t;let{scheduleOption:e}=this.player.options;e.enable&&this.init()}init(){"live"===this.player.options.type?new ns(this.player):new is(this.player),this.player.setQuality=this.setQuality.bind(this)}setQuality(t){let{def:e}=this.player;if(!e.qualities)return void ht.warn("Scheduler setQuality - 没有获取到可用清晰度");if(!e.qualities.includes(t))return void ht.warn(`Scheduler setQuality - 清晰度参数不可用-${t}；可设置清晰度：${e.qualities.join()}`);e.currentQuality=t,e.currentQualityLines=e.allQuality[t];let i=e.currentQualityLines.find((t=>t.line===e.currentQualityLineName));e.currentQualityUrl=i[e.key],Ja.refreshToken(e),this.player.emit(it.DEFINITION_CHANGE,{url:e.currentQualityUrl+"?token="+e.tokenStr,quality:t})}destroy(){}}),Qa.use(class{player;static pluginName="fullscreen";fsChangeHandler;constructor(t){this.player=t,this.fsChangeHandler=()=>{this.player.emit(it.FULLSCREEN_CHANGED,null!==ss.element)},this.init()}init(){ss.isEnabled?(this.player.enterFullscreen=ss.request.bind(ss,this.player.root),this.player.exitFullscreen=ss.exit,this.defineProperty(ss),this.player.toggleFullscreen=ss.toggle.bind(ss,this.player.root)):os.isEnabled(this.player.video)&&(this.player.enterFullscreen=os.request.bind(os,this.player.video),this.player.exitFullscreen=os.exit.bind(os,this.player.video),this.defineProperty(os),this.player.toggleFullscreen=os.toggle.bind(os,this.player.video)),ss.on("change",this.fsChangeHandler)}defineProperty(t){Object.defineProperty(this.player,"isFullscreen",{get:()=>t.isFullscreen})}destroy(){ss.off("change",this.fsChangeHandler)}}),Qa.use(class{player;static pluginName="switcher";lagTimes=0;constructor(t){this.player=t,this.init()}init(){let{switchOption:t,type:e}=this.player.options;t.enable?(this.player.switch=this.switch.bind(this),"vod"!==e?this.registerListeners():ht.warn("Switcher 点播不运行卡顿切线")):ht.warn("Switcher 未开启切线功能")}registerListeners(){this.player.on(it.LAG_REPORT,this.lag,this),this.player.on(it.LAG_RECOVER,this.lagRecover,this)}lag(t){ht.warn("Switcher LAG_REPORT",t),this.lagTimes+=1,this.lagTimes>=3&&(ht.info("Switcher 开始卡顿切线"),this.lagTimes=0,this.switch())}lagRecover(t){ht.info("Switcher LAG_RECOVER",t),this.lagTimes=0}switch(t){let{def:e}=this.player,i=e.currentQualityCdnName||e.currentQualityLineName;if(t&&t===i)return void ht.warn("Switcher switch - 切线被忽略, 切换到了相同线路");let n=t?this.findLine(e.currentQualityLines,t):this.getNextLine(e.currentQualityLines,i);n?(e.currentQualityUrl=n[e.key],e.currentQualityCdnName=n.cdn_name,e.currentQualityLineName=n.line,Ja.refreshToken(e),this.player.emit(it.LINE_CHANGE,{url:e.currentQualityUrl+"?token="+e.tokenStr,line:n.cdn_name||n.line,isReload:(n.cdn_name||n.line)===i})):ht.warn("Switcher switch - 切线被忽略, 线路未找到")}openLiveSubtitle(){}closeLiveSubtitle(){}getNextLine(t,e){let i=t.findIndex((t=>t.line===e))+1;return i>=t.length&&(i=0),t[i]}findLine(t,e){return t.find((t=>(t.cdn_name||t.line)===e))}destroy(){this.player.off(it.LAG_REPORT),this.player.off(it.LAG_RECOVER)}}),Qa.use(class{player;static pluginName="pursue";pursueConfig;isPursuing=!1;_onTimeupdate;constructor(t){this.player=t,this.init()}init(){let{scheduleOption:t,pursueOption:e,type:i}=this.player.options;if(!e.enable)return void ht.warn("Pursue - 未开启追播功能");if("vod"===i)return void ht.warn("Pursue - 点播不运行追播策略");let{playerType:n}=this.player;1!=+t.playerData.live_type||n!==J.Hls?n!==J.Flash?n!==J.HlsNative?(this.pursueConfig=e[n],ht.info("Pursue 开启追播策略",this.pursueConfig),this.registerListeners()):ht.warn("Pursue - 播放原生m3u8时，不运行追播策略"):ht.warn("Pursue - flash不运行追播策略"):ht.warn("Pursue - 时移直播不运行追播策略")}registerListeners(){this._onTimeupdate=U(this.onTimeupdate.bind(this),1e3),this.player.video.addEventListener("timeupdate",this._onTimeupdate)}unRegisterListeners(){this.player.video.removeEventListener("timeupdate",this._onTimeupdate)}onTimeupdate(){let t=this.player.bufferedMax,e=t-this.player.currentTime,{bufferPursue:i,bufferSeek:n,bufferStop:r,pursueSpeed:a,mode:s}=this.pursueConfig;if(e>i||this.isPursuing&&e>r)switch(s){case"pursue":e>n?this.jumpTo(t-r):this.run(a);break;case"seek":this.jumpTo(t-r);break;default:ht.warn(`Pursue 追播类型配置错误，只支持 pursue、seek，配置为 ${s}`)}else this.walk()}jumpTo(t){t<=0||(ht.info("Pursue jumpTo",t),this.player.currentTime=t,this.player.playbackRate=1,this.isPursuing=!1)}run(t){this.isPursuing||t<1||(ht.info("Pursue run speed",t),this.player.playbackRate=t,this.isPursuing=!0)}walk(){this.player.playbackRate=1,this.isPursuing=!1}destroy(){this.unRegisterListeners()}}),Qa.use(class{player;static pluginName="replay";pauseTime=0;firstTime=0;constructor(t){this.player=t,this.init()}init(){let{type:t}=this.player.options;"vod"!==t?this.registerListeners():ht.warn("Replay - 点播不运行暂停恢复逻辑")}registerListeners(){this.player.on(it.Play,this.onPlay,this),this.player.on(it.Pause,this.onPause,this),this.player.on(it.Loaded,this.onLoaded,this),this.player.on(it.LINE_CHANGE,this.onLineChange,this)}onLineChange(){this.pauseTime=0,this.firstTime=0}onPlay(){this.pauseTime?this.handleReplay((performance.now()-this.pauseTime)/1e3):this.onFirstPlay()}handleReplay(t){ht.info("Replay 暂停时长",t);let e=this.player.bufferedMax,{scheduleOption:i,liveOption:n}=this.player.options,r=1==+i.playerData.live_type;if(n.type===J.Hls&&r&&this.player.cdnName===et.TX)isFinite(e)&&e>=this.player.currentTime+t?ht.info("Replay - 时移直播暂停恢复(短暂停)，从暂停处接着播放"):ht.info("Replay - 时移直播暂停恢复(长暂停)，定位到最新进度");else{if(n.type===J.Flash)return void this.player.reload();ht.info("Replay - 直播暂停恢复，跳到最新"),this.player.currentTime=this.player.currentTime+t}}onFirstPlay(){if(ht.info("Replay - 直播开始时，定位到最新进度"),this.firstTime)this.handleReplay((performance.now()-this.firstTime)/1e3);else{let{pursueOption:t}=this.player.options,e=t[this.player.playerType],i=this.player.bufferedMax-e.bufferStop;i>0&&(this.player.currentTime=this.player.currentTime+i)}}onLoaded(){this.player.playerType===J.Hls&&(this.firstTime=performance.now())}onPause(){this.pauseTime=performance.now()}destroy(){}}),Qa.use(class{player;static pluginName="lag";lastCurrentTime=0;lagTimes=0;lagBeginTime=0;detectInterval=0;gapDetectTime=500;gapEmitTime=3e3;gapEmitLagTimes;constructor(t){this.player=t,this.init(),this.gapEmitLagTimes=this.gapEmitTime/this.gapDetectTime}init(){this.registerListeners()}registerListeners(){this.player.on(it.Play,this.startDetect,this),this.player.on(it.Pause,this.stopDetect,this),this.player.on(it.Ended,this.stopDetect,this),this.player.on(it.Error,this.onError,this),this.player.on(it.Stalled,this.onError,this),this.player.on(it.LINE_CHANGE,this.stopDetect,this),this.player.on(it.PULL_STREAM_FAILED,this.stopDetect,this)}onError(t){t&&t.target&&"stalled"===t.type||this.startDetect()}startDetect(){this.detectInterval||(ht.info("Lag - 开始卡顿检测..."),this.detectInterval=window.setInterval((()=>{this.checkLag(this.player.currentTime),this.lagTimes&&this.lagTimes%this.gapEmitLagTimes==0?this.player.emit(it.LAG_REPORT,{times:this.lagTimes,beginTime:this.lagBeginTime}):!this.lagTimes&&this.lagBeginTime&&(this.player.emit(it.LAG_RECOVER,{lastTime:Date.now()-this.lagBeginTime}),this.lagBeginTime=0)}),this.gapDetectTime))}stopDetect(){ht.info("Lag - 停止卡顿检测"),clearInterval(this.detectInterval),this.detectInterval=0,this.lagTimes=0,this.lagBeginTime=0,this.lastCurrentTime=0}checkLag(t){this.lastCurrentTime===t?(this.lagTimes+=1,this.lagBeginTime||(this.lagBeginTime=Date.now()-this.gapDetectTime)):(this.lastCurrentTime=t,this.lagTimes=0)}destroy(){clearInterval(this.detectInterval),this.detectInterval=0,this.lagTimes=0,this.lagBeginTime=0,this.lastCurrentTime=0}}),Qa.use(class{player;static pluginName="barrage";cssTransition;elRoot;elBarrageRoot;rootWidth=0;rootHeight=0;tracksSize=30;renderTopPosition=0;renderBottomPosition=0;tracker=[];renderQueue=[];renderTimer=0;renderSuccessCount=0;renderAborted=!1;renderDelay=150;opened=!0;constructor(t){this.player=t,this.init()}init(){let{videoNode:t,barrageOption:e}=this.player.options;if(!e.enable)return void ht.warn("Barrage - 未开启弹幕功能");this.opened=e.defaultOpen??!0;let i=V();!1!==i?(this.cssTransition=i,this.elRoot=M("#"+t),this.elBarrageRoot=N("div",{},{class:"barrage-root"}),this.elRoot.appendChild(this.elBarrageRoot),this.registerListeners(),this.player.addBarrage=this.addBarrage.bind(this),this.player.clearBarrage=this.clearBarrage.bind(this),this.player.openBarrage=this.open.bind(this),this.player.closeBarrage=this.close.bind(this)):ht.warn("Barrage - not support css3 transition")}registerListeners(){this.player.on(it.Ended,this.clearBarrage,this),this.player.on(it.UIResize,this.resize,this),H(null,(()=>{this.clearBarrage()}))}open(){this.opened=!0,this.player.emit(it.OPEN_BARRAGE)}close(){this.opened=!1,this.player.emit(it.CLOSE_BARRAGE),this.clearBarrage()}addBarrage(t,e={}){this.opened?this.tracker.length?(this.renderQueue.push({id:ls.create(),msg:this.filterContent(t),style:{...this.player.options.barrageOption.style,...e},width:0,totalDistance:0,rollSpeed:this.player.options.barrageOption.speed,rollTime:0,useTracks:0,tracks:[]}),this.renderTimer||this.render()):ht.warn("Barrage addBarrage - 添加弹幕失败，轨道数量为0"):ht.warn("Barrage addBarrage - 添加弹幕失败，弹幕未开启")}render(){try{this.renderToDom()}finally{this.renderEnd()}}renderToDom(){if(this.renderQueue.length){const t=this.renderQueue[0];let e=t.node;if(!e){t.node=e=N("div",{},{class:"barrage-item"}),e.innerHTML=t.msg;for(let i of Object.keys(t.style))e.style[i]=t.style[i]}if(this.elBarrageRoot.appendChild(e),t.useTracks=Math.ceil(e.offsetHeight/this.tracksSize),t.useTracks>this.tracker.length)return ht.warn("Barrage renderToDom - 弹幕占用高度过高，丢弃"),this.renderQueue.shift(),void this.elBarrageRoot.removeChild(e);t.width=e.offsetWidth,t.totalDistance=e.offsetWidth+this.rootWidth,t.rollTime=t.totalDistance/t.rollSpeed,this.addToTracks(t),t.tracks.length?(this.renderSuccessCount++,this.renderAborted=!1,this.renderQueue.shift(),e.setAttribute("data-y",t.tracks[0]+""),e.setAttribute("data-id",t.id),e.style.top=`${t.tracks[0]*this.tracksSize+this.renderTopPosition}px`,e.style[this.cssTransition.css]=`transform ${t.rollTime}s linear`,e.style.transform=`translate3d(-${t.totalDistance}px, 0, 0)`,e.addEventListener(this.cssTransition.event,(()=>{this.removeFromTracker(t.tracks,t.id),this.elBarrageRoot.removeChild(e)}),!1)):(this.renderAborted=!0,this.elBarrageRoot.removeChild(e))}}renderEnd(){this.renderQueue.length?(this.adaptRenderDelay(),this.renderTimer=window.setTimeout((()=>{this.render()}),this.renderDelay)):this.renderTimer=0}adaptRenderDelay(){this.renderAborted?(this.renderDelay+=40,this.renderSuccessCount=0):this.renderSuccessCount>10&&(this.renderDelay-=50,this.renderSuccessCount=0)}addToTracks(t){let e,i,n=[];for(let r=0;r<this.tracker.length;r++)if(e=this.tracker[r],e.length?(i=e[e.length-1],-z(i.node)>i.width?n.push(r):n=[]):n.push(r),n.length>=t.useTracks){t.tracks=n,n.forEach((e=>{this.tracker[e].push(t)}));break}}removeFromTracker(t,e){for(let i of t){const t=this.tracker[i];if(!t)continue;let n=0,r=t.length;for(;n<r;n++)if(t[n].id===e){t.splice(n,1);break}}}filterContent(t){return t&&t.replace(/<(?!img).*?>/gi,"")}clearBarrage(){this.eachNode((t=>{t.remove()})),this.tracker.forEach((t=>[])),this.renderQueue=[],this.player.emit(it.CLEAR_BARRAGE)}computedTracks(){let{positionRange:t}=this.player.options.barrageOption;this.player.isFullscreen?(this.renderTopPosition=window.innerHeight*t[0],this.renderBottomPosition=window.innerHeight*t[1]):(this.renderTopPosition=this.rootHeight*t[0],this.renderBottomPosition=this.rootHeight*t[1]);let e=this.renderBottomPosition-this.renderTopPosition;const i=Math.floor(e/this.tracksSize);this.tracker=new Array(i);for(let t=0;t<i;t++)this.tracker[t]=[];ht.info("Barrage computedTracks",i)}resize(){ht.info("Barrage resize"),this.rootWidth=this.elRoot.clientWidth,this.rootHeight=this.elRoot.clientHeight,this.clearBarrage(),this.computedTracks()}eachNode(t){let e,i,n=this.elBarrageRoot.firstChild;for(;n;)1===n.nodeType&&(i=n.getAttribute("data-y"),e=n.getAttribute("data-id"),i&&e&&t(n,+i,e)),n=n.nextSibling}destroy(){this.clearBarrage(),this.elBarrageRoot?.remove()}}),Qa.use(class{player;static pluginName="marquee";cssTransition;elRoot;elMarqueeRoot;timer=0;constructor(t){this.player=t,this.init()}init(){let{videoNode:t,marqueeOption:e}=this.player.options;if(!e.enable)return void ht.warn("Marquee - 未开启跑马灯功能");let i=V();!1!==i?(this.cssTransition=i,this.elRoot=M("#"+t),this.elMarqueeRoot=N("div",{},{class:"marquee-root"}),this.elRoot.appendChild(this.elMarqueeRoot),this.registerListeners(),this.createMarquee()):ht.warn("Marquee - not support css3 transition")}registerListeners(){H((()=>{this.timer||this.createMarquee()}),(()=>{this.destroy()}))}createMarquee(){let{type:t=0,interval:e=5}=this.player.options.marqueeOption;this.timer=window.setInterval(this.createMarqueeItem,1e3*e,t),this.createMarqueeItem(t)}createMarqueeItem=t=>{if(1===t){const t=this.elMarqueeRoot.querySelector(".marquee");t&&t.remove()}else if(!this.checkPosition())return!1;let{text:e,position:i=1,duration:n=6,alpha:r,fontSize:a,fontColor:s,height:o}=this.player.options.marqueeOption;if(!e)return void ht.warn("Marquee - 未提供配置：text");let l=N("div",{innerHTML:e},{class:"marquee",style:(r?`opacity: ${r/100};`:"")+(a?`font-size: ${a}px;`:"")+(s?`color: ${s};`:"")+(o?`line-height: ${o}px;`:"")});this.elMarqueeRoot.appendChild(l);const d=this.elMarqueeRoot.offsetWidth,h=this.elMarqueeRoot.offsetHeight,u=l.offsetWidth,c=l.offsetHeight,p={1:1,2:"20%",3:"50%",4:"80%"};switch(i){case 1:if(0===t){const t=.2*h,e=Math.floor(.6*h/c);let i=[t];for(let t=1;t<=e;t+=1)i.push(i[t-1]+c);let n=Math.floor(Math.random()*i.length);l.style.top=`${i[n]}px`}else.2*h>=c/2?(l.style.top=60*Math.random()+20+"%",l.style.transform="translateY(-50%)"):l.style.top=Math.random()*(h-c)+"px";break;case 2:.2*h>=c/2?(l.style.top=p[i],l.style.transform="translateY(-50%)"):l.style.top="0%";break;case 3:l.style.top=p[i],l.style.transform="translateY(-50%)";break;case 4:.2*h>=c/2?(l.style.top=p[i],l.style.transform="translateY(-50%)"):l.style.bottom="0%"}if(0===t)l.style.left="100%",l.style[this.cssTransition.css]=`transform ${n}s linear`,this._stepMoveCss3({label:l,textWidth:u,rootWidth:d});else{const t=d&&u&&(d-u)/d*100,e=t&&Math.random()*t;l.style.left=`${e}%`}};_stepMoveCss3(t){t.label.addEventListener(this.cssTransition.event,(()=>{t.label.remove()})),t.label.style.transform=`translate(-${t.textWidth+t.rootWidth}px, -50%)`}checkPosition(){const t=this.elMarqueeRoot.querySelectorAll(".marquee");for(let e=0;e<t.length;e+=1){if(0===z(t[e]))return!1}return!0}destroy(){let{marqueeOption:t}=this.player.options;if(!t.enable)return;clearInterval(this.timer),this.timer=0;const e=this.elMarqueeRoot.querySelectorAll(".marquee");let i=0,n=e.length;for(;i<n;i++)e[i].remove();this.elMarqueeRoot?.remove()}}),Qa.use(class{player;static pluginName="watermark";elRoot;elWatermarkRoot;mutationObserver;timer=0;constructor(t){this.player=t,this.init()}init(){let{videoNode:t,watermarkOption:e}=this.player.options;e.enable?(this.elRoot=M("#"+t),this.elWatermarkRoot=N("div",{},{class:"watermark-root",style:"position: absolute; left: 0; right: 0; top: 0; bottom: 0; z-index: 3; overflow: hidden;"}),this.elRoot.appendChild(this.elWatermarkRoot),this.createWatermark(),this.registerListeners()):ht.warn("Marquee - 未开启水印功能")}createWatermark(){let t=N("div",{},{});t.innerText="测试水印",this.elWatermarkRoot.appendChild(t)}registerListeners(){let t=this.player;this.mutationObserver=new MutationObserver((function(e,i){console.warn("请勿触碰水印",e),t.destroy()})),this.mutationObserver.observe(this.elWatermarkRoot,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.timer=window.setInterval((()=>{this.elRoot.querySelector(".watermark-root")||(console.warn("请勿触碰水印"),t.destroy())}),3e3)}destroy(){let{watermarkOption:t}=this.player.options;t.enable&&(this.mutationObserver&&this.mutationObserver.disconnect(),clearInterval(this.timer),this.timer=0,this.elWatermarkRoot?.remove())}}),Qa.use(class{player;static pluginName="capture";elCanvas;constructor(t){this.player=t,this.init()}init(){this.player.capture=this.capture.bind(this)}capture(){this.elCanvas||(this.elCanvas=document.createElement("canvas"));let t=this.player.video;this.elCanvas.width=t.videoWidth,this.elCanvas.height=t.videoHeight;let e=this.elCanvas.getContext("2d");return e?.drawImage(t,0,0),this.elCanvas.toDataURL("image/jpeg")}destroy(){}}),Qa.use(class{player;static pluginName="UI";elRoot;elLoadingWrapper;elControlWrapper;constructor(t){this.player=t,this.init()}init(){let{videoNode:t,scheduleOption:e,vttOptions:i,type:n,controls:r}=this.player.options;if("custom"!==r)return void ht.warn("UI - 未开启自定义控制栏");this.elRoot=M("#"+t),this.elControlWrapper=N("div",{},{class:"player-control-wrapper active "+("live"===n?"is-live":"")}),this.elLoadingWrapper=N("div",{},{class:"player-loading-wrapper hide"}),this.elLoadingWrapper.innerHTML='\n      <i class="iconfont-player icon-player-Loading"></i>\n    ',this.elControlWrapper.innerHTML='\n      <div class="bar-wrapper"></div>\n      <div class="tools-wrapper">\n        <div class="tools-wrapper-left"></div>\n        <div class="tools-wrapper-right"></div>\n      </div>',this.elRoot.appendChild(this.elLoadingWrapper),this.elRoot.appendChild(this.elControlWrapper);let a=this.elRoot.querySelector(".tools-wrapper-left"),s=this.elRoot.querySelector(".tools-wrapper-right"),o=this.elRoot.querySelector(".bar-wrapper");new ps(a,this.player),"live"===n&&new fs(a,this.player),"vod"===n?(new us(o,this.player),new gs(a,this.player)):1===e.playerData.live_type?new cs(o,this.player):o.remove(),new ms(s,this.player),"pc"===O.platform&&new ys(s,this.player),new vs(s,this.player),(e.enable||i.enable&&"vod"===n)&&new bs(s,this.player),this.player.openUI=this.openUI.bind(this),this.player.hideUI=this.hideUI.bind(this),this.registerListeners()}registerListeners(){this.elRoot.addEventListener("click",this.toggleShow),this.player.on(it.Waiting,(()=>{this.elLoadingWrapper.classList.remove("hide")})),this.player.on(it.Canplay,(()=>{this.elLoadingWrapper.classList.add("hide")}))}toggleShow=t=>{if(this.elControlWrapper.classList.contains("active")){let e=0,i=t.target;for(;e<6&&i&&i!==this.elControlWrapper;)i=i.parentNode,e+=1;i!==this.elControlWrapper&&this.elControlWrapper.classList.remove("active")}else this.elControlWrapper.classList.add("active")};openUI(){this.elControlWrapper.classList.add("active")}hideUI(){this.elControlWrapper.classList.remove("active")}destroy(){this.elControlWrapper?.remove()}}),Qa.use(class{player;static pluginName="Vtt";constructor(t){this.player=t,this.init()}init(){let{vttOptions:t,type:e}=this.player.options;"live"!==e?t.enable?t.tracks?.length?(this.loadTracks(),this.player.selectVtt=this.selectVtt.bind(this),this.player.closeVtt=this.closeVtt.bind(this)):ht.warn("Vtt - 字幕列表为空"):ht.warn("Vtt - 未开启字幕"):ht.warn("Vtt - 暂不支持对直播添加字幕")}loadTracks(){for(let t of this.player.options.vttOptions.tracks)this.addTracks(t);this.player.emit(it.VTT_ADDED)}selectVtt(t){for(let e of this.player.video.textTracks)e.language===t?(e.mode="showing",this.player.emit(it.VTT_SELECTED,{vtt:t})):e.mode="hidden"}closeVtt(){for(let t of this.player.video.textTracks)t.mode="hidden";this.player.emit(it.VTT_CLOSED)}addTracks(t){let e=N("track",{},{label:t.label||t.srclang,kind:t.kind,srclang:t.srclang,src:t.src});e.default=!0===t.default,this.player.video.appendChild(e)}destroy(){}}),Qa.use(ws),Qa}(flvjs,Hls,dashjs);
